window.CustomPlayer=(function(){function l(G,H){var F=new RegExp("(^|\\s)"+H+"(\\s|$)","g");if(F.test(G.className)){return}G.className=(G.className+" "+H).replace(/\s+/g," ").replace(/(^ | $)/g,"")}function o(G,H){var F=new RegExp("(^|\\s)"+H+"(\\s|$)","g");G.className=G.className.replace(F,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function c(G,H){var F=new RegExp("(^|\\s)"+H+"(\\s|$)","g");return F.test(G.className)}function A(H,G){if(H){for(var F=0;F<H.length;F++){if(G(H[F])===false){break}}}}function n(H){var G=[];for(var F in H){if(H.hasOwnProperty(F)){G.push(F)}}return G}function v(F){return typeof F==="object"&&F!==null&&F.constructor===Object}function E(F){return F?(v(F)?n(F).length==0:F.length==0):true}function t(G,F){A(n(F),function(H){if(v(G[H])&&v(F[H])&&!E(G[H])){t(G[H],F[H])}else{if(typeof G[H]!=="undefined"){G[H]=F[H]}}});return G}function y(G,F){A(n(F),function(H){if(v(G[H])&&v(F[H])&&!E(G[H])){y(G[H],F[H])}else{G[H]=F[H]}});return G}function D(H,G){for(var F=0;F<H.length;F++){if(!G(H[F])){return false}}return true}function j(M,K,J,I){if(K instanceof Array){for(var G=0;G<K.length;G++){j(M,K[G],J,I)}}else{var L=K.split(".")[0];var F=K.split(".")[1]||null;var H=function(N){if(J.call(I?I:M,N)===false){N.stopPropagation();N.preventDefault()}};if(!M.__events){M.__events={}}M.__events=M.__events||{};M.__events[L]=M.__events[L]||[];M.__events[L].push({tag:F,handler:H});M.addEventListener(L,H,false)}}function C(K,I){if(I instanceof Array){for(var H=0;H<I.length;H++){C(K,I[H])}}else{var J=I.split(".")[0];var F=I.split(".")[1]||null;var G=K.__events[J];for(var H=0;H<G.length;H++){if(G[H]&&(F===null||G[H].tag==F)){K.removeEventListener(J,G[H].handler,false);G[H]=null}}}}function k(F){var G=document.createElement("DIV");G.innerHTML=F;return G.firstChild}function z(){var F=navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description;return !!F}function w(H,F){var G={};A(document.cookie.split(";"),function(I){var J=I.split("=");if(J.length==2){G[J[0].trim()]=J[1].trim()}});return G[H]&&!isNaN(G[H])?G[H]:F}function q(F,G){document.cookie=F+"="+G+"; path=/"}function b(){if(window.XDomainRequest){return new XDomainRequest()}else{if(window.XMLHttpRequest){return new XMLHttpRequest()}else{return false}}}function f(G,I){var F=this;var H=b();H.onload=function(){if(!H.responseXML){H.responseXML=(new DOMParser).parseFromString(H.responseText,"text/xml")}I(true,H)};H.onerror=function(){I(false,H)};H.open("GET",G,true);H.send(null);return H}function u(F,G){var H=b();H.open("POST",F,true);H.send(G)}function e(){var F,G={};if(F=navigator.userAgent.match(/\bandroid\s(\d+)\.(\d+)(\.(\d+))?\b/i)){G.is_android=true;G.version=[F[1]|0,F[2]|0,F[4]|0]}else{if(/iPhone/.test(navigator.platform)){G.is_iphone=true}else{if(/iPad/.test(navigator.platform)){G.is_ipad=true}else{if(/iPod/.test(navigator.platform)){G.is_ipod=true}}}}G.is_mobile=G.is_android||G.is_iphone||G.is_ipad||G.is_ipod;return G}var r={enable:false,on:function(){this.enable=true},off:function(){this.enable=false},log:function(){if(this.enable){var H=new Date;var F=("0"+H.getHours()).substr(-2)+":"+("0"+H.getMinutes()).substr(-2)+":"+("0"+H.getSeconds()).substr(-2);var G="[DEBUG]["+F+"]"+[].join.call(arguments," ");console.info(G)}}};CustomObject={proxy:function(G,H){if(G instanceof Array){for(var F=0;F<G.length;F++){this.proxy(G[F],H)}}else{this.on(G,function(){var I=Array.prototype.splice.call(arguments,1);H.trigger.apply(H,[G].concat(I))})}},one:function(H,G,F){this.on(H,function(I){I.handler.remove();G.apply(this,arguments)},F)},on:function(J,I,H){var F=this;this._handlers=this._handlers||{};if(J instanceof Array){for(var G=0;G<J.length;G++){this.on(J[G],I,H)}}else{if(typeof this._handlers[J]==="undefined"){this._handlers[J]=[]}this._handlers[J].push({_id:this._handlers[J].length,handler:I,scope:H||this,remove:function(){F._handlers[J][this._id]=null}})}return this},off:function(F){this._handlers=this._handlers||{};if(typeof this._handlers[F]!=="undefined"){delete this._handlers[F]}},trigger:function(J){this._handlers=this._handlers||{};var H=Array.prototype.splice.call(arguments,1);var F=(this._handlers[J]||[]).concat(this._handlers["*"]||[]);for(var I=0;I<F.length;I++){if(h=F[I]){var G=h.handler.apply(h.scope,[{type:J,handler:h}].concat(H));if(G===false){break}}}return this}};function B(F,H){this.root=F;this.is_show_poster=false;this.is_loading=false;this.is_playing=false;this.is_muted=false;this.is_start_load=false;this.duration=null;this.sources=[];this._handlers={};this._plugins={};this.conf={baseCSSClass:"customPlayer",muted:false,autoplay:false,sources:[],plugins:{},defaultVolume:1,allow_backends:n(this.__backends),cookieKeyVolume:null,backend_options:{flash_swf:H.flash_swf||"video.swf",useDefaultControls:false}};t(this.conf,H);l(this.root,this.conf.baseCSSClass);if(this.conf.plugins){this._initPlugins(this.conf.plugins)}if(this.conf.sources){this.setSources(this.conf.sources)}var G=this;setTimeout(function(){G._init()},0)}B.prototype=y(Object.create(CustomObject),{__backends:{},__plugins:{},_init:function(){var F=this;if(this.conf.autoplay&&!e().is_mobile){F.play()}if(this.conf.cookieKeyVolume){this.setVolume(w(this.conf.cookieKeyVolume,this.conf.defaultVolume))}else{this.setVolume(this.conf.defaultVolume)}if(this.conf.muted){this.mute()}},_destroyBackend:function(){if(this.backend){this.backend.destroy();this.root.removeChild(this.backend.getElement())}},_initBackend:function(H){var F=this;this.trigger("waiting");if(!(this.backend instanceof H)){if(this.backend){this._destroyBackend()}this.backend=new H(this.conf.backend_options);this.backend.on("play",function(){F.is_playing=true;if(F.has_been_paused){F.trigger("resume")}});this.backend.on("pause",function(){F.is_playing=false;F.has_been_paused=true});this.backend.on("ended",function(){F.is_playing=false});this.backend.on("error",function(K,J,I){F.error(J,I)});this.backend.on("timeupdate",function(J,I){F.trigger("timeupdate",I,F.getDuration())});this.backend.on("ready",function(){this.setVolume(F.volume+0.1);this.setVolume(F.volume-0.1);this.setVolume(F.volume)});this.backend.proxy(["waiting","playing","seeking","seeked","progress","ended","volumechange","play","canplay","pause"],this);this.backend.init();var G=this.backend.getElement();G.style.width="100%";G.style.height="100%";G.style.position="absolute";G.style.left=0;G.style.top=0;this.root.appendChild(G);this.trigger("backendchange",this.backend)}},_initSources:function(J){var G=this.conf?this.conf.allow_backends:n(this.__backends);var F=this.__backends;for(var K=0;K<G.length;K++){var I=G[K];if(typeof F[I]==="undefined"){continue}for(var H=0;H<J.length;H++){if(F[I].prototype.isSupported()&&F[I].prototype.canPlayType(J[H].type)){this._initBackend(F[I]);this.source=J[H];this.trigger("sourcechange",this.source);return true}}}return false},_initPlugins:function(G){for(var F in G){if(G[F]&&(typeof G[F].enabled==="undefined"||G[F].enabled)){this._plugins[F]=new this.__plugins[F](this,G[F])}}},getWidth:function(){return this.root.offsetWidth},getHeight:function(){return this.root.offsetHeight},supportMedia:function(J){var G=this.conf?this.conf.allow_backends:n(this.__backends);var F=this.__backends;for(var I=0;I<G.length;I++){var H=G[I];if(typeof F[H]==="undefined"){continue}if(F[H].prototype.isSupported()&&F[H].prototype.canPlayType(J)){return true}}return false},destroy:function(){if(this.backend){this._destroyBackend();this.backend=null}this._handlers={};this.root.parentElement.removeChild(this.root);return this},decodeErrorCode:function(F){var G={100:"We are working to fix this as soon as possible. Thanks for patience.",101:"Your browser can not reproduce this video. Please update your browser for the best viewing experience.",102:"Oops, try again! There is no video.",200:"We are working to fix this as soon as possible. Thanks for patience.",201:"Video temporarily is unavailable, please try again later."};return G[F]||"Unknown error"},error:function(G,F){this.trigger("error",G,F||this.decodeErrorCode(G))},setSources:function(F){if(F&&F.length){if(this.is_playing){this.pause()}this.source=null;this.sources=F}else{this.error(102)}return this},load:function(){var F=this;if(this.sources&&this.sources.length){if(this._initSources(this.sources)){if(this.backend.is_ready){this.backend.setSource(F.source.src,F.source.type)}else{this.backend.one("ready",function(G){this.setSource(F.source.src,F.source.type)})}this.is_start_load=true}else{this.error(101)}}else{this.error(102)}},play:function(){if(!this.is_playing){this.is_playing=true;if(this.is_start_load){this.backend.play()}else{this.one("canplay",function(F){this.backend.play()});this.load()}}return this},pause:function(){if(this.is_playing){this.backend.pause();this.is_playing=false}return this},getVolume:function(){if(this.backend){this.volume=this.backend.getVolume()}return this.volume},setVolume:function(F){this.volume=Math.min(1,Math.max(0,F));if(this.conf.cookieKeyVolume){q(this.conf.cookieKeyVolume,this.volume)}this.trigger("volumechange",this.volume);if(this.backend){this.backend.setVolume(this.volume)}},mute:function(){this._old_volume=this.getVolume();this.setVolume(0)},unmute:function(){this.setVolume(this._old_volume||1)},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},setProgress:function(F){var G=this.getDuration()/100*F;this.backend.setCurrentTime(G)},getProgress:function(){if(this.backend){return this.getCurrentTime()/this.getDuration()*100}else{return 0}},showDefaultUI:function(){if(this.backend){this.backend.showDefaultUI()}else{this.one("backendchange",function(G,F){F.showDefaultUI()})}}});(function(){var F=document.createElement("STYLE");F.innerHTML='.customPlayer {position: relative;outline: none;background: #000;z-index: 0;font: 400 14px/1.2 \'Roboto\', sans-serif;overflow: hidden;}.customPlayer.fullscreen {position: absolute;top: 0;left: 0;width: 100% !important;height: 100% !important;}.customPlayer .ui {position: absolute;left: 0;top: 0;right: 0;bottom: 0;z-index: 100;outline: none;}.customPlayer .no-animate,.customPlayer .no-animate *{transition: none !important;}.customPlayer .ui > .loader {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui > .loader.hide {opacity: 0;}.customPlayer .ui > .error.fatal {position: absolute;display: table;top: 0;left: 0;width: 100%;height: 100%;color: rgb(255, 82, 82);font-size: 20pt;text-align: center;z-index: 1000;background: #000;}.customPlayer .ui > .error>div {display: table-cell;vertical-align: middle;}.customPlayer .ui .start-screen {position: absolute;left: 0;top: 0;width: 100%;height: 100%;z-index: 10;cursor: pointer;background-color: black;opacity: 1;transition: opacity ease .5s;}.customPlayer .ui .start-screen.hide {opacity: 0;}.customPlayer .ui .start-screen > .poster {position: absolute;left: 0;top: 0;width: 100%;height: 100%;background-repeat: no-repeat;background-position: 50% 50%;background-size: contain;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui .start-screen > .poster.hide {opacity: 0;}.customPlayer .ui .start-screen svg {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;}.customPlayer .ui .start-screen:hover svg > path {fill: rgba(255,255,255,0.9);}.customPlayer .ui>.controls {position: absolute;left: 0px;right: 0px;bottom: 0px;height: 69px;background: none;background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABFCAYAAACL3IzzAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjBCQUNBRUVFNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjBCQUNBRUVGNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MEJBQ0FFRUM2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MEJBQ0FFRUQ2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4PyzKNAAAAbElEQVR42myPUQ6AMAhDK9u1jB/e/0xV6NaQ6M/SBy0w3NcZAfAIEBEECvNJJLaqGjGMw4lUSgzjVlVLxAdnjk9lM9+aUKrmcWqvVI+5oZgbZeH0yo4yr/vWvIZ90TpIX9Xh8NCfmxfK/AgwACr2StbF5TFoAAAAAElFTkSuQmCC\');opacity: 0;transition: opacity ease .3s;z-index: 9;}.customPlayer .ui>.controls.show {opacity: 1;}.customPlayer .ui>.controls svg {width: 100%;height: 100%;fill: #FFFFFF;}.customPlayer .ui>.controls *:hover>svg {fill: #FCC010;}.customPlayer .ui>.controls .play-pause {position: absolute;left: 20px;bottom: 10px;cursor: pointer;width: 24px;height: 24px;overflow: hidden;}.customPlayer .ui>.controls .play-pause path.play {display: block;}.customPlayer .ui>.controls .play-pause path.pause {display: none;}.customPlayer .ui.playing>.controls .play-pause path.play {display: none;}.customPlayer .ui.playing>.controls .play-pause path.pause {display: block;}.customPlayer .ui>.controls .timer {position: absolute;bottom: 12px;left: 50px;color: #fff;font-size: 12px;padding: 0;line-height: 20px;height: 20px;vertical-align: middle;}.customPlayer .ui>.controls .time-label {position: absolute;color: #fff;background: #000;border-radius: 5px;padding: 5px 10px;text-align: center;bottom: 60px;opacity: 0;cursor: default;transition: opacity ease .5s;}.customPlayer .ui>.controls .time-label:after {content: "";position: absolute;width: 0;height: 0;top: 100%;left: 50%;border-style: solid;border-color: transparent;border-width: 5px;border-top-color: #000;margin-left: -5px;}.customPlayer .ui>.controls .time-label.show {opacity: 1;}.customPlayer .ui.small-mode>.controls .time-label {bottom: 75px;font-size: 20px;}.customPlayer .ui>.controls .progress {position: absolute;left: 0px;right: 0px;bottom: 45px;height: 17px;background: none;cursor: pointer;border-bottom: 5px solid rgba(108, 108, 108, 0.5);z-index: 0;}.customPlayer .ui>.controls .progress.readonly {border-bottom-width: 2px;cursor: default;}.customPlayer .ui>.controls .progress .load {position: absolute;height: 5px;left: 0;bottom: -5px;background: rgba(154, 154, 156, 0.5);z-index: 0;transition: width ease .3s;}.customPlayer .ui>.controls .progress.readonly .load {height: 2px;bottom: -2px;}.customPlayer .ui>.controls .progress .play {position: absolute;left: 0;bottom: -5px;height: 5px;background: #FCC010;z-index: 10;transition: width ease .3s;}.customPlayer .ui>.controls .progress.readonly .play {background: #BEBEBE;height: 2px;bottom: -2px;}.customPlayer .ui>.controls .progress.readonly .play:after {display: none;}.customPlayer .ui>.controls .progress .play:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 0px;height: 0px;border: none;margin: 3px 0 0 0;transition:margin ease .3s,width ease .3s,height ease .3s;}.customPlayer .ui>.controls .progress:hover .play:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}.customPlayer .ui>.controls .tray {position: absolute;bottom: 0px;right: 0px;height: 45px;white-space: nowrap;}.customPlayer .ui>.controls .tray > *{position: relative;width: 24px;height: 24px;margin: 10px;display: inline-block;cursor: pointer;vertical-align: middle;box-sizing: content-box;}.customPlayer .ui>.controls .volume svg {position: absolute;left: 0px;width: 24px;height: 24px;}.customPlayer .ui>.controls .volume svg .mute {display: none;}.customPlayer .ui.muted>.controls .volume svg .unmute {display: none;}.customPlayer .ui.muted>.controls .volume svg .mute {display: block;}.customPlayer .ui>.controls .volume {position: relative;outline: none;width: 120px;}.customPlayer .ui>.controls .volume .vlevel{display: none;position: absolute;width: 100%;box-sizing: border-box;height: 100px;bottom: 100%;left: 0px;border-width: 10px 10px 0 10px;border-style: solid;border-color: rgba(0,0,0,0.3);}.customPlayer .ui>.controls .volume .vlevel:before {position: absolute;content: "";left: 0;top: 0;width: 100%;height: 100%;background: rgba(154, 154, 156, 0.5);}.customPlayer .ui>.controls .volume .vlevel>.value{position: absolute;bottom: 0px;left: 0px;background: #fff;width: 100%;height: 100%;}.customPlayer .ui>.controls .volume .level{position: absolute;right: 5px;left: 40px;top: 50%;margin-top: -13px;height: 5px;border-style: solid;border-color: rgba(0,0,0,0);border-width: 10px 0;}.customPlayer .ui>.controls .volume .level:before {content: "";position: absolute;width: 100%;left: 0;top: 0;height: 5px;background: rgba(108, 108, 108, 0.5);}.customPlayer .ui>.controls .volume .level>.value{position: absolute;left: 0;width: 100%;height: 100%;background: #FFFFFF;transition: width ease .3s;}.customPlayer .ui>.controls .volume .level>.value:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 0px;height: 0px;border: none;margin: 3px 0 0 0;transition:margin ease .3s,width ease .3s,height ease .3s;}.customPlayer .ui>.controls .volume:hover .level>.value:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}.customPlayer .ui.small-mode > .controls .progress {border-bottom-width: 20px;}.customPlayer .ui.small-mode > .controls .progress .load {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play:after {display: none;content: "";position: absolute;right: -8px;top: 0px;height: 100%;width: 16px;background: #fff;border: none;margin: 0;border-radius: 0;}.customPlayer .ui.small-mode > .controls .volume {width: 24px;background: rgba(0,0,0,0);transition: background ease .5s;}.customPlayer .ui.small-mode > .controls .volume .vlevel{display: block;height: 0;border-top-width: 0; transition:border ease .3s,height ease .3s;}.customPlayer .ui.small-mode > .controls .volume .level{display: none;}.customPlayer .ui.small-mode > .controls .volume:focus {background: rgba(0,0,0,0.3);}.customPlayer .ui.small-mode > .controls .volume:focus .vlevel{border-top-width: 10px; height: 100px;}.customPlayer.fullscreen > .ui .tray .big {display: none;}.customPlayer > .ui.small-mode .tray .big {display: none;}';document.head.appendChild(F)})();window.TouchEvent=window.TouchEvent||function(){};function p(G,F){this.conf=y({progress:{show:true,readonly:false},timer:{show:true},poster:null,useMobileFallback:false},F);this.player=G;this.duration;this.is_show_start_screen=true;this.is_first_play=true;this.is_played=false;this.is_muted=false;this.dom=k('<div class="ui" tabindex="0" style="background:rgba(0,0,0,0)"><div class="loader"><svg viewBox="0 0 160 160" style="width:100%; height:100%"><circle cx="80" cy="80" r="75" fill="rgba(0, 0, 0, 0.5)" stroke="rgba(255, 255, 255, 0.1)" stroke-width="2" /><circle cx="80" cy="80" r="65" stroke="rgba(255, 255, 255, 0.5)" stroke-width="10" fill="transparent" /></svg></div><div class="start-screen"><div class="poster hide"></div><svg viewBox="0 0 160 160"><circle cx="80" cy="80" r="80" fill="rgba(0, 0, 0, 0.3)" /><path transform="translate(10, -14)" fill="rgba(255, 255, 255, 0.6)" d="M70,32.7c33.8,0,61.2,27.5,61.2,61.2c0,33.8-27.5,61.2-61.2,61.2c-33.8,0-61.2-27.5-61.2-61.2C8.7,60.2,36.2,32.7,70,32.7 M70,24C31.3,24,0,55.3,0,94c0,38.7,31.3,70,70,70c38.7,0,70-31.3,70-70C140,55.3,108.7,24,70,24L70,24z M59,73.4L94.7,94L59,114.6V73.4 M50.2,58.2v71.6l62-35.8L50.2,58.2L50.2,58.2z"/></svg></div><div class="controls"><div class="time-label"></div><div class="progress"><div class="load"></div><div class="play"></div></div><div class="play-pause"><svg><path class="play" transform="translate(-24, 0)" d="M26,0v24l20-12L26,0L26,0z"/><path class="pause" transform="translate(0, 0)" d="M3.5,0h7v24h-7V0z M13.5,0h7v24h-7V0z"/></svg></div><div class="timer"></div><div class="tray"><div class="volume" tabindex="0"><svg><g class="unmute" transform="translate(-48, 0)"><path d="M64.7,2.1L56.3,7h-5.8C49.7,7,49,7.7,49,8.5v7c0,0.8,0.7,1.5,1.5,1.5h5.8l8.4,4.9c1,0.6,2.3-0.1,2.3-1.3V3.4C67,2.3,65.7,1.6,64.7,2.1z"/><path d="M70.4,6.8c-0.1-0.5-0.7-0.9-1.2-0.8c-0.5,0.1-0.9,0.7-0.8,1.2C68.8,8.8,69,10.4,69,12s-0.2,3.2-0.5,4.7c-0.1,0.5,0.2,1.1,0.8,1.2c0.1,0,0.1,0,0.2,0c0.5,0,0.9-0.3,1-0.8c0.4-1.7,0.6-3.4,0.6-5.2S70.8,8.5,70.4,6.8z"/></g><path class="mute" transform="translate(-72, 0)" d="M73,15.5v-7C73,7.7,73.7,7,74.5,7h5.8l8.4-4.9c0.7-0.4,1.5-0.2,1.9,0.4L76.2,17h-1.7C73.7,17,73,16.3,73,15.5z M93.2,6.1c-0.5,0.1-0.9,0.7-0.8,1.2C92.8,8.8,93,10.4,93,12s-0.2,3.2-0.5,4.7c-0.1,0.5,0.2,1.1,0.8,1.2c0.1,0,0.1,0,0.2,0c0.5,0,0.9-0.3,1-0.8c0.4-1.7,0.6-3.4,0.6-5.2s-0.2-3.5-0.6-5.2C94.3,6.3,93.8,6,93.2,6.1z M81.3,17.6l7.5,4.3c1,0.6,2.3-0.1,2.3-1.3V7.8L81.3,17.6z M74.7,22.7l20-20c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-20,20c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3S74.5,22.9,74.7,22.7z"/></svg><div class="vlevel"><div class="value"></div></div><div class="level"><div class="value"></div></div></div></div></div></div>');this.loader=this.dom.getElementsByClassName("loader")[0];this.start_screen=this.dom.getElementsByClassName("start-screen")[0];this.start_screen.poster=this.start_screen.getElementsByClassName("poster")[0];this.controls=this.dom.getElementsByClassName("controls")[0];this.controls.time_label=this.controls.getElementsByClassName("time-label")[0];this.controls.timer=this.controls.getElementsByClassName("timer")[0];this.controls.play_pause_btn=this.controls.getElementsByClassName("play-pause")[0];this.controls.tray=this.controls.getElementsByClassName("tray")[0];this.controls.tray.volume=this.controls.tray.getElementsByClassName("volume")[0];this.controls.tray.mute=this.controls.tray.volume.getElementsByTagName("svg")[0];this.controls.tray.volume.level=this.controls.tray.volume.getElementsByClassName("level")[0];this.controls.tray.volume.level.value=this.controls.tray.volume.level.getElementsByClassName("value")[0];this.controls.tray.volume.vlevel=this.controls.tray.volume.getElementsByClassName("vlevel")[0];this.controls.tray.volume.vlevel.value=this.controls.tray.volume.vlevel.getElementsByClassName("value")[0];this.controls.progress=this.controls.getElementsByClassName("progress")[0];this.controls.progress.load=this.controls.progress.getElementsByClassName("load")[0];this.controls.progress.play=this.controls.progress.getElementsByClassName("play")[0];this.init()}p.prototype=y(Object.create(CustomObject),{getElement:function(){return this.dom},init:function(){this.initUI();this.initPlayerEvents();this.initUIEvents();this.initEasterEgg();this.initAdaptive();if(this.conf.poster){var G=this;var F=new Image;F.addEventListener("load",function(){G.start_screen.poster.style.backgroundImage="url("+G.conf.poster+")";o(G.start_screen.poster,"hide")});F.src=this.conf.poster}this.controls.tray.volume.level.value.style.width=this.player.volume*100+"%";this.controls.style.display="none";this.hideLoader();if(this.conf.progress.readonly){l(this.controls.progress,"readonly")}if(!this.conf.progress.show){this.controls.progress.style.display="none"}if(!this.conf.timer.show){this.controls.timer.style.display="none"}this.player.trigger("tray_ready",this.controls.tray)},initAdaptive:function(){var F=this;setInterval(function(){var H=F.dom.offsetWidth;if(H==0){return}var G=H>0&&H<=480;if(F.is_small_mode!=G){F.player.trigger("change_small_mode",G);if(G){l(F.dom,"small-mode")}else{o(F.dom,"small-mode")}}F.is_small_mode=G},1000)},initUI:function(){var H=this;this.on("play",function(){if(H.is_first_play){H.hideStartScreen();H.is_first_play=false;if(H.conf.useMobileFallback&&e().is_mobile){H.dom.style.display="none";H.player.showDefaultUI()}}});j(this.dom,"dblclick",function(K){if(K.target==H.dom){H.trigger("fullscreentoggle")}});j(this.dom,"selectstart",function(){return false});j(this.start_screen,"click",function(K){H.trigger("play")});j(this.dom,["mousedown","mouseup"],function(K){if(K.target==H.dom){if(K.type=="mousedown"){this._click_start=K.timeStamp}if(K.type=="mouseup"){if((K.timeStamp-this._click_start)<300){if(H.is_active){H.trigger(H.is_played?"pause":"play")}}}}});j(this.dom,"keydown",function(K){if(K.keyCode==32){H.trigger(H.is_played?"pause":"play");return false}});j(this.dom,"click",function(K){H.trigger("user_active")});j(this.dom,["mousemove","touchmove"],function(K){if(K.timeStamp-this._last_move<500){H.trigger("user_active")}this._last_move=K.timeStamp});j(this.controls.play_pause_btn,"click",function(){H.trigger(H.is_played?"pause":"play")});if(!this.conf.progress.readonly){var I=this.controls.progress;var F=this.controls.time_label;var G=function(M){var K=M-I.getBoundingClientRect().left;var N=H.duration*(K/I.offsetWidth);var L=F.offsetWidth;F.style.left=Math.max(0,Math.min(I.offsetWidth-L,K-(L/2)))+"px";F.innerHTML=H.formatTime(N);clearTimeout(F._t);l(F,"show")};j(I,["mousedown","touchstart"],function(K){if(K instanceof TouchEvent||K.which==1){H.hold_progress=true;var L=I.getBoundingClientRect().left;j(document,["mousemove.progress","touchmove.progress"],function(N){var M=N instanceof TouchEvent?N.changedTouches[0].clientX:N.clientX;l(I,"no-animate");I.play.style.width=Math.max(0,Math.min(100,(M-L)/I.offsetWidth*100))+"%";G(M);return false});j(document,["mouseup.progress","touchend.progress"],function(O){var N=I.offsetWidth;if(N){var M=O instanceof TouchEvent?O.changedTouches[0].clientX:O.clientX;H.hold_progress=false;var P=Math.max(0,Math.min(1,(M-L)/N));o(I,"no-animate");H.trigger("positionchange",P)}C(document,["mousemove.progress","mouseup.progress","touchmove.progress","touchend.progress"]);clearTimeout(F._t);F._t=setTimeout(function(){o(F,"show")},2000)})}});j(I,"mouseout",function(K){o(F,"show")});j(I,"mousemove",function(K){G(K.clientX)})}if(/iPad/.test(navigator.platform)){this.controls.tray.volume.style.display="none"}else{(function(K){j(K,["mousedown","touchstart"],function(M){if(M instanceof TouchEvent||M.which==1){var L=M instanceof TouchEvent?M.changedTouches[0].clientX:M.clientX;var N=K.getBoundingClientRect().left;H.trigger("volumechange",(L-N)/K.offsetWidth);j(document,["mousemove.volume","touchmove.volume"],function(P){var O=P instanceof TouchEvent?P.changedTouches[0].clientX:P.clientX;l(K,"no-animate");H.trigger("volumechange",(O-N)/K.offsetWidth);return false});j(document,["mouseup.volume","touchend.volume"],function(O){o(K,"no-animate");C(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})}})})(this.controls.tray.volume.level);(function(K){j(K,["mousedown","touchstart"],function(M){var N=M instanceof TouchEvent?M.changedTouches[0].clientY:M.clientY;var L=K.getBoundingClientRect().bottom;H.trigger("volumechange",(L-N)/(K.offsetHeight-10));j(document,["mousemove.volume","touchmove.volume"],function(O){var P=O instanceof TouchEvent?O.changedTouches[0].clientY:O.clientY;l(K,"no-animate");H.trigger("volumechange",(L-P)/(K.offsetHeight-10));return false});j(document,["mouseup.volume","touchend.volume"],function(O){o(K,"no-animate");C(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})})})(this.controls.tray.volume.vlevel);var J=this.controls.tray.mute;j(J,"click",function(){if(H.is_small_mode){H.controls.tray.volume.focus()}else{H.trigger(H.is_muted?"unmute":"mute")}})}},initUIEvents:function(){var G=this;var F,H;this.on("user_active",function(){G.is_active=true;l(G.controls,"show");o(G.controls,"hide");G.controls.style.display="";clearTimeout(F);clearTimeout(H);F=setTimeout(function(){G.is_active=false;l(G.controls,"hide");o(G.controls,"show");H=setTimeout(function(){G.controls.style.display="none"},500)},3000)})},initPlayerEvents:function(){var F=this;this.player.on(["waiting","seeking"],function(G){F.showLoader()});this.player.on(["playing","seeked"],function(G){F.hideLoader()});this.player.on("error",function(I,H,G){F.showError("("+H+") "+G)});this.player.on("play",function(){F.is_played=true;F.hideStartScreen();o(F.dom,"paused");l(F.dom,"playing");F.controls.play_pause_btn.title="Pause"});this.player.on("pause",function(){F.is_played=false;l(F.dom,"paused");o(F.dom,"playing");F.controls.play_pause_btn.title="Play"});this.player.on("ended",function(){F.showStartScreen();F.trigger("exitfullscreen");F.is_played=false;F.is_first_play=true});this.player.on("timeupdate",function(I,H,G){F.time=H;F.duration=G;if(F.duration){if(!F.hold_progress){F.controls.progress.play.style.width=(H/F.duration*100)+"%"}}if(H>0){F.controls.timer.innerHTML=F.formatTime(H)+" / "+F.formatTime(F.duration)}F.updateLoader()});this.player.on("progress",function(G,H){F.buffer=H;F.updateLoader()});this.player.on("volumechange",function(H,G){F.is_muted=G==0;if(F.is_muted){l(F.dom,"muted")}else{o(F.dom,"muted")}F.controls.tray.volume.level.value.style.width=(G*100)+"%";F.controls.tray.volume.vlevel.value.style.height=(G*100)+"%"})},updateLoader:function(){if(this.buffer){for(var G=0;G<this.buffer.length;G++){var H=this.buffer[G][0];var F=this.buffer[G][1];if(this.time>H&&this.time<F){this.controls.progress.load.style.width=(F/this.duration*100)+"%";break}}}},hideStartScreen:function(){if(!this.is_show_start_screen===true){return}var F=this;clearTimeout(this._sst);this.controls.style.display="";l(this.start_screen,"hide");this.is_show_start_screen=false;this._sst=setTimeout(function(){F.start_screen.style.display="none"},1000)},showStartScreen:function(){if(this.is_show_start_screen===false){return}var F=this;clearTimeout(this._sst);this.controls.style.display="none";this.start_screen.style.display="";this.is_show_start_screen=true;this._sst=setTimeout(function(){o(F.start_screen,"hide")},100)},hideLoader:function(){if(this.is_show_loader===false){return}var F=this;clearTimeout(this._lt);this.is_show_loader=false;l(this.loader,"hide");this._lt=setTimeout(function(){if(!F.is_show_loader){F.loader.style.display="none"}},500)},showLoader:function(){if(this.is_show_loader===true){return}var F=this;clearTimeout(this._lt);this.is_show_loader=true;this._lt=setTimeout(function(){if(F.is_show_loader){F.loader.style.display="";setTimeout(function(){o(F.loader,"hide")},100)}},500);var G=this.loader.getElementsByTagName("circle");(function(){G[0].setAttribute("r",((Math.sin((new Date)/100)+1)/4+0.5)*75);G[1].setAttribute("r",((Math.sin((new Date-100)/100)+1)/4+0.5)*65);if(F.is_show_loader||F.loader.style.display!="none"){setTimeout(arguments.callee,30)}})()},showError:function(F){this.dom.appendChild(k('<div class="error fatal"><div>'+F+"</div></div>"))},formatTime:function(I){var H=this.duration>=3600;var J=Math.ceil(I||0);var F=(J/3600)|0;J-=F*3600;var G=(J/60)|0;J-=G*60;return(H?("0"+F).substr(-2)+":":"")+("0"+G).substr(-2)+":"+("0"+J).substr(-2)},initEasterEgg:function(){var G=[];var F=this;j(this.dom,"keydown",function(J){G.push(J.keyCode)>6?G.shift():null;if(G.join(":")==="65:78:73:83:83:65"){var H=[1071,1053,1040,44,32,1071,32,1058,1045,1041,1071,32,1051,1070,1041,1051,1070,33,33,33];for(var I=0;I<H.length;I++){(function(K,M){var L=k('<div style="position:absolute;color:white;opacity:0.6;font-weight:bold;text-shadow:0 0 5px #000">'+M+"<div>");(function(){L.style.left=(K)+"%";L.style.top=50+(Math.sin(K/15)*30)+"%";L.style.fontSize=((0.5+(Math.sin(K/10)+1)/4)*35)+"px";if(K<-10){F.dom.removeChild(L)}else{K-=0.5;setTimeout(arguments.callee,30)}})();F.dom.appendChild(L)})(100+I*4,String.fromCharCode(H[I]))}}})}});HTML5Backend=(function(){!function(H){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=H()}else{if("function"==typeof define&&define.amd){define([],H)}else{var G;"undefined"!=typeof window?G=window:"undefined"!=typeof global?G=global:"undefined"!=typeof self&&(G=self),G.Hls=H()}}}(function(){var J,H,G;return(function I(L,P,N){function M(U,S){if(!P[U]){if(!L[U]){var R=typeof require=="function"&&require;if(!S&&R){return R(U,!0)}if(K){return K(U,!0)}var T=new Error("Cannot find module '"+U+"'");throw T.code="MODULE_NOT_FOUND",T}var Q=P[U]={exports:{}};L[U][0].call(Q.exports,function(V){var W=L[U][1][V];return M(W?W:V)},Q,Q.exports,I,L,P,N)}return P[U].exports}var K=typeof require=="function"&&require;for(var O=0;O<N.length;O++){M(N[O])}return M})({1:[function(O,P,M){function Q(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}P.exports=Q;Q.EventEmitter=Q;Q.prototype._events=undefined;Q.prototype._maxListeners=undefined;Q.defaultMaxListeners=10;Q.prototype.setMaxListeners=function(S){if(!N(S)||S<0||isNaN(S)){throw TypeError("n must be a positive number")}this._maxListeners=S;return this};Q.prototype.emit=function(X){var Y,W,S,T,U,V;if(!this._events){this._events={}}if(X==="error"){if(!this._events.error||(K(this._events.error)&&!this._events.error.length)){Y=arguments[1];if(Y instanceof Error){throw Y}throw TypeError('Uncaught, unspecified "error" event.')}}W=this._events[X];if(L(W)){return false}if(R(W)){switch(arguments.length){case 1:W.call(this);break;case 2:W.call(this,arguments[1]);break;case 3:W.call(this,arguments[1],arguments[2]);break;default:S=arguments.length;T=new Array(S-1);for(U=1;U<S;U++){T[U-1]=arguments[U]}W.apply(this,T)}}else{if(K(W)){S=arguments.length;T=new Array(S-1);for(U=1;U<S;U++){T[U-1]=arguments[U]}V=W.slice();S=V.length;for(U=0;U<S;U++){V[U].apply(this,T)}}}return true};Q.prototype.addListener=function(T,U){var S;if(!R(U)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",T,R(U.listener)?U.listener:U)}if(!this._events[T]){this._events[T]=U}else{if(K(this._events[T])){this._events[T].push(U)}else{this._events[T]=[this._events[T],U]}}if(K(this._events[T])&&!this._events[T].warned){var S;if(!L(this._maxListeners)){S=this._maxListeners}else{S=Q.defaultMaxListeners}if(S&&S>0&&this._events[T].length>S){this._events[T].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[T].length);if(typeof console.trace==="function"){console.trace()}}}return this};Q.prototype.on=Q.prototype.addListener;Q.prototype.once=function(S,U){if(!R(U)){throw TypeError("listener must be a function")}var V=false;function T(){this.removeListener(S,T);if(!V){V=true;U.apply(this,arguments)}}T.listener=U;this.on(S,T);return this};Q.prototype.removeListener=function(U,X){var W,S,V,T;if(!R(X)){throw TypeError("listener must be a function")}if(!this._events||!this._events[U]){return this}W=this._events[U];V=W.length;S=-1;if(W===X||(R(W.listener)&&W.listener===X)){delete this._events[U];if(this._events.removeListener){this.emit("removeListener",U,X)}}else{if(K(W)){for(T=V;T-->0;){if(W[T]===X||(W[T].listener&&W[T].listener===X)){S=T;break}}if(S<0){return this}if(W.length===1){W.length=0;delete this._events[U]}else{W.splice(S,1)}if(this._events.removeListener){this.emit("removeListener",U,X)}}}return this};Q.prototype.removeAllListeners=function(U){var S,T;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[U]){delete this._events[U]}}return this}if(arguments.length===0){for(S in this._events){if(S==="removeListener"){continue}this.removeAllListeners(S)}this.removeAllListeners("removeListener");this._events={};return this}T=this._events[U];if(R(T)){this.removeListener(U,T)}else{while(T.length){this.removeListener(U,T[T.length-1])}}delete this._events[U];return this};Q.prototype.listeners=function(T){var S;if(!this._events||!this._events[T]){S=[]}else{if(R(this._events[T])){S=[this._events[T]]}else{S=this._events[T].slice()}}return S};Q.listenerCount=function(U,T){var S;if(!U._events||!U._events[T]){S=0}else{if(R(U._events[T])){S=1}else{S=U._events[T].length}}return S};function R(S){return typeof S==="function"}function N(S){return typeof S==="number"}function K(S){return typeof S==="object"&&S!==null}function L(S){return S===void 0}},{}],2:[function(N,O,L){var Q=arguments[3];var M=arguments[4];var K=arguments[5];var P=JSON.stringify;O.exports=function(Y){var ac=[];var Z;var V=Object.keys(K);for(var U=0,T=V.length;U<T;U++){var ab=V[U];if(K[ab].exports===Y){Z=ab;break}}if(!Z){Z=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var W={};for(var U=0,T=V.length;U<T;U++){var ab=V[U];W[ab]=ab}M[Z]=[Function(["require","module","exports"],"("+Y+")(self)"),W]}var aa=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var S={};S[Z]=Z;M[aa]=[Function(["require"],"require("+P(Z)+")(self)"),S];var R="("+Q+")({"+Object.keys(M).map(function(ae){return P(ae)+":["+M[ae][0]+","+P(M[ae][1])+"]"}).join(",")+"},{},["+P(aa)+"])";var X=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(X.createObjectURL(new Blob([R],{type:"text/javascript"})))}},{}],3:[function(L,K,N){Object.defineProperty(N,"__esModule",{value:true});var M=(function(){function T(X,V){for(var U=0;U<V.length;U++){var W=V[U];W.enumerable=W.enumerable||false;W.configurable=true;if("value" in W){W.writable=true}Object.defineProperty(X,W.key,W)}}return function(W,U,V){if(U){T(W.prototype,U)}if(V){T(W,V)}return W}})();function S(T){return T&&T.__esModule?T:{"default":T}}function O(T,U){if(!(T instanceof U)){throw new TypeError("Cannot call a class as a function")}}var P=L("../events");var Q=S(P);var R=(function(){function V(Y){O(this,V);this.hls=Y;this.lastfetchlevel=0;this._autoLevelCapping=-1;this._nextAutoLevel=-1;this.onflp=this.onFragmentLoadProgress.bind(this);Y.on(Q["default"].FRAG_LOAD_PROGRESS,this.onflp)}M(V,[{key:"destroy",value:function U(){this.hls.off(Q["default"].FRAG_LOAD_PROGRESS,this.onflp)}},{key:"onFragmentLoadProgress",value:function W(Z,aa){var Y=aa.stats;if(Y.aborted===undefined){this.lastfetchduration=(performance.now()-Y.trequest)/1000;this.lastfetchlevel=aa.frag.level;this.lastbw=Y.loaded*8/this.lastfetchduration}}},{key:"autoLevelCapping",get:function T(){return this._autoLevelCapping},set:function X(Y){this._autoLevelCapping=Y}},{key:"nextAutoLevel",get:function T(){var ae=this.lastbw,Y=this.hls,aa,Z,ab;if(this._autoLevelCapping===-1){ab=Y.levels.length-1}else{ab=this._autoLevelCapping}if(this._nextAutoLevel!==-1){var ac=Math.min(this._nextAutoLevel,ab);if(ac===this.lastfetchlevel){this._nextAutoLevel=-1}else{return ac}}for(Z=0;Z<=ab;Z++){if(Z<=this.lastfetchlevel){aa=0.8*ae}else{aa=0.7*ae}if(aa<Y.levels[Z].bitrate){return Math.max(0,Z-1)}}return Z-1},set:function X(Y){this._nextAutoLevel=Y}}]);return V})();N["default"]=R;K.exports=N["default"]},{"../events":17}],4:[function(L,K,O){Object.defineProperty(O,"__esModule",{value:true});var N=(function(){function V(Z,X){for(var W=0;W<X.length;W++){var Y=X[W];Y.enumerable=Y.enumerable||false;Y.configurable=true;if("value" in Y){Y.writable=true}Object.defineProperty(Z,Y.key,Y)}}return function(Y,W,X){if(W){V(Y.prototype,W)}if(X){V(Y,X)}return Y}})();function U(V){return V&&V.__esModule?V:{"default":V}}function P(V,W){if(!(V instanceof W)){throw new TypeError("Cannot call a class as a function")}}var Q=L("../events");var R=U(Q);var T=L("../utils/logger");var M=L("../errors");var S=(function(){function ab(ag){P(this,ab);this.hls=ag;this.onml=this.onManifestLoaded.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);ag.on(R["default"].MANIFEST_LOADED,this.onml);ag.on(R["default"].LEVEL_LOADED,this.onll);ag.on(R["default"].ERROR,this.onerr);this._manualLevel=this._autoLevelCapping=-1}N(ab,[{key:"destroy",value:function af(){var ag=this.hls;ag.off(R["default"].MANIFEST_LOADED,this.onml);ag.off(R["default"].LEVEL_LOADED,this.onll);ag.off(R["default"].ERROR,this.onerr);if(this.timer){clearInterval(this.timer)}this._manualLevel=-1}},{key:"onManifestLoaded",value:function ac(ah,ai){var ak=[],ao=[],al,aj,an={},ag=false,am=false;ai.levels.forEach(function(aq){if(aq.videoCodec){ag=true}if(aq.audioCodec){am=true}var ap=an[aq.bitrate];if(ap===undefined){an[aq.bitrate]=ak.length;aq.url=[aq.url];aq.urlId=0;ak.push(aq)}else{ak[ap].url.push(aq.url)}});if(ag&&am){ak.forEach(function(ap){if(ap.videoCodec){ao.push(ap)}})}else{ao=ak}ak=ak.filter(function(at){var aq=function aq(au){return MediaSource.isTypeSupported("video/mp4;codecs="+au)};var ar=at.audioCodec,ap=at.videoCodec;return(ar&&aq(ar)||!ar)&&(ap&&aq(ap)||!ap)});al=ao[0].bitrate;ao.sort(function(aq,ap){return aq.bitrate-ap.bitrate});this._levels=ao;for(aj=0;aj<ao.length;aj++){if(ao[aj].bitrate===al){this._firstLevel=aj;T.logger.log("manifest loaded,"+ao.length+" level(s) found, first bitrate:"+al);break}}this.hls.trigger(R["default"].MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:ai.stats});return}},{key:"setLevelInternal",value:function W(ag){if(ag>=0&&ag<this._levels.length){if(this.timer){clearInterval(this.timer);this.timer=null}this._level=ag;T.logger.log("switching to level "+ag);this.hls.trigger(R["default"].LEVEL_SWITCH,{level:ag});var ai=this._levels[ag];if(ai.details===undefined||ai.details.live===true){T.logger.log("(re)loading playlist for level "+ag);var ah=ai.urlId;this.hls.trigger(R["default"].LEVEL_LOADING,{url:ai.url[ah],level:ag,id:ah})}}else{this.hls.trigger(R["default"].ERROR,{type:M.ErrorTypes.OTHER_ERROR,details:M.ErrorDetails.LEVEL_SWITCH_ERROR,level:ag,fatal:false,reason:"invalid level idx"})}}},{key:"onError",value:function Z(aj,ak){if(ak.fatal){return}var ah=ak.details,ag=this.hls,ai,am;switch(ah){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:case M.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case M.ErrorDetails.KEY_LOAD_ERROR:case M.ErrorDetails.KEY_LOAD_TIMEOUT:ai=ak.frag.level;break;case M.ErrorDetails.LEVEL_LOAD_ERROR:case M.ErrorDetails.LEVEL_LOAD_TIMEOUT:ai=ak.level;break;default:break}if(ai!==undefined){am=this._levels[ai];if(am.urlId<am.url.length-1){am.urlId++;am.details=undefined;T.logger.warn("level controller,"+ah+" for level "+ai+": switching to redundant stream id "+am.urlId)}else{var al=this._manualLevel===-1&&ai;if(al){T.logger.warn("level controller,"+ah+": emergency switch-down for next fragment");ag.abrController.nextAutoLevel=0}else{if(am&&am.details&&am.details.live){T.logger.warn("level controller,"+ah+" on live stream, discard")}else{T.logger.error("cannot recover "+ah+" error");this._level=undefined;if(this.timer){clearInterval(this.timer);this.timer=null}ak.fatal=true;ag.trigger(aj,ak)}}}}}},{key:"onLevelLoaded",value:function V(ag,ah){if(ah.details.live&&!this.timer){this.timer=setInterval(this.ontick,1000*ah.details.targetduration)}if(!ah.details.live&&this.timer){clearInterval(this.timer);this.timer=null}}},{key:"tick",value:function aa(){var ag=this._level;if(ag!==undefined){var ai=this._levels[ag],ah=ai.urlId;this.hls.trigger(R["default"].LEVEL_LOADING,{url:ai.url[ah],level:ag,id:ah})}}},{key:"nextLoadLevel",value:function Y(){if(this._manualLevel!==-1){return this._manualLevel}else{return this.hls.abrController.nextAutoLevel}}},{key:"levels",get:function X(){return this._levels}},{key:"level",get:function X(){return this._level},set:function ae(ag){if(this._level!==ag||this._levels[ag].details===undefined){this.setLevelInternal(ag)}}},{key:"manualLevel",get:function X(){return this._manualLevel},set:function ae(ag){this._manualLevel=ag;if(ag!==-1){this.level=ag}}},{key:"firstLevel",get:function X(){return this._firstLevel},set:function ae(ag){this._firstLevel=ag}},{key:"startLevel",get:function X(){if(this._startLevel===undefined){return this._firstLevel}else{return this._startLevel}},set:function ae(ag){this._startLevel=ag}}]);return ab})();O["default"]=S;K.exports=O["default"]},{"../errors":16,"../events":17,"../utils/logger":26}],5:[function(S,L,ab){Object.defineProperty(ab,"__esModule",{value:true});var X=(function(){function ac(ah,af){for(var ae=0;ae<af.length;ae++){var ag=af[ae];ag.enumerable=ag.enumerable||false;ag.configurable=true;if("value" in ag){ag.writable=true}Object.defineProperty(ah,ag.key,ag)}}return function(ag,ae,af){if(ae){ac(ag.prototype,ae)}if(af){ac(ag,af)}return ag}})();function K(ac){return ac&&ac.__esModule?ac:{"default":ac}}function N(ac,ae){if(!(ac instanceof ae)){throw new TypeError("Cannot call a class as a function")}}var P=S("../demux/demuxer");var Y=K(P);var T=S("../events");var R=K(T);var W=S("../utils/logger");var M=S("../utils/binary-search");var O=K(M);var V=S("../helper/level-helper");var Q=K(V);var Z=S("../errors");var U={ERROR:-2,STARTING:-1,IDLE:0,KEY_LOADING:1,FRAG_LOADING:2,WAITING_LEVEL:3,PARSING:4,PARSED:5,APPENDING:6,BUFFER_FLUSHING:7};var aa=(function(){function av(aR){N(this,av);this.config=aR.config;this.audioCodecSwap=false;this.hls=aR;this.onsbue=this.onSBUpdateEnd.bind(this);this.onsbe=this.onSBUpdateError.bind(this);this.onmediaatt0=this.onMediaAttaching.bind(this);this.onmediadet0=this.onMediaDetaching.bind(this);this.onmp=this.onManifestParsed.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onfl=this.onFragLoaded.bind(this);this.onkl=this.onKeyLoaded.bind(this);this.onis=this.onInitSegment.bind(this);this.onfpg=this.onFragParsing.bind(this);this.onfp=this.onFragParsed.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);aR.on(R["default"].MEDIA_ATTACHING,this.onmediaatt0);aR.on(R["default"].MEDIA_DETACHING,this.onmediadet0);aR.on(R["default"].MANIFEST_PARSED,this.onmp)}X(av,[{key:"destroy",value:function aE(){this.stop();var aR=this.hls;aR.off(R["default"].MEDIA_ATTACHING,this.onmediaatt0);aR.off(R["default"].MEDIA_DETACHING,this.onmediadet0);aR.off(R["default"].MANIFEST_PARSED,this.onmp);this.state=U.IDLE}},{key:"startLoad",value:function ai(){if(this.levels&&this.media){this.startInternal();if(this.lastCurrentTime){W.logger.log("seeking @ "+this.lastCurrentTime);if(!this.lastPaused){W.logger.log("resuming video");this.media.play()}this.state=U.IDLE}else{this.lastCurrentTime=0;this.state=U.STARTING}this.nextLoadPosition=this.startPosition=this.lastCurrentTime;this.tick()}else{W.logger.warn("cannot start loading as either manifest not parsed or video not attached")}}},{key:"startInternal",value:function ah(){var aR=this.hls;this.stop();this.demuxer=new Y["default"](aR);this.timer=setInterval(this.ontick,100);this.level=-1;aR.on(R["default"].FRAG_LOADED,this.onfl);aR.on(R["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aR.on(R["default"].FRAG_PARSING_DATA,this.onfpg);aR.on(R["default"].FRAG_PARSED,this.onfp);aR.on(R["default"].ERROR,this.onerr);aR.on(R["default"].LEVEL_LOADED,this.onll);aR.on(R["default"].KEY_LOADED,this.onkl)}},{key:"stop",value:function ar(){this.mp4segments=[];this.flushRange=[];this.bufferRange=[];var aV=this.fragCurrent;if(aV){if(aV.loader){aV.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.sourceBuffer){for(var aS in this.sourceBuffer){var aU=this.sourceBuffer[aS];try{this.mediaSource.removeSourceBuffer(aU);aU.removeEventListener("updateend",this.onsbue);aU.removeEventListener("error",this.onsbe)}catch(aT){}}this.sourceBuffer=null}if(this.timer){clearInterval(this.timer);this.timer=null}if(this.demuxer){this.demuxer.destroy();this.demuxer=null}var aR=this.hls;aR.off(R["default"].FRAG_LOADED,this.onfl);aR.off(R["default"].FRAG_PARSED,this.onfp);aR.off(R["default"].FRAG_PARSING_DATA,this.onfpg);aR.off(R["default"].LEVEL_LOADED,this.onll);aR.off(R["default"].KEY_LOADED,this.onkl);aR.off(R["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aR.off(R["default"].ERROR,this.onerr)}},{key:"tick",value:function af(){var a3,aT,bd,bj=this.hls;switch(this.state){case U.ERROR:break;case U.STARTING:this.startLevel=bj.startLevel;if(this.startLevel===-1){this.startLevel=0;this.fragBitrateTest=true}this.level=bj.nextLoadLevel=this.startLevel;this.state=U.WAITING_LEVEL;this.loadedmetadata=false;break;case U.IDLE:if(!this.media){break}if(this.loadedmetadata){a3=this.media.currentTime}else{a3=this.nextLoadPosition}if(this.startFragmentRequested===false){aT=this.startLevel}else{aT=bj.nextLoadLevel}var ba=this.bufferInfo(a3,0.3),bh=ba.len,aZ=ba.end,a2=this.fragPrevious,a9;if(this.levels[aT].hasOwnProperty("bitrate")){a9=Math.max(8*this.config.maxBufferSize/this.levels[aT].bitrate,this.config.maxBufferLength);a9=Math.min(a9,this.config.maxBufferLength)}else{a9=this.config.maxBufferLength}if(bh<a9){bj.nextLoadLevel=aT;this.level=aT;bd=this.levels[aT].details;if(typeof bd==="undefined"){this.state=U.WAITING_LEVEL;break}var bk=bd.fragments,bf=bk.length,a0=bk[0].start,aY=bk[bf-1].start+bk[bf-1].duration,be=undefined;if(bd.live){if(aZ<Math.max(a0,aY-this.config.liveMaxLatencyDurationCount*bd.targetduration)){this.seekAfterBuffered=a0+Math.max(0,bd.totalduration-this.config.liveSyncDurationCount*bd.targetduration);W.logger.log("buffer end: "+aZ+" is located too far from the end of live sliding playlist, media position will be reseted to: "+this.seekAfterBuffered.toFixed(3));aZ=this.seekAfterBuffered}if(this.startFragmentRequested&&!bd.PTSKnown){if(a2){var aS=a2.sn+1;if(aS>=bd.startSN&&aS<=bd.endSN){be=bk[aS-bd.startSN];W.logger.log("live playlist, switching playlist, load frag with next SN: "+be.sn)}}if(!be){be=bk[Math.min(bf-1,Math.round(bf/2))];W.logger.log("live playlist, switching playlist, unknown, load middle frag : "+be.sn)}}}else{if(aZ<a0){be=bk[0]}}if(!be){var a5;if(aZ<aY){a5=O["default"].search(bk,function(bl){if(bl.start+bl.duration<=aZ){return 1}else{if(bl.start>aZ){return -1}}return 0})}else{a5=bk[bf-1]}if(a5){be=a5;a0=a5.start;if(a2&&be.level===a2.level&&be.sn===a2.sn){if(be.sn<bd.endSN){be=bk[be.sn+1-bd.startSN];W.logger.log("SN just loaded, load next one: "+be.sn)}else{if(!bd.live){var aX=this.mediaSource;if(aX&&aX.readyState==="open"){var aU=this.sourceBuffer;if(!(aU.audio&&aU.audio.updating||aU.video&&aU.video.updating)){W.logger.log("all media data available, signal endOfStream() to MediaSource");aX.endOfStream()}}}be=null}}}}if(be){if(be.decryptdata.uri!=null&&be.decryptdata.key==null){W.logger.log("Loading key for "+be.sn+" of ["+bd.startSN+" ,"+bd.endSN+"],level "+aT);this.state=U.KEY_LOADING;bj.trigger(R["default"].KEY_LOADING,{frag:be})}else{W.logger.log("Loading "+be.sn+" of ["+bd.startSN+" ,"+bd.endSN+"],level "+aT+", currentTime:"+a3+",bufferEnd:"+aZ.toFixed(3));be.autoLevel=bj.autoLevelEnabled;if(this.levels.length>1){be.expectedLen=Math.round(be.duration*this.levels[aT].bitrate/8);be.trequest=performance.now()}if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(be.loadCounter){be.loadCounter++;var bi=this.config.fragLoadingLoopThreshold;if(be.loadCounter>bi&&Math.abs(this.fragLoadIdx-be.loadIdx)<bi){bj.trigger(R["default"].ERROR,{type:Z.ErrorTypes.MEDIA_ERROR,details:Z.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:be});return}}else{be.loadCounter=1}be.loadIdx=this.fragLoadIdx;this.fragCurrent=be;this.startFragmentRequested=true;bj.trigger(R["default"].FRAG_LOADING,{frag:be});this.state=U.FRAG_LOADING}}}break;case U.WAITING_LEVEL:aT=this.levels[this.level];if(aT&&aT.details){this.state=U.IDLE}break;case U.FRAG_LOADING:var a8=this.media,aW=this.fragCurrent;if(a8&&(!a8.paused||this.loadedmetadata===false)&&aW.autoLevel&&this.level&&this.levels.length>1){var a7=performance.now()-aW.trequest;if(a7>500*aW.duration){var aR=aW.loaded*1000/a7;if(aW.expectedLen<aW.loaded){aW.expectedLen=aW.loaded}a3=a8.currentTime;var a4=(aW.expectedLen-aW.loaded)/aR;var bc=this.bufferInfo(a3,0.3).end-a3;var a6=aW.duration*this.levels[bj.nextLoadLevel].bitrate/(8*aR);if(bc<2*aW.duration&&a4>bc&&a4>a6){W.logger.warn("loading too slow, abort fragment loading");W.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay :"+a4.toFixed(1)+"/"+bc.toFixed(1)+"/"+a6.toFixed(1));aW.loader.abort();bj.trigger(R["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:aW});this.state=U.IDLE}}}break;case U.PARSING:break;case U.PARSED:case U.APPENDING:if(this.sourceBuffer){if(this.media.error){W.logger.error("trying to append although a media error occured, switch to ERROR state");this.state=U.ERROR;return}else{if(this.sourceBuffer.audio&&this.sourceBuffer.audio.updating||this.sourceBuffer.video&&this.sourceBuffer.video.updating){}else{if(this.mp4segments.length){var aV=this.mp4segments.shift();try{this.sourceBuffer[aV.type].appendBuffer(aV.data);this.appendError=0}catch(a1){this.mp4segments.unshift(aV);if(this.appendError){this.appendError++}else{this.appendError=1}var bg={type:Z.ErrorTypes.MEDIA_ERROR,details:Z.ErrorDetails.BUFFER_APPEND_ERROR,frag:this.fragCurrent};if(this.appendError>this.config.appendErrorMaxRetry){W.logger.log("fail "+this.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");bg.fatal=true;bj.trigger(R["default"].ERROR,bg);this.state=U.ERROR;return}else{bg.fatal=false;bj.trigger(R["default"].ERROR,bg)}}this.state=U.APPENDING}}}}else{this.state=U.IDLE}break;case U.BUFFER_FLUSHING:while(this.flushRange.length){var bb=this.flushRange[0];if(this.flushBuffer(bb.start,bb.end)){this.flushRange.shift()}else{break}}if(this.flushRange.length===0){if(this.immediateSwitch){this.immediateLevelSwitchEnd()}this.state=U.IDLE;this.fragPrevious=null}break;default:break}this._checkFragmentChanged();this._checkBuffer()}},{key:"bufferInfo",value:function ak(aW,aU){var aV=this.media,aR=aV.buffered,aT=[],aS;for(aS=0;aS<aR.length;aS++){aT.push({start:aR.start(aS),end:aR.end(aS)})}return this.bufferedInfo(aT,aW,aU)}},{key:"bufferedInfo",value:function ao(aT,a0,aY){var aX=[],aS,a2,a3,aZ,aV;aT.sort(function(a5,a4){var a6=a5.start-a4.start;if(a6){return a6}else{return a4.end-a5.end}});for(aV=0;aV<aT.length;aV++){var a1=aX.length;if(a1){var aW=aX[a1-1].end;if(aT[aV].start-aW<aY){if(aT[aV].end>aW){aX[a1-1].end=aT[aV].end}}else{aX.push(aT[aV])}}else{aX.push(aT[aV])}}for(aV=0,aS=0,a2=a3=a0;aV<aX.length;aV++){var aR=aX[aV].start,aU=aX[aV].end;if(a0+aY>=aR&&a0<aU){a2=aR;a3=aU+aY;aS=a3-a0}else{if(a0+aY<aR){aZ=aR}}}return{len:aS,start:a2,end:a3,nextStart:aZ}}},{key:"getBufferRange",value:function ag(aR){var aT,aS;for(aT=this.bufferRange.length-1;aT>=0;aT--){aS=this.bufferRange[aT];if(aR>=aS.start&&aR<=aS.end){return aS}}return null}},{key:"followingBufferRange",value:function at(aR){if(aR){return this.getBufferRange(aR.end+0.5)}return null}},{key:"isBuffered",value:function an(aR){var aS=this.media,aU=aS.buffered;for(var aT=0;aT<aU.length;aT++){if(aR>=aU.start(aT)&&aR<=aU.end(aT)){return true}}return false}},{key:"_checkFragmentChanged",value:function aK(){var aU,aS,aR=this.media;if(aR&&aR.seeking===false){aS=aR.currentTime;if(aS>aR.playbackRate*this.lastCurrentTime){this.lastCurrentTime=aS}if(this.isBuffered(aS)){aU=this.getBufferRange(aS)}else{if(this.isBuffered(aS+0.1)){aU=this.getBufferRange(aS+0.1)}}if(aU){var aT=aU.frag;if(aT!==this.fragPlaying){this.fragPlaying=aT;this.hls.trigger(R["default"].FRAG_CHANGED,{frag:aT})}}}}},{key:"flushBuffer",value:function ac(aV,aX){var aZ,aS,aR,aY,a1,aU;if(this.flushBufferCounter++<2*this.bufferRange.length&&this.sourceBuffer){for(var aW in this.sourceBuffer){aZ=this.sourceBuffer[aW];if(!aZ.updating){for(aS=0;aS<aZ.buffered.length;aS++){aR=aZ.buffered.start(aS);aY=aZ.buffered.end(aS);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&aX===Number.POSITIVE_INFINITY){a1=aV;aU=aX}else{a1=Math.max(aR,aV);aU=Math.min(aY,aX)}if(aU-a1>0.5){W.logger.log("flush "+aW+" ["+a1+","+aU+"], of ["+aR+","+aY+"], pos:"+this.media.currentTime);aZ.remove(a1,aU);return false}}}else{return false}}}var a0=[],aT;for(aS=0;aS<this.bufferRange.length;aS++){aT=this.bufferRange[aS];if(this.isBuffered((aT.start+aT.end)/2)){a0.push(aT)}}this.bufferRange=a0;W.logger.log("buffer flushed");return true}},{key:"immediateLevelSwitch",value:function aw(){W.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;this.previouslyPaused=this.media.paused;this.media.pause()}var aR=this.fragCurrent;if(aR&&aR.loader){aR.loader.abort()}this.fragCurrent=null;this.flushBufferCounter=0;this.flushRange.push({start:0,end:Number.POSITIVE_INFINITY});this.state=U.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}},{key:"immediateLevelSwitchEnd",value:function aI(){this.immediateSwitch=false;this.media.currentTime-=0.0001;if(!this.previouslyPaused){this.media.play()}}},{key:"nextLevelSwitch",value:function aA(){var aW,aR,aX;aR=this.getBufferRange(this.media.currentTime);if(aR){this.flushRange.push({start:0,end:aR.start-1})}if(!this.media.paused){var aT=this.hls.nextLoadLevel,aV=this.levels[aT],aU=this.fragLastKbps;if(aU&&this.fragCurrent){aW=this.fragCurrent.duration*aV.bitrate/(1000*aU)+1}else{aW=0}}else{aW=0}aX=this.getBufferRange(this.media.currentTime+aW);if(aX){aX=this.followingBufferRange(aX);if(aX){this.flushRange.push({start:aX.start,end:Number.POSITIVE_INFINITY});var aS=this.fragCurrent;if(aS&&aS.loader){aS.loader.abort()}this.fragCurrent=null}}if(this.flushRange.length){this.flushBufferCounter=0;this.state=U.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}}},{key:"onMediaAttaching",value:function aq(aS,aT){var aU=this.media=aT.media;var aR=this.mediaSource=new MediaSource();this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);aR.addEventListener("sourceopen",this.onmso);aR.addEventListener("sourceended",this.onmse);aR.addEventListener("sourceclose",this.onmsc);aU.src=URL.createObjectURL(aR)}},{key:"onMediaDetaching",value:function au(){var aU=this.media;if(aU&&aU.ended){W.logger.log("MSE detaching and video ended, reset startPosition");this.startPosition=this.lastCurrentTime=0}var aT=this.levels;if(aT){aT.forEach(function(aV){if(aV.details){aV.details.fragments.forEach(function(aW){aW.loadCounter=undefined})}})}var aR=this.mediaSource;if(aR){if(aR.readyState==="open"){try{aR.endOfStream()}catch(aS){W.logger.warn("onMediaDetaching:"+aS.message+" while calling endOfStream")}}aR.removeEventListener("sourceopen",this.onmso);aR.removeEventListener("sourceended",this.onmse);aR.removeEventListener("sourceclose",this.onmsc);this.media.src="";this.mediaSource=null;if(aU){aU.removeEventListener("seeking",this.onvseeking);aU.removeEventListener("seeked",this.onvseeked);aU.removeEventListener("loadedmetadata",this.onvmetadata);aU.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvmetadata=null}this.media=null;this.loadedmetadata=false;this.stop()}this.onmso=this.onmse=this.onmsc=null;this.hls.trigger(R["default"].MEDIA_DETACHED)}},{key:"onMediaSeeking",value:function am(){if(this.state===U.FRAG_LOADING){if(this.bufferInfo(this.media.currentTime,0.3).len===0){W.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");var aR=this.fragCurrent;if(aR){if(aR.loader){aR.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;this.state=U.IDLE}}if(this.media){this.lastCurrentTime=this.media.currentTime}if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()}},{key:"onMediaSeeked",value:function aQ(){this.tick()}},{key:"onMediaMetadata",value:function aJ(){if(this.media.currentTime!==this.startPosition){this.media.currentTime=this.startPosition}this.loadedmetadata=true;this.tick()}},{key:"onMediaEnded",value:function az(){W.logger.log("media ended");this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function aN(aU,aV){var aS=false,aT=false,aR;aV.levels.forEach(function(aW){aR=aW.codecs;if(aR){if(aR.indexOf("mp4a.40.2")!==-1){aS=true}if(aR.indexOf("mp4a.40.5")!==-1){aT=true}}});this.audiocodecswitch=aS&&aT;if(this.audiocodecswitch){W.logger.log("both AAC/HE-AAC audio found in levels; declaring audio codec as HE-AAC")}this.levels=aV.levels;this.startLevelLoaded=false;this.startFragmentRequested=false;if(this.media&&this.config.autoStartLoad){this.startLoad()}}},{key:"onLevelLoaded",value:function aC(aV,aW){var aT=aW.details,aS=aW.level,aR=this.levels[aS],aX=aT.totalduration;W.logger.log("level "+aS+" loaded ["+aT.startSN+","+aT.endSN+"],duration:"+aX);if(aT.live){var aU=aR.details;if(aU){Q["default"].mergeDetails(aU,aT);if(aT.PTSKnown){W.logger.log("live playlist sliding:"+aT.fragments[0].start.toFixed(3))}else{W.logger.log("live playlist - outdated PTS, unknown sliding")}}else{aT.PTSKnown=false;W.logger.log("live playlist - first load, unknown sliding")}}else{aT.PTSKnown=false}aR.details=aT;this.hls.trigger(R["default"].LEVEL_UPDATED,{details:aT,level:aS});if(this.startLevelLoaded===false){if(aT.live){this.startPosition=Math.max(0,aX-this.config.liveSyncDurationCount*aT.targetduration)}this.nextLoadPosition=this.startPosition;this.startLevelLoaded=true}if(this.state===U.WAITING_LEVEL){this.state=U.IDLE}this.tick()}},{key:"onKeyLoaded",value:function ax(){if(this.state===U.KEY_LOADING){this.state=U.IDLE;this.tick()}}},{key:"onFragLoaded",value:function aH(aT,aY){var aZ=this.fragCurrent;if(this.state===U.FRAG_LOADING&&aZ&&aY.frag.level===aZ.level&&aY.frag.sn===aZ.sn){if(this.fragBitrateTest===true){this.state=U.IDLE;this.fragBitrateTest=false;aY.stats.tparsed=aY.stats.tbuffered=performance.now();this.hls.trigger(R["default"].FRAG_BUFFERED,{stats:aY.stats,frag:aZ})}else{this.state=U.PARSING;this.stats=aY.stats;var aV=this.levels[this.level],aR=aV.details,aX=aR.totalduration,aU=aZ.start,aS=aZ.level,aW=aZ.sn,a0=aV.audioCodec;if(a0&&this.audioCodecSwap){W.logger.log("swapping playlist audio codec");if(a0.indexOf("mp4a.40.5")!==-1){a0="mp4a.40.2"}else{a0="mp4a.40.5"}}W.logger.log("Demuxing "+aW+" of ["+aR.startSN+" ,"+aR.endSN+"],level "+aS);this.demuxer.push(aY.payload,a0,aV.videoCodec,aU,aZ.cc,aS,aW,aX,aZ.decryptdata)}}}},{key:"onInitSegment",value:function ay(aT,aU){if(this.state===U.PARSING){var aV=this.levels[this.level].audioCodec,aR=this.levels[this.level].videoCodec,aW;if(aV&&this.audioCodecSwap){W.logger.log("swapping playlist audio codec");if(aV.indexOf("mp4a.40.5")!==-1){aV="mp4a.40.2"}else{aV="mp4a.40.5"}}W.logger.log("playlist_level/init_segment codecs: video => "+aR+"/"+aU.videoCodec+"; audio => "+aV+"/"+aU.audioCodec);if(aV===undefined||aU.audioCodec===undefined){aV=aU.audioCodec}if(aR===undefined||aU.videoCodec===undefined){aR=aU.videoCodec}var aS=navigator.userAgent.toLowerCase();if(this.audiocodecswitch&&aU.audioChannelCount!==1&&aS.indexOf("android")===-1&&aS.indexOf("firefox")===-1){aV="mp4a.40.5"}if(!this.sourceBuffer){this.sourceBuffer={};W.logger.log("selected A/V codecs for sourceBuffers:"+aV+","+aR);if(aV){aW=this.sourceBuffer.audio=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aV);aW.addEventListener("updateend",this.onsbue);aW.addEventListener("error",this.onsbe)}if(aR){aW=this.sourceBuffer.video=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aR);aW.addEventListener("updateend",this.onsbue);aW.addEventListener("error",this.onsbe)}}if(aV){this.mp4segments.push({type:"audio",data:aU.audioMoov})}if(aR){this.mp4segments.push({type:"video",data:aU.videoMoov})}this.tick()}}},{key:"onFragParsing",value:function aF(aS,aT){if(this.state===U.PARSING){this.tparse2=Date.now();var aV=this.levels[this.level],aU=this.fragCurrent;W.logger.log("parsed data, type/startPTS/endPTS/startDTS/endDTS/nb:"+aT.type+"/"+aT.startPTS.toFixed(3)+"/"+aT.endPTS.toFixed(3)+"/"+aT.startDTS.toFixed(3)+"/"+aT.endDTS.toFixed(3)+"/"+aT.nb);var aR=Q["default"].updateFragPTS(aV.details,aU.sn,aT.startPTS,aT.endPTS);this.hls.trigger(R["default"].LEVEL_PTS_UPDATED,{details:aV.details,level:this.level,drift:aR});this.mp4segments.push({type:aT.type,data:aT.moof});this.mp4segments.push({type:aT.type,data:aT.mdat});this.nextLoadPosition=aT.endPTS;this.bufferRange.push({type:aT.type,start:aT.startPTS,end:aT.endPTS,frag:aU});this.tick()}else{W.logger.warn("not in PARSING state, discarding "+aS)}}},{key:"onFragParsed",value:function aP(){if(this.state===U.PARSING){this.state=U.PARSED;this.stats.tparsed=performance.now();this.tick()}}},{key:"onError",value:function ap(aR,aS){switch(aS.details){case Z.ErrorDetails.FRAG_LOAD_ERROR:case Z.ErrorDetails.FRAG_LOAD_TIMEOUT:case Z.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case Z.ErrorDetails.LEVEL_LOAD_ERROR:case Z.ErrorDetails.LEVEL_LOAD_TIMEOUT:case Z.ErrorDetails.KEY_LOAD_ERROR:case Z.ErrorDetails.KEY_LOAD_TIMEOUT:W.logger.warn("mediaController: "+aS.details+" while loading frag,switch to "+(aS.fatal?"ERROR":"IDLE")+" state ...");this.state=aS.fatal?U.ERROR:U.IDLE;break;default:break}}},{key:"onSBUpdateEnd",value:function aj(){if(this.state===U.APPENDING&&this.mp4segments.length===0){var aS=this.fragCurrent,aR=this.stats;if(aS){this.fragPrevious=aS;aR.tbuffered=performance.now();this.fragLastKbps=Math.round(8*aR.length/(aR.tbuffered-aR.tfirst));this.hls.trigger(R["default"].FRAG_BUFFERED,{stats:aR,frag:aS});W.logger.log("media buffered : "+this.timeRangesToString(this.media.buffered));this.state=U.IDLE}}this.tick()}},{key:"_checkBuffer",value:function aO(){var aW=this.media;if(aW){var aR=aW.readyState;if(aR){var aV=this.seekAfterBuffered;if(aV){if(aW.duration>=aV){aW.currentTime=aV;this.seekAfterBuffered=undefined}}else{if(aR<3){var aT=aW.currentTime;var aS=this.bufferInfo(aT,0);if(aS.len===0){var aU=aS.nextStart;if(aU&&aU-aT<0.3){W.logger.log("adjust currentTime from "+aT+" to "+aU);aW.currentTime=aU}}}}}}}},{key:"swapAudioCodec",value:function aG(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"onSBUpdateError",value:function al(aR){W.logger.error("sourceBuffer error:"+aR);this.state=U.ERROR;this.hls.trigger(R["default"].ERROR,{type:Z.ErrorTypes.MEDIA_ERROR,details:Z.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:false,frag:this.fragCurrent})}},{key:"timeRangesToString",value:function aB(aU){var aT="",aR=aU.length;for(var aS=0;aS<aR;aS++){aT+="["+aU.start(aS)+","+aU.end(aS)+"]"}return aT}},{key:"onMediaSourceOpen",value:function aD(){W.logger.log("media source opened");this.hls.trigger(R["default"].MEDIA_ATTACHED);this.onvseeking=this.onMediaSeeking.bind(this);this.onvseeked=this.onMediaSeeked.bind(this);this.onvmetadata=this.onMediaMetadata.bind(this);this.onvended=this.onMediaEnded.bind(this);var aR=this.media;aR.addEventListener("seeking",this.onvseeking);aR.addEventListener("seeked",this.onvseeked);aR.addEventListener("loadedmetadata",this.onvmetadata);aR.addEventListener("ended",this.onvended);if(this.levels&&this.config.autoStartLoad){this.startLoad()}this.mediaSource.removeEventListener("sourceopen",this.onmso)}},{key:"onMediaSourceClose",value:function aM(){W.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function ae(){W.logger.log("media source ended")}},{key:"currentLevel",get:function aL(){if(this.media){var aR=this.getBufferRange(this.media.currentTime);if(aR){return aR.frag.level}}return -1}},{key:"nextBufferRange",get:function aL(){if(this.media){return this.followingBufferRange(this.getBufferRange(this.media.currentTime))}else{return null}}},{key:"nextLevel",get:function aL(){var aR=this.nextBufferRange;if(aR){return aR.frag.level}else{return -1}}}]);return av})();ab["default"]=aa;L.exports=ab["default"]},{"../demux/demuxer":12,"../errors":16,"../events":17,"../helper/level-helper":18,"../utils/binary-search":25,"../utils/logger":26}],6:[function(M,O,K){Object.defineProperty(K,"__esModule",{value:true});var N=(function(){function Q(U,S){for(var R=0;R<S.length;R++){var T=S[R];T.enumerable=T.enumerable||false;T.configurable=true;if("value" in T){T.writable=true}Object.defineProperty(U,T.key,T)}}return function(T,R,S){if(R){Q(T.prototype,R)}if(S){Q(T,S)}return T}})();function P(Q,R){if(!(Q instanceof R)){throw new TypeError("Cannot call a class as a function")}}var L=(function(){function S(aa){P(this,S);this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]];this._precompute();var W,V,X,Z,ac,Y=this._tables[0][4],ab=this._tables[1],T=aa.length,U=1;if(T!==4&&T!==6&&T!==8){throw new Error("Invalid aes key size="+T)}Z=aa.slice(0);ac=[];this._key=[Z,ac];for(W=T;W<4*T+28;W++){X=Z[W-1];if(W%T===0||T===8&&W%T===4){X=Y[X>>>24]<<24^Y[X>>16&255]<<16^Y[X>>8&255]<<8^Y[X&255];if(W%T===0){X=X<<8^X>>>24^U<<24;U=U<<1^(U>>7)*283}}Z[W]=Z[W-T]^X}for(V=0;W;V++,W--){X=Z[V&3?W:W-4];if(W<=4||V<4){ac[V]=X}else{ac[V]=ab[0][Y[X>>>24]]^ab[1][Y[X>>16&255]]^ab[2][Y[X>>8&255]]^ab[3][Y[X&255]]}}}N(S,[{key:"_precompute",value:function Q(){var aa=this._tables[0],ai=this._tables[1],Z=aa[4],af=ai[4],Y,ac,X,ab=[],V=[],U,ah,ae,ag,W,T;for(Y=0;Y<256;Y++){V[(ab[Y]=Y<<1^(Y>>7)*283)^Y]=Y}for(ac=X=0;!Z[ac];ac^=U||1,X=V[X]||1){ag=X^X<<1^X<<2^X<<3^X<<4;ag=ag>>8^ag&255^99;Z[ac]=ag;af[ag]=ac;ae=ab[ah=ab[U=ab[ac]]];T=ae*16843009^ah*65537^U*257^ac*16843008;W=ab[ag]*257^ag*16843008;for(Y=0;Y<4;Y++){aa[Y][ac]=W=W<<24^W>>>8;ai[Y][ag]=T=T<<24^T>>>8}}for(Y=0;Y<5;Y++){aa[Y]=aa[Y].slice(0);ai[Y]=ai[Y].slice(0)}}},{key:"decrypt",value:function R(an,am,ak,ai,ab,T){var aq=this._key[1],al=an^aq[0],aj=ai^aq[1],ah=ak^aq[2],ag=am^aq[3],ao,U,W,ap=aq.length/4-2,aa,X=4,af=this._tables[1],ae=af[0],ac=af[1],Z=af[2],Y=af[3],V=af[4];for(aa=0;aa<ap;aa++){ao=ae[al>>>24]^ac[aj>>16&255]^Z[ah>>8&255]^Y[ag&255]^aq[X];U=ae[aj>>>24]^ac[ah>>16&255]^Z[ag>>8&255]^Y[al&255]^aq[X+1];W=ae[ah>>>24]^ac[ag>>16&255]^Z[al>>8&255]^Y[aj&255]^aq[X+2];ag=ae[ag>>>24]^ac[al>>16&255]^Z[aj>>8&255]^Y[ah&255]^aq[X+3];X+=4;al=ao;aj=U;ah=W}for(aa=0;aa<4;aa++){ab[(3&-aa)+T]=V[al>>>24]<<24^V[aj>>16&255]<<16^V[ah>>8&255]<<8^V[ag&255]^aq[X++];ao=al;al=aj;aj=ah;ah=ag;ag=ao}}}]);return S})();K["default"]=L;O.exports=K["default"]},{}],7:[function(N,L,P){Object.defineProperty(P,"__esModule",{value:true});var O=(function(){function T(X,V){for(var U=0;U<V.length;U++){var W=V[U];W.enumerable=W.enumerable||false;W.configurable=true;if("value" in W){W.writable=true}Object.defineProperty(X,W.key,W)}}return function(W,U,V){if(U){T(W.prototype,U)}if(V){T(W,V)}return W}})();function S(T){return T&&T.__esModule?T:{"default":T}}function R(T,U){if(!(T instanceof U)){throw new TypeError("Cannot call a class as a function")}}var K=N("./aes");var M=S(K);var Q=(function(){function T(Z,Y){R(this,T);this.key=Z;this.iv=Y}O(T,[{key:"ntoh",value:function W(Y){return Y<<24|(Y&65280)<<8|(Y&16711680)>>8|Y>>>24}},{key:"doDecrypt",value:function U(ak,am,aa){var al=new Int32Array(ak.buffer,ak.byteOffset,ak.byteLength>>2),ag=new M["default"](Array.prototype.slice.call(am)),an=new Uint8Array(ak.byteLength),ao=new Int32Array(an.buffer),aj,ai,ah,af,ae,ac,ab,Z,Y;aj=~~aa[0];ai=~~aa[1];ah=~~aa[2];af=~~aa[3];for(Y=0;Y<al.length;Y+=4){ae=~~this.ntoh(al[Y]);ac=~~this.ntoh(al[Y+1]);ab=~~this.ntoh(al[Y+2]);Z=~~this.ntoh(al[Y+3]);ag.decrypt(ae,ac,ab,Z,ao,Y);ao[Y]=this.ntoh(ao[Y]^aj);ao[Y+1]=this.ntoh(ao[Y+1]^ai);ao[Y+2]=this.ntoh(ao[Y+2]^ah);ao[Y+3]=this.ntoh(ao[Y+3]^af);aj=ae;ai=ac;ah=ab;af=Z}return an}},{key:"localDecript",value:function X(ac,ab,aa,Z){var Y=this.doDecrypt(ac,ab,aa);Z.set(Y,ac.byteOffset)}},{key:"decrypt",value:function V(ae){var ac=4*8000,af=new Int32Array(ae),Y=new Uint8Array(ae.byteLength),ab=0;var aa=this.key;var Z=this.iv;this.localDecript(af.subarray(ab,ab+ac),aa,Z,Y);for(ab=ac;ab<af.length;ab+=ac){Z=new Uint32Array([this.ntoh(af[ab-4]),this.ntoh(af[ab-3]),this.ntoh(af[ab-2]),this.ntoh(af[ab-1])]);this.localDecript(af.subarray(ab,ab+ac),aa,Z,Y)}return Y}}]);return T})();P["default"]=Q;L.exports=P["default"]},{"./aes":6}],8:[function(L,K,P){Object.defineProperty(P,"__esModule",{value:true});var O=(function(){function V(Z,X){for(var W=0;W<X.length;W++){var Y=X[W];Y.enumerable=Y.enumerable||false;Y.configurable=true;if("value" in Y){Y.writable=true}Object.defineProperty(Z,Y.key,Y)}}return function(Y,W,X){if(W){V(Y.prototype,W)}if(X){V(Y,X)}return Y}})();function U(V){return V&&V.__esModule?V:{"default":V}}function R(V,W){if(!(V instanceof W)){throw new TypeError("Cannot call a class as a function")}}var S=L("./aes128-decrypter");var M=U(S);var N=L("../errors");var T=L("../utils/logger");var Q=(function(){function aa(ac){R(this,aa);this.hls=ac;try{var ab=window?window.crypto:crypto;this.subtle=ab.subtle||ab.webkitSubtle;this.disableWebCrypto=!this.subtle}catch(ae){this.disableWebCrypto=true}}O(aa,[{key:"destroy",value:function Y(){}},{key:"decrypt",value:function W(ae,ac,ab,af){if(this.disableWebCrypto&&this.hls.config.enableSoftwareAES){this.decryptBySoftware(ae,ac,ab,af)}else{this.decryptByWebCrypto(ae,ac,ab,af)}}},{key:"decryptByWebCrypto",value:function Z(ae,ac,ab,ag){var af=this;T.logger.log("decrypting by WebCrypto API");this.subtle.importKey("raw",ac,{name:"AES-CBC",length:128},false,["decrypt"]).then(function(ah){af.subtle.decrypt({name:"AES-CBC",iv:ab.buffer},ah,ae).then(ag)["catch"](function(ai){af.onWebCryptoError(ai,ae,ac,ab,ag)})})["catch"](function(ah){af.onWebCryptoError(ah,ae,ac,ab,ag)})}},{key:"decryptBySoftware",value:function X(ag,aj,ac,ai){T.logger.log("decrypting by JavaScript Implementation");var ab=new DataView(aj.buffer);var af=new Uint32Array([ab.getUint32(0),ab.getUint32(4),ab.getUint32(8),ab.getUint32(12)]);ab=new DataView(ac.buffer);var ae=new Uint32Array([ab.getUint32(0),ab.getUint32(4),ab.getUint32(8),ab.getUint32(12)]);var ah=new M["default"](af,ae);ai(ah.decrypt(ag).buffer)}},{key:"onWebCryptoError",value:function V(ae,af,ac,ab,ag){if(this.hls.config.enableSoftwareAES){T.logger.log("disabling to use WebCrypto API");this.disableWebCrypto=true;this.decryptBySoftware(af,ac,ab,ag)}else{T.logger.error("decrypting error : "+ae.message);this.hls.trigger(Event.ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:true,reason:ae.message})}}}]);return aa})();P["default"]=Q;K.exports=P["default"]},{"../errors":16,"../utils/logger":26,"./aes128-decrypter":7}],9:[function(L,K,O){Object.defineProperty(O,"__esModule",{value:true});var N=(function(){function V(Z,X){for(var W=0;W<X.length;W++){var Y=X[W];Y.enumerable=Y.enumerable||false;Y.configurable=true;if("value" in Y){Y.writable=true}Object.defineProperty(Z,Y.key,Y)}}return function(Y,W,X){if(W){V(Y.prototype,W)}if(X){V(Y,X)}return Y}})();function U(V){return V&&V.__esModule?V:{"default":V}}function P(V,W){if(!(V instanceof W)){throw new TypeError("Cannot call a class as a function")}}var S=L("../utils/logger");var T=L("../demux/id3");var Q=U(T);var M=L("../errors");var R=(function(){function Z(aa,ab){P(this,Z);this.observer=aa;this.remuxerClass=ab;this.remuxer=new this.remuxerClass(aa);this._aacTrack={type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}N(Z,[{key:"push",value:function W(at,af,ao,ak,al,ac,aq,aa){var ab=new Q["default"](at),ae,ap,an=this._aacTrack,au=ab.timeStamp,ar,ah,ai,aj,am,ag;for(ae=ab.length,ap=at.length;ae<ap-1;ae++){if(at[ae]===255&&(at[ae+1]&240)===240){break}}if(!an.audiosamplerate){ar=this._ADTStoAudioConfig(at,ae,af);an.config=ar.config;an.audiosamplerate=ar.samplerate;an.channelCount=ar.channelCount;an.codec=ar.codec;an.timescale=this.remuxer.timescale;an.duration=this.remuxer.timescale*aa;S.logger.log("parsed codec:"+an.codec+",rate:"+ar.samplerate+",nb channel:"+ar.channelCount)}ah=0;while(ae+5<ap){ai=(at[ae+3]&3)<<11;ai|=at[ae+4]<<3;ai|=(at[ae+5]&224)>>>5;aj=!!(at[ae+1]&1)?7:9;ai-=aj;am=Math.round(90*au+ah*1024*90000/an.audiosamplerate);if(ai>0&&ae+aj+ai<=ap){ag={unit:at.subarray(ae+aj,ae+aj+ai),pts:am,dts:am};an.samples.push(ag);an.len+=ai;ae+=ai+aj;ah++;for(;ae<ap-1;ae++){if(at[ae]===255&&(at[ae+1]&240)===240){break}}}else{break}}this.remuxer.remux(this._aacTrack,{samples:[]},{samples:[{pts:au,dts:au,unit:ab.payload}]},ak)}},{key:"_ADTStoAudioConfig",value:function Y(ae,ac,ak){var ah,ag,af,ab,aa,aj=navigator.userAgent.toLowerCase(),ai=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];ah=((ae[ac+2]&192)>>>6)+1;ag=(ae[ac+2]&60)>>>2;if(ag>ai.length-1){this.observer.trigger(Event.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+ag});return}ab=(ae[ac+2]&1)<<2;ab|=(ae[ac+3]&192)>>>6;S.logger.log("manifest codec:"+ak+",ADTS data:type:"+ah+",sampleingIndex:"+ag+"["+ai[ag]+"Hz],channelConfig:"+ab);if(aj.indexOf("firefox")!==-1){if(ag>=6){ah=5;aa=new Array(4);af=ag-3}else{ah=2;aa=new Array(2);af=ag}}else{if(aj.indexOf("android")!==-1){ah=2;aa=new Array(2);af=ag}else{ah=5;aa=new Array(4);if(ak&&ak.indexOf("mp4a.40.5")!==-1||!ak&&ag>=6){af=ag-3}else{if(ak&&ak.indexOf("mp4a.40.2")!==-1&&(ag>=6||ab===1)){ah=2;aa=new Array(2)}af=ag}}}aa[0]=ah<<3;aa[0]|=(ag&14)>>1;aa[1]|=(ag&1)<<7;aa[1]|=ab<<3;if(ah===5){aa[1]|=(af&14)>>1;aa[2]=(af&1)<<7;aa[2]|=2<<2;aa[3]=0}return{config:aa,samplerate:ai[ag],channelCount:ab,codec:"mp4a.40."+ah}}},{key:"destroy",value:function X(){}}],[{key:"probe",value:function V(ae){var ac=new Q["default"](ae),ab,aa;if(ac.hasTimeStamp){for(ab=ac.length,aa=ae.length;ab<aa-1;ab++){if(ae[ab]===255&&(ae[ab+1]&240)===240){return true}}}return false}}]);return Z})();O["default"]=R;K.exports=O["default"]},{"../demux/id3":14,"../errors":16,"../utils/logger":26}],10:[function(L,K,P){Object.defineProperty(P,"__esModule",{value:true});var N=(function(){function Y(ac,aa){for(var Z=0;Z<aa.length;Z++){var ab=aa[Z];ab.enumerable=ab.enumerable||false;ab.configurable=true;if("value" in ab){ab.writable=true}Object.defineProperty(ac,ab.key,ab)}}return function(ab,Z,aa){if(Z){Y(ab.prototype,Z)}if(aa){Y(ab,aa)}return ab}})();function X(Y){return Y&&Y.__esModule?Y:{"default":Y}}function Q(Y,Z){if(!(Y instanceof Z)){throw new TypeError("Cannot call a class as a function")}}var R=L("../events");var S=X(R);var M=L("../errors");var V=L("../demux/aacdemuxer");var U=X(V);var W=L("../demux/tsdemuxer");var T=X(W);var O=(function(){function aa(ac,ab){Q(this,aa);this.hls=ac;this.remuxer=ab}N(aa,[{key:"destroy",value:function Z(){var ab=this.demuxer;if(ab){ab.destroy()}}},{key:"push",value:function Y(ai,ak,ah,aj,af,ab,ae,ag){var ac=this.demuxer;if(!ac){if(T["default"].probe(ai)){ac=this.demuxer=new T["default"](this.hls,this.remuxer)}else{if(U["default"].probe(ai)){ac=this.demuxer=new U["default"](this.hls,this.remuxer)}else{this.hls.trigger(S["default"].ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"no demux matching with content found"});return}}}ac.push(ai,ak,ah,aj,af,ab,ae,ag)}}]);return aa})();P["default"]=O;K.exports=P["default"]},{"../demux/aacdemuxer":9,"../demux/tsdemuxer":15,"../errors":16,"../events":17}],11:[function(N,K,P){Object.defineProperty(P,"__esModule",{value:true});function W(X){return X&&X.__esModule?X:{"default":X}}var O=N("../demux/demuxer-inline");var M=W(O);var R=N("../events");var U=W(R);var T=N("events");var Q=W(T);var V=N("../remux/mp4-remuxer");var S=W(V);var L=function L(Y){var X=new Q["default"]();X.trigger=function Z(ae){for(var ab=arguments.length,af=Array(ab>1?ab-1:0),ac=1;ac<ab;ac++){af[ac-1]=arguments[ac]}X.emit.apply(X,[ae,ae].concat(af))};X.off=function aa(ae){for(var ab=arguments.length,af=Array(ab>1?ab-1:0),ac=1;ac<ab;ac++){af[ac-1]=arguments[ac]}X.removeListener.apply(X,[ae].concat(af))};Y.addEventListener("message",function(ab){switch(ab.data.cmd){case"init":Y.demuxer=new M["default"](X,S["default"]);break;case"demux":var ac=ab.data;Y.demuxer.push(new Uint8Array(ac.data),ac.audioCodec,ac.videoCodec,ac.timeOffset,ac.cc,ac.level,ac.sn,ac.duration);break;default:break}});X.on(U["default"].FRAG_PARSING_INIT_SEGMENT,function(ae,af){var ab={event:ae};var ac=[];if(af.audioCodec){ab.audioCodec=af.audioCodec;ab.audioMoov=af.audioMoov.buffer;ab.audioChannelCount=af.audioChannelCount;ac.push(ab.audioMoov)}if(af.videoCodec){ab.videoCodec=af.videoCodec;ab.videoMoov=af.videoMoov.buffer;ab.videoWidth=af.videoWidth;ab.videoHeight=af.videoHeight;ac.push(ab.videoMoov)}Y.postMessage(ab,ac)});X.on(U["default"].FRAG_PARSING_DATA,function(ac,ae){var ab={event:ac,type:ae.type,startPTS:ae.startPTS,endPTS:ae.endPTS,startDTS:ae.startDTS,endDTS:ae.endDTS,moof:ae.moof.buffer,mdat:ae.mdat.buffer,nb:ae.nb};Y.postMessage(ab,[ab.moof,ab.mdat])});X.on(U["default"].FRAG_PARSED,function(ab){Y.postMessage({event:ab})});X.on(U["default"].ERROR,function(ab,ac){Y.postMessage({event:ab,data:ac})});X.on(U["default"].FRAG_PARSING_METADATA,function(ac,ae){var ab={event:ac,samples:ae.samples};Y.postMessage(ab)})};P["default"]=L;K.exports=P["default"]},{"../demux/demuxer-inline":10,"../events":17,"../remux/mp4-remuxer":24,events:1}],12:[function(Q,M,ab){Object.defineProperty(ab,"__esModule",{value:true});var X=(function(){function ac(ah,af){for(var ae=0;ae<af.length;ae++){var ag=af[ae];ag.enumerable=ag.enumerable||false;ag.configurable=true;if("value" in ag){ag.writable=true}Object.defineProperty(ah,ag.key,ag)}}return function(ag,ae,af){if(ae){ac(ag.prototype,ae)}if(af){ac(ag,af)}return ag}})();function K(ac){return ac&&ac.__esModule?ac:{"default":ac}}function O(ac,ae){if(!(ac instanceof ae)){throw new TypeError("Cannot call a class as a function")}}var S=Q("../events");var P=K(S);var U=Q("../demux/demuxer-inline");var Y=K(U);var W=Q("../demux/demuxer-worker");var R=K(W);var T=Q("../utils/logger");var L=Q("../remux/mp4-remuxer");var N=K(L);var Z=Q("../crypt/decrypter");var V=K(Z);var aa=(function(){function ae(aj){O(this,ae);this.hls=aj;if(aj.config.enableWorker&&typeof Worker!=="undefined"){T.logger.log("demuxing in webworker");try{var ai=Q("webworkify");this.w=ai(R["default"]);this.onwmsg=this.onWorkerMessage.bind(this);this.w.addEventListener("message",this.onwmsg);this.w.postMessage({cmd:"init"})}catch(ak){T.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline");this.demuxer=new Y["default"](aj,N["default"])}}else{this.demuxer=new Y["default"](aj,N["default"])}this.demuxInitialized=true}X(ae,[{key:"destroy",value:function ag(){if(this.w){this.w.removeEventListener("message",this.onwmsg);this.w.terminate();this.w=null}else{this.demuxer.destroy();this.demuxer=null}if(this.decrypter){this.decrypter.destroy();this.decrypter=null}}},{key:"pushDecrypted",value:function ah(ak,am,aj,ai,ap,ao,an,al){if(this.w){this.w.postMessage({cmd:"demux",data:ak,audioCodec:am,videoCodec:aj,timeOffset:ai,cc:ap,level:ao,sn:an,duration:al},[ak])}else{this.demuxer.push(new Uint8Array(ak),am,aj,ai,ap,ao,an,al)}}},{key:"push",value:function ac(an,ar,am,ap,ak,ai,aj,al,aq){if(an.byteLength>0&&aq!=null&&aq.key!=null&&aq.method==="AES-128"){if(this.decrypter==null){this.decrypter=new V["default"](this.hls)}var ao=this;this.decrypter.decrypt(an,aq.key,aq.iv,function(at){ao.pushDecrypted(at,ar,am,ap,ak,ai,aj,al)})}else{this.pushDecrypted(an,ar,am,ap,ak,ai,aj,al)}}},{key:"onWorkerMessage",value:function af(ai){switch(ai.data.event){case P["default"].FRAG_PARSING_INIT_SEGMENT:var aj={};if(ai.data.audioMoov){aj.audioMoov=new Uint8Array(ai.data.audioMoov);aj.audioCodec=ai.data.audioCodec;aj.audioChannelCount=ai.data.audioChannelCount}if(ai.data.videoMoov){aj.videoMoov=new Uint8Array(ai.data.videoMoov);aj.videoCodec=ai.data.videoCodec;aj.videoWidth=ai.data.videoWidth;aj.videoHeight=ai.data.videoHeight}this.hls.trigger(P["default"].FRAG_PARSING_INIT_SEGMENT,aj);break;case P["default"].FRAG_PARSING_DATA:this.hls.trigger(P["default"].FRAG_PARSING_DATA,{moof:new Uint8Array(ai.data.moof),mdat:new Uint8Array(ai.data.mdat),startPTS:ai.data.startPTS,endPTS:ai.data.endPTS,startDTS:ai.data.startDTS,endDTS:ai.data.endDTS,type:ai.data.type,nb:ai.data.nb});break;case P["default"].FRAG_PARSING_METADATA:this.hls.trigger(P["default"].FRAG_PARSING_METADATA,{samples:ai.data.samples});break;default:this.hls.trigger(ai.data.event,ai.data.data);break}}}]);return ae})();ab["default"]=aa;M.exports=ab["default"]},{"../crypt/decrypter":8,"../demux/demuxer-inline":10,"../demux/demuxer-worker":11,"../events":17,"../remux/mp4-remuxer":24,"../utils/logger":26,webworkify:2}],13:[function(M,O,L){Object.defineProperty(L,"__esModule",{value:true});var N=(function(){function R(V,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||false;U.configurable=true;if("value" in U){U.writable=true}Object.defineProperty(V,U.key,U)}}return function(U,S,T){if(S){R(U.prototype,S)}if(T){R(U,T)}return U}})();function Q(R,S){if(!(R instanceof S)){throw new TypeError("Cannot call a class as a function")}}var K=M("../utils/logger");var P=(function(){function ae(ag){Q(this,ae);this.data=ag;this.bytesAvailable=this.data.byteLength;this.word=0;this.bitsAvailable=0}N(ae,[{key:"loadWord",value:function U(){var ah=this.data.byteLength-this.bytesAvailable,ag=new Uint8Array(4),ai=Math.min(4,this.bytesAvailable);if(ai===0){throw new Error("no bytes available")}ag.set(this.data.subarray(ah,ah+ai));this.word=new DataView(ag.buffer).getUint32(0);this.bitsAvailable=ai*8;this.bytesAvailable-=ai}},{key:"skipBits",value:function af(ag){var ah;if(this.bitsAvailable>ag){this.word<<=ag;this.bitsAvailable-=ag}else{ag-=this.bitsAvailable;ah=ag>>3;ag-=ah>>3;this.bytesAvailable-=ah;this.loadWord();this.word<<=ag;this.bitsAvailable-=ag}}},{key:"readBits",value:function Z(ag){var ai=Math.min(this.bitsAvailable,ag),ah=this.word>>>32-ai;if(ag>32){K.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=ai;if(this.bitsAvailable>0){this.word<<=ai}else{if(this.bytesAvailable>0){this.loadWord()}}ai=ag-ai;if(ai>0){return ah<<ai|this.readBits(ai)}else{return ah}}},{key:"skipLZ",value:function X(){var ag;for(ag=0;ag<this.bitsAvailable;++ag){if(0!==(this.word&2147483648>>>ag)){this.word<<=ag;this.bitsAvailable-=ag;return ag}}this.loadWord();return ag+this.skipLZ()}},{key:"skipUEG",value:function T(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function ab(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function aa(){var ag=this.skipLZ();return this.readBits(ag+1)-1}},{key:"readEG",value:function W(){var ag=this.readUEG();if(1&ag){return 1+ag>>>1}else{return -1*(ag>>>1)}}},{key:"readBoolean",value:function R(){return 1===this.readBits(1)}},{key:"readUByte",value:function V(){return this.readBits(8)}},{key:"skipScalingList",value:function S(aj){var ah=8,ai=8,ag,ak;for(ag=0;ag<aj;ag++){if(ai!==0){ak=this.readEG();ai=(ah+ak+256)%256}ah=ai===0?ah:ai}}},{key:"readSPS",value:function ac(){var aq=0,ar=0,am=0,at=0,ai=1,aw,ag,ap,ak,ah,al,ay,an,au;this.readUByte();aw=this.readUByte();ag=this.readBits(5);this.skipBits(3);ap=this.readUByte();this.skipUEG();if(aw===100||aw===110||aw===122||aw===144){var aj=this.readUEG();if(aj===3){this.skipBits(1)}this.skipUEG();this.skipUEG();this.skipBits(1);if(this.readBoolean()){an=aj!==3?8:12;for(au=0;au<an;au++){if(this.readBoolean()){if(au<6){this.skipScalingList(16)}else{this.skipScalingList(64)}}}}}this.skipUEG();var ax=this.readUEG();if(ax===0){this.readUEG()}else{if(ax===1){this.skipBits(1);this.skipEG();this.skipEG();ak=this.readUEG();for(au=0;au<ak;au++){this.skipEG()}}}this.skipUEG();this.skipBits(1);ah=this.readUEG();al=this.readUEG();ay=this.readBits(1);if(ay===0){this.skipBits(1)}this.skipBits(1);if(this.readBoolean()){aq=this.readUEG();ar=this.readUEG();am=this.readUEG();at=this.readUEG()}if(this.readBoolean()){if(this.readBoolean()){var av=undefined;var ao=this.readUByte();switch(ao){case 2:av=[12,11];break;case 3:av=[10,11];break;case 4:av=[16,11];break;case 5:av=[40,33];break;case 6:av=[24,11];break;case 7:av=[20,11];break;case 8:av=[32,11];break;case 9:av=[80,33];break;case 10:av=[18,11];break;case 11:av=[15,11];break;case 12:av=[64,33];break;case 13:av=[160,99];break;case 14:av=[4,3];break;case 15:av=[3,2];break;case 16:av=[2,1];break;case 255:av=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()];break}if(av){ai=av[0]/av[1]}}}return{width:((ah+1)*16-aq*2-ar*2)*ai,height:(2-ay)*(al+1)*16-(ay?2:4)*(am+at)}}},{key:"readSliceType",value:function Y(){this.readUByte();this.readUEG();return this.readUEG()}}]);return ae})();L["default"]=P;O.exports=L["default"]},{"../utils/logger":26}],14:[function(N,P,M){Object.defineProperty(M,"__esModule",{value:true});var O=(function(){function R(V,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||false;U.configurable=true;if("value" in U){U.writable=true}Object.defineProperty(V,U.key,U)}}return function(U,S,T){if(S){R(U.prototype,S)}if(T){R(U,T)}return U}})();function Q(R,S){if(!(R instanceof S)){throw new TypeError("Cannot call a class as a function")}}var L=N("../utils/logger");var K=(function(){function R(Y){Q(this,R);this._hasTimeStamp=false;var X=0,af,ae,ac,ab,V,W,Z,aa;do{Z=this.readUTF(Y,X,3);X+=3;if(Z==="ID3"){X+=3;af=Y[X++]&127;ae=Y[X++]&127;ac=Y[X++]&127;ab=Y[X++]&127;V=(af<<21)+(ae<<14)+(ac<<7)+ab;W=X+V;this._parseID3Frames(Y,X,W);X=W}else{if(Z==="3DI"){X+=7;L.logger.log("3DI footer found, end: "+X)}else{X-=3;aa=X;if(aa){if(!this.hasTimeStamp){L.logger.warn("ID3 tag found, but no timestamp")}this._length=aa;this._payload=Y.subarray(0,aa)}return}}}while(true)}O(R,[{key:"readUTF",value:function U(Y,aa,W){var V="",Z=aa,X=aa+W;do{V+=String.fromCharCode(Y[Z++])}while(Z<X);return V}},{key:"_parseID3Frames",value:function T(ab,aa,V){var X,ae,Y,Z,ac;while(aa+8<=V){X=this.readUTF(ab,aa,4);aa+=4;ae=ab[aa++]<<24+ab[aa++]<<16+ab[aa++]<<8+ab[aa++];Z=ab[aa++]<<8+ab[aa++];Y=aa;switch(X){case"PRIV":if(this.readUTF(ab,aa,44)==="com.apple.streaming.transportStreamTimestamp"){aa+=44;aa+=4;var W=ab[aa++]&1;this._hasTimeStamp=true;ac=((ab[aa++]<<23)+(ab[aa++]<<15)+(ab[aa++]<<7)+ab[aa++])/45;if(W){ac+=47721858.84}ac=Math.round(ac);L.logger.trace("ID3 timestamp found: "+ac);this._timeStamp=ac}break;default:break}}}},{key:"hasTimeStamp",get:function S(){return this._hasTimeStamp}},{key:"timeStamp",get:function S(){return this._timeStamp}},{key:"length",get:function S(){return this._length}},{key:"payload",get:function S(){return this._payload}}]);return R})();M["default"]=K;P.exports=M["default"]},{"../utils/logger":26}],15:[function(M,K,Q){Object.defineProperty(Q,"__esModule",{value:true});var O=(function(){function X(ab,Z){for(var Y=0;Y<Z.length;Y++){var aa=Z[Y];aa.enumerable=aa.enumerable||false;aa.configurable=true;if("value" in aa){aa.writable=true}Object.defineProperty(ab,aa.key,aa)}}return function(aa,Y,Z){if(Y){X(aa.prototype,Y)}if(Z){X(aa,Z)}return aa}})();function W(X){return X&&X.__esModule?X:{"default":X}}function R(X,Y){if(!(X instanceof Y)){throw new TypeError("Cannot call a class as a function")}}var S=M("../events");var T=W(S);var U=M("./exp-golomb");var L=W(U);var V=M("../utils/logger");var N=M("../errors");var P=(function(){function ae(an,ao){R(this,ae);this.observer=an;this.remuxerClass=ao;this.lastCC=0;this.PES_TIMESCALE=90000;this.remuxer=new this.remuxerClass(an)}O(ae,[{key:"switchLevel",value:function ai(){this.pmtParsed=false;this._pmtId=-1;this._avcTrack={type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0};this._aacTrack={type:"audio",id:-1,sequenceNumber:0,samples:[],len:0};this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0};this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function aj(){this.switchLevel();this.remuxer.insertDiscontinuity()}},{key:"push",value:function ag(aH,ap,aB,au,aw,ao,aE,an){var at,aF,ay,aq,aD=aH.length,az,av,aI,ar;this.audioCodec=ap;this.videoCodec=aB;this.timeOffset=au;this._duration=an;this.contiguous=false;if(aw!==this.lastCC){V.logger.log("discontinuity detected");this.insertDiscontinuity();this.lastCC=aw}else{if(ao!==this.lastLevel){V.logger.log("level switch detected");this.switchLevel();this.lastLevel=ao}else{if(aE===this.lastSN+1){this.contiguous=true}}}this.lastSN=aE;if(!this.contiguous){this.aacOverFlow=null}var aA=this.pmtParsed,aG=this._avcTrack.id,aC=this._aacTrack.id,ax=this._id3Track.id;for(aq=0;aq<aD;aq+=188){if(aH[aq]===71){az=!!(aH[aq+1]&64);av=((aH[aq+1]&31)<<8)+aH[aq+2];aI=(aH[aq+3]&48)>>4;if(aI>1){ar=aq+5+aH[aq+4];if(ar===aq+188){continue}}else{ar=aq+4}if(aA){if(av===aG){if(az){if(at){this._parseAVCPES(this._parsePES(at))}at={data:[],size:0}}if(at){at.data.push(aH.subarray(ar,aq+188));at.size+=aq+188-ar}}else{if(av===aC){if(az){if(aF){this._parseAACPES(this._parsePES(aF))}aF={data:[],size:0}}if(aF){aF.data.push(aH.subarray(ar,aq+188));aF.size+=aq+188-ar}}else{if(av===ax){if(az){if(ay){this._parseID3PES(this._parsePES(ay))}ay={data:[],size:0}}if(ay){ay.data.push(aH.subarray(ar,aq+188));ay.size+=aq+188-ar}}}}}else{if(az){ar+=aH[ar]+1}if(av===0){this._parsePAT(aH,ar)}else{if(av===this._pmtId){this._parsePMT(aH,ar);aA=this.pmtParsed=true;aG=this._avcTrack.id;aC=this._aacTrack.id;ax=this._id3Track.id}}}}else{this.observer.trigger(T["default"].ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(at){this._parseAVCPES(this._parsePES(at))}if(aF){this._parseAACPES(this._parsePES(aF))}if(ay){this._parseID3PES(this._parsePES(ay))}this.remux()}},{key:"remux",value:function af(){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this.timeOffset,this.contiguous)}},{key:"destroy",value:function ak(){this.switchLevel();this._initPTS=this._initDTS=undefined;this._duration=0}},{key:"_parsePAT",value:function ac(an,ao){this._pmtId=(an[ao+10]&31)<<8|an[ao+11]}},{key:"_parsePMT",value:function aa(ar,at){var an,aq,ap,ao;an=(ar[at+1]&15)<<8|ar[at+2];aq=at+3+an-4;ap=(ar[at+10]&15)<<8|ar[at+11];at+=12+ap;while(at<aq){ao=(ar[at+1]&31)<<8|ar[at+2];switch(ar[at]){case 15:this._aacTrack.id=ao;break;case 21:this._id3Track.id=ao;break;case 27:this._avcTrack.id=ao;break;default:V.logger.log("unkown stream type:"+ar[at]);break}at+=((ar[at+3]&15)<<8|ar[at+4])+5}}},{key:"_parsePES",value:function am(av){var aq=0,aw,an,ap,ao,ay,ar,at,ax,au;aw=av.data[0];ap=(aw[0]<<16)+(aw[1]<<8)+aw[2];if(ap===1){ao=(aw[4]<<8)+aw[5];an=aw[7];if(an&192){at=(aw[9]&14)*536870912+(aw[10]&255)*4194304+(aw[11]&254)*16384+(aw[12]&255)*128+(aw[13]&254)/2;if(at>4294967295){at-=8589934592}if(an&64){ax=(aw[14]&14)*536870912+(aw[15]&255)*4194304+(aw[16]&254)*16384+(aw[17]&255)*128+(aw[18]&254)/2;if(ax>4294967295){ax-=8589934592}}else{ax=at}}ay=aw[8];au=ay+9;av.data[0]=av.data[0].subarray(au);av.size-=au;ar=new Uint8Array(av.size);while(av.data.length){aw=av.data.shift();ar.set(aw,aq);aq+=aw.byteLength}return{data:ar,pts:at,dts:ax,len:ao}}else{return null}}},{key:"_parseAVCPES",value:function al(aq){var av=this;var ap=this._avcTrack,aA=ap.samples,aw=this._parseAVCNALu(aq.data),aC=[],an=false,aB=false,ao=0,au,az;if(aw.length===0&&aA.length>0){var ay=aA[aA.length-1];var ax=ay.units.units[ay.units.units.length-1];var at=new Uint8Array(ax.data.byteLength+aq.data.byteLength);at.set(ax.data,0);at.set(aq.data,ax.data.byteLength);ax.data=at;ay.units.length+=aq.data.byteLength;ap.len+=aq.data.byteLength}aq.data=null;var ar="";aw.forEach(function(aI){switch(aI.type){case 1:az=true;if(an){ar+="NDR "}break;case 5:az=true;if(an){ar+="IDR "}aB=true;break;case 6:az=true;if(an){ar+="SEI "}break;case 7:az=true;if(an){ar+="SPS "}if(!ap.sps){var aJ=new L["default"](aI.data);var aF=aJ.readSPS();ap.width=aF.width;ap.height=aF.height;ap.sps=[aI.data];ap.timescale=av.remuxer.timescale;ap.duration=av.remuxer.timescale*av._duration;var aD=aI.data.subarray(1,4);var aE="avc1.";for(var aG=0;aG<3;aG++){var aH=aD[aG].toString(16);if(aH.length<2){aH="0"+aH}aE+=aH}ap.codec=aE}break;case 8:az=true;if(an){ar+="PPS "}if(!ap.pps){ap.pps=[aI.data]}break;case 9:az=true;if(an){ar+="AUD "}break;default:az=false;ar+="unknown NAL "+aI.type+" ";break}if(az){aC.push(aI);ao+=aI.data.byteLength}});if(an||ar.length){V.logger.log(ar)}if(aC.length){if(aB===true||ap.sps){au={units:{units:aC,length:ao},pts:aq.pts,dts:aq.dts,key:aB};aA.push(au);ap.len+=ao;ap.nbNalu+=aC.length}}}},{key:"_parseAVCNALu",value:function ab(av){var ar=0,at=av.byteLength,aA,ao,an=0;var aw=[],aB,az,au,ap;while(ar<at){aA=av[ar++];switch(an){case 0:if(aA===0){an=1}break;case 1:if(aA===0){an=2}else{an=0}break;case 2:case 3:if(aA===0){an=3}else{if(aA===1){az=av[ar]&31;if(au){aB={data:av.subarray(au,ar-an-1),type:ap};aw.push(aB)}else{ao=ar-an-1;if(ao){if(this._avcTrack.samples.length){var ay=this._avcTrack.samples[this._avcTrack.samples.length-1];var ax=ay.units.units[ay.units.units.length-1];var aq=new Uint8Array(ax.data.byteLength+ao);aq.set(ax.data,0);aq.set(av.subarray(0,ao),ax.data.byteLength);ax.data=aq;ay.units.length+=ao;this._avcTrack.len+=ao}}}au=ar;ap=az;if(az===1||az===5){ar=at}an=0}else{an=0}}break;default:break}}if(au){aB={data:av.subarray(au,at),type:ap};aw.push(aB)}return aw}},{key:"_parseAACPES",value:function ah(aq){var ao=this._aacTrack,ar,av=aq.data,ap,az,aA,aB,an,at,ax;if(this.aacOverFlow){var au=new Uint8Array(this.aacOverFlow.byteLength+av.byteLength);au.set(this.aacOverFlow,0);au.set(av,this.aacOverFlow.byteLength);av=au}for(aA=0,ax=av.length;aA<ax-1;aA++){if(av[aA]===255&&(av[aA+1]&240)===240){break}}if(aA){var aw,ay;if(aA<ax-1){aw="AAC PES did not start with ADTS header,offset:"+aA;ay=false}else{aw="no ADTS header found in AAC PES";ay=true}this.observer.trigger(T["default"].ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_PARSING_ERROR,fatal:ay,reason:aw});if(ay){return}}if(!ao.audiosamplerate){ap=this._ADTStoAudioConfig(av,aA,this.audioCodec);ao.config=ap.config;ao.audiosamplerate=ap.samplerate;ao.channelCount=ap.channelCount;ao.codec=ap.codec;ao.timescale=this.remuxer.timescale;ao.duration=this.remuxer.timescale*this._duration;V.logger.log("parsed codec:"+ao.codec+",rate:"+ap.samplerate+",nb channel:"+ap.channelCount)}at=0;while(aA+5<ax){az=(av[aA+3]&3)<<11;az|=av[aA+4]<<3;az|=(av[aA+5]&224)>>>5;aB=!!(av[aA+1]&1)?7:9;az-=aB;an=Math.round(aq.pts+at*1024*this.PES_TIMESCALE/ao.audiosamplerate);if(az>0&&aA+aB+az<=ax){ar={unit:av.subarray(aA+aB,aA+aB+az),pts:an,dts:an};this._aacTrack.samples.push(ar);this._aacTrack.len+=az;aA+=az+aB;at++;for(;aA<ax-1;aA++){if(av[aA]===255&&(av[aA+1]&240)===240){break}}}else{break}}if(aA<ax){this.aacOverFlow=av.subarray(aA,ax)}else{this.aacOverFlow=null}}},{key:"_ADTStoAudioConfig",value:function X(aq,ap,ax){var au,at,ar,ao,an,aw=navigator.userAgent.toLowerCase(),av=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];au=((aq[ap+2]&192)>>>6)+1;at=(aq[ap+2]&60)>>>2;if(at>av.length-1){this.observer.trigger(T["default"].ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+at});return}ao=(aq[ap+2]&1)<<2;ao|=(aq[ap+3]&192)>>>6;V.logger.log("manifest codec:"+ax+",ADTS data:type:"+au+",sampleingIndex:"+at+"["+av[at]+"Hz],channelConfig:"+ao);if(aw.indexOf("firefox")!==-1){if(at>=6){au=5;an=new Array(4);ar=at-3}else{au=2;an=new Array(2);ar=at}}else{if(aw.indexOf("android")!==-1){au=2;an=new Array(2);ar=at}else{au=5;an=new Array(4);if(ax&&(ax.indexOf("mp4a.40.29")!==-1||ax.indexOf("mp4a.40.5")!==-1)||!ax&&at>=6){ar=at-3}else{if(ax&&ax.indexOf("mp4a.40.2")!==-1&&(at>=6||ao===1)||!ax&&ao===1){au=2;an=new Array(2)}ar=at}}}an[0]=au<<3;an[0]|=(at&14)>>1;an[1]|=(at&1)<<7;an[1]|=ao<<3;if(au===5){an[1]|=(ar&14)>>1;an[2]=(ar&1)<<7;an[2]|=2<<2;an[3]=0}return{config:an,samplerate:av[at],channelCount:ao,codec:"mp4a.40."+au}}},{key:"_parseID3PES",value:function Y(an){this._id3Track.samples.push(an)}}],[{key:"probe",value:function Z(an){if(an.length>=3*188&&an[0]===71&&an[188]===71&&an[2*188]===71){return true}else{return false}}}]);return ae})();Q["default"]=P;K.exports=Q["default"]},{"../errors":16,"../events":17,"../utils/logger":26,"./exp-golomb":13}],16:[function(M,O,L){Object.defineProperty(L,"__esModule",{value:true});var N={NETWORK_ERROR:"hlsNetworkError",MEDIA_ERROR:"hlsMediaError",OTHER_ERROR:"hlsOtherError"};L.ErrorTypes=N;var K={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError"};L.ErrorDetails=K},{}],17:[function(L,M,K){Object.defineProperty(K,"__esModule",{value:true});K["default"]={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsPTSUpdated",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_METADATA:"hlsFraParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFPSDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded"};M.exports=K["default"]},{}],18:[function(M,O,L){Object.defineProperty(L,"__esModule",{value:true});var N=(function(){function R(V,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||false;U.configurable=true;if("value" in U){U.writable=true}Object.defineProperty(V,U.key,U)}}return function(U,S,T){if(S){R(U.prototype,S)}if(T){R(U,T)}return U}})();function P(R,S){if(!(R instanceof S)){throw new TypeError("Cannot call a class as a function")}}var K=M("../utils/logger");var Q=(function(){function U(){P(this,U)}N(U,null,[{key:"mergeDetails",value:function R(V,Z){var W=Math.max(V.startSN,Z.startSN)-Z.startSN,Y=Math.min(V.endSN,Z.endSN)-Z.startSN,ah=Z.startSN-V.startSN,ag=V.fragments,ab=Z.fragments,af=0,X;if(Y<W){Z.PTSKnown=false;return}for(var aa=W;aa<=Y;aa++){var ai=ag[ah+aa],ae=ab[aa];af=ai.cc-ae.cc;if(!isNaN(ai.startPTS)){ae.start=ae.startPTS=ai.startPTS;ae.endPTS=ai.endPTS;ae.duration=ai.duration;X=ae}}if(af){K.logger.log("discontinuity sliding from playlist, take drift into account");for(aa=0;aa<ab.length;aa++){ab[aa].cc+=af}}if(X){U.updateFragPTS(Z,X.sn,X.startPTS,X.endPTS)}else{var ac=ag[ah].start;for(aa=0;aa<ab.length;aa++){ab[aa].start+=ac}}Z.PTSKnown=V.PTSKnown;return}},{key:"updateFragPTS",value:function T(V,W,X,ac){var aa,Z,ae,Y;if(W<V.startSN||W>V.endSN){return 0}aa=W-V.startSN;Z=V.fragments;ae=Z[aa];if(!isNaN(ae.startPTS)){X=Math.max(X,ae.startPTS);ac=Math.min(ac,ae.endPTS)}var ab=X-ae.start;ae.start=ae.startPTS=X;ae.endPTS=ac;ae.duration=ac-X;for(Y=aa;Y>0;Y--){U.updatePTS(Z,Y,Y-1)}for(Y=aa;Y<Z.length-1;Y++){U.updatePTS(Z,Y,Y+1)}V.PTSKnown=true;return ab}},{key:"updatePTS",value:function S(W,Y,aa){var V=W[Y],X=W[aa],Z=X.startPTS;if(!isNaN(Z)){if(aa>Y){V.duration=Z-V.start;if(V.duration<0){K.logger.error("negative duration computed for "+V+", there should be some duration drift between playlist and fragment!")}}else{X.duration=V.start-Z;if(X.duration<0){K.logger.error("negative duration computed for "+X+", there should be some duration drift between playlist and fragment!")}}}else{if(aa>Y){X.start=V.start+V.duration}else{X.start=V.start-X.duration}}}}]);return U})();L["default"]=Q;O.exports=L["default"]},{"../utils/logger":26}],19:[function(V,M,ak){Object.defineProperty(ak,"__esModule",{value:true});var af=(function(){function am(aq,ao){for(var an=0;an<ao.length;an++){var ap=ao[an];ap.enumerable=ap.enumerable||false;ap.configurable=true;if("value" in ap){ap.writable=true}Object.defineProperty(aq,ap.key,ap)}}return function(ap,an,ao){if(an){am(ap.prototype,an)}if(ao){am(ap,ao)}return ap}})();function L(am){return am&&am.__esModule?am:{"default":am}}function Q(am,an){if(!(am instanceof an)){throw new TypeError("Cannot call a class as a function")}}var W=V("./events");var U=L(W);var ag=V("./errors");var al=V("./loader/playlist-loader");var Y=L(al);var R=V("./loader/fragment-loader");var P=L(R);var X=V("./controller/abr-controller");var K=L(X);var ac=V("./controller/mse-media-controller");var ab=L(ac);var N=V("./controller/level-controller");var ai=L(N);var aa=V("./utils/logger");var aj=V("./utils/xhr-loader");var ae=L(aj);var T=V("events");var S=L(T);var Z=V("./loader/key-loader");var ah=L(Z);var O=(function(){af(an,null,[{key:"isSupported",value:function ao(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function ap(){return U["default"]}},{key:"ErrorTypes",get:function ap(){return ag.ErrorTypes}},{key:"ErrorDetails",get:function ap(){return ag.ErrorDetails}}]);function an(){var aB=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];Q(this,an);var ay={autoStartLoad:true,debug:false,maxBufferLength:30,maxBufferSize:60*1000*1000,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,maxMaxBufferLength:600,enableWorker:true,enableSoftwareAES:true,fragLoadingTimeOut:20000,fragLoadingMaxRetry:1,fragLoadingRetryDelay:1000,fragLoadingLoopThreshold:3,manifestLoadingTimeOut:10000,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1000,appendErrorMaxRetry:200,loader:ae["default"],fLoader:undefined,pLoader:undefined,abrController:K["default"],mediaController:ab["default"]};for(var aD in ay){if(aD in aB){continue}aB[aD]=ay[aD]}if(aB.liveMaxLatencyDurationCount!==undefined&&aB.liveMaxLatencyDurationCount<=aB.liveSyncDurationCount){throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"')}(0,aa.enableLogs)(aB.debug);this.config=aB;var az=this.observer=new S["default"]();az.trigger=function aA(aG){for(var aE=arguments.length,aH=Array(aE>1?aE-1:0),aF=1;aF<aE;aF++){aH[aF-1]=arguments[aF]}az.emit.apply(az,[aG,aG].concat(aH))};az.off=function aC(aG){for(var aE=arguments.length,aH=Array(aE>1?aE-1:0),aF=1;aF<aE;aF++){aH[aF-1]=arguments[aF]}az.removeListener.apply(az,[aG].concat(aH))};this.on=az.on.bind(az);this.off=az.off.bind(az);this.trigger=az.trigger.bind(az);this.playlistLoader=new Y["default"](this);this.fragmentLoader=new P["default"](this);this.levelController=new ai["default"](this);this.abrController=new aB.abrController(this);this.mediaController=new aB.mediaController(this);this.keyLoader=new ah["default"](this)}af(an,[{key:"destroy",value:function ax(){aa.logger.log("destroy");this.trigger(U["default"].DESTROYING);this.detachMedia();this.playlistLoader.destroy();this.fragmentLoader.destroy();this.levelController.destroy();this.mediaController.destroy();this.keyLoader.destroy();this.url=null;this.observer.removeAllListeners()}},{key:"attachMedia",value:function at(ay){aa.logger.log("attachMedia");this.media=ay;this.trigger(U["default"].MEDIA_ATTACHING,{media:ay})}},{key:"detachMedia",value:function au(){aa.logger.log("detachMedia");this.trigger(U["default"].MEDIA_DETACHING);this.media=null}},{key:"loadSource",value:function aq(ay){aa.logger.log("loadSource:"+ay);this.url=ay;this.trigger(U["default"].MANIFEST_LOADING,{url:ay})}},{key:"startLoad",value:function av(){aa.logger.log("startLoad");this.mediaController.startLoad()}},{key:"swapAudioCodec",value:function am(){aa.logger.log("swapAudioCodec");this.mediaController.swapAudioCodec()}},{key:"recoverMediaError",value:function ar(){aa.logger.log("recoverMediaError");var ay=this.media;this.detachMedia();this.attachMedia(ay)}},{key:"levels",get:function ap(){return this.levelController.levels}},{key:"currentLevel",get:function ap(){return this.mediaController.currentLevel},set:function aw(ay){aa.logger.log("set currentLevel:"+ay);this.loadLevel=ay;this.mediaController.immediateLevelSwitch()}},{key:"nextLevel",get:function ap(){return this.mediaController.nextLevel},set:function aw(ay){aa.logger.log("set nextLevel:"+ay);this.levelController.manualLevel=ay;this.mediaController.nextLevelSwitch()}},{key:"loadLevel",get:function ap(){return this.levelController.level},set:function aw(ay){aa.logger.log("set loadLevel:"+ay);this.levelController.manualLevel=ay}},{key:"nextLoadLevel",get:function ap(){return this.levelController.nextLoadLevel()},set:function aw(ay){this.levelController.level=ay}},{key:"firstLevel",get:function ap(){return this.levelController.firstLevel},set:function aw(ay){aa.logger.log("set firstLevel:"+ay);this.levelController.firstLevel=ay}},{key:"startLevel",get:function ap(){return this.levelController.startLevel},set:function aw(ay){aa.logger.log("set startLevel:"+ay);this.levelController.startLevel=ay}},{key:"autoLevelCapping",get:function ap(){return this.abrController.autoLevelCapping},set:function aw(ay){aa.logger.log("set autoLevelCapping:"+ay);this.abrController.autoLevelCapping=ay}},{key:"autoLevelEnabled",get:function ap(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function ap(){return this.levelController.manualLevel}}]);return an})();ak["default"]=O;M.exports=ak["default"]},{"./controller/abr-controller":3,"./controller/level-controller":4,"./controller/mse-media-controller":5,"./errors":16,"./events":17,"./loader/fragment-loader":20,"./loader/key-loader":21,"./loader/playlist-loader":22,"./utils/logger":26,"./utils/xhr-loader":28,events:1}],20:[function(L,K,P){Object.defineProperty(P,"__esModule",{value:true});var N=(function(){function U(Y,W){for(var V=0;V<W.length;V++){var X=W[V];X.enumerable=X.enumerable||false;X.configurable=true;if("value" in X){X.writable=true}Object.defineProperty(Y,X.key,X)}}return function(X,V,W){if(V){U(X.prototype,V)}if(W){U(X,W)}return X}})();function T(U){return U&&U.__esModule?U:{"default":U}}function Q(U,V){if(!(U instanceof V)){throw new TypeError("Cannot call a class as a function")}}var R=L("../events");var S=T(R);var M=L("../errors");var O=(function(){function aa(ab){Q(this,aa);this.hls=ab;this.onfl=this.onFragLoading.bind(this);ab.on(S["default"].FRAG_LOADING,this.onfl)}N(aa,[{key:"destroy",value:function X(){if(this.loader){this.loader.destroy();this.loader=null}this.hls.off(S["default"].FRAG_LOADING,this.onfl)}},{key:"onFragLoading",value:function Z(ac,ae){var af=ae.frag;this.frag=af;this.frag.loaded=0;var ab=this.hls.config;af.loader=this.loader=typeof ab.fLoader!=="undefined"?new ab.fLoader(ab):new ab.loader(ab);this.loader.load(af.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),ab.fragLoadingTimeOut,ab.fragLoadingMaxRetry,ab.fragLoadingRetryDelay,this.loadprogress.bind(this),af)}},{key:"loadsuccess",value:function V(ac,ab){var ae=ac.currentTarget.response;ab.length=ae.byteLength;this.frag.loader=undefined;this.hls.trigger(S["default"].FRAG_LOADED,{payload:ae,frag:this.frag,stats:ab})}},{key:"loaderror",value:function Y(ab){this.loader.abort();this.hls.trigger(S["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_ERROR,fatal:false,frag:this.frag,response:ab})}},{key:"loadtimeout",value:function U(){this.loader.abort();this.hls.trigger(S["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:false,frag:this.frag})}},{key:"loadprogress",value:function W(ac,ab){this.frag.loaded=ab.loaded;this.hls.trigger(S["default"].FRAG_LOAD_PROGRESS,{frag:this.frag,stats:ab})}}]);return aa})();P["default"]=O;K.exports=P["default"]},{"../errors":16,"../events":17}],21:[function(L,K,O){Object.defineProperty(O,"__esModule",{value:true});var N=(function(){function U(Y,W){for(var V=0;V<W.length;V++){var X=W[V];X.enumerable=X.enumerable||false;X.configurable=true;if("value" in X){X.writable=true}Object.defineProperty(Y,X.key,X)}}return function(X,V,W){if(V){U(X.prototype,V)}if(W){U(X,W)}return X}})();function T(U){return U&&U.__esModule?U:{"default":U}}function P(U,V){if(!(U instanceof V)){throw new TypeError("Cannot call a class as a function")}}var Q=L("../events");var R=T(Q);var M=L("../errors");var S=(function(){function aa(ab){P(this,aa);this.hls=ab;this.decryptkey=null;this.decrypturl=null;this.ondkl=this.onDecryptKeyLoading.bind(this);ab.on(R["default"].KEY_LOADING,this.ondkl)}N(aa,[{key:"destroy",value:function Y(){if(this.loader){this.loader.destroy();this.loader=null}this.hls.off(R["default"].KEY_LOADING,this.ondkl)}},{key:"onDecryptKeyLoading",value:function V(ae,ag){var ah=this.frag=ag.frag,af=ah.decryptdata,ac=af.uri;if(ac!==this.decrypturl||this.decryptkey===null){var ab=this.hls.config;ah.loader=this.loader=new ab.loader(ab);this.decrypturl=ac;this.decryptkey=null;ah.loader.load(ac,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),ab.fragLoadingTimeOut,ab.fragLoadingMaxRetry,ab.fragLoadingRetryDelay,this.loadprogress.bind(this),ah)}else{if(this.decryptkey){af.key=this.decryptkey;this.hls.trigger(R["default"].KEY_LOADED,{frag:ah})}}}},{key:"loadsuccess",value:function W(ab){var ac=this.frag;this.decryptkey=ac.decryptdata.key=new Uint8Array(ab.currentTarget.response);ac.loader=undefined;this.hls.trigger(R["default"].KEY_LOADED,{frag:ac})}},{key:"loaderror",value:function Z(ab){this.loader.abort();this.hls.trigger(R["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.KEY_LOAD_ERROR,fatal:false,frag:this.frag,response:ab})}},{key:"loadtimeout",value:function U(){this.loader.abort();this.hls.trigger(R["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:false,frag:this.frag})}},{key:"loadprogress",value:function X(){}}]);return aa})();O["default"]=S;K.exports=O["default"]},{"../errors":16,"../events":17}],22:[function(L,K,O){Object.defineProperty(O,"__esModule",{value:true});var N=(function(){function W(aa,Y){for(var X=0;X<Y.length;X++){var Z=Y[X];Z.enumerable=Z.enumerable||false;Z.configurable=true;if("value" in Z){Z.writable=true}Object.defineProperty(aa,Z.key,Z)}}return function(Z,X,Y){if(X){W(Z.prototype,X)}if(Y){W(Z,Y)}return Z}})();function U(W){return W&&W.__esModule?W:{"default":W}}function P(W,X){if(!(W instanceof X)){throw new TypeError("Cannot call a class as a function")}}var Q=L("../events");var R=U(Q);var M=L("../errors");var V=L("../utils/url");var S=U(V);var T=(function(){function ah(al){P(this,ah);this.hls=al;this.onml=this.onManifestLoading.bind(this);this.onll=this.onLevelLoading.bind(this);al.on(R["default"].MANIFEST_LOADING,this.onml);al.on(R["default"].LEVEL_LOADING,this.onll)}N(ah,[{key:"destroy",value:function ag(){if(this.loader){this.loader.destroy();this.loader=null}this.url=this.id=null;this.hls.off(R["default"].MANIFEST_LOADING,this.onml);this.hls.off(R["default"].LEVEL_LOADING,this.onll)}},{key:"onManifestLoading",value:function ab(al,am){this.load(am.url,null)}},{key:"onLevelLoading",value:function X(al,am){this.load(am.url,am.level,am.id)}},{key:"load",value:function ai(am,ao,an){var al=this.hls.config;this.url=am;this.id=ao;this.id2=an;this.loader=typeof al.pLoader!=="undefined"?new al.pLoader(al):new al.loader(al);this.loader.load(am,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),al.manifestLoadingTimeOut,al.manifestLoadingMaxRetry,al.manifestLoadingRetryDelay)}},{key:"resolve",value:function aj(al,am){return S["default"].buildAbsoluteURL(am,al)}},{key:"parseMasterPlaylist",value:function ae(an,at){var aq=[],ar={},al,am,ap;var ao=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"([^\"\n\r]*)\",?)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/g;while((al=ao.exec(an))!=null){al.shift();al=al.filter(function(au){return au!==undefined});ar.url=this.resolve(al.pop(),at);while(al.length>0){switch(al.shift()){case"RES":ar.width=parseInt(al.shift());ar.height=parseInt(al.shift());break;case"BAND":ar.bitrate=parseInt(al.shift());break;case"NAME":ar.name=al.shift();break;case"CODECS":am=al.shift().split(",");while(am.length>0){ap=am.shift();if(ap.indexOf("avc1")!==-1){ar.videoCodec=this.avc1toavcoti(ap)}else{ar.audioCodec=ap}}break;default:break}}aq.push(ar);ar={}}return aq}},{key:"avc1toavcoti",value:function Y(an){var am,al=an.split(".");if(al.length>2){am=al.shift()+".";am+=parseInt(al.shift()).toString(16);am+=("00"+parseInt(al.shift()).toString(16)).substr(-4)}else{am=an}return am}},{key:"parseKeyParamsByRegex",value:function ak(am,an){var al=an.exec(am);if(al){al.shift();al=al.filter(function(ao){return ao!==undefined});if(al.length===2){return al[1]}}return null}},{key:"cloneObj",value:function aa(al){return JSON.parse(JSON.stringify(al))}},{key:"parseLevelPlaylist",value:function ac(al,aC,ax){var ay=0,aH=0,an={url:aC,fragments:[],live:true,startSN:0},av,aI,aw=0,ao,au,ar;var at={method:null,key:null,iv:null,uri:null};aI=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))/g;while((av=aI.exec(al))!==null){av.shift();av=av.filter(function(aJ){return aJ!==undefined});switch(av[0]){case"MEDIA-SEQUENCE":ay=an.startSN=parseInt(av[1]);break;case"TARGETDURATION":an.targetduration=parseFloat(av[1]);break;case"ENDLIST":an.live=false;break;case"DIS":aw++;break;case"BYTERANGE":var aG=av[1].split("@");if(aG.length===1){ar=au}else{ar=parseInt(aG[1])}au=parseInt(aG[0])+ar;ao=an.fragments.length?an.fragments[an.fragments.length-1]:null;if(ao&&!ao.url){ao.byteRangeStartOffset=ar;ao.byteRangeEndOffset=au;ao.url=this.resolve(av[2],aC)}break;case"INF":var am=parseFloat(av[1]);if(!isNaN(am)){var aA,aD=ay++;if(at.method&&at.uri&&!at.iv){aA=this.cloneObj(at);var aq=new Uint8Array(16);for(var aB=12;aB<16;aB++){aq[aB]=aD>>8*(15-aB)&255}aA.iv=aq}else{aA=at}an.fragments.push({url:av[2]?this.resolve(av[2],aC):null,duration:am,start:aH,sn:aD,level:ax,cc:aw,byteRangeStartOffset:ar,byteRangeEndOffset:au,decryptdata:aA});aH+=am;ar=null}break;case"KEY":var aF=av[1];var ap=this.parseKeyParamsByRegex(aF,/(METHOD)=([^,]*)/),az=this.parseKeyParamsByRegex(aF,/(URI)=["]([^,]*)["]/),aE=this.parseKeyParamsByRegex(aF,/(IV)=([^,]*)/);if(ap){at={method:null,key:null,iv:null,uri:null};if(az&&ap==="AES-128"){at.method=ap;at.uri=this.resolve(az,aC);at.key=null;if(aE){at.iv=aE;if(at.iv.substring(0,2)==="0x"){at.iv=at.iv.substring(2)}at.iv=at.iv.match(/.{8}/g);at.iv[0]=parseInt(at.iv[0],16);at.iv[1]=parseInt(at.iv[1],16);at.iv[2]=parseInt(at.iv[2],16);at.iv[3]=parseInt(at.iv[3],16);at.iv=new Uint32Array(at.iv)}}}break;default:break}}an.totalduration=aH;an.endSN=ay-1;return an}},{key:"loadsuccess",value:function Z(am,ap){var aq=am.currentTarget.responseText,an=am.currentTarget.responseURL,ao=this.id,at=this.id2,al=this.hls,au;if(an===undefined){an=this.url}ap.tload=performance.now();ap.mtime=new Date(am.currentTarget.getResponseHeader("Last-Modified"));if(aq.indexOf("#EXTM3U")===0){if(aq.indexOf("#EXTINF:")>0){if(this.id===null){al.trigger(R["default"].MANIFEST_LOADED,{levels:[{url:an}],url:an,stats:ap})}else{var ar=this.parseLevelPlaylist(aq,an,ao);ap.tparsed=performance.now();al.trigger(R["default"].LEVEL_LOADED,{details:ar,level:ao,id:at,stats:ap})}}else{au=this.parseMasterPlaylist(aq,an);if(au.length){al.trigger(R["default"].MANIFEST_LOADED,{levels:au,url:an,stats:ap})}else{al.trigger(R["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:an,reason:"no level found in manifest"})}}}else{al.trigger(R["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:M.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:an,reason:"no EXTM3U delimiter"})}}},{key:"loaderror",value:function af(am){var al,an;if(this.id===null){al=M.ErrorDetails.MANIFEST_LOAD_ERROR;an=true}else{al=M.ErrorDetails.LEVEL_LOAD_ERROR;an=false}this.loader.abort();this.hls.trigger(R["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:al,fatal:an,url:this.url,loader:this.loader,response:am.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function W(){var al,am;if(this.id===null){al=M.ErrorDetails.MANIFEST_LOAD_TIMEOUT;am=true}else{al=M.ErrorDetails.LEVEL_LOAD_TIMEOUT;am=false}this.loader.abort();this.hls.trigger(R["default"].ERROR,{type:M.ErrorTypes.NETWORK_ERROR,details:al,fatal:am,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]);return ah})();O["default"]=T;K.exports=O["default"]},{"../errors":16,"../events":17,"../utils/url":27}],23:[function(L,N,K){Object.defineProperty(K,"__esModule",{value:true});var M=(function(){function Q(U,S){for(var R=0;R<S.length;R++){var T=S[R];T.enumerable=T.enumerable||false;T.configurable=true;if("value" in T){T.writable=true}Object.defineProperty(U,T.key,T)}}return function(T,R,S){if(R){Q(T.prototype,R)}if(S){Q(T,S)}return T}})();function P(Q,R){if(!(Q instanceof R)){throw new TypeError("Cannot call a class as a function")}}var O=(function(){function ah(){P(this,ah)}M(ah,null,[{key:"init",value:function aj(){ah.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var aq;for(aq in ah.types){if(ah.types.hasOwnProperty(aq)){ah.types[aq]=[aq.charCodeAt(0),aq.charCodeAt(1),aq.charCodeAt(2),aq.charCodeAt(3)]}}ah.MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);ah.AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);ah.MINOR_VERSION=new Uint8Array([0,0,0,1]);ah.VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);ah.AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ah.HDLR_TYPES={video:ah.VIDEO_HDLR,audio:ah.AUDIO_HDLR};ah.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);ah.STCO=new Uint8Array([0,0,0,0,0,0,0,0]);ah.STSC=ah.STCO;ah.STTS=ah.STCO;ah.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);ah.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);ah.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);ah.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);ah.FTYP=ah.box(ah.types.ftyp,ah.MAJOR_BRAND,ah.MINOR_VERSION,ah.MAJOR_BRAND,ah.AVC1_BRAND);ah.DINF=ah.box(ah.types.dinf,ah.box(ah.types.dref,ah.DREF))}},{key:"box",value:function ae(av){var aw=Array.prototype.slice.call(arguments,1),au=0,at=aw.length,aq,ar;while(at--){au+=aw[at].byteLength}aq=new Uint8Array(au+8);ar=new DataView(aq.buffer);ar.setUint32(0,aq.byteLength);aq.set(av,4);for(at=0,au=8;at<aw.length;at++){aq.set(aw[at],au);au+=aw[at].byteLength}return aq}},{key:"hdlr",value:function S(aq){return ah.box(ah.types.hdlr,ah.HDLR_TYPES[aq])}},{key:"mdat",value:function R(aq){return ah.box(ah.types.mdat,aq)}},{key:"mdhd",value:function an(aq,ar){return ah.box(ah.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,aq>>24&255,aq>>16&255,aq>>8&255,aq&255,ar>>24,ar>>16&255,ar>>8&255,ar&255,85,196,0,0]))}},{key:"mdia",value:function V(aq){return ah.box(ah.types.mdia,ah.mdhd(aq.timescale,aq.duration),ah.hdlr(aq.type),ah.minf(aq))}},{key:"mfhd",value:function ap(aq){return ah.box(ah.types.mfhd,new Uint8Array([0,0,0,0,aq>>24,aq>>16&255,aq>>8&255,aq&255]))}},{key:"minf",value:function ag(aq){if(aq.type==="audio"){return ah.box(ah.types.minf,ah.box(ah.types.smhd,ah.SMHD),ah.DINF,ah.stbl(aq))}else{return ah.box(ah.types.minf,ah.box(ah.types.vmhd,ah.VMHD),ah.DINF,ah.stbl(aq))}}},{key:"moof",value:function Y(at,ar,aq){return ah.box(ah.types.moof,ah.mfhd(at),ah.traf(aq,ar))}},{key:"moov",value:function ao(aq){var at=aq.length,ar=[];while(at--){ar[at]=ah.trak(aq[at])}return ah.box.apply(null,[ah.types.moov,ah.mvhd(aq[0].timescale,aq[0].duration)].concat(ar).concat(ah.mvex(aq)))}},{key:"mvex",value:function aa(aq){var at=aq.length,ar=[];while(at--){ar[at]=ah.trex(aq[at])}return ah.box.apply(null,[ah.types.mvex].concat(ar))}},{key:"mvhd",value:function ak(ar,at){var aq=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,ar>>24&255,ar>>16&255,ar>>8&255,ar&255,at>>24&255,at>>16&255,at>>8&255,at&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ah.box(ah.types.mvhd,aq)}},{key:"sdtp",value:function af(at){var au=at.samples||[],ar=new Uint8Array(4+au.length),aq,av;for(av=0;av<au.length;av++){aq=au[av].flags;ar[av+4]=aq.dependsOn<<4|aq.isDependedOn<<2|aq.hasRedundancy}return ah.box(ah.types.sdtp,ar)}},{key:"stbl",value:function ab(aq){return ah.box(ah.types.stbl,ah.stsd(aq),ah.box(ah.types.stts,ah.STTS),ah.box(ah.types.stsc,ah.STSC),ah.box(ah.types.stsz,ah.STSZ),ah.box(ah.types.stco,ah.STCO))}},{key:"avc1",value:function ac(au){var ar=[],at=[],av,ax,aq;for(av=0;av<au.sps.length;av++){ax=au.sps[av];aq=ax.byteLength;ar.push(aq>>>8&255);ar.push(aq&255);ar=ar.concat(Array.prototype.slice.call(ax))}for(av=0;av<au.pps.length;av++){ax=au.pps[av];aq=ax.byteLength;at.push(aq>>>8&255);at.push(aq&255);at=at.concat(Array.prototype.slice.call(ax))}var aw=ah.box(ah.types.avcC,new Uint8Array([1,ar[3],ar[4],ar[5],252|3,224|au.sps.length].concat(ar).concat([au.pps.length]).concat(at)));return ah.box(ah.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,au.width>>8&255,au.width&255,au.height>>8&255,au.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),aw,ah.box(ah.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function X(aq){return new Uint8Array([0,0,0,0,3,23+aq.config.length,0,1,0,4,15+aq.config.length,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([aq.config.length]).concat(aq.config).concat([6,1,2]))}},{key:"mp4a",value:function am(aq){return ah.box(ah.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,aq.channelCount,0,16,0,0,0,0,aq.audiosamplerate>>8&255,aq.audiosamplerate&255,0,0]),ah.box(ah.types.esds,ah.esds(aq)))}},{key:"stsd",value:function Z(aq){if(aq.type==="audio"){return ah.box(ah.types.stsd,ah.STSD,ah.mp4a(aq))}else{return ah.box(ah.types.stsd,ah.STSD,ah.avc1(aq))}}},{key:"tkhd",value:function ai(aq){return ah.box(ah.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,aq.id>>24&255,aq.id>>16&255,aq.id>>8&255,aq.id&255,0,0,0,0,aq.duration>>24,aq.duration>>16&255,aq.duration>>8&255,aq.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,aq.width>>8&255,aq.width&255,0,0,aq.height>>8&255,aq.height&255,0,0]))}},{key:"traf",value:function U(aq,at){var ar=ah.sdtp(aq);return ah.box(ah.types.traf,ah.box(ah.types.tfhd,new Uint8Array([0,0,0,0,aq.id>>24,aq.id>>16&255,aq.id>>8&255,aq.id&255])),ah.box(ah.types.tfdt,new Uint8Array([0,0,0,0,at>>24,at>>16&255,at>>8&255,at&255])),ah.trun(aq,ar.length+16+16+8+16+8+8),ar)}},{key:"trak",value:function Q(aq){aq.duration=aq.duration||4294967295;return ah.box(ah.types.trak,ah.tkhd(aq),ah.mdia(aq))}},{key:"trex",value:function T(aq){return ah.box(ah.types.trex,new Uint8Array([0,0,0,0,aq.id>>24,aq.id>>16&255,aq.id>>8&255,aq.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function al(aq,av){var ar,au,at,aw;ar=aq.samples||[];aw=new Uint8Array(12+16*ar.length);av+=8+aw.byteLength;aw.set([0,0,15,1,ar.length>>>24&255,ar.length>>>16&255,ar.length>>>8&255,ar.length&255,av>>>24&255,av>>>16&255,av>>>8&255,av&255],0);for(at=0;at<ar.length;at++){au=ar[at];aw.set([au.duration>>>24&255,au.duration>>>16&255,au.duration>>>8&255,au.duration&255,au.size>>>24&255,au.size>>>16&255,au.size>>>8&255,au.size&255,au.flags.isLeading<<2|au.flags.dependsOn,au.flags.isDependedOn<<6|au.flags.hasRedundancy<<4|au.flags.paddingValue<<1|au.flags.isNonSync,au.flags.degradPrio&240<<8,au.flags.degradPrio&15,au.cts>>>24&255,au.cts>>>16&255,au.cts>>>8&255,au.cts&255],12+16*at)}return ah.box(ah.types.trun,aw)}},{key:"initSegment",value:function W(at){if(!ah.types){ah.init()}var ar=ah.moov(at),aq;aq=new Uint8Array(ah.FTYP.byteLength+ar.byteLength);aq.set(ah.FTYP);aq.set(ar,ah.FTYP.byteLength);return aq}}]);return ah})();K["default"]=O;N.exports=K["default"]},{}],24:[function(M,L,P){Object.defineProperty(P,"__esModule",{value:true});var O=(function(){function X(ab,Z){for(var Y=0;Y<Z.length;Y++){var aa=Z[Y];aa.enumerable=aa.enumerable||false;aa.configurable=true;if("value" in aa){aa.writable=true}Object.defineProperty(ab,aa.key,aa)}}return function(aa,Y,Z){if(Y){X(aa.prototype,Y)}if(Z){X(aa,Z)}return aa}})();function W(X){return X&&X.__esModule?X:{"default":X}}function Q(X,Y){if(!(X instanceof Y)){throw new TypeError("Cannot call a class as a function")}}var R=M("../events");var T=W(R);var V=M("../utils/logger");var K=M("../remux/mp4-generator");var U=W(K);var N=M("../errors");var S=(function(){function ac(aj){Q(this,ac);this.observer=aj;this.ISGenerated=false;this.PES2MP4SCALEFACTOR=4;this.PES_TIMESCALE=90000;this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}O(ac,[{key:"destroy",value:function ai(){}},{key:"insertDiscontinuity",value:function ah(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=undefined}},{key:"switchLevel",value:function ag(){this.ISGenerated=false}},{key:"remux",value:function ae(al,am,ak,aj,an){if(!this.ISGenerated){this.generateIS(al,am,aj)}if(am.samples.length){this.remuxVideo(am,aj,an)}if(al.samples.length){this.remuxAudio(al,aj,an)}if(ak.samples.length){this.remuxID3(ak,aj)}this.observer.trigger(T["default"].FRAG_PARSED)}},{key:"generateIS",value:function ab(al,ap,ar){var ao=this.observer,ak=al.samples,aj=ap.samples,aq=ak.length,am=aj.length,an=this.PES_TIMESCALE;if(aq===0&&am===0){ao.trigger(T["default"].ERROR,{type:N.ErrorTypes.MEDIA_ERROR,details:N.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}else{if(am===0){if(al.config){ao.trigger(T["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:U["default"].initSegment([al]),audioCodec:al.codec,audioChannelCount:al.channelCount});this.ISGenerated=true}if(this._initPTS===undefined){this._initPTS=ak[0].pts-an*ar;this._initDTS=ak[0].dts-an*ar}}else{if(aq===0){if(ap.sps&&ap.pps){ao.trigger(T["default"].FRAG_PARSING_INIT_SEGMENT,{videoMoov:U["default"].initSegment([ap]),videoCodec:ap.codec,videoWidth:ap.width,videoHeight:ap.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=aj[0].pts-an*ar;this._initDTS=aj[0].dts-an*ar}}}else{if(al.config&&ap.sps&&ap.pps){ao.trigger(T["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:U["default"].initSegment([al]),audioCodec:al.codec,audioChannelCount:al.channelCount,videoMoov:U["default"].initSegment([ap]),videoCodec:ap.codec,videoWidth:ap.width,videoHeight:ap.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=Math.min(aj[0].pts,ak[0].pts)-an*ar;this._initDTS=Math.min(aj[0].dts,ak[0].dts)-an*ar}}}}}}},{key:"remuxVideo",value:function Z(aA,ay,aF){var au,aB=8,ak=this.PES_TIMESCALE,aj=this.PES2MP4SCALEFACTOR,aD,am,aq,ax,al,an,at,aC,az,aG,ap,ao,aw,av=[];al=new Uint8Array(aA.len+4*aA.nbNalu+8);au=new DataView(al.buffer);au.setUint32(0,al.byteLength);al.set(U["default"].types.mdat,4);while(aA.samples.length){aD=aA.samples.shift();aq=0;while(aD.units.units.length){ax=aD.units.units.shift();au.setUint32(aB,ax.data.byteLength);aB+=4;al.set(ax.data,aB);aB+=ax.data.byteLength;aq+=4+ax.data.byteLength}aG=aD.pts-this._initDTS;ap=aD.dts-this._initDTS;if(az!==undefined){ao=this._PTSNormalize(aG,az);aw=this._PTSNormalize(ap,az);am.duration=(aw-az)/aj;if(am.duration<0){am.duration=0}}else{var ar=this.nextAvcDts,aE;ao=this._PTSNormalize(aG,ar);aw=this._PTSNormalize(ap,ar);aE=Math.round((aw-ar)/90);if(aF||Math.abs(aE)<600){if(aE){if(aE>1){V.logger.log("AVC:"+aE+" ms hole between fragments detected,filling it")}else{if(aE<-1){V.logger.log("AVC:"+-aE+" ms overlapping between fragments detected")}}aw=ar;ao=Math.max(ao-aE,aw);V.logger.log("Video/PTS/DTS adjusted:"+ao+"/"+aw)}}at=Math.max(0,ao);aC=Math.max(0,aw)}am={size:aq,duration:0,cts:(ao-aw)/aj,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}};if(aD.key===true){am.flags.dependsOn=2;am.flags.isNonSync=0}else{am.flags.dependsOn=1;am.flags.isNonSync=1}av.push(am);az=aw}if(av.length>=2){am.duration=av[av.length-2].duration}this.nextAvcDts=aw+am.duration*aj;aA.len=0;aA.nbNalu=0;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){av[0].flags.dependsOn=2;av[0].flags.isNonSync=0}aA.samples=av;an=U["default"].moof(aA.sequenceNumber++,aC/aj,aA);aA.samples=[];this.observer.trigger(T["default"].FRAG_PARSING_DATA,{moof:an,mdat:al,startPTS:at/ak,endPTS:(ao+aj*am.duration)/ak,startDTS:aC/ak,endDTS:(aw+aj*am.duration)/ak,type:"video",nb:av.length})}},{key:"remuxAudio",value:function af(aA,ay,aE){var au,aB=8,ak=this.PES_TIMESCALE,aj=this.PES2MP4SCALEFACTOR,ar,an,ax,al,ao,at,aC,az,aF,aq,ap,aw,av=[];al=new Uint8Array(aA.len+8);au=new DataView(al.buffer);au.setUint32(0,al.byteLength);al.set(U["default"].types.mdat,4);while(aA.samples.length){ar=aA.samples.shift();ax=ar.unit;al.set(ax,aB);aB+=ax.byteLength;aF=ar.pts-this._initDTS;aq=ar.dts-this._initDTS;if(az!==undefined){ap=this._PTSNormalize(aF,az);aw=this._PTSNormalize(aq,az);an.duration=(aw-az)/aj;if(an.duration<0){V.logger.log("invalid AAC sample duration at PTS:"+ar.pts+":"+an.duration);an.duration=0}}else{var am=this.nextAacPts,aD;ap=this._PTSNormalize(aF,am);aw=this._PTSNormalize(aq,am);aD=Math.round(1000*(ap-am)/ak);if(aE||Math.abs(aD)<600){if(aD){if(aD>1){V.logger.log(aD+" ms hole between AAC samples detected,filling it")}else{if(aD<-1){V.logger.log(-aD+" ms overlapping between AAC samples detected")}}ap=aw=am}}at=Math.max(0,ap);aC=Math.max(0,aw)}an={size:ax.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};av.push(an);az=aw}if(av.length>=2){an.duration=av[av.length-2].duration}this.nextAacPts=ap+aj*an.duration;aA.len=0;aA.samples=av;ao=U["default"].moof(aA.sequenceNumber++,aC/aj,aA);aA.samples=[];this.observer.trigger(T["default"].FRAG_PARSING_DATA,{moof:ao,mdat:al,startPTS:at/ak,endPTS:this.nextAacPts/ak,startDTS:aC/ak,endDTS:(aw+aj*an.duration)/ak,type:"audio",nb:av.length})}},{key:"remuxID3",value:function Y(ak,aj){var an=ak.samples.length,am;if(an){for(var al=0;al<an;al++){am=ak.samples[al];am.pts=(am.pts-this._initPTS)/this.PES_TIMESCALE;am.dts=(am.dts-this._initDTS)/this.PES_TIMESCALE}this.observer.trigger(T["default"].FRAG_PARSING_METADATA,{samples:ak.samples})}ak.samples=[];aj=aj}},{key:"_PTSNormalize",value:function aa(ak,aj){var al;if(aj===undefined){return ak}if(aj<ak){al=-8589934592}else{al=8589934592}while(Math.abs(ak-aj)>4294967296){ak+=al}return ak}},{key:"timescale",get:function X(){return this.MP4_TIMESCALE}}]);return ac})();P["default"]=S;L.exports=P["default"]},{"../errors":16,"../events":17,"../remux/mp4-generator":23,"../utils/logger":26}],25:[function(M,O,L){var K={search:function N(V,R){var T=0;var U=V.length-1;var Q=null;var S=null;while(T<=U){Q=(T+U)/2|0;S=V[Q];var P=R(S);if(P>0){T=Q+1}else{if(P<0){U=Q-1}else{return S}}}return null}};O.exports=K},{}],26:[function(M,L,N){Object.defineProperty(N,"__esModule",{value:true});function T(){}var O={trace:T,debug:T,log:T,warn:T,info:T,error:T};var K=O;function U(V,W){W="["+V+"] > "+W;return W}function R(V){var W=window.console[V];if(W){return function(){for(var X=arguments.length,Y=Array(X),Z=0;Z<X;Z++){Y[Z]=arguments[Z]}if(Y[0]){Y[0]=U(V,Y[0])}W.apply(window.console,Y)}}return T}function Q(X){for(var V=arguments.length,Y=Array(V>1?V-1:0),W=1;W<V;W++){Y[W-1]=arguments[W]}Y.forEach(function(Z){K[Z]=X[Z]?X[Z].bind(X):R(Z)})}var P=function P(V){if(V===true||typeof V==="object"){Q(V,"debug","log","info","warn","error");try{K.log()}catch(W){K=O}}else{K=O}};N.enableLogs=P;var S=K;N.logger=S},{}],27:[function(M,N,K){var P={buildAbsoluteURL:function O(S,T){T=T.trim();if(/^[a-z]+:/i.test(T)){return T}var Q=null;var U=null;var aa=/^([^#]*)(.*)$/.exec(T);if(aa){U=aa[2];T=aa[1]}var ac=/^([^\?]*)(.*)$/.exec(T);if(ac){Q=ac[2];T=ac[1]}var X=/^([^#]*)(.*)$/.exec(S);if(X){S=X[1]}var ae=/^([^\?]*)(.*)$/.exec(S);if(ae){S=ae[1]}var Z=/^((([a-z]+):)?\/\/[a-z0-9\.-]+(:[0-9]+)?\/)(.*)$/i.exec(S);var V=Z[3];var W=Z[1];var ab=Z[5];var R=null;if(/^\/\//.test(T)){R=V+"://"+P.buildAbsolutePath("",T.substring(2))}else{if(/^\//.test(T)){R=W+P.buildAbsolutePath("",T.substring(1))}else{var Y=P.buildAbsolutePath(ab,T);R=W+Y}}if(Q){R+=Q}if(U){R+=U}return R},buildAbsolutePath:function L(X,R){var S=R;var W,T="",Q=X.replace(/[^\/]*$/,S.replace(/(\/|^)(?:\.?\/+)+/g,"$1"));for(var V,U=0;V=Q.indexOf("/../",U),V>-1;U=V+W){W=/^\/(?:\.\.\/)*/.exec(Q.slice(V))[0].length;T=(T+Q.substring(U,V)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(W-1)/3+"}$"),"/")}return T+Q.substr(U)}};N.exports=P},{}],28:[function(N,P,M){Object.defineProperty(M,"__esModule",{value:true});var O=(function(){function R(V,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||false;U.configurable=true;if("value" in U){U.writable=true}Object.defineProperty(V,U.key,U)}}return function(U,S,T){if(S){R(U.prototype,S)}if(T){R(U,T)}return U}})();function Q(R,S){if(!(R instanceof S)){throw new TypeError("Cannot call a class as a function")}}var L=N("../utils/logger");var K=(function(){function S(aa){Q(this,S);if(aa&&aa.xhrSetup){this.xhrSetup=aa.xhrSetup}}O(S,[{key:"destroy",value:function Y(){this.abort();this.loader=null}},{key:"abort",value:function U(){if(this.loader&&this.loader.readyState!==4){this.stats.aborted=true;this.loader.abort()}if(this.timeoutHandle){window.clearTimeout(this.timeoutHandle)}}},{key:"load",value:function Z(aa,ab,ae,ac,af,ag,ah,aj){var ai=arguments.length<=8||arguments[8]===undefined?null:arguments[8];var ak=arguments.length<=9||arguments[9]===undefined?null:arguments[9];this.url=aa;if(ak&&!isNaN(ak.byteRangeStartOffset)&&!isNaN(ak.byteRangeEndOffset)){this.byteRange=ak.byteRangeStartOffset+"-"+ak.byteRangeEndOffset}this.responseType=ab;this.onSuccess=ae;this.onProgress=ai;this.onTimeout=af;this.onError=ac;this.stats={trequest:performance.now(),retry:0};this.timeout=ag;this.maxRetry=ah;this.retryDelay=aj;this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),ag);this.loadInternal()}},{key:"loadInternal",value:function V(){var aa=this.loader=new XMLHttpRequest();aa.onload=this.loadsuccess.bind(this);aa.onerror=this.loaderror.bind(this);aa.onprogress=this.loadprogress.bind(this);aa.open("GET",this.url,true);if(this.byteRange){aa.setRequestHeader("Range","bytes="+this.byteRange)}aa.responseType=this.responseType;this.stats.tfirst=null;this.stats.loaded=0;if(this.xhrSetup){this.xhrSetup(aa,this.url)}aa.send()}},{key:"loadsuccess",value:function T(aa){window.clearTimeout(this.timeoutHandle);this.stats.tload=performance.now();this.onSuccess(aa,this.stats)}},{key:"loaderror",value:function W(aa){if(this.stats.retry<this.maxRetry){L.logger.warn(aa.type+" while loading "+this.url+", retrying in "+this.retryDelay+"...");this.destroy();window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,64000);this.stats.retry++}else{window.clearTimeout(this.timeoutHandle);L.logger.error(aa.type+" while loading "+this.url);this.onError(aa)}}},{key:"loadtimeout",value:function R(aa){L.logger.warn("timeout while loading "+this.url);this.onTimeout(aa,this.stats)}},{key:"loadprogress",value:function X(ab){var aa=this.stats;if(aa.tfirst===null){aa.tfirst=performance.now()}aa.loaded=ab.loaded;if(this.onProgress){this.onProgress(ab,aa)}}}]);return S})();M["default"]=K;P.exports=M["default"]},{"../utils/logger":26}]},{},[19])(19)});function F(G){this.width="100%";this.height="100%";y(this,G);this.video=document.createElement("VIDEO");if(G.poster){this.video.poster=G.poster}}F.prototype=y(Object.create(CustomObject),{is_ready:false,isSupported:function(){return typeof document.createElement("VIDEO").play=="function"},isHLS:function(G){return["application/x-mpegURL","application/vnd.apple.mpegurl"].indexOf(G)>-1},canPlayTypeNative:function(G){var H=e();if(this.isHLS(G)){if(H.is_android&&H.version[0]>=4){return true}}return["maybe","probably"].indexOf(document.createElement("VIDEO").canPlayType(G))>-1},canPlayType:function(G){if(this.canPlayTypeNative(G)){return true}if(this.isHLS(G)&&Hls.isSupported()){return true}return false},setSource:function(J,I){var G=this;if(this.canPlayTypeNative(I)){this.video.src=J;this.video.load()}else{if(this.isHLS(I)){var H=new Hls({fragLoadingTimeOut:100000,maxBufferLength:30});H.loadSource(J);H.attachMedia(this.video);H.on(Hls.Events.ERROR,function(L,K){console.log(K);if(K.fatal){G.trigger("error",201)}})}}},getElement:function(){return this.video},destroy:function(){this.video.oncontextmenu=null},setWidth:function(G){this.video.style.width=G},setHeight:function(G){this.video.style.height=G},init:function(){var G=this;this.setWidth(this.width);this.setHeight(this.height);this.initEvents();this.on("ready",function(){G.is_ready=true});this.trigger("ready")},initEvents:function(){var G=this;this.video.onerror=function(){G.trigger("error",201)};this.video.oncontextmenu=function(){event.preventDefault()};this.video.addEventListener("loadedmetadata",function(){G.trigger("canplay")});this.video.addEventListener("durationchange",function(){G.trigger("durationchange",this.duration)});this.video.addEventListener("volumechange",function(){G.trigger("volumechange",this.muted?0:this.volume)});this.video.addEventListener("timeupdate",function(){var H=null;for(var I=0;I<this.buffered.length;I++){if(this.currentTime>this.buffered.start(I)&&this.currentTime<this.buffered.end(I)){H=this.duration-this.buffered.end(I)<0.5||Math.abs(this.currentTime-this.buffered.end(I))>0.5;break}}if(H!==null){if(H){if(G.is_waiting){G.trigger("playing");G.is_waiting=false}}else{G.is_waiting=true;G.trigger("waiting")}}G.trigger("timeupdate",this.currentTime);if(this.duration&&this.duration-this.currentTime<0.5){G.trigger("ended");this.pause();this.currentTime=0}});this.video.addEventListener("ended",function(){G.trigger("ended")});this.video.addEventListener("waiting",function(){G.trigger("waiting")});this.video.addEventListener("playing",function(){G.trigger("playing")});this.video.addEventListener("play",function(){G.trigger("play")});this.video.addEventListener("pause",function(){G.trigger("pause")});this.video.addEventListener("canplay",function(){G.trigger("canplay")});this.video.addEventListener("seeking",function(){G.trigger("seeking")});this.video.addEventListener("seeked",function(){G.trigger("seeked")});this.video.addEventListener("progress",function(){var I=[];for(var H=0;H<this.buffered.length;H++){I.push([this.buffered.start(H),this.buffered.end(H)])}G.trigger("progress",I)})},play:function(){this.video.play()},pause:function(){this.video.pause()},getCurrentTime:function(){return this.video.currentTime},getDuration:function(){return this.video.duration},setCurrentTime:function(G){if(this.video.readyState!=HTMLMediaElement.HAVE_NOTHING){this.video.currentTime=Math.max(0,Math.min(this.video.duration-0.9,G))}},setVolume:function(G){G=Math.max(0,Math.min(1,G||0));this.video.volume=G;this.video.muted=!G},getVolume:function(){return this.video.volume},showDefaultUI:function(){this.video.controls=true},hideDefaultUI:function(){this.video.controls=false}});return F})();B.prototype.__backends.HTML5=HTML5Backend;function s(F){this.flash_swf=null;t(this,F);this.swf=document.createElement("OBJECT")}s.prototype=y(Object.create(CustomObject),{is_ready:false,_flashFn:function(G){var F="window";var H="__"+Math.random().toString(16).split(".")[1];window[H]=function(){G.apply(window,arguments)};return F+"."+H},_setSWFProperty:function(G,H){if(!this.swf.vjs_setProperty){var F=this;setTimeout(function(){F._setSWFProperty(G,H)},0);return}this.swf.vjs_setProperty(G,H)},init:function(){var F=this;this.on("ready",function(){F.is_ready=true});this.swf.setAttribute("type","application/x-shockwave-flash");this.swf.setAttribute("width","100%");this.swf.setAttribute("height","100%");this.swf.setAttribute("data",this.flash_swf);l(this.swf,"screen");var I={wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all",quality:"high",flashvars:"readyFunction="+this._flashFn(function(){F.initEvents()})};for(var G in I){var H=document.createElement("PARAM");H.setAttribute("name",G);H.setAttribute("value",I[G]);this.swf.appendChild(H)}},isSupported:function(){return z()},canPlayType:function(F){return["video/mp4","video/flv","video/x-flv","video/m4v","application/x-mpegURL"].indexOf(F)>-1},getElement:function(){return this.swf},destroy:function(){clearInterval(this._play_interval)},initEvents:function(){var F=this;this._setSWFProperty("eventProxyFunction",this._flashFn(function(H,G){switch(G){case"playing":F.trigger("playing");break;case"seeked":F.trigger("seeked");break;case"waiting":F.trigger("waiting");break;case"ended":F.trigger("ended");break;case"canplay":case"loadedmetadata":F.trigger("canplay");break;case"play":F.trigger("play");break;case"volumechange":F.trigger("volumechange",F.getVolume());break;case"durationchange":F.trigger("durationchange",F.getDuration());break}}));this._setSWFProperty("errorEventProxyFunction",this._flashFn(function(H,G){switch(G){case"srcnotfound":F.trigger("error",201);break;default:F.trigger("error",200)}}));this.on("play",function(){F.__timeupdate=setInterval(function(){F.trigger("progress",[[0,F.swf.vjs_getProperty("buffered")]]);F.trigger("timeupdate",F.getCurrentTime())},500)});this.on(["pause","ended"],function(){clearInterval(F.__timeupdate)});this.trigger("ready")},setSource:function(F){this.swf.vjs_src(F)},play:function(){this.swf.vjs_play()},pause:function(){this.swf.vjs_pause();this.trigger("pause")},getCurrentTime:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("currentTime")}return 0},getDuration:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("duration")}return 0},setCurrentTime:function(F){this._setSWFProperty("currentTime",F)},setVolume:function(F){this._setSWFProperty("volume",F)},getVolume:function(F){return this.swf.vjs_getProperty("volume")},showDefaultUI:function(){},hideDefaultUI:function(){}});B.prototype.__backends.Flash=s;function d(H,G){var F=this;this.player=H;this.is_fullscreen=false;if(this.checkSupportFullscreen()){this.init()}}d.prototype={init:function(){var F=this;j(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"],function(G){F.player.trigger("fullscreenchange",F.checkFullscreen())});this.player.on("tray_ready",function(H,G){G.appendChild(F.getUI())})},getUI:function(){var F=this;var H=k('<div class="fullscreen"><svg><path class="on" d="M18,18V6H6v12H18z M8,16V8h8v8H8z M22,2v6h-2V4h-4V2H22z M20,16h2v6h-6v-2h4V16z M4,20h4v2H2v-6h2V20z M4,8H2V2h6v2H4V8z"/><path class="off" d="M18,8v2h-4V6h2v2H18z M14,14v4h2v-2h2v-2H14z M6,14v2h2v2h2v-4H6z M8,8H6v2h4V6H8 V8z M22,2v20H2V2H22z M20,4H4v16h16V4z"/></svg></div>');var G=H.getElementsByClassName("on")[0];var I=H.getElementsByClassName("off")[0];j(H,"click",function(){if(F.is_fullscreen){F.exitFullscreen()}else{F.requestFullscreen()}});this.player.on("fullscreenchange",function(K,J){F.is_fullscreen=J;if(F.is_fullscreen){l(F.player.root,"fullscreen");H.title="Exit from Fullscreen";G.style.display="none";I.style.display=""}else{o(F.player.root,"fullscreen");H.title="Fullscreen";G.style.display="";I.style.display="none"}});this.player.trigger("fullscreenchange");return H},checkFullscreen:function(){return(document.fullscreenElement&&document.fullscreenElement!==null)||document.mozFullScreen||document.webkitIsFullScreen},checkSupportFullscreen:function(){if(e().is_android){return false}return document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen||document.createElement("video").webkitEnterFullscreen},requestFullscreen:function(){var G=this;var H=document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen;if(H){H.call(this.player.root);this.is_fullscreen=true}else{var F=this.player.backend.getElement();if(F.webkitEnterFullscreen){this.is_fullscreen=true;j(F,"webkitendfullscreen",function(I){C(F,I.type);G.is_fullscreen=false});F.webkitEnterFullscreen()}}},exitFullscreen:function(){var F=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;if(F){F.call(document);this.is_fullscreen=false}}};B.prototype.__plugins.FullScreen=d;VASTPlugin=(function(){function H(ab,ae){var ac=((new Date).getTime()/1000)|0;var ae=y({CACHEBUSTER:ac,CACHE_BUSTER:ac,timestamp:ac},ae);A(n(ae),function(af){ab=ab.replace("["+af+"]",encodeURIComponent(ae[af]))});return ab}function O(ac,af){var ab=new Image;var ac=H(ac,af);var ae=ac.indexOf("?")==-1?"?":"&";ab.src=ac;r.log("Fire pixel",ac)}function Z(ab,ac){window.open(H(ab,ac),"_blank")}function K(ab){var ac={};if(ab&&ab.tagName.match(/^TrackingEvents$/i)){A(ab.getElementsByTagName("Tracking"),function(ae){var ag={};var af=ae.getAttribute("event");if(typeof ac[af]==="undefined"){ac[af]=[]}ag.content=ae.textContent;A(ae.attributes,function(ah){ag[ah.name]=ah.value});ac[af].push(ag)})}return ac}function P(ab){ab=ab.trim();if(match=/^(\d{1,2}):(\d{1,2}):(\d{1,2})/.exec(ab)){return{type:"seconds",value:parseInt(match[1])*3600+parseInt(match[2])*60+parseInt(match[3])}}if(match=/^(\d{1,3})%$/.exec(ab)){return{type:"percent",value:parseInt(match[1])}}}function V(ab,ac){if(ab=="html"){elm=document.createElement("DIV");elm.innerHTML=ac}else{if(ab=="iframe"){elm=document.createElement("IFRAME");elm.src=ac;elm.style.border="none";elm.scrolling="no"}else{if(ab=="application/x-shockwave-flash"){elm=document.createElement("OBJECT");elm.setAttribute("type","application/x-shockwave-flash");elm.setAttribute("data",ac)}else{elm=document.createElement("IMG");elm.src=ac}}}return elm}function R(ac){if(ac&&ac.length){for(var ab=0;ab<ac.length;ab++){O(ac[ab].content)}}}function F(ac){var ab=this;this.type;this.src;this.creative;y(this,ac);this.vpaid=null;this.on("vpaidevent",function(ai,ah,ag){r.log("VPAID event:",ah);switch(ah){case"AdLoaded":ab.vpaid.startAd();break;case"AdClickThru":var af=ag[0];var ae=ag[2];ab.trigger("vastevent","clickthru",{click_through:af,no_fire_pixel:!ae},ab);break;case"AdSkipped":ab.trigger("vastevent","skip",{},ab);break;case"AdStopped":ab.trigger("vastevent","complete",{},ab);break;case"AdError":ab.trigger("vasterror",901,ag);break;case"AdStarted":ab.trigger("vastevent","start",{},ab);break;case"AdVideoFirstQuartile":ab.trigger("vastevent","firstQuartile",{},ab);break;case"AdVideoMidpoint":ab.trigger("vastevent","midpoint",{},ab);break;case"AdVideoThirdQuartile":ab.trigger("vastevent","thirdQuartile",{},ab);break;case"AdImpression":ab.trigger("start",ab);ab.trigger("vastevent","creativeView",{},ab);break}})}F.prototype=y(Object.create(CustomObject),{vpaidEventsList:["AdLoaded","AdSkipped","AdStarted","AdStopped","AdLinearChange","AdSkippableStateChange","AdSizeChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],show:function(ac,ah,ab,af){var ae=this;var ag=k('<iframe id="iframe" frameborder="no" scrolling="no" allowfullscreen></iframe>');ag.width=ah;ag.height=ab;ac.appendChild(ag);var ai=setTimeout(function(){r.log("Timeout VPAID AdLoaded event > skip");ae.trigger("vasterror",900,"Timeout VPAID AdLoaded event")},af.timeout);this.on("vpaidevent",function(ak,aj){if(aj=="AdLoaded"||aj=="AdStarted"||aj=="AdError"){clearTimeout(ai)}});if(this.type=="application/x-shockwave-flash"){this.showFlash(ag,ah,ab,af)}else{this.showJS(ag,ah,ab,af,ag)}},showFlash:function(ae,ab,aj,al){var ak=this;var ah=ae.contentDocument;var af=ae.contentWindow;var ai="_custom_player_vpaid_on_ready"+Math.random().toString(16).split(".")[1];var ag="_custom_player_vpaid_on_error"+Math.random().toString(16).split(".")[1];var ac=function(an,am){var ao="_custom_player_vpaid_"+an+Math.random().toString(16).split(".")[1];ae.contentWindow[ao]=am;ak.vpaid.subscribe(an,ao)};ae.contentWindow[ag]=function(){ak.trigger("vpaidevent","AdError")};ae.contentWindow[ai]=function(){ak.vpaid=ae.contentWindow.vpaid;console.log("--VPAID version:",ak.vpaid.handshakeVersion("2.0"));console.log("getAdLinear:",ak.vpaid.getAdLinear());ac("AdLoaded",function(){r.log('Call "startAd" for flash VPAID application');ak.vpaid.startAd()});A(ak.vpaidEventsList,function(am){ac(am,function(an){ak.trigger("vpaidevent",am,an)})});r.log('Call "initAd" for flash VPAID application');ak.vpaid.initAd(ab,aj,"normal",500,ak.creative.params.AdParameters,"")};ah.open();ah.write('<body style="padding:0; margin:0; width:100%; height:100%;"><object id="vpaid" type="application/x-shockwave-flash" width="100%" height="100%" data="'+al.vpaid_flash_bridge+'"><param name="allowScriptAccess" value="always"></param><param name="allowNetworking" value="all"></param><param name="wmode" value="transparent"><param name="flashvars" value="onReady='+ai+"&onError="+ag+"&src="+encodeURIComponent(this.src)+'"></param></object></body>');ah.close()},showJS:function(ag,af,ab,ae){var ac=this;ag.contentWindow.trigger_error=function(){ac.trigger("vpaidevent","AdError","Can't load vpaid file")};ag.contentWindow.trigger_load=function(){var ah=ag.contentWindow.getVPAIDAd;if(typeof ah!=="function"){ac.trigger("vasterror",901,"General VPAID error.",ac.creative);return}ac.vpaid=ah();A(ac.vpaidEventsList,function(ai){ac.vpaid.subscribe(function(){ac.trigger("vpaidevent",ai,arguments)},ai)});ac.vpaid.initAd(af,ab,"normal",500,ac.creative.params,{slot:ag.contentDocument.body})};ag.contentDocument.open();ag.contentDocument.write('<body style="margin:0; padding:0; width:100%; height:100%;"><script src="'+this.src+'" onload="trigger_load()" onerror="trigger_error()"><\/script></body>');ag.contentDocument.close()},getIsSupport:function(){var ab=["application/javascript","application/x-javascript"];if(z()){ab.push("application/x-shockwave-flash")}return ab.indexOf(this.type)>-1}});function M(ac){var ab=this;this.type;this.src;this.creative;y(this,ac);this.player=null;this.use_html5=false;this.use_flash=false}M.prototype=y(Object.create(CustomObject),{show:function(ac,ag,ab,af){var ae=this;this.player=new B(ac,af);this.player.on("error",function(aj,ai,ah){ae.trigger("vasterror",400,"General Linear error. "+ah,this)});this.player.one("play",function(aj){this.on("ended",function(){ae.trigger("vastevent","complete",{},ae.creative);ae.off("vastevent")});this.on("pause",function(){ae.trigger("vastevent","pause",{},ae.creative)});this.on("resume",function(){ae.trigger("vastevent","resume",{},ae.creative)});var ah;this.on("volumechange",function(al,ak){if(ak>0&&ah==0){ae.trigger("vastevent","unmute",{},ae.creative)}if(ak==0&&ah!=0){ae.trigger("vastevent","mute",{},ae.creative)}ah=ak});var ai=0;this.on("timeupdate",function(am,al){var ak=al/this.getDuration()*100;if(ak>0&&ai==0){ai++;ae.trigger("vastevent","start",{},ae.creative);ae.trigger("vastevent","creativeView",{},ae.creative)}if(ak>25&&ai==1){ai++;ae.trigger("vastevent","firstQuartile",{},ae.creative)}if(ak>50&&ai==2){ai++;ae.trigger("vastevent","midpoint",{},ae.creative)}if(ak>75&&ai==3){ai++;ae.trigger("vastevent","thirdQuartile",{},ae.creative)}});ae.trigger("start",ae)});this.player.one("canplay",function(ah){if(!e().is_mobile){ae.player.play()}});this.player.setSources([{src:this.src,type:this.type}]);this.player.load()},getIsSupport:function(){return B.prototype.supportMedia(this.type)}});function Y(ac,ab){this.creative;this.is_vpaid=false;y(this,ab);this.is_error=false;this.on("vasterror",function(ah,af,ae,ag){this.is_error=true});this.parse(ac)}Y.prototype=y(Object.create(CustomObject),{parse:function(ae){var ab=this;var ac={type:ae.getAttribute("type"),src:ae.textContent.trim(),creative:this.creative};this.is_vpaid=this.is_vpaid||(ae.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";if(this.is_vpaid){this.media=new F(ac)}else{this.media=new M(ac)}this.media.proxy(["vastevent","vasterror","vpaidevent","done","start"],ab)},getSource:function(){return this.media.src},getIsSupport:function(){return this.media.getIsSupport()},show:function(ac,af,ab,ae){this.creative.is_vpaid=this.is_vpaid;this.media.show(ac,af,ab,ae)}});function X(ae,ac){this.place=null;this.width;this.height;this.player_options={};this.vpaid_options={};y(this,ac);this.id;this.skipoffset=null;this.sequence=1;this.is_vpaid=false;this.click_through=null;this.params={};this.tracking={};this.medias=[];this.is_ready=false;this.is_error=false;this.is_done=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ai,ag,af,ah){this.is_error=true;this.trigger("error")});this.on("vastevent",function(ai,ag,af,ah){r.log("VAST event",ag,JSON.stringify(af));switch(ag){case"clickthru":if(!af.no_fire_pixel){Z(af.click_through)}break;case"skip":case"complete":this.trigger("done");break}R(this.tracking[ag])});this.on("start",function(af){this.trigger("linearstart",this)});this.on("done",function(){this.is_done=true});var ab=this;setTimeout(function(){ab.parse(ae)},0)}X.prototype=y(Object.create(CustomObject),{parse:function(ac){var ab=this;this.id=ac.getAttribute("id")||null;this.sequence=parseInt(ac.getAttribute("sequence"))||1;this.is_vpaid=(ac.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";this.tracking=K(ac.getElementsByTagName("TrackingEvents")[0]);if(ad_parameters_xml=ac.getElementsByTagName("AdParameters")[0]){this.params.AdParameters=ad_parameters_xml.textContent.trim()}if(skipoffset_attr=ac.getAttribute("skipoffset")){this.skipoffset=P(skipoffset_attr)}if(clicks_xml=ac.getElementsByTagName("VideoClicks")[0]){if(through_xml=clicks_xml.getElementsByTagName("ClickThrough")[0]){this.click_through=through_xml.textContent.trim()}if(click_tracking_xml=ac.getElementsByTagName("ClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent.trim()})}}A(ac.getElementsByTagName("MediaFile"),function(ae){var af=new Y(ae,{is_vpaid:ab.is_vpaid,creative:ab});af.proxy(["vasterror","vastevent","start"],ab);ab.medias.push(af)});this.trigger("ready")},show:function(ac){var ab=this;if(this.medias.length){for(var ae=0;ae<this.medias.length;ae++){var ag=this.medias[ae];if(ag.getIsSupport()){this.media=ag;break}}if(this.media){var af=k('<div style="position:absolute; width:100%; height:100%; top:0; background:black"></div>');ac.place.appendChild(af);this.on("done",function(){ac.place.removeChild(af)});if(ac.place.offsetHeight==0){return}if(this.media.is_vpaid){r.log("Show linear VPAID",this.media.getSource());this.media.show(af,ac.place.offsetWidth,ac.place.offsetHeight,ac.vpaid_options)}else{r.log("Show linear video",this.media.getSource());this.media.show(af,ac.place.offsetWidth,ac.place.offsetHeight,ac.player_options)}}else{r.log("No support any media of this creative",this.id);this.trigger("vasterror",403,"Couldn't find MediaFile that is supported by this video player, based on the attributes of the MediaFile element.",this)}}else{r.log("Not found any media of this creative",this.id);this.trigger("vasterror",400,"General Linear error. Video player is unable to display the Linear Ad.",this)}},play:function(){this.media.media.player.play()},pause:function(){this.media.media.player.pause()},skip:function(){this.trigger("vastevent","skip",{},this)},clickthru:function(ab){this.trigger("vastevent","clickthru",{click_through:ab},this)},setVolume:function(ab){this.media.media.player.setVolume(ab)},mute:function(){this.media.media.player.mute()},unmute:function(){this.media.media.player.unmute()}});function T(ab){this.place;this.elm;this.width;this.height;this.is_vpaid=false;this.min_duration;this.resource;this.click_through;this.tracking=[];this.can_show=false;this.is_error=false;this.on("vasterror",function(ag,ae,ac,af){this.is_error=true});this.on("vastevent",function(ag,ae,ac,af){if(ae=="clickthru"){Z(ac.click_through)}R(this.tracking[ae])});this.parse(ab)}T.prototype=y(Object.create(CustomObject),{parse:function(ab){this.is_vpaid=(ab.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";this.width=ab.getAttribute("width")||0;this.height=ab.getAttribute("height")||0;this.tracking=K(ab.getElementsByTagName("TrackingEvents")[0]);if(min_duration=ab.getAttribute("minSuggestedDuration")){if(m=/^(\d{1,2}):(\d{1,2}):(\d{1,2})/.exec(min_duration)){this.min_duration=parseInt(m[1])*3600+parseInt(m[2])*60+parseInt(m[3])}}if(click_through_xml=ab.getElementsByTagName("NonLinearClickThrough")[0]){this.click_through=click_through_xml.textContent}if(click_tracking_xml=ab.getElementsByTagName("NonLinearClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent})}if(!this.resource&&(static_xml=ab.getElementsByTagName("StaticResource")[0])){var ac=static_xml.getAttribute("creativeType");if(this.supportMedia(ac)){this.resource={type:ac,src:static_xml.textContent.trim()}}}if(!this.resource&&(iframe_xml=ab.getElementsByTagName("IFrameResource")[0])){this.resource={type:"iframe",src:iframe_xml.textContent.trim()}}if(!this.resource&&(html_xml=ab.getElementsByTagName("HTMLResource")[0])){this.resource={type:"html",src:html_xml.textContent.trim()}}this.can_show=!!this.resource},show:function(ac){var af=this;this.place=ac;this.elm=k('<div class="nonlinear"><div class="close">x</div><div class="inner"></div></div>');var ag=this.elm.getElementsByClassName("close")[0];var ae=this.elm.getElementsByClassName("inner")[0];this.elm.style.width=this.width+"px";this.elm.style.height=this.height+"px";this.elm.style.right="10px";this.elm.style.bottom="70px";var ab=V(this.resource.type,this.resource.src);ae.appendChild(ab);if(this.click_through){j(this.elm,"click",function(){af.trigger("vastevent","clickthru",{click_through:af.click_through},af)})}if(this.min_duration){ag.style.display="none";setTimeout(function(){ag.style.display=""},this.min_duration*1000)}j(ag,"click",function(){af.close();return false});this.place.appendChild(this.elm);this.trigger("vastevent","creativeView",{},this)},close:function(){this.trigger("vastevent","collapse",{},this);this.trigger("vastevent","close",{},this);this.place.removeChild(this.elm)},supportMedia:function(ab){return ab!="application/x-shockwave-flash"||z()}});function Q(ae,ac){this.place=null;y(this,ac);this.sequence;this.required;this.banners=[];this.is_ready=false;this.is_error=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ai,ag,af,ah){this.is_error=true});var ab=this;setTimeout(function(){ab.parse(ae)},0)}Q.prototype=y(Object.create(CustomObject),{parse:function(ac){var ab=this;this.sequence=parseInt(ac.getAttribute("sequence"))||1;A(ac.getElementsByTagName("NonLinear"),function(ae){var af=new T(ae);af.proxy(["vasterror","vastevent"],ab);ab.banners.push(af)});this.trigger("ready")},show:function(){var ac=this;if(this.banners.length==0){ac.trigger("vasterror",500,"General NonLinearAds error",ac);return}var ab=0;(function(){var ae=arguments.callee;if(banner=ac.banners[ab]){if(banner.can_show){banner.on("close",function(){ab++;ae()});banner.show(ac.place)}else{ac.trigger("vasterror",503,"Couldn’t find NonLinear resource with supported type.",ac);ab++;ae()}}else{}})()}});function S(ab){this.place;this.width;this.height;this.resource;this.click_through;this.tracking=[];this.is_error=false;this.on("vasterror",function(ag,ae,ac,af){this.is_error=true});this.on("vastevent",function(ag,ae,ac,af){if(ae=="clickthru"){Z(ac.click_through)}R(this.tracking[ae])});this.parse(ab)}S.prototype=y(Object.create(CustomObject),{parse:function(ab){this.width=ab.getAttribute("width")||0;this.height=ab.getAttribute("height")||0;this.tracking=K(ab.getElementsByTagName("TrackingEvents")[0]);if(through_xml=ab.getElementsByTagName("CompanionClickThrough")[0]){this.click_through=through_xml.textContent}if(click_tracking_xml=ab.getElementsByTagName("CompanionClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent})}if(!this.resource&&(static_xml=ab.getElementsByTagName("StaticResource")[0])){var ac=static_xml.getAttribute("creativeType");if(this.supportMedia(ac)){this.resource={type:ac,src:static_xml.textContent.trim()}}}if(!this.resource&&(iframe_xml=ab.getElementsByTagName("IFrameResource")[0])){this.resource={type:"iframe",src:iframe_xml.textContent.trim()}}if(!this.resource&&(html_xml=ab.getElementsByTagName("HTMLResource")[0])){this.resource={type:"html",src:html_xml.textContent.trim()}}if(this.resource&&(ad_slot_id=ab.getAttribute("adSlotID"))){if(custom_place=document.getElementById(ad_slot_id)){if(this.width==custom_place.offsetWidth&&this.height==custom_place.offsetHeight){this.place=custom_place}}}},show:function(){var ab=this;var ac=V(this.resource.type,this.resource.src);ac.width=this.width;ac.height=this.height;if(this.click_through){ac.style.cursor="pointer";j(ac,"click",function(){ab.trigger("vastevent","clickthru",{click_through:ab.click_through},ab)})}this.place.innerHTML="";this.place.appendChild(ac);ab.trigger("vastevent","creativeView",{},this)},supportMedia:function(ab){return ab!="application/x-shockwave-flash"||z()}});function L(ae,ac){this.places=[];y(this,ac);this.sequence;this.required;this.banners=[];this.is_ready=false;this.is_error=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ai,ag,af,ah){this.is_error=true});var ab=this;setTimeout(function(){ab.parse(ae)},0)}L.prototype=y(Object.create(CustomObject),{parse:function(ac){var ab=this;this.sequence=parseInt(ac.getAttribute("sequence"))||1;this.required=ac.getAttribute("required")||"any";if(this.required!="none"){A(ac.getElementsByTagName("Companion"),function(ae){var af=new S(ae);af.proxy(["vasterror","vastevent"],ab);ab.banners.push(af)})}this.trigger("ready")},show:function(){var ab=this;if(this.required!="none"){var ac=[];var ae=[];A(this.places,function(af){if(elm=document.getElementById(af.id)){ac.push(af.width+"x"+af.height);ae.push(elm)}});A(this.banners,function(af){if(af.place){if((i=ae.indexOf(af.place))>-1){ac[i]=null}}else{if((i=ac.indexOf(af.width+"x"+af.height))>-1){ac[i]=null;af.place=ae[i]}}if(af.place){af.show()}else{ab.trigger("vasterror",601,"Unable to display Companion because creative dimensions do not fit within Companion display area (i.e., no available space).",af);if(ab.required=="all"){ab.trigger("vasterror",602,"Unable to display Required Companion",ab);return false}}})}}});function U(ae,ac){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};y(this,ac);this.type;this.creative;this.tracking={};this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ai,ag,af,ah){this.is_error=true});this.on("vastevent",function(ai,ag,af,ah){R(this.tracking[ag])});this.on("lineardone",function(){this.is_linear_done=true});var ab=this;setTimeout(function(){ab.parse(ae)},0)}U.prototype=y(Object.create(CustomObject),{parse:function(ac){var ab=this;this.id=ac.getAttribute("id")||null;this.tracking={};if(linear_xml=ac.getElementsByTagName("Linear")[0]){this.type="linear";this.creative=new X(linear_xml,this.linear_options);this.creative.on(["done","error"],function(){setTimeout(function(){ab.trigger("lineardone")},0)})}else{if(nonlinear_xml=ac.getElementsByTagName("NonLinearAds")[0]){this.type="nonlinear";this.creative=new Q(nonlinear_xml,this.nonlinear_options)}else{if(companion_xml=ac.getElementsByTagName("CompanionAds")[0]){this.type="companion";this.creative=new L(companion_xml,this.companion_options)}else{this.trigger("vasterror",0,"",this);return}}}this.creative.parent=this;this.creative.proxy(["ready","vasterror","vastevent","linearstart"],ab)},show:function(){switch(this.type){case"linear":this.creative.show(this.linear_options);break;case"nonlinear":this.creative.show(this.nonlinear_options);break;case"companion":this.creative.show(this.companion_options);break}}});function N(ae,ac){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};y(this,ac);this.error_url;this.impression_url;this.tracking={};this.creatives=[];this.linear=[];this.nonlinear=[];this.companion=[];this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});this.on("vastevent",function(ai,ag,af,ah){if(ag=="creativeView"){ai.handler.remove();if(this.impression_url){O(this.impression_url);this.trigger("vastevent","impression",{url:this.impression_url},this)}}});this.on("vasterror",function(ai,ag,af,ah){if(this.error_url){O(this.error_url,{ERRORCODE:ag})}});var ab=this;setTimeout(function(){ab.parse(ae)},0)}N.prototype=y(Object.create(CustomObject),{parse:function(ae){var ab=this;r.log("Parse InLine tag");if(error_xml=ae.getElementsByTagName("Error")[0]){this.error_url=error_xml.textContent.trim()}if(impression_xml=ae.getElementsByTagName("Impression")[0]){this.impression_url=impression_xml.textContent.trim()}if(creatives_xml=ae.getElementsByTagName("Creatives")[0]){var ac={parent:ab,linear_options:ab.linear_options,nonlinear_options:ab.nonlinear_options,companion_options:ab.companion_options};A(creatives_xml.getElementsByTagName("Creative"),function(ag){var af=new U(ag,ac);ab.creatives.push(af);af.on("ready",function(){if(af.type=="linear"){ab.linear.push(af)}if(af.type=="nonlinear"){ab.nonlinear.push(af)}if(af.type=="companion"){ab.companion.push(af)}if(D(ab.creatives,function(ah){return ah.is_ready||ah.is_error})){ab.trigger("ready")}});af.proxy(["vasterror","vastevent","linearstart"],ab)});this.linear.sort(function(ag,af){return ag.sequence-af.sequence});this.nonlinear.sort(function(ag,af){return ag.sequence-af.sequence});this.companion.sort(function(ag,af){return ag.sequence-af.sequence})}},start:function(){var ab=this;this.on("lineardone",function(){ab.startNonLinear()});this.startCompanion();this.startLinear()},startLinear:function(){var ac=this;var ab=0;(function(){var ae=arguments.callee;if(creative=ac.linear[ab]){creative.on("lineardone",function(){ab++;ae()});creative.show()}else{ac.trigger("lineardone")}})()},startNonLinear:function(){if(this.nonlinear.length==0){r.log("This creative haven't any nonlinear creatives")}A(this.nonlinear,function(ab){ab.show()})},startCompanion:function(){if(this.companion.length==0){r.log("This creative haven't any companion creatives")}A(this.companion,function(ab){ab.show()})}});function W(ae,ac){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};y(this,ac);this.vast;this.error_url;this.impression_url;this.trackings={linear:{},nonlinear:{},companion:{}};this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});this.on("vastevent",function(ai,ag,af,ah){if(ag=="creativeView"){ai.handler.remove();if(this.impression_url){O(this.impression_url);this.trigger("vastevent","impression",{url:this.impression_url},this)}}});this.on("vastevent",function(ai,ag,af,ah){if(ah instanceof X){R(this.trackings.linear[ag])}if(ah instanceof Q){R(this.trackings.nonlinear[ag])}if(ah instanceof L){R(this.trackings.companion[ag])}});this.on("vasterror",function(ai,ag,af,ah){if(this.error_url){O(this.error_url,{ERRORCODE:ag})}});var ab=this;setTimeout(function(){ab.parse(ae)},0)}W.prototype=y(Object.create(CustomObject),{parse:function(ae){var ab=this;var ac=ae.getElementsByTagName("VASTAdTagURI")[0].textContent;r.log("Parse Wrapper tag");if(error_xml=ae.getElementsByTagName("Error")[0]){this.error_url=error_xml.textContent.trim()}if(impression_xml=ae.getElementsByTagName("Impression")[0]){this.impression_url=impression_xml.textContent.trim()}this.vast=new I(ac,{parent:this,linear_options:this.linear_options,nonlinear_options:this.nonlinear_options,companion_options:this.companion_options});if(creatives_xml=ae.getElementsByTagName("Creatives")[0]){A(creatives_xml.getElementsByTagName("Creative"),function(af){if(linear_xml=ae.getElementsByTagName("Linear")[0]){ab.trackings.linear=K(linear_xml.getElementsByTagName("TrackingEvents")[0])}if(nonlinear_xml=ae.getElementsByTagName("NonLinearAds")[0]){ab.trackings.nonlinear=K(nonlinear_xml.getElementsByTagName("TrackingEvents")[0])}if(companion_xml=ae.getElementsByTagName("CompanionAds")[0]){ab.trackings.companion=K(companion_xml.getElementsByTagName("TrackingEvents")[0])}})}this.vast.proxy(["ready","error","vastevent","vasterror","lineardone","linearstart"],ab)},start:function(){this.vast.start()},startLinear:function(){this.vast.startLinear()},startCompanion:function(){this.vast.startCompanion()},startNonLinear:function(){this.vast.startNonLinear()}});function aa(ae,ac){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};y(this,ac);this.id;this.sequence;this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.is_wrapper=false;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});var ab=this;setTimeout(function(){ab.parse(ae)},0)}aa.prototype=y(Object.create(CustomObject),{parse:function(ae){var ab=this;this.id=ae.getAttribute("id")||null;this.sequence=parseInt(ae.getAttribute("sequence"))||1;var ac={parent:this,linear_options:ab.linear_options,nonlinear_options:ab.nonlinear_options,companion_options:ab.companion_options};if(wrapper_xml=ae.getElementsByTagName("Wrapper")[0]){this.inline=new W(wrapper_xml,ac)}else{if(inline_xml=ae.getElementsByTagName("InLine")[0]){this.inline=new N(inline_xml,ac)}else{this.trigger("error")}}this.inline.proxy(["ready","linearstart","lineardone","error","vastevent","vasterror"],ab)},start:function(){this.inline.start()},startLinear:function(){this.inline.startLinear()},startCompanion:function(){this.inline.startCompanion()},startNonLinear:function(){this.inline.startNonLinear()}});function I(ae,ac){var ab=this;this.parent=null;this.timeout=7000;this.linear_options={player_options:{},vpaid_options:{timeout:10000}};this.nonlinear_options={};this.companion_options={};y(this,ac);this.url=H(ae,{URL:location.href,CONTAINER_WIDTH:this.linear_options.width,CONTAINER_HEIGHT:this.linear_options.height});this.ads=[];this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.on("ready",function(){this.is_ready=true});this.on("error",function(ah,ag,af){r.log("ERROR in VAST",this.url,ag,af);this.is_error=true});this.on("vasterror",function(ah,ag,af){r.log("ERROR in VAST",this.url,ag,af)});this.on("lineardone",function(){r.log("End linear procees for VAST",this.url);this.is_linear_done=true});ab.load(ab.url)}I.prototype=y(Object.create(CustomObject),{load:function(ac){var ab=this;var af=null;r.log("Load VAST tag:",ac);var ae;if(this.timeout){ae=setTimeout(function(){r.log("Timeout load",ac);ab.trigger("error",301,"Timeout of VAST URI "+ac);af.abort()},this.timeout)}af=f(ac,function(ah,ag){clearTimeout(ae);if(ah){if(ag.status==0){r.log("Can not load VAST tag");ab.trigger("error",902,"Can not load VAST tag");return}if(!ag.responseXML||!ag.responseXML.documentElement){r.log("XML parsing error");ab.trigger("error",100,"XML parsing error");return}A(ag.responseXML.documentElement.getElementsByTagName("Ad"),function(ai){var aj=new aa(ai,{parent:ab,linear_options:ab.linear_options,nonlinear_options:ab.nonlinear_options,companion_options:ab.companion_options});aj.on("ready",function(){if(D(ab.ads,function(ak){return ak.is_ready||ak.is_error})){ab.trigger("ready")}});aj.proxy(["linearstart","vastevent","vasterror","error"],ab);ab.ads.push(aj)});if(ab.ads.length){ab.ads.sort(function(aj,ai){return aj.sequence-ai.sequence})}else{r.log("No Ads in VAST tag");ab.trigger("error",903,"No Ads in VAST tag")}}else{r.log("Can not load VAST tag");ab.trigger("error",902,"Can not load VAST tag")}});if(!af){clearTimeout(ae);r.log("Browser can not make ajax requests");ab.trigger("error",904,"Browser can not make ajax requests")}},start:function(){var ab=this;this.on("lineardone",function(){ab.startNonLinear()});this.startCompanion();this.startLinear()},startLinear:function(){var ac=this;var ab=0;r.log("Process linear for VAST:",this.url);(function(){var ae=arguments.callee;if(ad=ac.ads[ab]){ad.on("lineardone",function(){ab++;ae()});ad.startLinear()}else{if(!ac.is_linear_done){ac.trigger("lineardone")}}})()},startCompanion:function(){r.log("Process companion for VAST:",this.url);A(this.ads,function(ab){ab.startCompanion()})},startNonLinear:function(){r.log("Process nonlinear for VAST:",this.url);A(this.ads,function(ab){ab.startNonLinear()})}});(function(){var ab=document.createElement("STYLE");ab.innerHTML=".Ad {position: absolute;width: 100%;height: 100%;top: 0;z-index: 1000;}.Ad .ad-info {position: absolute;right: 5px;vertical-align: middle;top: 10px;color: #fff;font-size: 13pt;z-index: 10;background: rgba(0,0,0,0.5);padding: 5px 10px;}.Ad .ad-info .ad-link{color: #fff;border-bottom: 1px dashed #fff;text-decoration: none;cursor: pointer;}.Ad .ad-skip {position: absolute;display: table;right: 5px;bottom: 70px;padding: 5px;background: rgba(0,0,0,0.4);cursor: pointer;z-index: 10;}.Ad .ad-skip  > .message {display: table-cell;color: #fff;vertical-align: middle;text-align: center;font-size: 12pt;padding-right: 10px;}.Ad .ad-skip > img {display: table-cell;height: 60px;}.customPlayer > .nonlinear {position: absolute;z-index: 1000;}.customPlayer > .nonlinear .close {position: absolute;right: 0;top: 0;width: 15px;height: 15px;cursor: pointer;color: red;z-index: 1;text-align: center;}.customPlayer > .nonlinear .close:hover {text-decoration: underline;}.customPlayer > .nonlinear .inner {position: absolute;left: 0;top: 0;cursor: pointer;}";document.head.appendChild(ab)})();function J(ac,ab){this.click_through=null;this.skipoffset=null;y(this,ab);this.player=ac;this.info=k('<div class="ad-info"><span><span class="ad-link">Visit advertiser\'s site</span><span style="margin:0 10px">&bull;</span></span><span class="timer"></span></div>');this.skip=k('<div class="ad-skip"><div class="message"></div></div>');this.ctrl=new p(this.player,{progress:{readonly:true},timer:{show:false}});this.ctrl.proxy(["play","pause","volumechange","mute","unmute"],this);this.init()}J.prototype=y(Object.create(CustomObject),{getElement:function(){return this.ctrl.getElement()},init:function(){var ac=this;var ae=this.player;var aj=this.info.getElementsByClassName("timer")[0];var ah=this.info.firstChild;var ag=this.skip;var ab=this.ctrl.getElement();ab.appendChild(this.info);ab.appendChild(this.skip);ae.on("timeupdate",function(ak,al){aj.innerHTML="Ad. "+ac.ctrl.formatTime(ac.ctrl.duration-al)});if(this.click_through){j(ah,"click",function(){ac.trigger("clickthru",ac.click_through);return false})}else{ah.style.display="none"}this.skipoffset={type:"seconds",value:3};if(this.skipoffset){var ai=null;if(this.skipoffset.type=="seconds"){ai=this.skipoffset.value}if(this.skipoffset.type=="percent"){ai=ac.ctrl.duration/100*this.skipoffset.value}if(ai){var af=ag.getElementsByClassName("message")[0];ae.on("timeupdate",function(ak,al){if(al>ai){ak.handler.remove();af.innerHTML="Skip to video";j(ag,"click",function(am){ac.trigger("skip");return false})}else{af.innerHTML="You can skip<br>to video<br>in "+parseInt(ai-al)}})}}else{ag.style.display="none"}}});function G(ae,ac){var ab=this;this.player=ae;this.conf={debug:false,vpaid_flash_bridge:"vpaid_bridge.swf",schedule:[],companion_places:[],onvastevent:function(){},onvasterror:function(){}};t(this.conf,ac);if(this.conf.debug){r.on()}this.ad_place=k('<div class="Ad"></div>');this.queue=[];A(this.conf.schedule,function(ag){var ag=t({offset:"pre",tag:null,onvastevent:function(){},onvasterror:function(){}},ag);if(typeof ag.tag==="function"){ag.tag=ag.tag()}if(ag.offset=="pre"){ab.player.one("play",function(ai){ab.processVast(ag)})}if(ag.offset=="post"){ab.player.on("timeupdate",function(ai,aj){if((ab.player.getDuration()-aj)<=2){ai.handler.remove();ab.processVast(ag)}})}if(m=/^(\d+)$/.exec(ag.offset)){var af=m[1]|0;ab.player.on("timeupdate",function(ai,aj){if(aj>af){ai.handler.remove();ab.processVast(ag)}})}if(m=/^(\d+)%$/.exec(ag.offset)){var ah=m[1]|0;ab.player.on("timeupdate",function(ai){if(ab.player.getProgress()>ah){ai.handler.remove();ab.processVast(ag)}})}})}G.prototype={processVast:function(ae){var ab=this;var af=new I(ae.tag,{linear_options:{place:this.ad_place,player_options:{cookieKeyVolume:this.player.conf.cookieKeyVolume,flash_swf:this.player.conf.backend_options.flash_swf,plugins:{BigMode:this.player.conf.plugins.BigMode}},vpaid_options:{vpaid_flash_bridge:ab.conf.vpaid_flash_bridge}},nonlinear_options:{place:this.player.root},companion_options:{places:this.conf.companion_places}});af.on("vasterror",function(ag){ab.conf.onvasterror();ae.onvasterror()});af.on("vastevent",function(aj,ag,ah,ai){ab.conf.onvastevent(ag,ah,ai);ae.onvastevent(ag,ah,ai)});af.on("linearstart",function(ah,ag){ab.initControls(ag)});var ac=function(){var ag=ab.queue[0];if(ag&&!ag.is_error){ab.player.root.appendChild(ab.ad_place);ag.on(["lineardone","error"],function(){ab.player.root.removeChild(ab.ad_place);ab.queue.shift();ac()});if(ag.is_ready){ag.start()}else{ag.on("ready",function(){this.start()})}}else{ab.player.trigger("vast_linear_ad_done");ab.player.play()}};af.on("error",function(aj,ah,ag,ai){console.error(ah,ag,ai)});this.queue.push(af);if(this.queue.length==1){this.player.pause();ab.player.trigger("vast_start_ad");ac()}},initControls:function(ab){var ae=this;if(!ab.is_vpaid){var af=ab.media.media.player;var ac=new J(af,{click_through:ab.click_through,skipoffset:ab.skipoffset});ac.on(["play","pause","skip","mute","unmute"],function(ag){ab[ag.type]()});ac.on("clickthru",function(ah,ag){ab.clickthru(ag)});ac.on("volumechange",function(ah,ag){ab.setVolume(ag);ae.player.setVolume(ag)});af.root.appendChild(ac.getElement())}}};return G})();B.prototype.__plugins.VAST=VASTPlugin;function x(H,G){this.player=H;this.conf={hq:false};t(this.conf,G);this.can_hq=false;this.hq=!!this.conf.hq;this.btn=k('<div class="hq" style="width: 32px;"><svg><path transform="translate(-104, 0)" d="M114.1,3.7h3.7v13.6h-3.7v-5.5h-4.3v5.5h-3.7V3.7h3.7v5h4.3V3.7z M133.8,20.5h-4.6l-2.4-3l0,0v0l0,0c-2.1,0-3.8-0.6-4.9-1.8c-1.1-1.2-1.7-2.9-1.7-5.2c0-2.3,0.6-4,1.7-5.2c1.1-1.2,2.8-1.8,4.9-1.8c2.2,0,3.8,0.6,4.9,1.8c1.1,1.2,1.7,2.9,1.7,5.2c0,3.1-1,5.1-2.9,6.2L133.8,20.5z M129.6,10.5c0-1.4-0.2-2.4-0.7-3c-0.5-0.6-1.1-1-2-1c-1.8,0-2.8,1.3-2.8,4c0,2.6,0.9,3.9,2.7,3.9c0.9,0,1.6-0.3,2.1-1C129.3,12.8,129.6,11.8,129.6,10.5z"/></svg></div>');var F=this;this.player.on("tray_ready",function(J,I){if(I.lastChild&&I.lastChild.className=="fullscreen"){I.insertBefore(F.getUI(),I.lastChild)}else{I.appendChild(F.getUI())}});this.init()}x.prototype={init:function(){var F=this;this.origin_setSources=this.player.setSources;this.player.setSources=this.setSources.bind(this);j(this.btn,"click",function(){F.setHQ(!F.hq)})},getUI:function(){return this.btn},setSources:function(G){var F=this;this.sources=G;A(G,function(H){F.can_hq=F.can_hq||H.hq});this.setHQ(this.can_hq?this.hq:false);this.player},setHQ:function(F){this.hq=!!F;if(this.can_hq){this.btn.style.display=null}else{this.btn.style.display="none"}if(this.hq){this.btn.style.opacity=1}else{this.btn.style.opacity=0.5}this.applySourceHQ(F)},applySourceHQ:function(){var G=this;var F=this.sources.filter(function(J){return typeof J.hq==="undefined"||J.hq==G.hq});if(this.player.is_start_load){var I=this.player.is_playing;var H=this.player.getProgress();this.player.one("canplay",function(J){this.setProgress(H);if(I){this.play()}});this.origin_setSources.call(this.player,F);this.player.load()}else{this.origin_setSources.call(this.player,F)}}};B.prototype.__plugins.HQ=x;function a(H,G){var F=this;this.player=H;this.conf={bigClass:"big",target:document.body};t(this.conf,G);this.can_hq=false;this.hq=!!this.conf.hq;this.btn=k('<div class="big"><svg><path d="M22,11.4l-3-3l-3.1,3.1l-3.3-3.3L15.7,5l-3-3H22V11.4z M8.3,19l3,3H2v-9.4l3,3l3.2-3.2l3.3,3.3L8.3,19z"/><path d="M12.5,2.1l3,3L18.7,2L22,5.3l-3.1,3.1l3,3h-9.4V2.1z M5.2,15.5l-3-3h9.4v9.4l-3-3L5.3,22L2,18.7L5.2,15.5z"/></svg></div>');this.player.on("tray_ready",function(J,I){if(I.lastChild&&I.lastChild.className=="fullscreen"){I.insertBefore(this.btn,I.lastChild)}else{I.appendChild(this.btn)}var K=this.btn.getElementsByTagName("path");if(c(F.conf.target,F.conf.bigClass)){K[0].style.display="none";K[1].style.display=""}else{K[1].style.display="none";K[0].style.display=""}j(this.btn,"click",function(){if(c(F.conf.target,F.conf.bigClass)){o(F.conf.target,F.conf.bigClass);K[1].style.display="none";K[0].style.display=""}else{l(F.conf.target,F.conf.bigClass);K[0].style.display="none";K[1].style.display=""}})},this)}B.prototype.__plugins.BigMode=a;function g(H,G){var F=this;this.conf={src:null,href:null,title:null,width:null,height:null};this.player=H;t(this.conf,G);if(!this.conf.src){return}this.icon=k('<a target="_blank"></a>');this.icon.style.position="absolute";this.icon.style.zIndex=200;this.icon.style.top="1%";this.icon.style.right="1%";this.icon.style.opacity=0.5;this.icon.style.display="none";if(this.conf.href){this.icon.href=this.conf.href}if(this.conf.title){this.icon.title=this.conf.title}this.img=new Image;this.img.src=this.conf.src;if(this.conf.width){this.img.width=this.conf.width}if(this.conf.height){this.img.height=this.conf.height}this.icon.appendChild(this.img);this.player.root.appendChild(this.icon);this.player.on("play",function(){F.icon.style.display=""});j(this.icon,"click",function(){F.player.pause()});j(this.icon,"mouseover",function(){this.style.opacity=1});j(this.icon,"mouseout",function(){this.style.opacity=0.5})}B.prototype.__plugins.Icon=g;return function(F,G){var G=y({allow_backends:["HTML5","Flash"],controls:{}},G);var H=new B(F,G);if(G.controls){var I=new p(H,t({useMobileFallback:true,poster:G.poster},G.controls));I.on(["play","pause","mute","unmute"],function(J){H[J.type]()});I.on("positionchange",function(K,J){H.setProgress(J*100)});I.on("volumechange",function(K,J){H.setVolume(J)});if(H._plugins.FullScreen){I.on("fullscreentoggle",function(){var J=H._plugins.FullScreen;if(J.is_fullscreen){J.exitFullscreen()}else{J.requestFullscreen()}});I.on("exitfullscreen",function(){H._plugins.FullScreen.exitFullscreen()})}F.appendChild(I.getElement())}return H}})();window.CustomPlayer.version="a870ccc.1461338651";