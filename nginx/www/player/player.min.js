window.CustomPlayer=(function(){function g(B,C){var A=new RegExp("(^|\\s)"+C+"(\\s|$)","g");if(A.test(B.className)){return}B.className=(B.className+" "+C).replace(/\s+/g," ").replace(/(^ | $)/g,"")}function k(B,C){var A=new RegExp("(^|\\s)"+C+"(\\s|$)","g");B.className=B.className.replace(A,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function b(B,C){var A=new RegExp("(^|\\s)"+C+"(\\s|$)","g");return A.test(B.className)}function v(C,B){if(C){for(var A=0;A<C.length;A++){if(B(C[A])===false){break}}}}function j(C){var B=[];for(var A in C){if(C.hasOwnProperty(A)){B.push(A)}}return B}function q(A){return typeof A==="object"&&A!==null&&A.constructor===Object}function z(A){return A?(q(A)?j(A).length==0:A.length==0):true}function p(B,A){v(j(A),function(C){if(q(B[C])&&q(A[C])&&!z(B[C])){p(B[C],A[C])}else{if(typeof B[C]!=="undefined"){B[C]=A[C]}}});return B}function t(B,A){v(j(A),function(C){if(q(B[C])&&q(A[C])&&!z(B[C])){t(B[C],A[C])}else{B[C]=A[C]}});return B}function y(C,B){for(var A=0;A<C.length;A++){if(!B(C[A])){return false}}return true}function e(H,F,E,D){if(F instanceof Array){for(var B=0;B<F.length;B++){e(H,F[B],E,D)}}else{var G=F.split(".")[0];var A=F.split(".")[1]||null;var C=function(I){if(E.call(D?D:H,I)===false){I.stopPropagation();I.preventDefault()}};if(!H.__events){H.__events={}}H.__events=H.__events||{};H.__events[G]=H.__events[G]||[];H.__events[G].push({tag:A,handler:C});H.addEventListener(G,C,false)}}function x(F,D){if(D instanceof Array){for(var C=0;C<D.length;C++){x(F,D[C])}}else{var E=D.split(".")[0];var A=D.split(".")[1]||null;var B=F.__events[E];for(var C=0;C<B.length;C++){if(B[C]&&(A===null||B[C].tag==A)){F.removeEventListener(E,B[C].handler,false);B[C]=null}}}}function f(A){var B=document.createElement("DIV");B.innerHTML=A;return B.firstChild}function u(){var A=navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description;return !!A}function r(C,A){var B={};v(document.cookie.split(";"),function(D){var E=D.split("=");if(E.length==2){B[E[0].trim()]=E[1].trim()}});return B[C]&&!isNaN(B[C])?B[C]:A}function n(A,B){document.cookie=A+"="+B+"; path=/"}function d(B,D){var A=this;var C=new XMLHttpRequest();C.onreadystatechange=function(){if(C.readyState==4){D(C.status==200,C)}};C.open("GET",B,true);C.send(null);return C}CustomObject={proxy:function(B,C){if(B instanceof Array){for(var A=0;A<B.length;A++){this.proxy(B[A],C)}}else{this.on(B,function(){var D=Array.prototype.splice.call(arguments,1);C.trigger.apply(C,[B].concat(D))})}},on:function(E,D,C){var A=this;this._handlers=this._handlers||{};if(E instanceof Array){for(var B=0;B<E.length;B++){this.on(E[B],D,C)}}else{if(typeof this._handlers[E]==="undefined"){this._handlers[E]=[]}this._handlers[E].push({_id:this._handlers[E].length,handler:D,scope:C||this,remove:function(){A._handlers[E][this._id]=null}})}return this},trigger:function(E){this._handlers=this._handlers||{};var C=Array.prototype.splice.call(arguments,1);var A=(this._handlers[E]||[]).concat(this._handlers["*"]||[]);for(var D=0;D<A.length;D++){if(h=A[D]){var B=h.handler.apply(h.scope,[{type:E,handler:h}].concat(C));if(B===false){break}}}return this}};function w(A,C){this.root=A;this.is_show_poster=false;this.is_loading=false;this.is_playing=false;this.is_muted=false;this.is_start_load=false;this.duration=null;this.sources=[];this._handlers={};this._plugins={};this.conf={baseCSSClass:"customPlayer",muted:false,autoplay:false,sources:[],plugins:{},defaultVolume:1,allow_backends:j(this.__backends),flash_swf:"video.swf",cookieKeyVolume:null};p(this.conf,C);g(this.root,this.conf.baseCSSClass);if(this.conf.plugins){this._initPlugins(this.conf.plugins)}var B=this;setTimeout(function(){if(B.conf.sources){B.setSources(B.conf.sources)}B._init()},0)}w.prototype=t(Object.create(CustomObject),{__backends:{},__plugins:{},_init:function(){if(this.conf.autoplay){this.play()}if(this.conf.cookieKeyVolume){this.setVolume(r(this.conf.cookieKeyVolume,this.conf.defaultVolume))}else{this.setVolume(this.conf.defaultVolume)}if(this.conf.muted){this.mute()}},_destroyBackend:function(){if(this.backend){this.backend.destroy();this.root.removeChild(this.backend.getElement())}},_initBackend:function(C){var A=this;this.trigger("waiting");if(!(this.backend instanceof C)){if(this.backend){this._destroyBackend()}this.backend=new C({flash_swf:this.conf.flash_swf});this.backend.on("play",function(){A.is_playing=true});this.backend.on("pause",function(){A.is_playing=false});this.backend.on("ended",function(){A.is_playing=false});this.backend.on("error",function(F,E,D){A.error(E,D)});this.backend.on("timeupdate",function(E,D){A.trigger("timeupdate",D,A.getDuration())});this.backend.on("ready",function(){this.setVolume(A.volume+0.1);this.setVolume(A.volume-0.1);this.setVolume(A.volume)});this.backend.proxy(["waiting","playing","seeking","seeked","progress","ended","volumechange","play","canplay","pause"],this);this.backend.init();var B=this.backend.getElement();B.style.width="100%";B.style.height="100%";B.style.position="absolute";B.style.left=0;B.style.top=0;this.root.appendChild(B);this.trigger("backendchange",this.backend)}},_initSources:function(E){var B=this.conf?this.conf.allow_backends:j(this.__backends);var A=this.__backends;for(var F=0;F<B.length;F++){var D=B[F];if(typeof A[D]==="undefined"){continue}for(var C=0;C<E.length;C++){if(A[D].prototype.isSupported()&&A[D].prototype.canPlayType(E[C].type)){this._initBackend(A[D]);this.source=E[C];this.trigger("sourcechange",this.source);return true}}}return false},_initPlugins:function(B){for(var A in B){if(B[A]&&(typeof B[A].enabled==="undefined"||B[A].enabled)){this._plugins[A]=new this.__plugins[A](this,B[A])}}},getWidth:function(){return this.root.offsetWidth},getHeight:function(){return this.root.offsetHeight},supportMedia:function(E){var B=this.conf?this.conf.allow_backends:j(this.__backends);var A=this.__backends;for(var D=0;D<B.length;D++){var C=B[D];if(typeof A[C]==="undefined"){continue}if(A[C].prototype.isSupported()&&A[C].prototype.canPlayType(E)){return true}}return false},destroy:function(){if(this.backend){this._destroyBackend();this.backend=null}this._handlers={};this.root.parentElement.removeChild(this.root);return this},decodeErrorCode:function(A){var B={100:"We are working to fix this as soon as possible. Thanks for patience.",101:"Your browser can not reproduce this video. Please update your browser for the best viewing experience.",102:"Oops, try again! There is no video.",200:"We are working to fix this as soon as possible. Thanks for patience.",201:"Video temporarily is unavailable, please try again later."};return B[A]||"Unknown error"},error:function(B,A){this.trigger("error",B,A||this.decodeErrorCode(B))},setSources:function(A){if(A&&A.length){if(this.is_playing){this.pause()}this.source=null;this.sources=A}else{this.error(102)}return this},load:function(){var A=this;if(this.sources&&this.sources.length){if(this._initSources(this.sources)){if(this.backend.is_ready){this.backend.setSource(A.source.src,A.source.type)}else{this.backend.on("ready",function(B){B.handler.remove();this.setSource(A.source.src,A.source.type)})}this.is_start_load=true}else{this.error(101)}}else{this.error(102)}},play:function(){if(!this.is_playing){this.is_playing=true;if(this.is_start_load){this.backend.play()}else{this.on("canplay",function(A){A.handler.remove();this.backend.play()});this.load()}}return this},pause:function(){if(this.is_playing){this.backend.pause();this.is_playing=false}return this},getVolume:function(){if(this.backend){this.volume=this.backend.getVolume()}return this.volume},setVolume:function(A){this.volume=Math.min(1,Math.max(0,A));if(this.conf.cookieKeyVolume){n(this.conf.cookieKeyVolume,this.volume)}this.trigger("volumechange",this.volume);if(this.backend){this.backend.setVolume(this.volume)}},mute:function(){this._old_volume=this.getVolume();this.setVolume(0)},unmute:function(){this.setVolume(this._old_volume||1)},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},setProgress:function(A){var B=this.getDuration()/100*A;this.backend.setCurrentTime(B)},getProgress:function(){if(this.backend){return this.getCurrentTime()/this.getDuration()*100}else{return 0}}});(function(){var A=document.createElement("STYLE");A.innerHTML='.customPlayer {position: relative;outline: none;background: #000;z-index: 0;font: 400 14px/1.2 \'Roboto\', sans-serif;overflow: hidden;}.customPlayer.fullscreen {position: absolute;top: 0;left: 0;width: 100% !important;height: 100% !important;}.customPlayer .ui {position: absolute;left: 0;top: 0;right: 0;bottom: 0;z-index: 100;outline: none;}.customPlayer .no-animate,.customPlayer .no-animate *{transition: none !important;}.customPlayer .ui > .loader {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui > .loader.hide {opacity: 0;}.customPlayer .ui > .error.fatal {position: absolute;display: table;top: 0;left: 0;width: 100%;height: 100%;color: rgb(255, 82, 82);font-size: 20pt;text-align: center;z-index: 1000;background: #000;}.customPlayer .ui > .error>div {display: table-cell;vertical-align: middle;}.customPlayer .ui .start-screen {position: absolute;left: 0;top: 0;width: 100%;height: 100%;z-index: 10;cursor: pointer;background-color: black;opacity: 1;transition: opacity ease .5s;}.customPlayer .ui .start-screen.hide {opacity: 0;}.customPlayer .ui .start-screen > .poster {position: absolute;left: 0;top: 0;width: 100%;height: 100%;background-repeat: no-repeat;background-position: 50% 50%;background-size: contain;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui .start-screen > .poster.hide {opacity: 0;}.customPlayer .ui .start-screen svg {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;}.customPlayer .ui .start-screen:hover svg > path {fill: rgba(255,255,255,0.9);}.customPlayer .ui>.controls {position: absolute;left: 0px;right: 0px;bottom: 0px;height: 69px;background: none;background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABFCAYAAACL3IzzAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjBCQUNBRUVFNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjBCQUNBRUVGNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MEJBQ0FFRUM2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MEJBQ0FFRUQ2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4PyzKNAAAAbElEQVR42myPUQ6AMAhDK9u1jB/e/0xV6NaQ6M/SBy0w3NcZAfAIEBEECvNJJLaqGjGMw4lUSgzjVlVLxAdnjk9lM9+aUKrmcWqvVI+5oZgbZeH0yo4yr/vWvIZ90TpIX9Xh8NCfmxfK/AgwACr2StbF5TFoAAAAAElFTkSuQmCC\');opacity: 0;transition: opacity ease .3s;z-index: 9;}.customPlayer .ui>.controls.show {opacity: 1;}.customPlayer .ui>.controls svg {fill: #FFFFFF;}.customPlayer .ui>.controls svg:hover {fill: #FCC010;}.customPlayer .ui>.controls .play-pause {position: absolute;left: 20px;bottom: 10px;cursor: pointer;width: 24px;height: 24px;overflow: hidden;}.customPlayer .ui>.controls .play-pause path.play {display: block;}.customPlayer .ui>.controls .play-pause path.pause {display: none;}.customPlayer .ui.playing>.controls .play-pause path.play {display: none;}.customPlayer .ui.playing>.controls .play-pause path.pause {display: block;}.customPlayer .ui>.controls .timer {position: absolute;bottom: 12px;left: 50px;color: #fff;font-size: 12px;padding: 0;line-height: 20px;height: 20px;vertical-align: middle;}.customPlayer .ui>.controls .time-label {position: absolute;color: #fff;background: #000;border-radius: 5px;padding: 5px 10px;text-align: center;bottom: 60px;opacity: 0;cursor: default;transition: opacity ease .5s;}.customPlayer .ui>.controls .time-label:after {content: "";position: absolute;width: 0;height: 0;top: 100%;left: 50%;border-style: solid;border-color: transparent;border-width: 5px;border-top-color: #000;margin-left: -5px;}.customPlayer .ui>.controls .time-label.show {opacity: 1;}.customPlayer .ui>.controls .progress {position: absolute;left: 0px;right: 0px;bottom: 45px;height: 17px;background: none;cursor: pointer;border-bottom: 5px solid rgba(108, 108, 108, 0.5);z-index: 0;}.customPlayer .ui>.controls .progress.readonly {border-bottom-width: 2px;cursor: default;}.customPlayer .ui>.controls .progress .load {position: absolute;height: 5px;left: 0;bottom: -5px;background: rgba(154, 154, 156, 0.5);z-index: 0;transition: width ease .3s;}.customPlayer .ui>.controls .progress.readonly .load {height: 2px;bottom: -2px;}.customPlayer .ui>.controls .progress .play {position: absolute;left: 0;bottom: -5px;height: 5px;background: #FCC010;z-index: 10;transition: width ease .3s;}.customPlayer .ui>.controls .progress.readonly .play {background: #BEBEBE;height: 2px;bottom: -2px;}.customPlayer .ui>.controls .progress.readonly .play:after {display: none;}.customPlayer .ui>.controls .progress .play:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 0px;height: 0px;border: none;margin: 3px 0 0 0;transition:margin ease .3s,width ease .3s,height ease .3s;}.customPlayer .ui>.controls .progress:hover .play:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}.customPlayer .ui>.controls .tray {position: absolute;bottom: 0px;right: 0px;height: 45px;white-space: nowrap;}.customPlayer .ui>.controls .tray > *{position: relative;width: 24px;height: 24px;margin: 0;padding: 10px;display: inline-block;cursor: pointer;vertical-align: middle;box-sizing: content-box;}.customPlayer .ui>.controls .volume svg {width: 24px;height: 24px;}.customPlayer .ui>.controls .volume svg .mute {display: none;}.customPlayer .ui.muted>.controls .volume svg .unmute {display: none;}.customPlayer .ui.muted>.controls .volume svg .mute {display: block;}.customPlayer .ui>.controls .volume {position: relative;outline: none;width: 120px;}.customPlayer .ui>.controls .volume .vlevel{display: none;position: absolute;width: 100%;box-sizing: border-box;height: 100px;bottom: 100%;left: 0px;border-width: 10px 10px 0 10px;border-style: solid;border-color: rgba(0,0,0,0.3);}.customPlayer .ui>.controls .volume .vlevel:before {position: absolute;content: "";left: 0;top: 0;width: 100%;height: 100%;background: rgba(154, 154, 156, 0.5);}.customPlayer .ui>.controls .volume .vlevel>.value{position: absolute;bottom: 0px;left: 0px;background: #fff;width: 100%;height: 100%;}.customPlayer .ui>.controls .volume .level{position: absolute;right: 5px;left: 40px;top: 50%;margin-top: -8px;height: 5px;background: rgba(108, 108, 108, 0.5);border-width: 5px 0;border-style: solid;border-color: #000;}.customPlayer .ui>.controls .volume .level>.value{position: absolute;left: 0;width: 100%;height: 100%;background: #FFFFFF;transition: width ease .3s;}.customPlayer .ui>.controls .volume .level>.value:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 0px;height: 0px;border: none;margin: 3px 0 0 0;transition:margin ease .3s,width ease .3s,height ease .3s;}.customPlayer .ui>.controls .volume:hover .level>.value:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}.customPlayer .ui.small-mode > .controls .progress {border-bottom-width: 20px;}.customPlayer .ui.small-mode > .controls .progress .load {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play:after {display: none;content: "";position: absolute;right: -8px;top: 0px;height: 100%;width: 16px;background: #fff;border: none;margin: 0;border-radius: 0;}.customPlayer .ui.small-mode > .controls .volume {width: 24px;background: rgba(0,0,0,0);transition: background ease .5s;}.customPlayer .ui.small-mode > .controls .volume .vlevel{display: block;height: 0;border-top-width: 0; transition:border ease .3s,height ease .3s;}.customPlayer .ui.small-mode > .controls .volume .level{display: none;}.customPlayer .ui.small-mode > .controls .volume:focus {background: rgba(0,0,0,0.3);}.customPlayer .ui.small-mode > .controls .volume:focus .vlevel{border-top-width: 10px; height: 100px;}';document.head.appendChild(A)})();window.TouchEvent=window.TouchEvent||function(){};function l(B,A){this.conf=t({progress:{show:true,readonly:false},timer:{show:true},poster:null},A);this.player=B;this.duration;this.is_show_start_screen=true;this.is_first_play=true;this.is_played=false;this.is_muted=false;this.dom=f('<div class="ui" tabindex="0" style="background:rgba(0,0,0,0)"><div class="loader"><svg viewBox="0 0 160 160" style="width:100%; height:100%"><circle cx="80" cy="80" r="75" fill="rgba(0, 0, 0, 0.5)" stroke="rgba(255, 255, 255, 0.1)" stroke-width="2" /><circle cx="80" cy="80" r="65" stroke="rgba(255, 255, 255, 0.5)" stroke-width="10" fill="transparent" /></svg></div><div class="start-screen"><div class="poster hide"></div><svg viewBox="0 0 160 160"><circle cx="80" cy="80" r="80" fill="rgba(0, 0, 0, 0.3)" /><path transform="translate(10, -14)" fill="rgba(255, 255, 255, 0.6)" d="M70,32.7c33.8,0,61.2,27.5,61.2,61.2c0,33.8-27.5,61.2-61.2,61.2c-33.8,0-61.2-27.5-61.2-61.2C8.7,60.2,36.2,32.7,70,32.7 M70,24C31.3,24,0,55.3,0,94c0,38.7,31.3,70,70,70c38.7,0,70-31.3,70-70C140,55.3,108.7,24,70,24L70,24z M59,73.4L94.7,94L59,114.6V73.4 M50.2,58.2v71.6l62-35.8L50.2,58.2L50.2,58.2z"/></svg></div><div class="controls"><div class="time-label"></div><div class="progress"><div class="load"></div><div class="play"></div></div><div class="play-pause"><svg><path class="play" transform="translate(-24, 0)" d="M26,0v24l20-12L26,0L26,0z"/><path class="pause" transform="translate(0, 0)" d="M3.5,0h7v24h-7V0z M13.5,0h7v24h-7V0z"/></svg></div><div class="timer"></div><div class="tray"><div class="volume" tabindex="0"><svg><g class="unmute" transform="translate(-48, 0)"><path d="M64.7,2.1L56.3,7h-5.8C49.7,7,49,7.7,49,8.5v7c0,0.8,0.7,1.5,1.5,1.5h5.8l8.4,4.9c1,0.6,2.3-0.1,2.3-1.3V3.4C67,2.3,65.7,1.6,64.7,2.1z"/><path d="M70.4,6.8c-0.1-0.5-0.7-0.9-1.2-0.8c-0.5,0.1-0.9,0.7-0.8,1.2C68.8,8.8,69,10.4,69,12s-0.2,3.2-0.5,4.7c-0.1,0.5,0.2,1.1,0.8,1.2c0.1,0,0.1,0,0.2,0c0.5,0,0.9-0.3,1-0.8c0.4-1.7,0.6-3.4,0.6-5.2S70.8,8.5,70.4,6.8z"/></g><path class="mute" transform="translate(-72, 0)" d="M73,15.5v-7C73,7.7,73.7,7,74.5,7h5.8l8.4-4.9c0.7-0.4,1.5-0.2,1.9,0.4L76.2,17h-1.7C73.7,17,73,16.3,73,15.5z M93.2,6.1c-0.5,0.1-0.9,0.7-0.8,1.2C92.8,8.8,93,10.4,93,12s-0.2,3.2-0.5,4.7c-0.1,0.5,0.2,1.1,0.8,1.2c0.1,0,0.1,0,0.2,0c0.5,0,0.9-0.3,1-0.8c0.4-1.7,0.6-3.4,0.6-5.2s-0.2-3.5-0.6-5.2C94.3,6.3,93.8,6,93.2,6.1z M81.3,17.6l7.5,4.3c1,0.6,2.3-0.1,2.3-1.3V7.8L81.3,17.6z M74.7,22.7l20-20c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-20,20c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3S74.5,22.9,74.7,22.7z"/></svg><div class="vlevel"><div class="value"></div></div><div class="level"><div class="value"></div></div></div></div></div></div>');this.loader=this.dom.getElementsByClassName("loader")[0];this.start_screen=this.dom.getElementsByClassName("start-screen")[0];this.start_screen.poster=this.start_screen.getElementsByClassName("poster")[0];this.controls=this.dom.getElementsByClassName("controls")[0];this.controls.time_label=this.controls.getElementsByClassName("time-label")[0];this.controls.timer=this.controls.getElementsByClassName("timer")[0];this.controls.play_pause_btn=this.controls.getElementsByClassName("play-pause")[0];this.controls.tray=this.controls.getElementsByClassName("tray")[0];this.controls.tray.volume=this.controls.tray.getElementsByClassName("volume")[0];this.controls.tray.mute=this.controls.tray.volume.getElementsByTagName("svg")[0];this.controls.tray.volume.level=this.controls.tray.volume.getElementsByClassName("level")[0];this.controls.tray.volume.level.value=this.controls.tray.volume.level.getElementsByClassName("value")[0];this.controls.tray.volume.vlevel=this.controls.tray.volume.getElementsByClassName("vlevel")[0];this.controls.tray.volume.vlevel.value=this.controls.tray.volume.vlevel.getElementsByClassName("value")[0];this.controls.progress=this.controls.getElementsByClassName("progress")[0];this.controls.progress.load=this.controls.progress.getElementsByClassName("load")[0];this.controls.progress.play=this.controls.progress.getElementsByClassName("play")[0];this.init()}l.prototype=t(Object.create(CustomObject),{getElement:function(){return this.dom},init:function(){this.initUI();this.initPlayerEvents();this.initUIEvents();this.initEasterEgg();this.initAdaptive();if(this.conf.poster){var B=this;var A=new Image;A.addEventListener("load",function(){B.start_screen.poster.style.backgroundImage="url("+B.conf.poster+")";k(B.start_screen.poster,"hide")});A.src=this.conf.poster}this.controls.tray.volume.level.value.style.width=this.player.volume*100+"%";this.controls.style.display="none";this.hideLoader();if(this.conf.progress.readonly){g(this.controls.progress,"readonly")}if(!this.conf.progress.show){this.controls.progress.style.display="none"}if(!this.conf.timer.show){this.controls.timer.style.display="none"}this.player.trigger("tray_ready",this.controls.tray)},initAdaptive:function(){var A=this;setInterval(function(){var C=A.dom.offsetWidth;if(C==0){return}var B=C>0&&C<=480;if(A.is_small_mode!=B){A.player.trigger("change_small_mode",B);if(B){g(A.dom,"small-mode")}else{k(A.dom,"small-mode")}}A.is_small_mode=B},1000)},initUI:function(){var B=this;e(this.dom,"dblclick",function(E){if(E.target==B.dom){B.trigger("fullscreentoggle")}});e(this.dom,"selectstart",function(){return false});e(this.start_screen,"click",function(E){B.trigger("play");B.hideStartScreen()});e(this.dom,["mousedown","mouseup"],function(E){if(E.target==B.dom){if(E.type=="mousedown"){this._click_start=E.timeStamp}if(E.type=="mouseup"){if((E.timeStamp-this._click_start)<300){if(B.is_active){B.trigger(B.is_played?"pause":"play")}}}}});e(this.dom,"keydown",function(E){if(E.keyCode==32){B.trigger(B.is_played?"pause":"play");return false}});e(this.dom,"click",function(E){B.trigger("user_active")});e(this.dom,["mousemove","touchmove"],function(E){if(E.timeStamp-this._last_move<500){B.trigger("user_active")}this._last_move=E.timeStamp});e(this.controls.play_pause_btn,"click",function(){B.trigger(B.is_played?"pause":"play")});if(!this.conf.progress.readonly){var C=this.controls.progress;e(C,["mousedown","touchstart"],function(E){if(E instanceof TouchEvent||E.which==1){B.hold_progress=true;var F=C.getBoundingClientRect().left;e(document,["mousemove.progress","touchmove.progress"],function(H){var G=H instanceof TouchEvent?H.changedTouches[0].clientX:H.clientX;g(C,"no-animate");C.play.style.width=Math.max(0,Math.min(100,(G-F)/C.offsetWidth*100))+"%";return false});e(document,["mouseup.progress","touchend.progress"],function(H){var G=H instanceof TouchEvent?H.changedTouches[0].clientX:H.clientX;B.hold_progress=false;var I=Math.max(0,Math.min(1,(G-F)/C.offsetWidth));k(C,"no-animate");x(document,["mousemove.progress","mouseup.progress","touchmove.progress","touchend.progress"]);B.trigger("positionchange",I)})}});var A=this.controls.time_label;e(C,"mouseout",function(E){k(A,"show")});e(C,"mousemove",function(G){var E=G.clientX-C.getBoundingClientRect().left;var H=B.duration*(E/C.offsetWidth);var F=A.offsetWidth;A.style.left=Math.max(0,Math.min(C.offsetWidth-F,E-(F/2)))+"px";A.innerHTML=B.formatTime(H);g(A,"show")})}if(/iPad/.test(navigator.platform)){this.controls.tray.volume.style.display="none"}else{(function(E){e(E,["mousedown","touchstart"],function(G){if(G instanceof TouchEvent||G.which==1){var F=G instanceof TouchEvent?G.changedTouches[0].clientX:G.clientX;var H=E.getBoundingClientRect().left-window.scrollX;B.trigger("volumechange",(F-H)/E.offsetWidth);e(document,["mousemove.volume","touchmove.volume"],function(J){var I=J instanceof TouchEvent?J.changedTouches[0].clientX:J.clientX;g(E,"no-animate");B.trigger("volumechange",(I-H)/E.offsetWidth);return false});e(document,["mouseup.volume","touchend.volume"],function(I){k(E,"no-animate");x(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})}})})(this.controls.tray.volume.level);(function(E){e(E,["mousedown","touchstart"],function(G){var H=G instanceof TouchEvent?G.changedTouches[0].clientY:G.clientY;var F=E.getBoundingClientRect().bottom;B.trigger("volumechange",(F-H)/(E.offsetHeight-10));e(document,["mousemove.volume","touchmove.volume"],function(I){var J=I instanceof TouchEvent?I.changedTouches[0].clientY:I.clientY;g(E,"no-animate");B.trigger("volumechange",(F-J)/(E.offsetHeight-10));return false});e(document,["mouseup.volume","touchend.volume"],function(I){k(E,"no-animate");x(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})})})(this.controls.tray.volume.vlevel);var D=this.controls.tray.mute;e(D,"click",function(){if(B.is_small_mode){B.controls.tray.volume.focus()}else{B.trigger(B.is_muted?"unmute":"mute")}})}},initUIEvents:function(){var B=this;var A,C;this.on("user_active",function(){B.is_active=true;g(B.controls,"show");k(B.controls,"hide");B.controls.style.display="";clearTimeout(A);clearTimeout(C);A=setTimeout(function(){B.is_active=false;g(B.controls,"hide");k(B.controls,"show");C=setTimeout(function(){B.controls.style.display="none"},500)},3000)})},initPlayerEvents:function(){var A=this;this.player.on(["waiting","seeking"],function(B){A.showLoader()});this.player.on(["playing","seeked"],function(B){A.hideLoader()});this.player.on("error",function(D,C,B){A.showError("("+C+") "+B)});this.player.on("play",function(){A.is_played=true;k(A.dom,"paused");g(A.dom,"playing");A.controls.play_pause_btn.title="Pause";if(A.is_first_play){A.hideStartScreen();A.is_first_play=false}});this.player.on("pause",function(){A.is_played=false;g(A.dom,"paused");k(A.dom,"playing");A.controls.play_pause_btn.title="Play"});this.player.on("ended",function(){A.showStartScreen();A.is_played=false;A.is_first_play=true});this.player.on("timeupdate",function(D,C,B){A.time=C;A.duration=B;if(A.duration){if(!A.hold_progress){A.controls.progress.play.style.width=(C/A.duration*100)+"%"}}else{}A.updateLoader();A.controls.timer.innerHTML=A.formatTime(C)+" / "+A.formatTime(A.duration)});this.player.on("progress",function(B,C){A.buffer=C;A.updateLoader()});this.player.on("volumechange",function(C,B){A.is_muted=B==0;if(A.is_muted){g(A.dom,"muted")}else{k(A.dom,"muted")}A.controls.tray.volume.level.value.style.width=(B*100)+"%";A.controls.tray.volume.vlevel.value.style.height=(B*100)+"%"})},updateLoader:function(){if(this.buffer){for(var B=0;B<this.buffer.length;B++){var C=this.buffer[B][0];var A=this.buffer[B][1];if(this.time>C&&this.time<A){this.controls.progress.load.style.width=(A/this.duration*100)+"%";break}}}},hideStartScreen:function(){if(!this.is_show_start_screen){return}var A=this;this.controls.style.display="";g(this.start_screen,"hide");this.is_show_start_screen=false;setTimeout(function(){A.start_screen.style.display="none"},1000)},showStartScreen:function(){if(this.is_show_start_screen){return}var A=this;this.controls.style.display="none";this.start_screen.style.display="";this.is_show_start_screen=true;setTimeout(function(){k(A.start_screen,"hide")},100)},hideLoader:function(){if(!this.is_show_loader){return}var A=this;this.is_show_loader=false;g(this.loader,"hide");setTimeout(function(){if(!A.is_show_loader){A.loader.style.display="none"}},500)},showLoader:function(){if(this.is_show_loader){return}var A=this;this.is_show_loader=true;setTimeout(function(){if(A.is_show_loader){A.loader.style.display="";setTimeout(function(){k(A.loader,"hide")},100)}},500);var B=this.loader.getElementsByTagName("circle");(function(){B[0].setAttribute("r",((Math.sin((new Date)/100)+1)/4+0.5)*75);B[1].setAttribute("r",((Math.sin((new Date-100)/100)+1)/4+0.5)*65);if(A.is_show_loader||A.loader.style.display!="none"){setTimeout(arguments.callee,30)}})()},showError:function(A){this.dom.appendChild(f('<div class="error fatal"><div>'+A+"</div></div>"))},formatTime:function(D){var C=this.duration>=3600;var E=D|0;var A=(E/3600)|0;E-=A*3600;var B=(E/60)|0;E-=B*60;return(C?("0"+A).substr(-2)+":":"")+("0"+B).substr(-2)+":"+("0"+E).substr(-2)},initEasterEgg:function(){var B=[];var A=this;e(this.dom,"keydown",function(E){B.push(E.keyCode)>6?B.shift():null;if(B.join(":")==="65:78:73:83:83:65"){var C=[1071,1053,1040,44,32,1071,32,1058,1045,1041,1071,32,1051,1070,1041,1051,1070,33,33,33];for(var D=0;D<C.length;D++){(function(F,H){var G=f('<div style="position:absolute;color:white;opacity:0.6;font-weight:bold;text-shadow:0 0 5px #000">'+H+"<div>");(function(){G.style.left=(F)+"%";G.style.top=50+(Math.sin(F/15)*30)+"%";G.style.fontSize=((0.5+(Math.sin(F/10)+1)/4)*35)+"px";if(F<-10){A.dom.removeChild(G)}else{F-=0.5;setTimeout(arguments.callee,30)}})();A.dom.appendChild(G)})(100+D*4,String.fromCharCode(C[D]))}}})}});HTML5Backend=(function(){!function(C){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=C()}else{if("function"==typeof define&&define.amd){define([],C)}else{var B;"undefined"!=typeof window?B=window:"undefined"!=typeof global?B=global:"undefined"!=typeof self&&(B=self),B.Hls=C()}}}(function(){var E,C,B;return(function D(G,K,I){function H(P,N){if(!K[P]){if(!G[P]){var M=typeof require=="function"&&require;if(!N&&M){return M(P,!0)}if(F){return F(P,!0)}var O=new Error("Cannot find module '"+P+"'");throw O.code="MODULE_NOT_FOUND",O}var L=K[P]={exports:{}};G[P][0].call(L.exports,function(Q){var R=G[P][1][Q];return H(R?R:Q)},L,L.exports,D,G,K,I)}return K[P].exports}var F=typeof require=="function"&&require;for(var J=0;J<I.length;J++){H(I[J])}return H})({1:[function(J,K,H){function L(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}K.exports=L;L.EventEmitter=L;L.prototype._events=undefined;L.prototype._maxListeners=undefined;L.defaultMaxListeners=10;L.prototype.setMaxListeners=function(N){if(!I(N)||N<0||isNaN(N)){throw TypeError("n must be a positive number")}this._maxListeners=N;return this};L.prototype.emit=function(S){var T,R,N,O,P,Q;if(!this._events){this._events={}}if(S==="error"){if(!this._events.error||(F(this._events.error)&&!this._events.error.length)){T=arguments[1];if(T instanceof Error){throw T}throw TypeError('Uncaught, unspecified "error" event.')}}R=this._events[S];if(G(R)){return false}if(M(R)){switch(arguments.length){case 1:R.call(this);break;case 2:R.call(this,arguments[1]);break;case 3:R.call(this,arguments[1],arguments[2]);break;default:N=arguments.length;O=new Array(N-1);for(P=1;P<N;P++){O[P-1]=arguments[P]}R.apply(this,O)}}else{if(F(R)){N=arguments.length;O=new Array(N-1);for(P=1;P<N;P++){O[P-1]=arguments[P]}Q=R.slice();N=Q.length;for(P=0;P<N;P++){Q[P].apply(this,O)}}}return true};L.prototype.addListener=function(O,P){var N;if(!M(P)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",O,M(P.listener)?P.listener:P)}if(!this._events[O]){this._events[O]=P}else{if(F(this._events[O])){this._events[O].push(P)}else{this._events[O]=[this._events[O],P]}}if(F(this._events[O])&&!this._events[O].warned){var N;if(!G(this._maxListeners)){N=this._maxListeners}else{N=L.defaultMaxListeners}if(N&&N>0&&this._events[O].length>N){this._events[O].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[O].length);if(typeof console.trace==="function"){console.trace()}}}return this};L.prototype.on=L.prototype.addListener;L.prototype.once=function(N,P){if(!M(P)){throw TypeError("listener must be a function")}var Q=false;function O(){this.removeListener(N,O);if(!Q){Q=true;P.apply(this,arguments)}}O.listener=P;this.on(N,O);return this};L.prototype.removeListener=function(P,S){var R,N,Q,O;if(!M(S)){throw TypeError("listener must be a function")}if(!this._events||!this._events[P]){return this}R=this._events[P];Q=R.length;N=-1;if(R===S||(M(R.listener)&&R.listener===S)){delete this._events[P];if(this._events.removeListener){this.emit("removeListener",P,S)}}else{if(F(R)){for(O=Q;O-->0;){if(R[O]===S||(R[O].listener&&R[O].listener===S)){N=O;break}}if(N<0){return this}if(R.length===1){R.length=0;delete this._events[P]}else{R.splice(N,1)}if(this._events.removeListener){this.emit("removeListener",P,S)}}}return this};L.prototype.removeAllListeners=function(P){var N,O;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[P]){delete this._events[P]}}return this}if(arguments.length===0){for(N in this._events){if(N==="removeListener"){continue}this.removeAllListeners(N)}this.removeAllListeners("removeListener");this._events={};return this}O=this._events[P];if(M(O)){this.removeListener(P,O)}else{while(O.length){this.removeListener(P,O[O.length-1])}}delete this._events[P];return this};L.prototype.listeners=function(O){var N;if(!this._events||!this._events[O]){N=[]}else{if(M(this._events[O])){N=[this._events[O]]}else{N=this._events[O].slice()}}return N};L.listenerCount=function(P,O){var N;if(!P._events||!P._events[O]){N=0}else{if(M(P._events[O])){N=1}else{N=P._events[O].length}}return N};function M(N){return typeof N==="function"}function I(N){return typeof N==="number"}function F(N){return typeof N==="object"&&N!==null}function G(N){return N===void 0}},{}],2:[function(I,J,G){var L=arguments[3];var H=arguments[4];var F=arguments[5];var K=JSON.stringify;J.exports=function(T){var X=[];var U;var Q=Object.keys(F);for(var P=0,O=Q.length;P<O;P++){var W=Q[P];if(F[W].exports===T){U=W;break}}if(!U){U=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var R={};for(var P=0,O=Q.length;P<O;P++){var W=Q[P];R[W]=W}H[U]=[Function(["require","module","exports"],"("+T+")(self)"),R]}var V=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var N={};N[U]=U;H[V]=[Function(["require"],"require("+K(U)+")(self)"),N];var M="("+L+")({"+Object.keys(H).map(function(Y){return K(Y)+":["+H[Y][0]+","+K(H[Y][1])+"]"}).join(",")+"},{},["+K(V)+"])";var S=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(S.createObjectURL(new Blob([M],{type:"text/javascript"})))}},{}],3:[function(G,F,I){Object.defineProperty(I,"__esModule",{value:true});var H=(function(){function O(S,Q){for(var P=0;P<Q.length;P++){var R=Q[P];R.enumerable=R.enumerable||false;R.configurable=true;if("value" in R){R.writable=true}Object.defineProperty(S,R.key,R)}}return function(R,P,Q){if(P){O(R.prototype,P)}if(Q){O(R,Q)}return R}})();function N(O){return O&&O.__esModule?O:{"default":O}}function J(O,P){if(!(O instanceof P)){throw new TypeError("Cannot call a class as a function")}}var K=G("../events");var L=N(K);var M=(function(){function Q(T){J(this,Q);this.hls=T;this.lastfetchlevel=0;this._autoLevelCapping=-1;this._nextAutoLevel=-1;this.onflp=this.onFragmentLoadProgress.bind(this);T.on(L["default"].FRAG_LOAD_PROGRESS,this.onflp)}H(Q,[{key:"destroy",value:function P(){this.hls.off(L["default"].FRAG_LOAD_PROGRESS,this.onflp)}},{key:"onFragmentLoadProgress",value:function R(U,V){var T=V.stats;if(T.aborted===undefined){this.lastfetchduration=(new Date()-T.trequest)/1000;this.lastfetchlevel=V.frag.level;this.lastbw=T.loaded*8/this.lastfetchduration;this._nextAutoLevel=-1}}},{key:"autoLevelCapping",get:function O(){return this._autoLevelCapping},set:function S(T){this._autoLevelCapping=T}},{key:"nextAutoLevel",get:function O(){var X=this.lastbw,T=this.hls,V,U,W;if(this._autoLevelCapping===-1){W=T.levels.length-1}else{W=this._autoLevelCapping}if(this._nextAutoLevel!==-1){return Math.min(this._nextAutoLevel,W)}for(U=0;U<=W;U++){if(U<=this.lastfetchlevel){V=0.8*X}else{V=0.7*X}if(V<T.levels[U].bitrate){return Math.max(0,U-1)}}return U-1},set:function S(T){this._nextAutoLevel=T}}]);return Q})();I["default"]=M;F.exports=I["default"]},{"../events":11}],4:[function(I,H,M){Object.defineProperty(M,"__esModule",{value:true});var L=(function(){function U(Y,W){for(var V=0;V<W.length;V++){var X=W[V];X.enumerable=X.enumerable||false;X.configurable=true;if("value" in X){X.writable=true}Object.defineProperty(Y,X.key,X)}}return function(X,V,W){if(V){U(X.prototype,V)}if(W){U(X,W)}return X}})();function T(U){return U&&U.__esModule?U:{"default":U}}function N(U,V){if(!(U instanceof V)){throw new TypeError("Cannot call a class as a function")}}var O=I("../events");var P=T(O);var R=I("../utils/logger");var Q=I("../demux/demuxer");var K=T(Q);var G=I("../helper/level-helper");var F=T(G);var J=I("../errors");var S=(function(){function ab(aC){N(this,ab);this.ERROR=-2;this.STARTING=-1;this.IDLE=0;this.LOADING=1;this.WAITING_LEVEL=2;this.PARSING=3;this.PARSED=4;this.APPENDING=5;this.BUFFER_FLUSHING=6;this.config=aC.config;this.startPosition=0;this.hls=aC;this.onsbue=this.onSBUpdateEnd.bind(this);this.onsbe=this.onSBUpdateError.bind(this);this.onmse=this.onMSEAttached.bind(this);this.onmsed=this.onMSEDetached.bind(this);this.onmp=this.onManifestParsed.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onfl=this.onFragLoaded.bind(this);this.onis=this.onInitSegment.bind(this);this.onfpg=this.onFragParsing.bind(this);this.onfp=this.onFragParsed.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);aC.on(P["default"].MSE_ATTACHED,this.onmse);aC.on(P["default"].MSE_DETACHED,this.onmsed);aC.on(P["default"].MANIFEST_PARSED,this.onmp)}L(ab,[{key:"destroy",value:function ay(){this.stop();this.hls.off(P["default"].MANIFEST_PARSED,this.onmp);this.state=this.IDLE}},{key:"startLoad",value:function ao(){if(this.levels&&this.video){this.startInternal();if(this.lastCurrentTime){R.logger.log("seeking @ "+this.lastCurrentTime);this.nextLoadPosition=this.startPosition=this.lastCurrentTime;if(!this.lastPaused){R.logger.log("resuming video");this.video.play()}this.state=this.IDLE}else{this.nextLoadPosition=this.startPosition;this.state=this.STARTING}this.tick()}else{R.logger.warn("cannot start loading as either manifest not parsed or video not attached")}}},{key:"startInternal",value:function az(){var aC=this.hls;this.stop();this.demuxer=new K["default"](aC);this.timer=setInterval(this.ontick,100);this.level=-1;aC.on(P["default"].FRAG_LOADED,this.onfl);aC.on(P["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aC.on(P["default"].FRAG_PARSING_DATA,this.onfpg);aC.on(P["default"].FRAG_PARSED,this.onfp);aC.on(P["default"].ERROR,this.onerr);aC.on(P["default"].LEVEL_LOADED,this.onll)}},{key:"stop",value:function at(){this.mp4segments=[];this.flushRange=[];this.bufferRange=[];var aG=this.fragCurrent;if(aG){if(aG.loader){aG.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.sourceBuffer){for(var aD in this.sourceBuffer){var aF=this.sourceBuffer[aD];try{this.mediaSource.removeSourceBuffer(aF);aF.removeEventListener("updateend",this.onsbue);aF.removeEventListener("error",this.onsbe)}catch(aE){}}this.sourceBuffer=null}if(this.timer){clearInterval(this.timer);this.timer=null}if(this.demuxer){this.demuxer.destroy();this.demuxer=null}var aC=this.hls;aC.off(P["default"].FRAG_LOADED,this.onfl);aC.off(P["default"].FRAG_PARSED,this.onfp);aC.off(P["default"].FRAG_PARSING_DATA,this.onfpg);aC.off(P["default"].LEVEL_LOADED,this.onll);aC.off(P["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aC.off(P["default"].ERROR,this.onerr)}},{key:"tick",value:function au(){var aL,aE,aV,aR;switch(this.state){case this.ERROR:break;case this.STARTING:this.startLevel=this.hls.startLevel;if(this.startLevel===-1){this.startLevel=0;this.fragBitrateTest=true}this.level=this.hls.nextLoadLevel=this.startLevel;this.state=this.WAITING_LEVEL;this.loadedmetadata=false;break;case this.IDLE:if(!this.video){break}if(this.loadedmetadata){aL=this.video.currentTime}else{aL=this.nextLoadPosition}if(this.startFragmentRequested===false){aE=this.startLevel}else{aE=this.hls.nextLoadLevel}var aS=this.bufferInfo(aL,0.3),aZ=aS.len,aI=aS.end,aP;if(this.levels[aE].hasOwnProperty("bitrate")){aP=Math.max(8*this.config.maxBufferSize/this.levels[aE].bitrate,this.config.maxBufferLength);aP=Math.min(aP,this.config.maxMaxBufferLength)}else{aP=this.config.maxBufferLength}if(aZ<aP){this.hls.nextLoadLevel=aE;this.level=aE;aV=this.levels[aE].details;if(typeof aV==="undefined"){this.state=this.WAITING_LEVEL;break}var a1=aV.fragments,aX=a1.length,aJ=a1[0].start,aH=a1[aX-1].start+a1[aX-1].duration,aW=undefined;if(aV.live){if(aI<Math.max(aJ,aH-this.config.liveMaxLatencyDurationCount*aV.targetduration)){this.seekAfterBuffered=aJ+Math.max(0,aV.totalduration-this.config.liveSyncDurationCount*aV.targetduration);R.logger.log("buffer end: "+aI+" is located too far from the end of live sliding playlist, media position will be reseted to: "+this.seekAfterBuffered.toFixed(3));aI=this.seekAfterBuffered}if(this.startFragmentRequested&&!aV.PTSKnown){if(this.fragPrevious){var aD=this.fragPrevious.sn+1;if(aD>=aV.startSN&&aD<=aV.endSN){aW=a1[aD-aV.startSN];R.logger.log("live playlist, switching playlist, load frag with next SN: "+aW.sn)}}if(!aW){aW=a1[Math.round(aX/2)];R.logger.log("live playlist, switching playlist, unknown, load middle frag : "+aW.sn)}}}else{if(aI<aJ){aW=a1[0]}}if(!aW){if(aI>aH){break}for(aR=0;aR<aX;aR++){aW=a1[aR];aJ=aW.start;if(aJ<=aI&&aJ+aW.duration>aI){break}}if(this.fragPrevious&&aW.level===this.fragPrevious.level&&aW.sn===this.fragPrevious.sn){if(aR===aX-1){break}else{aW=a1[aR+1];R.logger.log("SN just loaded, load next one: "+aW.sn)}}}R.logger.log("Loading "+aW.sn+" of ["+aV.startSN+" ,"+aV.endSN+"],level "+aE+", currentTime:"+aL+",bufferEnd:"+aI.toFixed(3));aW.autoLevel=this.hls.autoLevelEnabled;if(this.levels.length>1){aW.expectedLen=Math.round(aW.duration*this.levels[aE].bitrate/8);aW.trequest=new Date()}if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(aW.loadCounter){aW.loadCounter++;var a0=this.config.fragLoadingLoopThreshold;if(aW.loadCounter>a0&&Math.abs(this.fragLoadIdx-aW.loadIdx)<a0){this.hls.trigger(P["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:aW});return}}else{aW.loadCounter=1}aW.loadIdx=this.fragLoadIdx;this.fragCurrent=aW;this.startFragmentRequested=true;this.hls.trigger(P["default"].FRAG_LOADING,{frag:aW});this.state=this.LOADING}break;case this.WAITING_LEVEL:aE=this.levels[this.level];if(aE&&aE.details){this.state=this.IDLE}break;case this.LOADING:var aQ=this.video,aG=this.fragCurrent;if(aQ&&(!aQ.paused||this.loadedmetadata===false)&&aG.autoLevel&&this.level&&this.levels.length>1){var aO=new Date()-aG.trequest;if(aO>500*aG.duration){var aC=aG.loaded*1000/aO;if(aG.expectedLen<aG.loaded){aG.expectedLen=aG.loaded}aL=aQ.currentTime;var aM=(aG.expectedLen-aG.loaded)/aC;var aU=this.bufferInfo(aL,0.3).end-aL;var aN=aG.duration*this.levels[this.hls.nextLoadLevel].bitrate/(8*aC);if(aU<2*aG.duration&&aM>aU&&aM>aN){R.logger.warn("loading too slow, abort fragment loading");R.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay :"+aM.toFixed(1)+"/"+aU.toFixed(1)+"/"+aN.toFixed(1));aG.loader.abort();this.hls.trigger(P["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:aG});this.state=this.IDLE}}}break;case this.PARSING:break;case this.PARSED:case this.APPENDING:if(this.sourceBuffer){if(this.sourceBuffer.audio&&this.sourceBuffer.audio.updating||this.sourceBuffer.video&&this.sourceBuffer.video.updating){}else{if(this.mp4segments.length){var aF=this.mp4segments.shift();try{this.sourceBuffer[aF.type].appendBuffer(aF.data);this.appendError=0}catch(aK){R.logger.error("error while trying to append buffer:"+aK.message+",try appending later");this.mp4segments.unshift(aF);if(this.appendError){this.appendError++}else{this.appendError=1}var aY={type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_APPENDING_ERROR,frag:this.fragCurrent};if(this.appendError>this.config.appendErrorMaxRetry){R.logger.log("fail "+this.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");aY.fatal=true;this.hls.trigger(P["default"].ERROR,aY);this.state=this.ERROR;return}else{aY.fatal=false;this.hls.trigger(P["default"].ERROR,aY)}}this.state=this.APPENDING}}}else{this.state=this.IDLE}break;case this.BUFFER_FLUSHING:while(this.flushRange.length){var aT=this.flushRange[0];if(this.flushBuffer(aT.start,aT.end)){this.flushRange.shift()}else{break}}if(this.flushRange.length===0){if(this.immediateSwitch){this.immediateLevelSwitchEnd()}this.state=this.IDLE;this.fragPrevious=null}break;default:break}this._checkFragmentChanged()}},{key:"bufferInfo",value:function ak(aK,aI){var aL=this.video,aE=aL.buffered,aD,aM,aN,aJ,aG;var aH=[];for(aG=0;aG<aE.length;aG++){if(aH.length&&aE.start(aG)-aH[aH.length-1].end<aI){aH[aH.length-1].end=aE.end(aG)}else{aH.push({start:aE.start(aG),end:aE.end(aG)})}}for(aG=0,aD=0,aM=aN=aK;aG<aH.length;aG++){var aC=aH[aG].start,aF=aH[aG].end;if(aK+aI>=aC&&aK<aF){aM=aC;aN=aF+aI;aD=aN-aK}else{if(aK+aI<aC){aJ=aC}}}return{len:aD,start:aM,end:aN,nextStart:aJ}}},{key:"getBufferRange",value:function U(aC){var aE,aD;for(aE=this.bufferRange.length-1;aE>=0;aE--){aD=this.bufferRange[aE];if(aC>=aD.start&&aC<=aD.end){return aD}}return null}},{key:"followingBufferRange",value:function aq(aC){if(aC){return this.getBufferRange(aC.end+0.5)}return null}},{key:"isBuffered",value:function ag(aC){var aD=this.video,aF=aD.buffered;for(var aE=0;aE<aF.length;aE++){if(aC>=aF.start(aE)&&aC<=aF.end(aE)){return true}}return false}},{key:"_checkFragmentChanged",value:function X(){var aF,aD;if(this.video&&this.video.seeking===false){this.lastCurrentTime=aD=this.video.currentTime;if(this.isBuffered(aD)){aF=this.getBufferRange(aD)}else{if(this.isBuffered(aD+0.1)){aF=this.getBufferRange(aD+0.1)}}if(aF){var aE=aF.frag;if(aE!==this.fragPlaying){this.fragPlaying=aE;this.hls.trigger(P["default"].FRAG_CHANGED,{frag:aE})}var aC=this.levels[this.level].details;if(aC&&!aC.live){if(aE.sn===aC.endSN){if(this.mediaSource&&this.mediaSource.readyState==="open"){R.logger.log("all media data available, signal endOfStream() to MediaSource");this.mediaSource.endOfStream()}}}}}}},{key:"flushBuffer",value:function ai(aG,aI){var aK,aD,aC,aJ,aM,aF;if(this.flushBufferCounter++<2*this.bufferRange.length&&this.sourceBuffer){for(var aH in this.sourceBuffer){aK=this.sourceBuffer[aH];if(!aK.updating){for(aD=0;aD<aK.buffered.length;aD++){aC=aK.buffered.start(aD);aJ=aK.buffered.end(aD);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&aI===Number.POSITIVE_INFINITY){aM=aG;aF=aI}else{aM=Math.max(aC,aG);aF=Math.min(aJ,aI)}if(aF-aM>0.5){R.logger.log("flush "+aH+" ["+aM+","+aF+"], of ["+aC+","+aJ+"], pos:"+this.video.currentTime);aK.remove(aM,aF);return false}}}else{return false}}}var aL=[],aE;for(aD=0;aD<this.bufferRange.length;aD++){aE=this.bufferRange[aD];if(this.isBuffered((aE.start+aE.end)/2)){aL.push(aE)}}this.bufferRange=aL;R.logger.log("buffer flushed");return true}},{key:"immediateLevelSwitch",value:function W(){R.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;this.previouslyPaused=this.video.paused;this.video.pause()}var aC=this.fragCurrent;if(aC&&aC.loader){aC.loader.abort()}this.fragCurrent=null;this.flushBufferCounter=0;this.flushRange.push({start:0,end:Number.POSITIVE_INFINITY});this.state=this.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}},{key:"immediateLevelSwitchEnd",value:function aa(){this.immediateSwitch=false;this.video.currentTime-=0.0001;if(!this.previouslyPaused){this.video.play()}}},{key:"nextLevelSwitch",value:function aj(){var aF,aC,aG;aC=this.getBufferRange(this.video.currentTime);if(aC){this.flushRange.push({start:0,end:aC.start-1})}if(!this.video.paused){var aD=this.hls.nextLoadLevel,aE=this.levels[aD];if(this.hls.stats.fragLastKbps&&this.fragCurrent){aF=this.fragCurrent.duration*aE.bitrate/(1000*this.hls.stats.fragLastKbps)+1}else{aF=0}}else{aF=0}aG=this.getBufferRange(this.video.currentTime+aF);if(aG){aG=this.followingBufferRange(aG);if(aG){this.flushRange.push({start:aG.start,end:Number.POSITIVE_INFINITY})}}if(this.flushRange.length){this.flushBufferCounter=0;this.state=this.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}}},{key:"onMSEAttached",value:function ae(aC,aD){this.video=aD.video;this.mediaSource=aD.mediaSource;this.onvseeking=this.onVideoSeeking.bind(this);this.onvseeked=this.onVideoSeeked.bind(this);this.onvmetadata=this.onVideoMetadata.bind(this);this.onvended=this.onVideoEnded.bind(this);this.video.addEventListener("seeking",this.onvseeking);this.video.addEventListener("seeked",this.onvseeked);this.video.addEventListener("loadedmetadata",this.onvmetadata);this.video.addEventListener("ended",this.onvended);if(this.levels&&this.config.autoStartLoad){this.startLoad()}}},{key:"onMSEDetached",value:function ac(){if(this.video){this.video.removeEventListener("seeking",this.onvseeking);this.video.removeEventListener("seeked",this.onvseeked);this.video.removeEventListener("loadedmetadata",this.onvmetadata);this.video.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvmetadata=null}this.video=null;this.loadedmetadata=false;this.stop()}},{key:"onVideoSeeking",value:function av(){if(this.state===this.LOADING){if(this.bufferInfo(this.video.currentTime,0.3).len===0){R.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");this.fragCurrent.loader.abort();this.fragCurrent=null;this.fragPrevious=null;this.state=this.IDLE}}if(this.video){this.lastCurrentTime=this.video.currentTime}if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()}},{key:"onVideoSeeked",value:function aB(){this.tick()}},{key:"onVideoMetadata",value:function af(){if(this.video.currentTime!==this.startPosition){this.video.currentTime=this.startPosition}this.loadedmetadata=true;this.tick()}},{key:"onVideoEnded",value:function ax(){R.logger.log("video ended");this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function aA(aF,aG){var aD=false,aE=false,aC;aG.levels.forEach(function(aH){aC=aH.codecs;if(aC){if(aC.indexOf("mp4a.40.2")!==-1){aD=true}if(aC.indexOf("mp4a.40.5")!==-1){aE=true}}});this.audiocodecswitch=aD&&aE;if(this.audiocodecswitch){R.logger.log("both AAC/HE-AAC audio found in levels; declaring audio codec as HE-AAC")}this.levels=aG.levels;this.startLevelLoaded=false;this.startFragmentRequested=false;if(this.video&&this.config.autoStartLoad){this.startLoad()}}},{key:"onLevelLoaded",value:function V(aG,aH){var aE=aH.details,aD=aH.level,aC=this.levels[aD],aI=aE.totalduration;R.logger.log("level "+aD+" loaded ["+aE.startSN+","+aE.endSN+"],duration:"+aI);if(aE.live){var aF=aC.details;if(aF){F["default"].mergeDetails(aF,aE);if(aE.PTSKnown){R.logger.log("live playlist sliding:"+aE.fragments[0].start.toFixed(3))}else{R.logger.log("live playlist - outdated PTS, unknown sliding")}}else{aE.PTSKnown=false;R.logger.log("live playlist - first load, unknown sliding")}}else{aE.PTSKnown=false}aC.details=aE;if(this.startLevelLoaded===false){if(aE.live){this.startPosition=Math.max(0,aI-this.config.liveSyncDurationCount*aE.targetduration)}this.nextLoadPosition=this.startPosition;this.startLevelLoaded=true}if(this.state===this.WAITING_LEVEL){this.state=this.IDLE}this.tick()}},{key:"onFragLoaded",value:function an(aE,aF){var aC=this.fragCurrent;if(this.state===this.LOADING&&aC&&aF.frag.level===aC.level&&aF.frag.sn===aC.sn){if(this.fragBitrateTest===true){this.state=this.IDLE;this.fragBitrateTest=false;aF.stats.tparsed=aF.stats.tbuffered=new Date();this.hls.trigger(P["default"].FRAG_BUFFERED,{stats:aF.stats,frag:aC})}else{this.state=this.PARSING;this.stats=aF.stats;var aH=this.levels[this.level],aD=aH.details,aG=aD.totalduration,aI=aC.start;R.logger.log("Demuxing "+aC.sn+" of ["+aD.startSN+" ,"+aD.endSN+"],level "+this.level);this.demuxer.push(aF.payload,aH.audioCodec,aH.videoCodec,aI,aC.cc,this.level,aG)}}}},{key:"onInitSegment",value:function ah(aD,aE){if(this.state===this.PARSING){var aF=this.levels[this.level].audioCodec,aC=this.levels[this.level].videoCodec,aG;if(aF===undefined||aE.audiocodec===undefined){aF=aE.audioCodec}if(aC===undefined||aE.videocodec===undefined){aC=aE.videoCodec}if(this.audiocodecswitch&&aE.audioChannelCount===2&&navigator.userAgent.toLowerCase().indexOf("android")===-1&&navigator.userAgent.toLowerCase().indexOf("firefox")===-1){aF="mp4a.40.5"}if(!this.sourceBuffer){this.sourceBuffer={};R.logger.log("selected A/V codecs for sourceBuffers:"+aF+","+aC);if(aF){aG=this.sourceBuffer.audio=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aF);aG.addEventListener("updateend",this.onsbue);aG.addEventListener("error",this.onsbe)}if(aC){aG=this.sourceBuffer.video=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aC);aG.addEventListener("updateend",this.onsbue);aG.addEventListener("error",this.onsbe)}}if(aF){this.mp4segments.push({type:"audio",data:aE.audioMoov})}if(aC){this.mp4segments.push({type:"video",data:aE.videoMoov})}this.tick()}}},{key:"onFragParsing",value:function am(aC,aD){if(this.state===this.PARSING){this.tparse2=Date.now();var aF=this.levels[this.level],aE=this.fragCurrent;R.logger.log("parsed data, type/startPTS/endPTS/startDTS/endDTS/nb:"+aD.type+"/"+aD.startPTS.toFixed(3)+"/"+aD.endPTS.toFixed(3)+"/"+aD.startDTS.toFixed(3)+"/"+aD.endDTS.toFixed(3)+"/"+aD.nb);F["default"].updateFragPTS(aF.details,aE.sn,aD.startPTS,aD.endPTS);this.mp4segments.push({type:aD.type,data:aD.moof});this.mp4segments.push({type:aD.type,data:aD.mdat});this.nextLoadPosition=aD.endPTS;this.bufferRange.push({type:aD.type,start:aD.startPTS,end:aD.endPTS,frag:aE});this.tick()}else{R.logger.warn("not in PARSING state, discarding "+aC)}}},{key:"onFragParsed",value:function Z(){if(this.state===this.PARSING){this.state=this.PARSED;this.stats.tparsed=new Date();this.tick()}}},{key:"onError",value:function Y(aC,aD){switch(aD.details){case J.ErrorDetails.FRAG_LOAD_ERROR:case J.ErrorDetails.FRAG_LOAD_TIMEOUT:case J.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case J.ErrorDetails.LEVEL_LOAD_ERROR:case J.ErrorDetails.LEVEL_LOAD_TIMEOUT:R.logger.warn("buffer controller: "+aD.details+" while loading frag,switch to "+(aD.fatal?"ERROR":"IDLE")+" state ...");this.state=aD.fatal?this.ERROR:this.IDLE;break;default:break}}},{key:"onSBUpdateEnd",value:function al(){if(this.state===this.APPENDING&&this.mp4segments.length===0){var aG=this.fragCurrent;if(aG){this.fragPrevious=aG;this.stats.tbuffered=new Date();this.hls.trigger(P["default"].FRAG_BUFFERED,{stats:this.stats,frag:aG});R.logger.log("video buffered : "+this.timeRangesToString(this.video.buffered));this.state=this.IDLE}var aE=this.video;if(aE){if(this.seekAfterBuffered){aE.currentTime=this.seekAfterBuffered}else{var aD=aE.currentTime;var aC=this.bufferInfo(aD,0);if(aC.len===0){var aF=aC.nextStart;if(aF&&aF-aD<0.3){R.logger.log("adjust currentTime from "+aD+" to "+aF);if(aE.readyState!=HTMLMediaElement.HAVE_NOTHING){aE.currentTime=aF}}}}}this.seekAfterBuffered=undefined}this.tick()}},{key:"onSBUpdateError",value:function ap(aC){R.logger.error("sourceBuffer error:"+aC);this.state=this.ERROR;this.hls.trigger(P["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_APPENDING_ERROR,fatal:true,frag:this.fragCurrent})}},{key:"timeRangesToString",value:function ar(aF){var aE="",aC=aF.length;for(var aD=0;aD<aC;aD++){aE+="["+aF.start(aD)+","+aF.end(aD)+"]"}return aE}},{key:"currentLevel",get:function aw(){if(this.video){var aC=this.getBufferRange(this.video.currentTime);if(aC){return aC.frag.level}}return -1}},{key:"nextBufferRange",get:function aw(){if(this.video){return this.followingBufferRange(this.getBufferRange(this.video.currentTime))}else{return null}}},{key:"nextLevel",get:function aw(){var aC=this.nextBufferRange;if(aC){return aC.frag.level}else{return -1}}}]);return ab})();M["default"]=S;H.exports=M["default"]},{"../demux/demuxer":6,"../errors":10,"../events":11,"../helper/level-helper":12,"../utils/logger":19}],5:[function(G,F,J){Object.defineProperty(J,"__esModule",{value:true});var I=(function(){function Q(U,S){for(var R=0;R<S.length;R++){var T=S[R];T.enumerable=T.enumerable||false;T.configurable=true;if("value" in T){T.writable=true}Object.defineProperty(U,T.key,T)}}return function(T,R,S){if(R){Q(T.prototype,R)}if(S){Q(T,S)}return T}})();function P(Q){return Q&&Q.__esModule?Q:{"default":Q}}function K(Q,R){if(!(Q instanceof R)){throw new TypeError("Cannot call a class as a function")}}var L=G("../events");var M=P(L);var O=G("../utils/logger");var H=G("../errors");var N=(function(){function W(aa){K(this,W);this.hls=aa;this.onml=this.onManifestLoaded.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);aa.on(M["default"].MANIFEST_LOADED,this.onml);aa.on(M["default"].LEVEL_LOADED,this.onll);aa.on(M["default"].ERROR,this.onerr);this._manualLevel=this._autoLevelCapping=-1}I(W,[{key:"destroy",value:function Z(){var aa=this.hls;aa.off(M["default"].MANIFEST_LOADED,this.onml);aa.off(M["default"].LEVEL_LOADED,this.onll);aa.off(M["default"].ERROR,this.onerr);if(this.timer){clearInterval(this.timer)}this._manualLevel=-1}},{key:"onManifestLoaded",value:function X(ab,ac){var af=[],aj=[],ag,ae,ai={},aa=false,ah=false;ac.levels.forEach(function(al){if(al.videoCodec){aa=true}if(al.audioCodec){ah=true}var ak=ai[al.bitrate];if(ak===undefined){ai[al.bitrate]=aj.length;al.url=[al.url];al.urlId=0;af.push(al)}else{af[ak].url.push(al.url)}});if(aa&&ah){af.forEach(function(ak){if(ak.videoCodec){aj.push(ak)}})}else{aj=af}ag=aj[0].bitrate;aj.sort(function(al,ak){return al.bitrate-ak.bitrate});this._levels=aj;for(ae=0;ae<aj.length;ae++){if(aj[ae].bitrate===ag){this._firstLevel=ae;O.logger.log("manifest loaded,"+aj.length+" level(s) found, first bitrate:"+ag);break}}this.hls.trigger(M["default"].MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:ac.stats});return}},{key:"setLevelInternal",value:function R(aa){if(aa>=0&&aa<this._levels.length){if(this.timer){clearInterval(this.timer);this.timer=null}this._level=aa;O.logger.log("switching to level "+aa);this.hls.trigger(M["default"].LEVEL_SWITCH,{level:aa});var ac=this._levels[aa];if(ac.details===undefined||ac.details.live===true){O.logger.log("(re)loading playlist for level "+aa);var ab=ac.urlId;this.hls.trigger(M["default"].LEVEL_LOADING,{url:ac.url[ab],level:aa,id:ab})}}else{this.hls.trigger(M["default"].ERROR,{type:H.ErrorTypes.OTHER_ERROR,details:H.ErrorDetails.LEVEL_SWITCH_ERROR,level:aa,fatal:false,reason:"invalid level idx"})}}},{key:"onError",value:function U(ac,ae){var aa=ae.details,ab,ag;switch(aa){case H.ErrorDetails.FRAG_LOAD_ERROR:case H.ErrorDetails.FRAG_LOAD_TIMEOUT:case H.ErrorDetails.FRAG_LOOP_LOADING_ERROR:ab=ae.frag.level;break;case H.ErrorDetails.LEVEL_LOAD_ERROR:case H.ErrorDetails.LEVEL_LOAD_TIMEOUT:ab=ae.level;break;default:break}if(ab!==undefined){ag=this._levels[ab];if(ag.urlId<ag.url.length-1){ag.urlId++;ag.details=undefined;O.logger.warn("level controller,"+aa+" for level "+ab+": switching to redundant stream id "+ag.urlId)}else{var af=this._manualLevel===-1&&ab;if(af){O.logger.warn("level controller,"+aa+": emergency switch-down for next fragment");this.hls.abrController.nextAutoLevel=0}else{if(ag&&ag.details&&ag.details.live){O.logger.warn("level controller,"+aa+" on live stream, discard")}else{O.logger.error("cannot recover "+aa+" error");this._level=undefined;if(this.timer){clearInterval(this.timer);this.timer=null;ae.fatal=true;this.hls.trigger(ac,ae)}}}}}}},{key:"onLevelLoaded",value:function Q(aa,ab){if(ab.details.live&&!this.timer){this.timer=setInterval(this.ontick,1000*ab.details.targetduration)}}},{key:"tick",value:function V(){var aa=this._level;if(aa!==undefined){var ac=this._levels[aa],ab=ac.urlId;this.hls.trigger(M["default"].LEVEL_LOADING,{url:ac.url[ab],level:aa,id:ab})}}},{key:"nextLoadLevel",value:function T(){if(this._manualLevel!==-1){return this._manualLevel}else{return this.hls.abrController.nextAutoLevel}}},{key:"levels",get:function S(){return this._levels}},{key:"level",get:function S(){return this._level},set:function Y(aa){if(this._level!==aa||this._levels[aa].details===undefined){this.setLevelInternal(aa)}}},{key:"manualLevel",get:function S(){return this._manualLevel},set:function Y(aa){this._manualLevel=aa;if(aa!==-1){this.level=aa}}},{key:"firstLevel",get:function S(){return this._firstLevel},set:function Y(aa){this._firstLevel=aa}},{key:"startLevel",get:function S(){if(this._startLevel===undefined){return this._firstLevel}else{return this._startLevel}},set:function Y(aa){this._startLevel=aa}}]);return W})();J["default"]=N;F.exports=J["default"]},{"../errors":10,"../events":11,"../utils/logger":19}],6:[function(G,F,I){Object.defineProperty(I,"__esModule",{value:true});var H=(function(){function V(Z,X){for(var W=0;W<X.length;W++){var Y=X[W];Y.enumerable=Y.enumerable||false;Y.configurable=true;if("value" in Y){Y.writable=true}Object.defineProperty(Z,Y.key,Y)}}return function(Y,W,X){if(W){V(Y.prototype,W)}if(X){V(Y,X)}return Y}})();function U(V){return V&&V.__esModule?V:{"default":V}}function J(V,W){if(!(V instanceof W)){throw new TypeError("Cannot call a class as a function")}}var K=G("../events");var N=U(K);var R=G("./tsdemuxer");var M=U(R);var T=G("./tsdemuxerworker");var O=U(T);var Q=G("../utils/logger");var P=G("../remux/mp4-remuxer");var L=U(P);var S=(function(){function W(aa){J(this,W);this.hls=aa;if(aa.config.enableWorker&&typeof Worker!=="undefined"){Q.logger.log("TS demuxing in webworker");try{var Z=G("webworkify");this.w=Z(O["default"]);this.onwmsg=this.onWorkerMessage.bind(this);this.w.addEventListener("message",this.onwmsg);this.w.postMessage({cmd:"init"})}catch(ab){Q.logger.error("error while initializing TSDemuxerWorker, fallback on regular TSDemuxer");this.demuxer=new M["default"](aa,L["default"])}}else{this.demuxer=new M["default"](aa,L["default"])}this.demuxInitialized=true}H(W,[{key:"destroy",value:function Y(){if(this.w){this.w.removeEventListener("message",this.onwmsg);this.w.terminate();this.w=null}else{this.demuxer.destroy()}}},{key:"push",value:function V(ab,ae,aa,Z,ag,af,ac){if(this.w){this.w.postMessage({cmd:"demux",data:ab,audioCodec:ae,videoCodec:aa,timeOffset:Z,cc:ag,level:af,duration:ac},[ab])}else{this.demuxer.push(new Uint8Array(ab),ae,aa,Z,ag,af,ac);this.demuxer.remux()}}},{key:"onWorkerMessage",value:function X(Z){switch(Z.data.event){case N["default"].FRAG_PARSING_INIT_SEGMENT:var aa={};if(Z.data.audioMoov){aa.audioMoov=new Uint8Array(Z.data.audioMoov);aa.audioCodec=Z.data.audioCodec;aa.audioChannelCount=Z.data.audioChannelCount}if(Z.data.videoMoov){aa.videoMoov=new Uint8Array(Z.data.videoMoov);aa.videoCodec=Z.data.videoCodec;aa.videoWidth=Z.data.videoWidth;aa.videoHeight=Z.data.videoHeight}this.hls.trigger(N["default"].FRAG_PARSING_INIT_SEGMENT,aa);break;case N["default"].FRAG_PARSING_DATA:this.hls.trigger(N["default"].FRAG_PARSING_DATA,{moof:new Uint8Array(Z.data.moof),mdat:new Uint8Array(Z.data.mdat),startPTS:Z.data.startPTS,endPTS:Z.data.endPTS,startDTS:Z.data.startDTS,endDTS:Z.data.endDTS,type:Z.data.type,nb:Z.data.nb});break;case N["default"].FRAG_PARSING_METADATA:this.hls.trigger(N["default"].FRAG_PARSING_METADATA,{samples:Z.data.samples});break;default:this.hls.trigger(Z.data.event,Z.data.data);break}}}]);return W})();I["default"]=S;F.exports=I["default"]},{"../events":11,"../remux/mp4-remuxer":17,"../utils/logger":19,"./tsdemuxer":8,"./tsdemuxerworker":9,webworkify:2}],7:[function(H,J,G){Object.defineProperty(G,"__esModule",{value:true});var I=(function(){function M(Q,O){for(var N=0;N<O.length;N++){var P=O[N];P.enumerable=P.enumerable||false;P.configurable=true;if("value" in P){P.writable=true}Object.defineProperty(Q,P.key,P)}}return function(P,N,O){if(N){M(P.prototype,N)}if(O){M(P,O)}return P}})();function L(M,N){if(!(M instanceof N)){throw new TypeError("Cannot call a class as a function")}}var F=H("../utils/logger");var K=(function(){function Y(aa){L(this,Y);this.data=aa;this.bytesAvailable=this.data.byteLength;this.word=0;this.bitsAvailable=0}I(Y,[{key:"loadWord",value:function P(){var ab=this.data.byteLength-this.bytesAvailable,aa=new Uint8Array(4),ac=Math.min(4,this.bytesAvailable);if(ac===0){throw new Error("no bytes available")}aa.set(this.data.subarray(ab,ab+ac));this.word=new DataView(aa.buffer).getUint32(0);this.bitsAvailable=ac*8;this.bytesAvailable-=ac}},{key:"skipBits",value:function Z(aa){var ab;if(this.bitsAvailable>aa){this.word<<=aa;this.bitsAvailable-=aa}else{aa-=this.bitsAvailable;ab=aa>>3;aa-=ab>>3;this.bytesAvailable-=ab;this.loadWord();this.word<<=aa;this.bitsAvailable-=aa}}},{key:"readBits",value:function U(aa){var ac=Math.min(this.bitsAvailable,aa),ab=this.word>>>32-ac;if(aa>32){F.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=ac;if(this.bitsAvailable>0){this.word<<=ac}else{if(this.bytesAvailable>0){this.loadWord()}}ac=aa-ac;if(ac>0){return ab<<ac|this.readBits(ac)}else{return ab}}},{key:"skipLZ",value:function S(){var aa;for(aa=0;aa<this.bitsAvailable;++aa){if(0!==(this.word&2147483648>>>aa)){this.word<<=aa;this.bitsAvailable-=aa;return aa}}this.loadWord();return aa+this.skipLZ()}},{key:"skipUEG",value:function O(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function W(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function V(){var aa=this.skipLZ();return this.readBits(aa+1)-1}},{key:"readEG",value:function R(){var aa=this.readUEG();if(1&aa){return 1+aa>>>1}else{return -1*(aa>>>1)}}},{key:"readBoolean",value:function M(){return 1===this.readBits(1)}},{key:"readUByte",value:function Q(){return this.readBits(8)}},{key:"skipScalingList",value:function N(ae){var ab=8,ac=8,aa,af;for(aa=0;aa<ae;aa++){if(ac!==0){af=this.readEG();ac=(ab+af+256)%256}ab=ac===0?ab:ac}}},{key:"readSPS",value:function X(){var ao=0,ae=0,an=0,aj=0,ap,ag,ak,am,ah,ac,af,al,ai;this.readUByte();ap=this.readUByte();ag=this.readBits(5);this.skipBits(3);ak=this.readUByte();this.skipUEG();if(ap===100||ap===110||ap===122||ap===144){var ab=this.readUEG();if(ab===3){this.skipBits(1)}this.skipUEG();this.skipUEG();this.skipBits(1);if(this.readBoolean()){al=ab!==3?8:12;for(ai=0;ai<al;ai++){if(this.readBoolean()){if(ai<6){this.skipScalingList(16)}else{this.skipScalingList(64)}}}}}this.skipUEG();var aa=this.readUEG();if(aa===0){this.readUEG()}else{if(aa===1){this.skipBits(1);this.skipEG();this.skipEG();am=this.readUEG();for(ai=0;ai<am;ai++){this.skipEG()}}}this.skipUEG();this.skipBits(1);ah=this.readUEG();ac=this.readUEG();af=this.readBits(1);if(af===0){this.skipBits(1)}this.skipBits(1);if(this.readBoolean()){ao=this.readUEG();ae=this.readUEG();an=this.readUEG();aj=this.readUEG()}return{profileIdc:ap,profileCompat:ag,levelIdc:ak,width:(ah+1)*16-ao*2-ae*2,height:(2-af)*(ac+1)*16-an*2-aj*2}}},{key:"readSliceType",value:function T(){this.readUByte();this.readUEG();return this.readUEG()}}]);return Y})();G["default"]=K;J.exports=G["default"]},{"../utils/logger":19}],8:[function(H,F,L){Object.defineProperty(L,"__esModule",{value:true});var J=(function(){function S(W,U){for(var T=0;T<U.length;T++){var V=U[T];V.enumerable=V.enumerable||false;V.configurable=true;if("value" in V){V.writable=true}Object.defineProperty(W,V.key,V)}}return function(V,T,U){if(T){S(V.prototype,T)}if(U){S(V,U)}return V}})();function R(S){return S&&S.__esModule?S:{"default":S}}function M(S,T){if(!(S instanceof T)){throw new TypeError("Cannot call a class as a function")}}var N=H("../events");var O=R(N);var P=H("./exp-golomb");var G=R(P);var Q=H("../utils/logger");var I=H("../errors");var K=(function(){function X(ah,ai){M(this,X);this.observer=ah;this.remuxerClass=ai;this.lastCC=0;this.PES_TIMESCALE=90000;this.remuxer=new this.remuxerClass(this.observer)}J(X,[{key:"switchLevel",value:function ab(){this.pmtParsed=false;this._pmtId=-1;this._avcTrack={type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0};this._aacTrack={type:"audio",id:-1,sequenceNumber:0,samples:[],len:0};this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0};this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function ac(){this.switchLevel();this.remuxer.insertDiscontinuity()}},{key:"push",value:function Z(aA,aj,av,an,ap,ai,ah){var am,ay,ar,ak,ax=aA.length,at,ao,aB,al;this.audioCodec=aj;this.videoCodec=av;this.timeOffset=an;this._duration=ah;if(ap!==this.lastCC){Q.logger.log("discontinuity detected");this.insertDiscontinuity();this.lastCC=ap}else{if(ai!==this.lastLevel){Q.logger.log("level switch detected");this.switchLevel();this.lastLevel=ai}}var au=this.pmtParsed,az=this._avcTrack.id,aw=this._aacTrack.id,aq=this._id3Track.id;for(ak=0;ak<ax;ak+=188){if(aA[ak]===71){at=!!(aA[ak+1]&64);ao=((aA[ak+1]&31)<<8)+aA[ak+2];aB=(aA[ak+3]&48)>>4;if(aB>1){al=ak+5+aA[ak+4];if(al===ak+188){continue}}else{al=ak+4}if(au){if(ao===az){if(at){if(am){this._parseAVCPES(this._parsePES(am))}am={data:[],size:0}}if(am){am.data.push(aA.subarray(al,ak+188));am.size+=ak+188-al}}else{if(ao===aw){if(at){if(ay){this._parseAACPES(this._parsePES(ay))}ay={data:[],size:0}}if(ay){ay.data.push(aA.subarray(al,ak+188));ay.size+=ak+188-al}}else{if(ao===aq){if(at){if(ar){this._parseID3PES(this._parsePES(ar))}ar={data:[],size:0}}if(ar){ar.data.push(aA.subarray(al,ak+188));ar.size+=ak+188-al}}}}}else{if(at){al+=aA[al]+1}if(ao===0){this._parsePAT(aA,al)}else{if(ao===this._pmtId){this._parsePMT(aA,al);au=this.pmtParsed=true;az=this._avcTrack.id;aw=this._aacTrack.id;aq=this._id3Track.id}}}}else{this.observer.trigger(O["default"].ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(am){this._parseAVCPES(this._parsePES(am))}if(ay){this._parseAACPES(this._parsePES(ay))}if(ar){this._parseID3PES(this._parsePES(ar))}}},{key:"remux",value:function Y(){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this.timeOffset)}},{key:"destroy",value:function ae(){this.switchLevel();this._initPTS=this._initDTS=undefined;this._duration=0}},{key:"_parsePAT",value:function W(ah,ai){this._pmtId=(ah[ai+10]&31)<<8|ah[ai+11]}},{key:"_parsePMT",value:function U(al,am){var ah,ak,aj,ai;ah=(al[am+1]&15)<<8|al[am+2];ak=am+3+ah-4;aj=(al[am+10]&15)<<8|al[am+11];am+=12+aj;while(am<ak){ai=(al[am+1]&31)<<8|al[am+2];switch(al[am]){case 15:this._aacTrack.id=ai;break;case 21:this._id3Track.id=ai;break;case 27:this._avcTrack.id=ai;break;default:Q.logger.log("unkown stream type:"+al[am]);break}am+=((al[am+3]&15)<<8|al[am+4])+5}}},{key:"_parsePES",value:function ag(ao){var ak=0,ap,ah,aj,ai,ar,al,am,aq,an;ap=ao.data[0];aj=(ap[0]<<16)+(ap[1]<<8)+ap[2];if(aj===1){ai=(ap[4]<<8)+ap[5];ah=ap[7];if(ah&192){am=(ap[9]&14)*536870912+(ap[10]&255)*4194304+(ap[11]&254)*16384+(ap[12]&255)*128+(ap[13]&254)/2;if(am>4294967295){am-=8589934592}if(ah&64){aq=(ap[14]&14)*536870912+(ap[15]&255)*4194304+(ap[16]&254)*16384+(ap[17]&255)*128+(ap[18]&254)/2;if(aq>4294967295){aq-=8589934592}}else{aq=am}}ar=ap[8];an=ar+9;ao.data[0]=ao.data[0].subarray(an);ao.size-=an;al=new Uint8Array(ao.size);while(ao.data.length){ap=ao.data.shift();al.set(ap,ak);ak+=ap.byteLength}return{data:al,pts:am,dts:aq,len:ai}}else{return null}}},{key:"_parseAVCPES",value:function af(ai){var al=this;var am,ah=this._avcTrack,ak,ap=false;am=this._parseAVCNALu(ai.data);if(am.length===0&this._avcTrack.samples.length>0){var ao=this._avcTrack.samples[this._avcTrack.samples.length-1];var an=ao.units.units[ao.units.units.length-1];var aj=new Uint8Array(an.data.byteLength+ai.data.byteLength);aj.set(an.data,0);aj.set(ai.data,an.data.byteLength);an.data=aj;ao.units.length+=ai.data.byteLength;this._avcTrack.len+=ai.data.byteLength}ai.data=null;am.units.forEach(function(ax){switch(ax.type){case 1:var aw=new G["default"](ax.data).readSliceType();if(aw===2||aw===4||aw===7||aw===9){ap=true}break;case 5:ap=true;break;case 7:if(!ah.sps){var ay=new G["default"](ax.data);var at=ay.readSPS();ah.width=at.width;ah.height=at.height;ah.profileIdc=at.profileIdc;ah.profileCompat=at.profileCompat;ah.levelIdc=at.levelIdc;ah.sps=[ax.data];ah.timescale=al.remuxer.timescale;ah.duration=al.remuxer.timescale*al._duration;var aq=ax.data.subarray(1,4);var ar="avc1.";for(var au=0;au<3;au++){var av=aq[au].toString(16);if(av.length<2){av="0"+av}ar+=av}ah.codec=ar}break;case 8:if(!ah.pps){ah.pps=[ax.data]}break;default:break}});if(am.length){if(ap===true||ah.sps){ak={units:am,pts:ai.pts,dts:ai.dts,key:ap};this._avcTrack.samples.push(ak);this._avcTrack.len+=am.length;this._avcTrack.nbNalu+=am.units.length}}}},{key:"_parseAVCNALu",value:function V(ap){var am=0,an=ap.byteLength,av,aj,ah=0;var aq=[],aw,au,ao,ak,ai=0;while(am<an){av=ap[am++];switch(ah){case 0:if(av===0){ah=1}break;case 1:if(av===0){ah=2}else{ah=0}break;case 2:case 3:if(av===0){ah=3}else{if(av===1){au=ap[am]&31;if(ao){aw={data:ap.subarray(ao,am-ah-1),type:ak};ai+=am-ah-1-ao;aq.push(aw)}else{aj=am-ah-1;if(aj){if(this._avcTrack.samples.length){var at=this._avcTrack.samples[this._avcTrack.samples.length-1];var ar=at.units.units[at.units.units.length-1];var al=new Uint8Array(ar.data.byteLength+aj);al.set(ar.data,0);al.set(ap.subarray(0,aj),ar.data.byteLength);ar.data=al;at.units.length+=aj;this._avcTrack.len+=aj}}}ao=am;ak=au;if(au===1||au===5){am=an}ah=0}else{ah=0}}break;default:break}}if(ao){aw={data:ap.subarray(ao,an),type:ak};ai+=an-ao;aq.push(aw)}return{units:aq,length:ai}}},{key:"_parseAACPES",value:function aa(ak){var ai=this._aacTrack,al,ao=ak.data,aj,at,au,av,ah,am,aq;if(this.aacOverFlow){var an=new Uint8Array(this.aacOverFlow.byteLength+ao.byteLength);an.set(this.aacOverFlow,0);an.set(ao,this.aacOverFlow.byteLength);ao=an}for(au=0,aq=ao.length;au<aq-1;au++){if(ao[au]===255&&(ao[au+1]&240)===240){break}}if(au){var ap,ar;if(au<aq-1){ap="AAC PES did not start with ADTS header,offset:"+au;ar=false}else{ap="no ADTS header found in AAC PES";ar=true}this.observer.trigger(O["default"].ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:ar,reason:ap});if(ar){return}}if(!ai.audiosamplerate){aj=this._ADTStoAudioConfig(ao,au,this.audioCodec);ai.config=aj.config;ai.audiosamplerate=aj.samplerate;ai.channelCount=aj.channelCount;ai.codec=aj.codec;ai.timescale=this.remuxer.timescale;ai.duration=this.remuxer.timescale*this._duration;Q.logger.log("parsed codec:"+ai.codec+",rate:"+aj.samplerate+",nb channel:"+aj.channelCount)}am=0;while(au+5<aq){at=(ao[au+3]&3)<<11;at|=ao[au+4]<<3;at|=(ao[au+5]&224)>>>5;av=!!(ao[au+1]&1)?7:9;at-=av;ah=Math.round(ak.pts+am*1024*this.PES_TIMESCALE/ai.audiosamplerate);if(au+av+at<=aq){al={unit:ao.subarray(au+av,au+av+at),pts:ah,dts:ah};this._aacTrack.samples.push(al);this._aacTrack.len+=at;au+=at+av;am++}else{break}}if(au<aq){this.aacOverFlow=ao.subarray(au,aq)}else{this.aacOverFlow=null}}},{key:"_ADTStoAudioConfig",value:function S(ak,aj,aq){var an,am,al,ai,ah,ap=navigator.userAgent.toLowerCase(),ao=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];an=((ak[aj+2]&192)>>>6)+1;am=(ak[aj+2]&60)>>>2;if(am>ao.length-1){this.observer.trigger(O["default"].ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+am});return}ai=(ak[aj+2]&1)<<2;ai|=(ak[aj+3]&192)>>>6;Q.logger.log("manifest codec:"+aq+",ADTS data:type:"+an+",sampleingIndex:"+am+"["+ao[am]+"kHz],channelConfig:"+ai);if(ap.indexOf("firefox")!==-1){if(am>=6){an=5;ah=new Array(4);al=am-3}else{an=2;ah=new Array(2);al=am}}else{if(ap.indexOf("android")!==-1){an=2;ah=new Array(2);al=am}else{an=5;ah=new Array(4);if(aq&&aq.indexOf("mp4a.40.5")!==-1||!aq&&am>=6){al=am-3}else{if(aq&&aq.indexOf("mp4a.40.2")!==-1&&(am>=6||ai===1)){an=2;ah=new Array(2)}al=am}}}ah[0]=an<<3;ah[0]|=(am&14)>>1;ah[1]|=(am&1)<<7;ah[1]|=ai<<3;if(an===5){ah[1]|=(al&14)>>1;ah[2]=(al&1)<<7;ah[2]|=2<<2;ah[3]=0}return{config:ah,samplerate:ao[am],channelCount:ai,codec:"mp4a.40."+an}}},{key:"_parseID3PES",value:function T(ah){this._id3Track.samples.push(ah)}}]);return X})();L["default"]=K;F.exports=L["default"]},{"../errors":10,"../events":11,"../utils/logger":19,"./exp-golomb":7}],9:[function(G,F,H){Object.defineProperty(H,"__esModule",{value:true});function S(T){return T&&T.__esModule?T:{"default":T}}function P(T){if(Array.isArray(T)){for(var V=0,U=Array(T.length);V<T.length;V++){U[V]=T[V]}return U}else{return Array.from(T)}}var J=G("../events");var M=S(J);var L=G("events");var I=S(L);var Q=G("../demux/tsdemuxer");var O=S(Q);var N=G("../remux/mp4-remuxer");var K=S(N);var R=function R(U){var T=new I["default"]();T.trigger=function V(Z){for(var X=arguments.length,aa=Array(X>1?X-1:0),Y=1;Y<X;Y++){aa[Y-1]=arguments[Y]}T.emit.apply(T,[Z,Z].concat(P(aa)))};T.off=function W(Z){for(var X=arguments.length,aa=Array(X>1?X-1:0),Y=1;Y<X;Y++){aa[Y-1]=arguments[Y]}T.removeListener.apply(T,[Z].concat(P(aa)))};U.addEventListener("message",function(X){switch(X.data.cmd){case"init":U.demuxer=new O["default"](T,K["default"]);break;case"demux":U.demuxer.push(new Uint8Array(X.data.data),X.data.audioCodec,X.data.videoCodec,X.data.timeOffset,X.data.cc,X.data.level,X.data.duration);U.demuxer.remux();break;default:break}});T.on(M["default"].FRAG_PARSING_INIT_SEGMENT,function(Z,aa){var X={event:Z};var Y=[];if(aa.audioCodec){X.audioCodec=aa.audioCodec;X.audioMoov=aa.audioMoov.buffer;X.audioChannelCount=aa.audioChannelCount;Y.push(X.audioMoov)}if(aa.videoCodec){X.videoCodec=aa.videoCodec;X.videoMoov=aa.videoMoov.buffer;X.videoWidth=aa.videoWidth;X.videoHeight=aa.videoHeight;Y.push(X.videoMoov)}U.postMessage(X,Y)});T.on(M["default"].FRAG_PARSING_DATA,function(Y,Z){var X={event:Y,type:Z.type,startPTS:Z.startPTS,endPTS:Z.endPTS,startDTS:Z.startDTS,endDTS:Z.endDTS,moof:Z.moof.buffer,mdat:Z.mdat.buffer,nb:Z.nb};U.postMessage(X,[X.moof,X.mdat])});T.on(M["default"].FRAG_PARSED,function(X){U.postMessage({event:X})});T.on(M["default"].ERROR,function(X,Y){U.postMessage({event:X,data:Y})});T.on(M["default"].FRAG_PARSING_METADATA,function(Y,Z){var X={event:Y,samples:Z.samples};U.postMessage(X)})};H["default"]=R;F.exports=H["default"]},{"../demux/tsdemuxer":8,"../events":11,"../remux/mp4-remuxer":17,events:1}],10:[function(H,J,G){Object.defineProperty(G,"__esModule",{value:true});var I={NETWORK_ERROR:"hlsNetworkError",MEDIA_ERROR:"hlsMediaError",OTHER_ERROR:"hlsOtherError"};G.ErrorTypes=I;var F={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_PARSING_ERROR:"fragParsingError",FRAG_APPENDING_ERROR:"fragAppendingError"};G.ErrorDetails=F},{}],11:[function(G,H,F){Object.defineProperty(F,"__esModule",{value:true});F["default"]={MSE_ATTACHED:"hlsMediaSourceAttached",MSE_DETACHED:"hlsMediaSourceDetached",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_METADATA:"hlsFraParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFPSDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying"};H.exports=F["default"]},{}],12:[function(H,J,G){Object.defineProperty(G,"__esModule",{value:true});var I=(function(){function M(Q,O){for(var N=0;N<O.length;N++){var P=O[N];P.enumerable=P.enumerable||false;P.configurable=true;if("value" in P){P.writable=true}Object.defineProperty(Q,P.key,P)}}return function(P,N,O){if(N){M(P.prototype,N)}if(O){M(P,O)}return P}})();function K(M,N){if(!(M instanceof N)){throw new TypeError("Cannot call a class as a function")}}var F=H("../utils/logger");var L=(function(){function P(){K(this,P)}I(P,null,[{key:"mergeDetails",value:function M(Q,U){var R=Math.max(Q.startSN,U.startSN)-U.startSN,T=Math.min(Q.endSN,U.endSN)-U.startSN,ab=U.startSN-Q.startSN,aa=Q.fragments,W=U.fragments,Z=0,S;if(T<R){U.PTSKnown=false;return}for(var V=R;V<=T;V++){var ac=aa[ab+V],Y=W[V];Z=ac.cc-Y.cc;if(!isNaN(ac.startPTS)){Y.start=Y.startPTS=ac.startPTS;Y.endPTS=ac.endPTS;Y.duration=ac.duration;S=Y}}if(Z){F.logger.log("discontinuity sliding from playlist, take drift into account");for(V=0;V<W.length;V++){W[V].cc+=Z}}if(S){P.updateFragPTS(U,S.sn,S.startPTS,S.endPTS)}else{var X=aa[ab].start;for(V=0;V<W.length;V++){W[V].start+=X}}U.PTSKnown=Q.PTSKnown;return}},{key:"updateFragPTS",value:function O(U,W,S,R){var V,Q,X,T;if(W<U.startSN||W>U.endSN){return}V=W-U.startSN;Q=U.fragments;X=Q[V];if(!isNaN(X.startPTS)){S=Math.max(S,X.startPTS);R=Math.min(R,X.endPTS)}X.start=X.startPTS=S;X.endPTS=R;X.duration=R-S;for(T=V;T>0;T--){P.updatePTS(Q,T,T-1)}for(T=V;T<Q.length-1;T++){P.updatePTS(Q,T,T+1)}U.PTSKnown=true}},{key:"updatePTS",value:function N(R,T,V){var Q=R[T],S=R[V],U=S.startPTS;if(!isNaN(U)){if(V>T){Q.duration=U-Q.start;if(Q.duration<0){F.logger.error("negative duration computed for "+Q+", there should be some duration drift between playlist and fragment!")}}else{S.duration=Q.start-U;if(S.duration<0){F.logger.error("negative duration computed for "+S+", there should be some duration drift between playlist and fragment!")}}}else{if(V>T){S.start=Q.start+Q.duration}else{S.start=Q.start-S.duration}}}}]);return P})();G["default"]=L;J.exports=G["default"]},{"../utils/logger":19}],13:[function(R,H,ag){Object.defineProperty(ag,"__esModule",{value:true});var aa=(function(){function ai(am,ak){for(var aj=0;aj<ak.length;aj++){var al=ak[aj];al.enumerable=al.enumerable||false;al.configurable=true;if("value" in al){al.writable=true}Object.defineProperty(am,al.key,al)}}return function(al,aj,ak){if(aj){ai(al.prototype,aj)}if(ak){ai(al,ak)}return al}})();function G(ai){return ai&&ai.__esModule?ai:{"default":ai}}function L(ai){if(Array.isArray(ai)){for(var ak=0,aj=Array(ai.length);ak<ai.length;ak++){aj[ak]=ai[ak]}return aj}else{return Array.from(ai)}}function M(ai,aj){if(!(ai instanceof aj)){throw new TypeError("Cannot call a class as a function")}}var T=R("./events");var Q=G(T);var ac=R("./errors");var V=R("./stats");var ab=G(V);var ah=R("./loader/playlist-loader");var W=G(ah);var N=R("./loader/fragment-loader");var K=G(N);var U=R("./controller/abr-controller");var F=G(U);var S=R("./controller/buffer-controller");var Y=G(S);var I=R("./controller/level-controller");var ae=G(I);var X=R("./utils/logger");var af=R("./utils/xhr-loader");var Z=G(af);var P=R("events");var O=G(P);var J=(function(){aa(ai,null,[{key:"isSupported",value:function aj(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function ak(){return Q["default"]}},{key:"ErrorTypes",get:function ak(){return ac.ErrorTypes}},{key:"ErrorDetails",get:function ak(){return ac.ErrorDetails}}]);function ai(){var az=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];M(this,ai);var aw={autoStartLoad:true,debug:false,maxBufferLength:30,maxBufferSize:60*1000*1000,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,maxMaxBufferLength:600,enableWorker:true,fragLoadingTimeOut:20000,fragLoadingMaxRetry:1,fragLoadingRetryDelay:1000,fragLoadingLoopThreshold:3,manifestLoadingTimeOut:10000,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1000,fpsDroppedMonitoringPeriod:5000,fpsDroppedMonitoringThreshold:0.2,appendErrorMaxRetry:200,loader:Z["default"],abrController:F["default"]};for(var aB in aw){if(aB in az){continue}az[aB]=aw[aB]}if(az.liveMaxLatencyDurationCount!==undefined&&az.liveMaxLatencyDurationCount<=az.liveSyncDurationCount){throw new Error('Illegal hls.js configuration: "liveMaxLatencyDurationCount" must be strictly superior to "liveSyncDurationCount" in player configuration')}(0,X.enableLogs)(az.debug);this.config=az;var ax=this.observer=new O["default"]();ax.trigger=function ay(aE){for(var aC=arguments.length,aF=Array(aC>1?aC-1:0),aD=1;aD<aC;aD++){aF[aD-1]=arguments[aD]}ax.emit.apply(ax,[aE,aE].concat(L(aF)))};ax.off=function aA(aE){for(var aC=arguments.length,aF=Array(aC>1?aC-1:0),aD=1;aD<aC;aD++){aF[aD-1]=arguments[aD]}ax.removeListener.apply(ax,[aE].concat(L(aF)))};this.on=ax.on.bind(ax);this.off=ax.off.bind(ax);this.trigger=ax.trigger.bind(ax);this.playlistLoader=new W["default"](this);this.fragmentLoader=new K["default"](this);this.levelController=new ae["default"](this);this.abrController=new az.abrController(this);this.bufferController=new Y["default"](this);this.statsHandler=new ab["default"](this)}aa(ai,[{key:"destroy",value:function av(){X.logger.log("destroy");this.trigger(Q["default"].DESTROYING);this.playlistLoader.destroy();this.fragmentLoader.destroy();this.levelController.destroy();this.bufferController.destroy();this.statsHandler.destroy();this.url=null;this.detachVideo();this.observer.removeAllListeners()}},{key:"attachVideo",value:function ao(ax){X.logger.log("attachVideo");this.video=ax;this.statsHandler.attachVideo(ax);var aw=this.mediaSource=new MediaSource();this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);aw.addEventListener("sourceopen",this.onmso);aw.addEventListener("sourceended",this.onmse);aw.addEventListener("sourceclose",this.onmsc);ax.src=URL.createObjectURL(aw);ax.addEventListener("error",this.onverror)}},{key:"detachVideo",value:function aq(){X.logger.log("detachVideo");var ax=this.video;this.statsHandler.detachVideo(ax);var aw=this.mediaSource;if(aw){if(aw.readyState==="open"){aw.endOfStream()}aw.removeEventListener("sourceopen",this.onmso);aw.removeEventListener("sourceended",this.onmse);aw.removeEventListener("sourceclose",this.onmsc);ax.src="";this.mediaSource=null;X.logger.log("trigger MSE_DETACHED");this.trigger(Q["default"].MSE_DETACHED)}this.onmso=this.onmse=this.onmsc=null;if(ax){this.video=null}}},{key:"loadSource",value:function am(aw){X.logger.log("loadSource:"+aw);this.url=aw;this.trigger(Q["default"].MANIFEST_LOADING,{url:aw})}},{key:"startLoad",value:function at(){X.logger.log("startLoad");this.bufferController.startLoad()}},{key:"recoverMediaError",value:function an(){X.logger.log("recoverMediaError");var aw=this.video;this.detachVideo();this.attachVideo(aw)}},{key:"onMediaSourceOpen",value:function al(){X.logger.log("media source opened");this.trigger(Q["default"].MSE_ATTACHED,{video:this.video,mediaSource:this.mediaSource});this.mediaSource.removeEventListener("sourceopen",this.onmso)}},{key:"onMediaSourceClose",value:function ar(){X.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function ap(){X.logger.log("media source ended")}},{key:"levels",get:function ak(){return this.levelController.levels}},{key:"currentLevel",get:function ak(){return this.bufferController.currentLevel},set:function au(aw){X.logger.log("set currentLevel:"+aw);this.loadLevel=aw;this.bufferController.immediateLevelSwitch()}},{key:"nextLevel",get:function ak(){return this.bufferController.nextLevel},set:function au(aw){X.logger.log("set nextLevel:"+aw);this.levelController.manualLevel=aw;this.bufferController.nextLevelSwitch()}},{key:"loadLevel",get:function ak(){return this.levelController.level},set:function au(aw){X.logger.log("set loadLevel:"+aw);this.levelController.manualLevel=aw}},{key:"nextLoadLevel",get:function ak(){return this.levelController.nextLoadLevel()},set:function au(aw){this.levelController.level=aw}},{key:"firstLevel",get:function ak(){return this.levelController.firstLevel},set:function au(aw){X.logger.log("set firstLevel:"+aw);this.levelController.firstLevel=aw}},{key:"startLevel",get:function ak(){return this.levelController.startLevel},set:function au(aw){X.logger.log("set startLevel:"+aw);this.levelController.startLevel=aw}},{key:"autoLevelCapping",get:function ak(){return this.abrController.autoLevelCapping},set:function au(aw){X.logger.log("set autoLevelCapping:"+aw);this.abrController.autoLevelCapping=aw}},{key:"autoLevelEnabled",get:function ak(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function ak(){return this.levelController.manualLevel}},{key:"stats",get:function ak(){return this.statsHandler.stats}}]);return ai})();ag["default"]=J;H.exports=ag["default"]},{"./controller/abr-controller":3,"./controller/buffer-controller":4,"./controller/level-controller":5,"./errors":10,"./events":11,"./loader/fragment-loader":14,"./loader/playlist-loader":15,"./stats":18,"./utils/logger":19,"./utils/xhr-loader":20,events:1}],14:[function(G,F,K){Object.defineProperty(K,"__esModule",{value:true});var I=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function O(P){return P&&P.__esModule?P:{"default":P}}function L(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var M=G("../events");var N=O(M);var H=G("../errors");var J=(function(){function V(W){L(this,V);this.hls=W;this.onfl=this.onFragLoading.bind(this);W.on(N["default"].FRAG_LOADING,this.onfl)}I(V,[{key:"destroy",value:function S(){if(this.loader){this.loader.destroy();this.loader=null}this.hls.off(N["default"].FRAG_LOADING,this.onfl)}},{key:"onFragLoading",value:function U(X,Y){var Z=Y.frag;this.frag=Z;this.frag.loaded=0;var W=this.hls.config;Z.loader=this.loader=new W.loader(W);this.loader.load(Z.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),W.fragLoadingTimeOut,W.fragLoadingMaxRetry,W.fragLoadingRetryDelay,this.loadprogress.bind(this),Z)}},{key:"loadsuccess",value:function Q(X,W){var Y=X.currentTarget.response;W.length=Y.byteLength;this.frag.loader=undefined;this.hls.trigger(N["default"].FRAG_LOADED,{payload:Y,frag:this.frag,stats:W})}},{key:"loaderror",value:function T(W){this.loader.abort();this.hls.trigger(N["default"].ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.FRAG_LOAD_ERROR,fatal:false,frag:this.frag,response:W})}},{key:"loadtimeout",value:function P(){this.loader.abort();this.hls.trigger(N["default"].ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:false,frag:this.frag})}},{key:"loadprogress",value:function R(X,W){this.frag.loaded=W.loaded;this.hls.trigger(N["default"].FRAG_LOAD_PROGRESS,{frag:this.frag,stats:W})}}]);return V})();K["default"]=J;F.exports=K["default"]},{"../errors":10,"../events":11}],15:[function(G,F,J){Object.defineProperty(J,"__esModule",{value:true});var I=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function O(P){return P&&P.__esModule?P:{"default":P}}function K(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var L=G("../events");var M=O(L);var H=G("../errors");var N=(function(){function Y(ab){K(this,Y);this.hls=ab;this.onml=this.onManifestLoading.bind(this);this.onll=this.onLevelLoading.bind(this);ab.on(M["default"].MANIFEST_LOADING,this.onml);ab.on(M["default"].LEVEL_LOADING,this.onll)}I(Y,[{key:"destroy",value:function X(){if(this.loader){this.loader.destroy();this.loader=null}this.url=this.id=null;this.hls.off(M["default"].MANIFEST_LOADING,this.onml);this.hls.off(M["default"].LEVEL_LOADING,this.onll)}},{key:"onManifestLoading",value:function T(ab,ac){this.load(ac.url,null)}},{key:"onLevelLoading",value:function Q(ab,ac){this.load(ac.url,ac.level,ac.id)}},{key:"load",value:function Z(ac,af,ae){var ab=this.hls.config;this.url=ac;this.id=af;this.id2=ae;this.loader=new ab.loader(ab);this.loader.load(ac,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),ab.manifestLoadingTimeOut,ab.manifestLoadingMaxRetry,ab.manifestLoadingRetryDelay)}},{key:"resolve",value:function aa(ab,ah){var ak=document,ae=ak.getElementsByTagName("base")[0],ac=ae&&ae.href,ai=ak.head||ak.getElementsByTagName("head")[0],aj=ae||ai.appendChild(ak.createElement("base")),af=ak.createElement("a"),ag;aj.href=ah;af.href=ab;ag=af.href;if(ae){ae.href=ac}else{ai.removeChild(aj)}return ag}},{key:"parseMasterPlaylist",value:function V(ae,aj){var ah=[],ai={},ab,ac,ag;var af=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"([^\"\n\r]*)\",?)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/g;while((ab=af.exec(ae))!=null){ab.shift();ab=ab.filter(function(ak){return ak!==undefined});ai.url=this.resolve(ab.pop(),aj);while(ab.length>0){switch(ab.shift()){case"RES":ai.width=parseInt(ab.shift());ai.height=parseInt(ab.shift());break;case"BAND":ai.bitrate=parseInt(ab.shift());break;case"NAME":ai.name=ab.shift();break;case"CODECS":ac=ab.shift().split(",");while(ac.length>0){ag=ac.shift();if(ag.indexOf("avc1")!==-1){ai.videoCodec=this.avc1toavcoti(ag)}else{ai.audioCodec=ag}}break;default:break}}ah.push(ai);ai={}}return ah}},{key:"avc1toavcoti",value:function R(ae){var ac,ab=ae.split(".");if(ab.length>2){ac=ab.shift()+".";ac+=parseInt(ab.shift()).toString(16);ac+=("00"+parseInt(ab.shift()).toString(16)).substr(-4)}else{ac=ae}return ac}},{key:"parseLevelPlaylist",value:function U(ai,aj,ac){var ae=0,af=0,ab={url:aj,fragments:[],live:true,startSN:0},al,ak,ag=0;ak=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT(INF):([\d\.]+)[^\r\n]*[\r\n]+([^\r\n]+)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))/g;while((al=ak.exec(ai))!==null){al.shift();al=al.filter(function(am){return am!==undefined});switch(al[0]){case"MEDIA-SEQUENCE":ae=ab.startSN=parseInt(al[1]);break;case"TARGETDURATION":ab.targetduration=parseFloat(al[1]);break;case"ENDLIST":ab.live=false;break;case"DIS":ag++;break;case"INF":var ah=parseFloat(al[1]);if(!isNaN(ah)){ab.fragments.push({url:this.resolve(al[2],aj),duration:ah,start:af,sn:ae++,level:ac,cc:ag});af+=ah}break;default:break}}ab.totalduration=af;ab.endSN=ae-1;return ab}},{key:"loadsuccess",value:function S(ah,ag){var ae=ah.currentTarget.responseText,ac=ah.currentTarget.responseURL,aj=this.id,af=this.id2,ab=this.hls,ai;if(ac===undefined){ac=this.url}ag.tload=new Date();ag.mtime=new Date(ah.currentTarget.getResponseHeader("Last-Modified"));if(ae.indexOf("#EXTM3U")===0){if(ae.indexOf("#EXTINF:")>0){if(this.id===null){ab.trigger(M["default"].MANIFEST_LOADED,{levels:[{url:ac}],url:ac,stats:ag})}else{ab.trigger(M["default"].LEVEL_LOADED,{details:this.parseLevelPlaylist(ae,ac,aj),level:aj,id:af,stats:ag})}}else{ai=this.parseMasterPlaylist(ae,ac);if(ai.length){ab.trigger(M["default"].MANIFEST_LOADED,{levels:ai,url:ac,stats:ag})}else{ab.trigger(M["default"].ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:ac,reason:"no level found in manifest"})}}}else{ab.trigger(M["default"].ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:H.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:ac,reason:"no EXTM3U delimiter"})}}},{key:"loaderror",value:function W(ac){var ab,ae;if(this.id===null){ab=H.ErrorDetails.MANIFEST_LOAD_ERROR;ae=true}else{ab=H.ErrorDetails.LEVEL_LOAD_ERROR;ae=false}this.loader.abort();this.hls.trigger(M["default"].ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:ab,fatal:ae,url:this.url,loader:this.loader,response:ac.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function P(){var ab,ac;if(this.id===null){ab=H.ErrorDetails.MANIFEST_LOAD_TIMEOUT;ac=true}else{ab=H.ErrorDetails.LEVEL_LOAD_TIMEOUT;ac=false}this.loader.abort();this.hls.trigger(M["default"].ERROR,{type:H.ErrorTypes.NETWORK_ERROR,details:ab,fatal:ac,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]);return Y})();J["default"]=N;F.exports=J["default"]},{"../errors":10,"../events":11}],16:[function(G,I,F){Object.defineProperty(F,"__esModule",{value:true});var H=(function(){function L(P,N){for(var M=0;M<N.length;M++){var O=N[M];O.enumerable=O.enumerable||false;O.configurable=true;if("value" in O){O.writable=true}Object.defineProperty(P,O.key,O)}}return function(O,M,N){if(M){L(O.prototype,M)}if(N){L(O,N)}return O}})();function K(L,M){if(!(L instanceof M)){throw new TypeError("Cannot call a class as a function")}}var J=(function(){function ab(){K(this,ab)}H(ab,null,[{key:"init",value:function ae(){ab.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var al;for(al in ab.types){if(ab.types.hasOwnProperty(al)){ab.types[al]=[al.charCodeAt(0),al.charCodeAt(1),al.charCodeAt(2),al.charCodeAt(3)]}}ab.MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);ab.AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);ab.MINOR_VERSION=new Uint8Array([0,0,0,1]);ab.VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);ab.AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ab.HDLR_TYPES={video:ab.VIDEO_HDLR,audio:ab.AUDIO_HDLR};ab.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);ab.STCO=new Uint8Array([0,0,0,0,0,0,0,0]);ab.STSC=ab.STCO;ab.STTS=ab.STCO;ab.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);ab.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);ab.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);ab.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);ab.FTYP=ab.box(ab.types.ftyp,ab.MAJOR_BRAND,ab.MINOR_VERSION,ab.MAJOR_BRAND,ab.AVC1_BRAND);ab.DINF=ab.box(ab.types.dinf,ab.box(ab.types.dref,ab.DREF))}},{key:"box",value:function Y(ap){var aq=Array.prototype.slice.call(arguments,1),ao=0,an=aq.length,al,am;while(an--){ao+=aq[an].byteLength}al=new Uint8Array(ao+8);am=new DataView(al.buffer);am.setUint32(0,al.byteLength);al.set(ap,4);for(an=0,ao=8;an<aq.length;an++){al.set(aq[an],ao);ao+=aq[an].byteLength}return al}},{key:"hdlr",value:function N(al){return ab.box(ab.types.hdlr,ab.HDLR_TYPES[al])}},{key:"mdat",value:function M(al){return ab.box(ab.types.mdat,al)}},{key:"mdhd",value:function ai(al,am){return ab.box(ab.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,al>>24&255,al>>16&255,al>>8&255,al&255,am>>24,am>>16&255,am>>8&255,am&255,85,196,0,0]))}},{key:"mdia",value:function Q(al){return ab.box(ab.types.mdia,ab.mdhd(al.timescale,al.duration),ab.hdlr(al.type),ab.minf(al))}},{key:"mfhd",value:function ak(al){return ab.box(ab.types.mfhd,new Uint8Array([0,0,0,0,al>>24,al>>16&255,al>>8&255,al&255]))}},{key:"minf",value:function aa(al){if(al.type==="audio"){return ab.box(ab.types.minf,ab.box(ab.types.smhd,ab.SMHD),ab.DINF,ab.stbl(al))}else{return ab.box(ab.types.minf,ab.box(ab.types.vmhd,ab.VMHD),ab.DINF,ab.stbl(al))}}},{key:"moof",value:function T(an,am,al){return ab.box(ab.types.moof,ab.mfhd(an),ab.traf(al,am))}},{key:"moov",value:function aj(al){var an=al.length,am=[];while(an--){am[an]=ab.trak(al[an])}return ab.box.apply(null,[ab.types.moov,ab.mvhd(al[0].timescale,al[0].duration)].concat(am).concat(ab.mvex(al)))}},{key:"mvex",value:function V(al){var an=al.length,am=[];while(an--){am[an]=ab.trex(al[an])}return ab.box.apply(null,[ab.types.mvex].concat(am))}},{key:"mvhd",value:function af(am,an){var al=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,am>>24&255,am>>16&255,am>>8&255,am&255,an>>24&255,an>>16&255,an>>8&255,an&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ab.box(ab.types.mvhd,al)}},{key:"sdtp",value:function Z(an){var ao=an.samples||[],am=new Uint8Array(4+ao.length),al,ap;for(ap=0;ap<ao.length;ap++){al=ao[ap].flags;am[ap+4]=al.dependsOn<<4|al.isDependedOn<<2|al.hasRedundancy}return ab.box(ab.types.sdtp,am)}},{key:"stbl",value:function W(al){return ab.box(ab.types.stbl,ab.stsd(al),ab.box(ab.types.stts,ab.STTS),ab.box(ab.types.stsc,ab.STSC),ab.box(ab.types.stsz,ab.STSZ),ab.box(ab.types.stco,ab.STCO))}},{key:"avc1",value:function X(an){var al=[],am=[],ao;for(ao=0;ao<an.sps.length;ao++){al.push(an.sps[ao].byteLength>>>8&255);al.push(an.sps[ao].byteLength&255);al=al.concat(Array.prototype.slice.call(an.sps[ao]))}for(ao=0;ao<an.pps.length;ao++){am.push(an.pps[ao].byteLength>>>8&255);am.push(an.pps[ao].byteLength&255);am=am.concat(Array.prototype.slice.call(an.pps[ao]))}return ab.box(ab.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,an.width>>8&255,an.width&255,an.height>>8&255,an.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),ab.box(ab.types.avcC,new Uint8Array([1,an.profileIdc,an.profileCompat,an.levelIdc,255].concat([an.sps.length]).concat(al).concat([an.pps.length]).concat(am))),ab.box(ab.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function S(al){return new Uint8Array([0,0,0,0,3,23+al.config.length,0,1,0,4,15+al.config.length,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([al.config.length]).concat(al.config).concat([6,1,2]))}},{key:"mp4a",value:function ah(al){return ab.box(ab.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,al.channelCount,0,16,0,0,0,0,al.audiosamplerate>>8&255,al.audiosamplerate&255,0,0]),ab.box(ab.types.esds,ab.esds(al)))}},{key:"stsd",value:function U(al){if(al.type==="audio"){return ab.box(ab.types.stsd,ab.STSD,ab.mp4a(al))}else{return ab.box(ab.types.stsd,ab.STSD,ab.avc1(al))}}},{key:"tkhd",value:function ac(al){return ab.box(ab.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,al.id>>24&255,al.id>>16&255,al.id>>8&255,al.id&255,0,0,0,0,al.duration>>24,al.duration>>16&255,al.duration>>8&255,al.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,al.width>>8&255,al.width&255,0,0,al.height>>8&255,al.height&255,0,0]))}},{key:"traf",value:function P(al,an){var am=ab.sdtp(al);return ab.box(ab.types.traf,ab.box(ab.types.tfhd,new Uint8Array([0,0,0,0,al.id>>24,al.id>>16&255,al.id>>8&255,al.id&255])),ab.box(ab.types.tfdt,new Uint8Array([0,0,0,0,an>>24,an>>16&255,an>>8&255,an&255])),ab.trun(al,am.length+16+16+8+16+8+8),am)}},{key:"trak",value:function L(al){al.duration=al.duration||4294967295;return ab.box(ab.types.trak,ab.tkhd(al),ab.mdia(al))}},{key:"trex",value:function O(al){return ab.box(ab.types.trex,new Uint8Array([0,0,0,0,al.id>>24,al.id>>16&255,al.id>>8&255,al.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function ag(al,ap){var am,ao,an,aq;am=al.samples||[];aq=new Uint8Array(12+16*am.length);ap+=8+aq.byteLength;aq.set([0,0,15,1,am.length>>>24&255,am.length>>>16&255,am.length>>>8&255,am.length&255,ap>>>24&255,ap>>>16&255,ap>>>8&255,ap&255],0);for(an=0;an<am.length;an++){ao=am[an];aq.set([ao.duration>>>24&255,ao.duration>>>16&255,ao.duration>>>8&255,ao.duration&255,ao.size>>>24&255,ao.size>>>16&255,ao.size>>>8&255,ao.size&255,ao.flags.isLeading<<2|ao.flags.dependsOn,ao.flags.isDependedOn<<6|ao.flags.hasRedundancy<<4|ao.flags.paddingValue<<1|ao.flags.isNonSync,ao.flags.degradPrio&240<<8,ao.flags.degradPrio&15,ao.cts>>>24&255,ao.cts>>>16&255,ao.cts>>>8&255,ao.cts&255],12+16*an)}return ab.box(ab.types.trun,aq)}},{key:"initSegment",value:function R(an){if(!ab.types){ab.init()}var am=ab.moov(an),al;al=new Uint8Array(ab.FTYP.byteLength+am.byteLength);al.set(ab.FTYP);al.set(am,ab.FTYP.byteLength);return al}}]);return ab})();F["default"]=J;I.exports=F["default"]},{}],17:[function(H,G,K){Object.defineProperty(K,"__esModule",{value:true});var J=(function(){function S(W,U){for(var T=0;T<U.length;T++){var V=U[T];V.enumerable=V.enumerable||false;V.configurable=true;if("value" in V){V.writable=true}Object.defineProperty(W,V.key,V)}}return function(V,T,U){if(T){S(V.prototype,T)}if(U){S(V,U)}return V}})();function R(S){return S&&S.__esModule?S:{"default":S}}function L(S,T){if(!(S instanceof T)){throw new TypeError("Cannot call a class as a function")}}var M=H("../events");var O=R(M);var Q=H("../utils/logger");var F=H("../remux/mp4-generator");var P=R(F);var I=H("../errors");var N=(function(){function X(ae){L(this,X);this.observer=ae;this.ISGenerated=false;this.PES2MP4SCALEFACTOR=4;this.PES_TIMESCALE=90000;this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}J(X,[{key:"destroy",value:function ac(){}},{key:"insertDiscontinuity",value:function ab(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=undefined}},{key:"switchLevel",value:function aa(){this.ISGenerated=false}},{key:"remux",value:function Y(ag,ah,af,ae){if(!this.ISGenerated){this.generateIS(ag,ah,ae)}if(ah.samples.length){this.remuxVideo(ah,ae)}if(ag.samples.length){this.remuxAudio(ag,ae)}if(af.samples.length){this.remuxID3(af,ae)}this.observer.trigger(O["default"].FRAG_PARSED)}},{key:"generateIS",value:function W(ag,ak,am){var aj=this.observer,af=ag.samples,ae=ak.samples,al=af.length,ah=ae.length,ai=this.PES_TIMESCALE;if(al===0&&ah===0){aj.trigger(O["default"].ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}else{if(ah===0){if(ag.config){aj.trigger(O["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:P["default"].initSegment([ag]),audioCodec:ag.codec,audioChannelCount:ag.channelCount});this.ISGenerated=true}if(this._initPTS===undefined){this._initPTS=af[0].pts-ai*am;this._initDTS=af[0].dts-ai*am}}else{if(al===0){if(ak.sps&&ak.pps){aj.trigger(O["default"].FRAG_PARSING_INIT_SEGMENT,{videoMoov:P["default"].initSegment([ak]),videoCodec:ak.codec,videoWidth:ak.width,videoHeight:ak.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=ae[0].pts-ai*am;this._initDTS=ae[0].dts-ai*am}}}else{if(ag.config&&ak.sps&&ak.pps){aj.trigger(O["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:P["default"].initSegment([ag]),audioCodec:ag.codec,audioChannelCount:ag.channelCount,videoMoov:P["default"].initSegment([ak]),videoCodec:ak.codec,videoWidth:ak.width,videoHeight:ak.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=Math.min(ae[0].pts,af[0].pts)-ai*am;this._initDTS=Math.min(ae[0].dts,af[0].dts)-ai*am}}}}}}},{key:"remuxVideo",value:function U(aw,au){var ap,ax=8,af=this.PES_TIMESCALE,ae=this.PES2MP4SCALEFACTOR,aA,ai,an,at,ag,aj,ao,ay,av,aC,am,ak,ar,aq=[];ag=new Uint8Array(aw.len+4*aw.nbNalu+8);ap=new DataView(ag.buffer);ap.setUint32(0,ag.byteLength);ag.set(P["default"].types.mdat,4);while(aw.samples.length){aA=aw.samples.shift();an=0;while(aA.units.units.length){at=aA.units.units.shift();ap.setUint32(ax,at.data.byteLength);ax+=4;ag.set(at.data,ax);ax+=at.data.byteLength;an+=4+at.data.byteLength}aC=aA.pts-this._initDTS;am=aA.dts-this._initDTS;if(av!==undefined){ak=this._PTSNormalize(aC,av);ar=this._PTSNormalize(am,av);ai.duration=(ar-av)/ae;if(ai.duration<0){ai.duration=0}}else{ak=this._PTSNormalize(aC,this.nextAvcDts);ar=this._PTSNormalize(am,this.nextAvcDts);if(this.nextAvcDts){var aB=Math.round((ar-this.nextAvcDts)/90),ah=Math.abs(aB);if(ah<300){if(aB>1){Q.logger.log("AVC:"+aB+" ms hole between fragments detected,filling it")}else{if(aB<-1){Q.logger.log("AVC:"+-aB+" ms overlapping between fragments detected")}}if(ah){ar=this.nextAvcDts;ak=Math.max(ak-aB,ar);Q.logger.log("Video/PTS/DTS adjusted:"+ak+"/"+ar)}}else{var az=af*au;if(Math.abs(az-ar)>af*3600){var al=az-ar;ar=az;ak=ar;this._initPTS-=al;this._initDTS-=al}}}ao=Math.max(0,ak);ay=Math.max(0,ar)}ai={size:an,duration:0,cts:(ak-ar)/ae,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}};if(aA.key===true){ai.flags.dependsOn=2;ai.flags.isNonSync=0}else{ai.flags.dependsOn=1;ai.flags.isNonSync=1}aq.push(ai);av=ar}if(aq.length>=2){ai.duration=aq[aq.length-2].duration}this.nextAvcDts=ar+ai.duration*ae;aw.len=0;aw.nbNalu=0;aw.samples=aq;aj=P["default"].moof(aw.sequenceNumber++,ay/ae,aw);aw.samples=[];this.observer.trigger(O["default"].FRAG_PARSING_DATA,{moof:aj,mdat:ag,startPTS:ao/af,endPTS:(ak+ae*ai.duration)/af,startDTS:ay/af,endDTS:(ar+ae*ai.duration)/af,type:"video",nb:aq.length})}},{key:"remuxAudio",value:function Z(ax,av){var ap,ay=8,ag=this.PES_TIMESCALE,af=this.PES2MP4SCALEFACTOR,an,aj,au,ah,ak,ao,az,aw,aB,am,al,at,ar=[];ah=new Uint8Array(ax.len+8);ap=new DataView(ah.buffer);ap.setUint32(0,ah.byteLength);ah.set(P["default"].types.mdat,4);while(ax.samples.length){an=ax.samples.shift();au=an.unit;ah.set(au,ay);ay+=au.byteLength;aB=an.pts-this._initDTS;am=an.dts-this._initDTS;if(aw!==undefined){al=this._PTSNormalize(aB,aw);at=this._PTSNormalize(am,aw);aj.duration=(at-aw)/af;if(aj.duration<0){aj.duration=0}}else{al=this._PTSNormalize(aB,this.nextAacPts);at=this._PTSNormalize(am,this.nextAacPts);if(this.nextAacPts&&this.nextAacPts!==al){var aA=Math.round(1000*(al-this.nextAacPts)/ag),ai=Math.abs(aA);if(ai>1&&ai<300){if(aA>0){Q.logger.log("AAC:"+aA+" ms hole between fragments detected,filling it")}else{Q.logger.log("AAC:"+-aA+" ms overlapping between fragments detected")}al=at=this.nextAacPts;Q.logger.log("Audio/PTS/DTS adjusted:"+al+"/"+at)}else{if(ai){var aq=ag*av;if(Math.abs(aq-al)>ag*3600){var ae=aq-al;al=aq;at=al;this._initPTS-=ae;this._initDTS-=ae}}}}ao=Math.max(0,al);az=Math.max(0,at)}aj={size:au.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};ar.push(aj);aw=at}if(ar.length>=2){aj.duration=ar[ar.length-2].duration}this.nextAacPts=al+af*aj.duration;ax.len=0;ax.samples=ar;ak=P["default"].moof(ax.sequenceNumber++,az/af,ax);ax.samples=[];this.observer.trigger(O["default"].FRAG_PARSING_DATA,{moof:ak,mdat:ah,startPTS:ao/ag,endPTS:this.nextAacPts/ag,startDTS:az/ag,endDTS:(at+af*aj.duration)/ag,type:"audio",nb:ar.length})}},{key:"remuxID3",value:function T(af,ae){var ai=af.samples.length,ah;if(ai){for(var ag=0;ag<ai;ag++){ah=af.samples[ag];ah.pts=(ah.pts-this._initPTS)/this.PES_TIMESCALE;ah.dts=(ah.dts-this._initDTS)/this.PES_TIMESCALE}this.observer.trigger(O["default"].FRAG_PARSING_METADATA,{samples:af.samples})}af.samples=[];ae=ae}},{key:"_PTSNormalize",value:function V(af,ae){var ag;if(ae===undefined){return af}if(ae<af){ag=-8589934592}else{ag=8589934592}while(Math.abs(af-ae)>4294967296){af+=ag}return af}},{key:"timescale",get:function S(){return this.MP4_TIMESCALE}}]);return X})();K["default"]=N;G.exports=K["default"]},{"../errors":10,"../events":11,"../remux/mp4-generator":16,"../utils/logger":19}],18:[function(G,F,I){Object.defineProperty(I,"__esModule",{value:true});var H=(function(){function O(S,Q){for(var P=0;P<Q.length;P++){var R=Q[P];R.enumerable=R.enumerable||false;R.configurable=true;if("value" in R){R.writable=true}Object.defineProperty(S,R.key,R)}}return function(R,P,Q){if(P){O(R.prototype,P)}if(Q){O(R,Q)}return R}})();function N(O){return O&&O.__esModule?O:{"default":O}}function J(O,P){if(!(O instanceof P)){throw new TypeError("Cannot call a class as a function")}}var K=G("./events");var L=N(K);var M=(function(){function X(Z){J(this,X);this.hls=Z;this.onmp=this.onManifestParsed.bind(this);this.onfc=this.onFragmentChanged.bind(this);this.onfb=this.onFragmentBuffered.bind(this);this.onflea=this.onFragmentLoadEmergencyAborted.bind(this);this.onerr=this.onError.bind(this);this.onfpsd=this.onFPSDrop.bind(this);Z.on(L["default"].MANIFEST_PARSED,this.onmp);Z.on(L["default"].FRAG_BUFFERED,this.onfb);Z.on(L["default"].FRAG_CHANGED,this.onfc);Z.on(L["default"].ERROR,this.onerr);Z.on(L["default"].FRAG_LOAD_EMERGENCY_ABORTED,this.onflea);Z.on(L["default"].FPS_DROP,this.onfpsd)}H(X,[{key:"destroy",value:function W(){var Z=this.hls;Z.off(L["default"].MANIFEST_PARSED,this.onmp);Z.off(L["default"].FRAG_BUFFERED,this.onfb);Z.off(L["default"].FRAG_CHANGED,this.onfc);Z.off(L["default"].ERROR,this.onerr);Z.off(L["default"].FRAG_LOAD_EMERGENCY_ABORTED,this.onflea);Z.off(L["default"].FPS_DROP,this.onfpsd)}},{key:"attachVideo",value:function S(Z){this.video=Z}},{key:"detachVideo",value:function U(){this.video=null}},{key:"onManifestParsed",value:function O(Z,aa){this._stats={tech:"hls.js",levelNb:aa.levels.length}}},{key:"onFragmentChanged",value:function P(ab,ac){var aa=this._stats,ae=ac.frag.level,Z=ac.frag.autoLevel;if(aa){if(aa.levelStart===undefined){aa.levelStart=ae}if(Z){if(aa.fragChangedAuto){aa.autoLevelMin=Math.min(aa.autoLevelMin,ae);aa.autoLevelMax=Math.max(aa.autoLevelMax,ae);aa.fragChangedAuto++;if(this.levelLastAuto&&ae!==aa.autoLevelLast){aa.autoLevelSwitch++}}else{aa.autoLevelMin=aa.autoLevelMax=ae;aa.autoLevelSwitch=0;aa.fragChangedAuto=1;this.sumAutoLevel=0}this.sumAutoLevel+=ae;aa.autoLevelAvg=Math.round(1000*this.sumAutoLevel/aa.fragChangedAuto)/1000;aa.autoLevelLast=ae}else{if(aa.fragChangedManual){aa.manualLevelMin=Math.min(aa.manualLevelMin,ae);aa.manualLevelMax=Math.max(aa.manualLevelMax,ae);aa.fragChangedManual++;if(!this.levelLastAuto&&ae!==aa.manualLevelLast){aa.manualLevelSwitch++}}else{aa.manualLevelMin=aa.manualLevelMax=ae;aa.manualLevelSwitch=0;aa.fragChangedManual=1}aa.manualLevelLast=ae}this.levelLastAuto=Z}}},{key:"onFragmentBuffered",value:function V(ab,ae){var Z=this._stats,ac=ae.stats.tfirst-ae.stats.trequest,af=ae.stats.tbuffered-ae.stats.trequest,aa=Math.round(8*ae.stats.length/(ae.stats.tbuffered-ae.stats.tfirst));if(Z.fragBuffered){Z.fragMinLatency=Math.min(Z.fragMinLatency,ac);Z.fragMaxLatency=Math.max(Z.fragMaxLatency,ac);Z.fragMinProcess=Math.min(Z.fragMinProcess,af);Z.fragMaxProcess=Math.max(Z.fragMaxProcess,af);Z.fragMinKbps=Math.min(Z.fragMinKbps,aa);Z.fragMaxKbps=Math.max(Z.fragMaxKbps,aa);Z.autoLevelCappingMin=Math.min(Z.autoLevelCappingMin,this.hls.autoLevelCapping);Z.autoLevelCappingMax=Math.max(Z.autoLevelCappingMax,this.hls.autoLevelCapping);Z.fragBuffered++}else{Z.fragMinLatency=Z.fragMaxLatency=ac;Z.fragMinProcess=Z.fragMaxProcess=af;Z.fragMinKbps=Z.fragMaxKbps=aa;Z.fragBuffered=1;Z.fragBufferedBytes=0;Z.autoLevelCappingMin=Z.autoLevelCappingMax=this.hls.autoLevelCapping;this.sumLatency=0;this.sumKbps=0;this.sumProcess=0}Z.fraglastLatency=ac;this.sumLatency+=ac;Z.fragAvgLatency=Math.round(this.sumLatency/Z.fragBuffered);Z.fragLastProcess=af;this.sumProcess+=af;Z.fragAvgProcess=Math.round(this.sumProcess/Z.fragBuffered);Z.fragLastKbps=aa;this.sumKbps+=aa;Z.fragAvgKbps=Math.round(this.sumKbps/Z.fragBuffered);Z.fragBufferedBytes+=ae.stats.length;Z.autoLevelCappingLast=this.hls.autoLevelCapping}},{key:"onFragmentLoadEmergencyAborted",value:function T(){var Z=this._stats;if(Z){if(Z.fragLoadEmergencyAborted===undefined){Z.fragLoadEmergencyAborted=1}else{Z.fragLoadEmergencyAborted++}}}},{key:"onError",value:function R(aa,ab){var Z=this._stats;if(Z){if(Z[ab.details]===undefined){Z[ab.details]=1}else{Z[ab.details]+=1}if(ab.fatal){if(Z.fatalError===undefined){Z.fatalError=1}else{Z.fatalError+=1}}}}},{key:"onFPSDrop",value:function Y(aa,ab){var Z=this._stats;if(Z){if(Z.fpsDropEvent===undefined){Z.fpsDropEvent=1}else{Z.fpsDropEvent++}Z.fpsTotalDroppedFrames=ab.totalDroppedFrames}}},{key:"stats",get:function Q(){if(this.video){this._stats.lastPos=this.video.currentTime.toFixed(3)}return this._stats}}]);return X})();I["default"]=M;F.exports=I["default"]},{"./events":11}],19:[function(J,K,H){Object.defineProperty(H,"__esModule",{value:true});function L(){}var M={log:L,warn:L,info:L,error:L};var G=M;var F=function F(N){if(N===true||typeof N==="object"){G.log=N.log?N.log.bind(N):console.log.bind(console);G.info=N.info?N.info.bind(N):console.info.bind(console);G.error=N.error?N.error.bind(N):console.error.bind(console);G.warn=N.warn?N.warn.bind(N):console.warn.bind(console);try{G.log()}catch(O){G.log=L;G.info=L;G.error=L;G.warn=L}}else{G=M}};H.enableLogs=F;var I=G;H.logger=I},{}],20:[function(I,K,H){Object.defineProperty(H,"__esModule",{value:true});var J=(function(){function M(Q,O){for(var N=0;N<O.length;N++){var P=O[N];P.enumerable=P.enumerable||false;P.configurable=true;if("value" in P){P.writable=true}Object.defineProperty(Q,P.key,P)}}return function(P,N,O){if(N){M(P.prototype,N)}if(O){M(P,O)}return P}})();function L(M,N){if(!(M instanceof N)){throw new TypeError("Cannot call a class as a function")}}var G=I("../utils/logger");var F=(function(){function N(V){L(this,N);if(V&&V.xhrSetup){this.xhrSetup=V.xhrSetup}}J(N,[{key:"destroy",value:function T(){this.abort();this.loader=null}},{key:"abort",value:function P(){if(this.loader&&this.loader.readyState!==4){this.stats.aborted=true;this.loader.abort()}if(this.timeoutHandle){window.clearTimeout(this.timeoutHandle)}}},{key:"load",value:function U(V,W,Y,X,Z,aa,ab,ae){var ac=arguments.length<=8||arguments[8]===undefined?null:arguments[8];this.url=V;this.responseType=W;this.onSuccess=Y;this.onProgress=ac;this.onTimeout=Z;this.onError=X;this.stats={trequest:new Date(),retry:0};this.timeout=aa;this.maxRetry=ab;this.retryDelay=ae;this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),aa);this.loadInternal()}},{key:"loadInternal",value:function Q(){var V=this.loader=new XMLHttpRequest();V.onload=this.loadsuccess.bind(this);V.onerror=this.loaderror.bind(this);V.onprogress=this.loadprogress.bind(this);V.open("GET",this.url,true);V.responseType=this.responseType;this.stats.tfirst=null;this.stats.loaded=0;if(this.xhrSetup){this.xhrSetup(V)}V.send()}},{key:"loadsuccess",value:function O(V){window.clearTimeout(this.timeoutHandle);this.stats.tload=new Date();this.onSuccess(V,this.stats)}},{key:"loaderror",value:function R(V){if(this.stats.retry<this.maxRetry){G.logger.warn(V.type+" while loading "+this.url+", retrying in "+this.retryDelay+"...");this.destroy();window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,64000);this.stats.retry++}else{window.clearTimeout(this.timeoutHandle);G.logger.error(V.type+" while loading "+this.url);this.onError(V)}}},{key:"loadtimeout",value:function M(V){G.logger.warn("timeout while loading "+this.url);this.onTimeout(V,this.stats)}},{key:"loadprogress",value:function S(W){var V=this.stats;if(V.tfirst===null){V.tfirst=new Date()}V.loaded=W.loaded;if(this.onProgress){this.onProgress(W,V)}}}]);return N})();H["default"]=F;K.exports=H["default"]},{"../utils/logger":19}]},{},[13])(13)});function A(B){this.width="100%";this.height="100%";t(this,B);this.video=document.createElement("VIDEO")}A.prototype=t(Object.create(CustomObject),{is_ready:false,isSupported:function(){return typeof document.createElement("VIDEO").play=="function"},canPlayType:function(C){var B=["maybe","probably"].indexOf(document.createElement("VIDEO").canPlayType(C))>-1;if((C=="application/x-mpegURL"||C=="application/vnd.apple.mpegurl")&&!B&&Hls.isSupported()){return true}return B},setSource:function(E,D){var B=this;if(["maybe","probably"].indexOf(this.video.canPlayType(D))>-1){this.video.src=E;this.video.load()}else{if(D=="application/x-mpegURL"||D=="application/vnd.apple.mpegurl"){var C=new Hls({fragLoadingTimeOut:100000});C.loadSource(E);C.attachVideo(this.video);C.on(Hls.Events.ERROR,function(G,F){console.log(F);if(F.fatal){B.trigger("error",201)}})}}},getElement:function(){return this.video},destroy:function(){this.video.oncontextmenu=null},setWidth:function(B){this.video.style.width=B},setHeight:function(B){this.video.style.height=B},init:function(){var B=this;this.setWidth(this.width);this.setHeight(this.height);this.initEvents();this.on("ready",function(){B.is_ready=true});this.trigger("ready")},initEvents:function(){var B=this;this.video.onerror=function(){};this.video.oncontextmenu=function(){event.preventDefault()};this.video.addEventListener("loadedmetadata",function(){B.trigger("canplay")});this.video.addEventListener("durationchange",function(){B.trigger("durationchange",this.duration)});this.video.addEventListener("volumechange",function(){B.trigger("volumechange",this.muted?0:this.volume)});this.video.addEventListener("timeupdate",function(){var C=false;for(var D=0;D<this.buffered.length;D++){if(this.currentTime>this.buffered.start(D)&&this.currentTime<this.buffered.end(D)){C=this.duration-this.buffered.end(D)<0.5||Math.abs(this.currentTime-this.buffered.end(D))>0.5;break}}if(C){if(B.is_waiting){B.trigger("playing");B.is_waiting=false}}else{B.is_waiting=true;B.trigger("waiting")}B.trigger("timeupdate",this.currentTime);if(this.duration&&this.duration-this.currentTime<0.5){B.trigger("ended");this.pause();this.currentTime=0}});this.video.addEventListener("ended",function(){B.trigger("ended")});this.video.addEventListener("waiting",function(){B.trigger("waiting")});this.video.addEventListener("playing",function(){B.trigger("playing")});this.video.addEventListener("play",function(){B.trigger("play")});this.video.addEventListener("pause",function(){B.trigger("pause")});this.video.addEventListener("canplay",function(){B.trigger("canplay")});this.video.addEventListener("seeking",function(){B.trigger("seeking")});this.video.addEventListener("seeked",function(){B.trigger("seeked")});this.video.addEventListener("progress",function(){var D=[];for(var C=0;C<this.buffered.length;C++){D.push([this.buffered.start(C),this.buffered.end(C)])}B.trigger("progress",D)})},play:function(){this.video.play()},pause:function(){this.video.pause()},getCurrentTime:function(){return this.video.currentTime},getDuration:function(){return this.video.duration},setCurrentTime:function(B){if(this.video.readyState!=HTMLMediaElement.HAVE_NOTHING){this.video.currentTime=Math.max(0,Math.min(this.video.duration-0.9,B))}},setVolume:function(B){B=Math.max(0,Math.min(1,B||0));this.video.volume=B;this.video.muted=!B},getVolume:function(){return this.video.volume}});return A})();w.prototype.__backends.HTML5=HTML5Backend;function o(A){this.flash_swf=null;p(this,A);this.swf=document.createElement("OBJECT")}o.prototype=t(Object.create(CustomObject),{is_ready:false,_flashFn:function(B){var A="window";var C="__"+Math.random().toString(16).split(".")[1];window[C]=function(){B.apply(window,arguments)};return A+"."+C},init:function(){var A=this;this.on("ready",function(){A.is_ready=true});this.swf.setAttribute("type","application/x-shockwave-flash");this.swf.setAttribute("width","100%");this.swf.setAttribute("height","100%");this.swf.setAttribute("data",this.flash_swf);g(this.swf,"screen");var D={wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all",quality:"high",flashvars:"readyFunction="+this._flashFn(function(){A.initEvents()})};for(var B in D){var C=document.createElement("PARAM");C.setAttribute("name",B);C.setAttribute("value",D[B]);this.swf.appendChild(C)}},isSupported:function(){return u()},canPlayType:function(A){return["video/mp4","video/flv","video/x-flv","video/m4v","application/x-mpegURL"].indexOf(A)>-1},getElement:function(){return this.swf},destroy:function(){clearInterval(this._play_interval)},initEvents:function(){var A=this;this.swf.vjs_setProperty("eventProxyFunction",this._flashFn(function(C,B){switch(B){case"playing":A.trigger("playing");break;case"seeked":A.trigger("seeked");break;case"waiting":A.trigger("waiting");break;case"ended":A.trigger("ended");break;case"canplay":case"loadedmetadata":A.trigger("canplay");break;case"play":A.trigger("play");break;case"volumechange":A.trigger("volumechange",A.getVolume());break;case"durationchange":A.trigger("durationchange",A.getDuration());break}}));this.swf.vjs_setProperty("errorEventProxyFunction",this._flashFn(function(C,B){switch(B){case"srcnotfound":A.trigger("error",201);break;default:A.trigger("error",200)}}));this.on("play",function(){A.__timeupdate=setInterval(function(){A.trigger("progress",[[0,A.swf.vjs_getProperty("buffered")]]);A.trigger("timeupdate",A.getCurrentTime())},500)});this.on(["pause","ended"],function(){clearInterval(A.__timeupdate)});this.trigger("ready")},setSource:function(A){this.swf.vjs_src(A)},play:function(){this.swf.vjs_play()},pause:function(){this.swf.vjs_pause();this.trigger("pause")},getCurrentTime:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("currentTime")}return 0},getDuration:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("duration")}return 0},setCurrentTime:function(A){this.swf.vjs_setProperty("currentTime",A)},setVolume:function(A){this.swf.vjs_setProperty("volume",A)},getVolume:function(A){return this.swf.vjs_getProperty("volume")}});w.prototype.__backends.Flash=o;function c(C,B){var A=this;this.player=C;this.is_fullscreen=false;if(this.checkSupportFullscreen()){this.init()}}c.prototype={init:function(){var A=this;e(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"],function(B){A.player.trigger("fullscreenchange",A.checkFullscreen())});this.player.on("tray_ready",function(C,B){B.appendChild(A.getUI())})},getUI:function(){var A=this;var C=f('<div class="fullscreen"><svg><path class="on" d="M18,18V6H6v12H18z M8,16V8h8v8H8z M22,2v6h-2V4h-4V2H22z M20,16h2v6h-6v-2h4V16z M4,20h4v2H2v-6h2V20z M4,8H2V2h6v2H4V8z"/><path class="off" d="M18,8v2h-4V6h2v2H18z M14,14v4h2v-2h2v-2H14z M6,14v2h2v2h2v-4H6z M8,8H6v2h4V6H8 V8z M22,2v20H2V2H22z M20,4H4v16h16V4z"/></svg></div>');var B=C.getElementsByClassName("on")[0];var D=C.getElementsByClassName("off")[0];e(C,"click",function(){if(A.is_fullscreen){A.exitFullscreen()}else{A.requestFullscreen()}});this.player.on("fullscreenchange",function(F,E){A.is_fullscreen=E;if(A.is_fullscreen){g(A.player.root,"fullscreen");C.title="Exit from Fullscreen";B.style.display="none";D.style.display=""}else{k(A.player.root,"fullscreen");C.title="Fullscreen";B.style.display="";D.style.display="none"}});this.player.trigger("fullscreenchange");return C},checkFullscreen:function(){return(document.fullscreenElement&&document.fullscreenElement!==null)||document.mozFullScreen||document.webkitIsFullScreen},checkSupportFullscreen:function(){return document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen||document.createElement("video").webkitEnterFullscreen},requestFullscreen:function(){var B=this;var C=document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen;if(C){C.call(this.player.root);this.is_fullscreen=true}else{var A=this.player.backend.getElement();if(A.webkitEnterFullscreen){this.is_fullscreen=true;e(A,"webkitendfullscreen",function(D){x(A,D.type);B.is_fullscreen=false});A.webkitEnterFullscreen()}}},exitFullscreen:function(){var A=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;if(A){A.call(document);this.is_fullscreen=false}}};w.prototype.__plugins.FullScreen=c;VASTPlugin=(function(){function C(W,Y){var X=((new Date).getTime()/1000)|0;var Y=t({CACHEBUSTER:X,CACHE_BUSTER:X,timestamp:X},Y);v(j(Y),function(Z){W=W.replace("["+Z+"]",encodeURIComponent(Y[Z]))});return W}function J(X,Z){var W=new Image;var X=C(X,Z);var Y=X.indexOf("?")==-1?"?":"&";W.src=X}function U(W,X){window.open(C(W,X),"_blank")}function F(W){var X={};if(W){v(W.getElementsByTagName("Tracking"),function(Y){var aa={};var Z=Y.getAttribute("event");if(typeof X[Z]==="undefined"){X[Z]=[]}aa.content=Y.textContent;v(Y.attributes,function(ab){aa[ab.name]=ab.value});X[Z].push(aa)})}return X}function K(W){W=W.trim();if(match=/^(\d{1,2}):(\d{1,2}):(\d{1,2})/.exec(W)){return{type:"seconds",value:parseInt(match[1])*3600+parseInt(match[2])*60+parseInt(match[3])}}if(match=/^(\d{1,3})%$/.exec(W)){return{type:"percent",value:parseInt(match[1])}}}function Q(W,X){if(W=="html"){elm=document.createElement("DIV");elm.innerHTML=X}else{if(W=="iframe"){elm=document.createElement("IFRAME");elm.src=X;elm.style.border="none";elm.scrolling="no"}else{if(W=="application/x-shockwave-flash"){elm=document.createElement("OBJECT");elm.setAttribute("type","application/x-shockwave-flash");elm.setAttribute("data",X)}else{elm=document.createElement("IMG");elm.src=X}}}return elm}function M(X){if(X&&X.length){for(var W=0;W<X.length;W++){J(X[W].content)}}}function A(X){var W=this;this.type;this.src;this.creative;t(this,X);this.vpaid=null;this.on("vpaidevent",function(ac,ab,aa){console.log(">>>VPAID Log:",ab,aa);switch(ab){case"AdLoaded":W.vpaid.startAd();break;case"AdClickThru":var Z=aa[0];var Y=aa[2];W.trigger("vastevent","clickthru",{click_through:Z,no_fire_pixel:!Y},W);break;case"AdSkipped":W.trigger("vastevent","skip",{},W);break;case"AdStopped":W.trigger("vastevent","complete",{},W);break;case"AdError":W.trigger("vasterror",901,aa);break;case"AdStarted":W.trigger("vastevent","start",{},W);W.trigger("vastevent","creativeView",{},W);break;case"AdVideoFirstQuartile":W.trigger("vastevent","firstQuartile",{},W);break;case"AdVideoMidpoint":W.trigger("vastevent","midpoint",{},W);break;case"AdVideoThirdQuartile":W.trigger("vastevent","thirdQuartile",{},W);break}})}A.prototype=t(Object.create(CustomObject),{vpaidEventsList:["AdLoaded","AdSkipped","AdStarted","AdStopped","AdLinearChange","AdSkippableStateChange","AdSizeChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],show:function(X,ab,W,Z){var Y=this;var aa=f('<iframe id="iframe" frameborder="no" scrolling="no" allowfullscreen></iframe>');aa.width=ab;aa.height=W;X.appendChild(aa);var ac=setTimeout(function(){Y.trigger("vasterror",900,"Timeout VPAID AdLoaded event")},Z.timeout);this.on("vpaidevent",function(af,ae){if(ae=="AdLoaded"||ae=="AdStarted"||ae=="AdError"){clearTimeout(ac)}});if(this.type=="application/x-shockwave-flash"){this.showFlash(aa,ab,W,Z)}else{this.showJS(aa,ab,W,Z,aa)}},showFlash:function(Y,W,ae,ag){var af=this;var ab=Y.contentDocument;var Z=Y.contentWindow;var ac="_custom_player_vpaid_on_ready"+Math.random().toString(16).split(".")[1];var aa="_custom_player_vpaid_on_error"+Math.random().toString(16).split(".")[1];var X=function(ai,ah){var aj="_custom_player_vpaid_"+ai+Math.random().toString(16).split(".")[1];Y.contentWindow[aj]=ah;af.vpaid.subscribe(ai,aj)};Y.contentWindow[aa]=function(){af.trigger("vpaidevent","AdError")};Y.contentWindow[ac]=function(){af.vpaid=Y.contentWindow.vpaid;console.log("--VPAID version:",af.vpaid.handshakeVersion("2.0"));console.log("getAdLinear:",af.vpaid.getAdLinear());X("AdLoaded",function(){af.vpaid.startAd()});v(af.vpaidEventsList,function(ah){X(ah,function(ai){af.trigger("vpaidevent",ah,ai)})});af.vpaid.initAd(W,ae,"normal",500,af.creative.params,"")};ab.open();ab.write('<body style="padding:0; margin:0; width:100%; height:100%;"><object id="vpaid" type="application/x-shockwave-flash" width="100%" height="100%" data="'+ag.vpaid_flash_bridge+'"><param name="allowScriptAccess" value="always"></param><param name="allowNetworking" value="all"></param><param name="wmode" value="transparent"><param name="flashvars" value="onReady='+ac+"&onError="+aa+"&src="+encodeURIComponent(this.src)+'"></param></object></body>');ab.close();console.log(this)},showJS:function(aa,Z,W,Y){var X=this;aa.contentWindow.trigger_error=function(){X.trigger("vpaidevent","AdError","Can't load vpaid file")};aa.contentWindow.trigger_load=function(){var ab=aa.contentWindow.getVPAIDAd;if(typeof ab!=="function"){X.trigger("vasterror",901,"General VPAID error.",X.creative);return}X.vpaid=ab();v(X.vpaidEventsList,function(ac){X.vpaid.subscribe(function(){X.trigger("vpaidevent",ac,arguments)},ac)});X.vpaid.initAd(Z,W,"normal",500,X.creative.params,{slot:aa.contentDocument.body})};aa.contentDocument.open();aa.contentDocument.write('<body style="margin:0; padding:0; width:100%; height:100%;"><script src="'+this.src+'" onload="trigger_load()" onerror="trigger_error()"><\/script></body>');aa.contentDocument.close()},getIsSupport:function(){var W=["application/javascript","application/x-javascript"];if(u()){W.push("application/x-shockwave-flash")}return W.indexOf(this.type)>-1}});function H(X){var W=this;this.type;this.src;this.creative;t(this,X);this.player=null;this.use_html5=false;this.use_flash=false}H.prototype=t(Object.create(CustomObject),{show:function(X,ab,W,Z){var Y=this;this.player=new w(X,Z);this.player.on("error",function(){});this.player.on("ended",function(){Y.trigger("vastevent","complete",{},Y.creative)});this.player.on("canplay",function(ae){ae.handler.remove();Y.trigger("start",Y);Y.player.play()});this.player.on("pause",function(){Y.trigger("vastevent","pause",{},Y.creative)});this.player.on("resume",function(){Y.trigger("vastevent","resume",{},Y.creative)});var aa;this.player.on("volumechange",function(af,ae){if(ae>0&&aa==0){Y.trigger("vastevent","unmute",{},Y.creative)}if(ae==0&&aa!=0){Y.trigger("vastevent","mute",{},Y.creative)}aa=ae});var ac=0;this.player.on("timeupdate",function(ag,af){var ae=af/this.getDuration()*100;if(ae>0&&ac==0){ac++;Y.trigger("vastevent","start",{},Y.creative);Y.trigger("vastevent","creativeView",{},Y.creative)}if(ae>25&&ac==1){ac++;Y.trigger("vastevent","firstQuartile",{},Y.creative)}if(ae>50&&ac==2){ac++;Y.trigger("vastevent","midpoint",{},Y.creative)}if(ae>75&&ac==3){ac++;Y.trigger("vastevent","thirdQuartile",{},Y.creative)}});this.player.setSources([{src:this.src,type:this.type}]);this.player.load()},getIsSupport:function(){return w.prototype.supportMedia(this.type)}});function T(X,W){this.creative;this.is_vpaid=false;t(this,W);this.is_error=false;this.on("vasterror",function(ab,Z,Y,aa){this.is_error=true});this.parse(X)}T.prototype=t(Object.create(CustomObject),{parse:function(Y){var W=this;var X={type:Y.getAttribute("type"),src:Y.textContent.trim(),creative:this.creative};this.is_vpaid=this.is_vpaid||(Y.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";if(this.is_vpaid){this.media=new A(X)}else{this.media=new H(X)}this.media.proxy(["vastevent","vasterror","vpaidevent","done","start"],W)},getIsSupport:function(){return this.media.getIsSupport()},show:function(X,Z,W,Y){this.media.show(X,Z,W,Y)}});function S(Y,X){this.place=null;this.width;this.height;this.player_options={};this.vpaid_options={};t(this,X);this.width=this.width||this.place.offsetWidth;this.height=this.height||this.place.offsetHeight;this.id;this.skipoffset=null;this.sequence=1;this.is_vpaid=false;this.click_through=null;this.params={};this.tracking={};this.medias=[];this.is_ready=false;this.is_error=false;this.is_done=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ac,aa,Z,ab){this.is_error=true;this.place.innerHTML="";this.trigger("error")});this.on("vastevent",function(ac,aa,Z,ab){switch(aa){case"clickthru":if(!Z.no_fire_pixel){U(Z.click_through)}break;case"skip":case"complete":this.trigger("done");break}M(this.tracking[aa])});this.on("start",function(Z){W.trigger("linearstart",W)});this.on("done",function(){this.is_done=true});var W=this;setTimeout(function(){W.parse(Y)},0)}S.prototype=t(Object.create(CustomObject),{parse:function(X){var W=this;this.id=X.getAttribute("id")||null;this.sequence=parseInt(X.getAttribute("sequence"))||1;this.is_vpaid=(X.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";this.tracking=F(X.getElementsByTagName("TrackingEvents")[0]);if(ad_parameters_xml=X.getElementsByTagName("AdParameters")[0]){this.params.AdParameters=ad_parameters_xml.textContent.trim()}if(skipoffset_attr=X.getAttribute("skipoffset")){this.skipoffset=K(skipoffset_attr)}if(clicks_xml=X.getElementsByTagName("VideoClicks")[0]){if(through_xml=clicks_xml.getElementsByTagName("ClickThrough")[0]){this.click_through=through_xml.textContent.trim()}if(click_tracking_xml=X.getElementsByTagName("ClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent.trim()})}}v(X.getElementsByTagName("MediaFile"),function(Y){var Z=new T(Y,{is_vpaid:W.is_vpaid,creative:W});Z.proxy(["vasterror","vastevent","start"],W);W.medias.push(Z)});this.trigger("ready")},show:function(){var W=this;if(this.medias.length){for(var X=0;X<this.medias.length;X++){var Z=this.medias[X];if(Z.getIsSupport()){this.media=Z;break}}if(this.media){var Y=f('<div style="position:absolute; width:100%; height:100%; top:0; background:black"></div>');W.place.appendChild(Y);this.on("done",function(){W.place.removeChild(Y)});if(this.media.is_vpaid){this.media.show(Y,W.width,W.height,W.vpaid_options)}else{this.media.show(Y,W.width,W.height,W.player_options)}}else{this.trigger("vasterror",403,"Couldn't find MediaFile that is supported by this video player, based on the attributes of the MediaFile element.",this)}}else{this.trigger("vasterror",400,"General Linear error. Video player is unable to display the Linear Ad.",this)}},play:function(){this.media.media.player.play()},pause:function(){this.media.media.player.pause()},skip:function(){this.trigger("vastevent","skip",{},this)},clickthru:function(W){this.trigger("vastevent","clickthru",{click_through:W},this)},setVolume:function(W){this.media.media.player.setVolume(W)},mute:function(){this.media.media.player.mute()},unmute:function(){this.media.media.player.unmute()}});function O(W){this.place;this.elm;this.width;this.height;this.is_vpaid=false;this.min_duration;this.resource;this.click_through;this.tracking=[];this.can_show=false;this.is_error=false;this.on("vasterror",function(aa,Y,X,Z){this.is_error=true});this.on("vastevent",function(aa,Y,X,Z){if(Y=="clickthru"){U(X.click_through)}M(this.tracking[Y])});this.parse(W)}O.prototype=t(Object.create(CustomObject),{parse:function(W){this.is_vpaid=(W.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";this.width=W.getAttribute("width")||0;this.height=W.getAttribute("height")||0;this.tracking=F(W.getElementsByTagName("TrackingEvents")[0]);if(min_duration=W.getAttribute("minSuggestedDuration")){if(m=/^(\d{1,2}):(\d{1,2}):(\d{1,2})/.exec(min_duration)){this.min_duration=parseInt(m[1])*3600+parseInt(m[2])*60+parseInt(m[3])}}if(click_through_xml=W.getElementsByTagName("NonLinearClickThrough")[0]){this.click_through=click_through_xml.textContent}if(click_tracking_xml=W.getElementsByTagName("NonLinearClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent})}if(!this.resource&&(static_xml=W.getElementsByTagName("StaticResource")[0])){var X=static_xml.getAttribute("creativeType");if(this.supportMedia(X)){this.resource={type:X,src:static_xml.textContent.trim()}}}if(!this.resource&&(iframe_xml=W.getElementsByTagName("IFrameResource")[0])){this.resource={type:"iframe",src:iframe_xml.textContent.trim()}}if(!this.resource&&(html_xml=W.getElementsByTagName("HTMLResource")[0])){this.resource={type:"html",src:html_xml.textContent.trim()}}this.can_show=!!this.resource},show:function(X){var Z=this;this.place=X;this.elm=f('<div class="nonlinear"><div class="close">x</div><div class="inner"></div></div>');var aa=this.elm.getElementsByClassName("close")[0];var Y=this.elm.getElementsByClassName("inner")[0];this.elm.style.width=this.width+"px";this.elm.style.height=this.height+"px";this.elm.style.right="10px";this.elm.style.bottom="70px";var W=Q(this.resource.type,this.resource.src);Y.appendChild(W);if(this.click_through){e(this.elm,"click",function(){Z.trigger("vastevent","clickthru",{click_through:Z.click_through},Z)})}if(this.min_duration){aa.style.display="none";setTimeout(function(){aa.style.display=""},this.min_duration*1000)}e(aa,"click",function(){Z.close();return false});this.place.appendChild(this.elm);this.trigger("vastevent","creativeView",{},this)},close:function(){this.trigger("vastevent","collapse",{},this);this.trigger("vastevent","close",{},this);this.place.removeChild(this.elm)},supportMedia:function(W){return W!="application/x-shockwave-flash"||u()}});function L(Y,X){this.place=null;t(this,X);this.sequence;this.required;this.banners=[];this.is_ready=false;this.is_error=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ac,aa,Z,ab){this.is_error=true});var W=this;setTimeout(function(){W.parse(Y)},0)}L.prototype=t(Object.create(CustomObject),{parse:function(X){var W=this;this.sequence=parseInt(X.getAttribute("sequence"))||1;v(X.getElementsByTagName("NonLinear"),function(Y){var Z=new O(Y);Z.proxy(["vasterror","vastevent"],W);W.banners.push(Z)});this.trigger("ready")},show:function(){var X=this;if(this.banners.length==0){X.trigger("vasterror",500,"General NonLinearAds error",X);return}var W=0;(function(){var Y=arguments.callee;if(banner=X.banners[W]){if(banner.can_show){banner.on("close",function(){W++;Y()});banner.show(X.place)}else{X.trigger("vasterror",503,"Couldn’t find NonLinear resource with supported type.",X);W++;Y()}}else{}})()}});function N(W){this.place;this.width;this.height;this.resource;this.click_through;this.tracking=[];this.is_error=false;this.on("vasterror",function(aa,Y,X,Z){this.is_error=true});this.on("vastevent",function(aa,Y,X,Z){if(Y=="clickthru"){U(X.click_through)}M(this.tracking[Y])});this.parse(W)}N.prototype=t(Object.create(CustomObject),{parse:function(W){this.width=W.getAttribute("width")||0;this.height=W.getAttribute("height")||0;this.tracking=F(W.getElementsByTagName("TrackingEvents")[0]);if(through_xml=W.getElementsByTagName("CompanionClickThrough")[0]){this.click_through=through_xml.textContent}if(click_tracking_xml=W.getElementsByTagName("CompanionClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent})}if(!this.resource&&(static_xml=W.getElementsByTagName("StaticResource")[0])){var X=static_xml.getAttribute("creativeType");if(this.supportMedia(X)){this.resource={type:X,src:static_xml.textContent.trim()}}}if(!this.resource&&(iframe_xml=W.getElementsByTagName("IFrameResource")[0])){this.resource={type:"iframe",src:iframe_xml.textContent.trim()}}if(!this.resource&&(html_xml=W.getElementsByTagName("HTMLResource")[0])){this.resource={type:"html",src:html_xml.textContent.trim()}}if(this.resource&&(ad_slot_id=W.getAttribute("adSlotID"))){if(custom_place=document.getElementById(ad_slot_id)){if(this.width==custom_place.offsetWidth&&this.height==custom_place.offsetHeight){this.place=custom_place}}}},show:function(){var W=this;var X=Q(this.resource.type,this.resource.src);X.width=this.width;X.height=this.height;if(this.click_through){X.style.cursor="pointer";e(X,"click",function(){W.trigger("vastevent","clickthru",{click_through:W.click_through},W)})}this.place.innerHTML="";this.place.appendChild(X);W.trigger("vastevent","creativeView",{},this)},supportMedia:function(W){return W!="application/x-shockwave-flash"||u()}});function G(Y,X){this.places=[];t(this,X);this.sequence;this.required;this.banners=[];this.is_ready=false;this.is_error=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ac,aa,Z,ab){this.is_error=true});var W=this;setTimeout(function(){W.parse(Y)},0)}G.prototype=t(Object.create(CustomObject),{parse:function(X){var W=this;this.sequence=parseInt(X.getAttribute("sequence"))||1;this.required=X.getAttribute("required")||"any";if(this.required!="none"){v(X.getElementsByTagName("Companion"),function(Y){var Z=new N(Y);Z.proxy(["vasterror","vastevent"],W);W.banners.push(Z)})}this.trigger("ready")},show:function(){var W=this;if(this.required!="none"){var X=[];var Y=[];v(this.places,function(Z){if(elm=document.getElementById(Z.id)){X.push(Z.width+"x"+Z.height);Y.push(elm)}});v(this.banners,function(Z){if(Z.place){if((i=Y.indexOf(Z.place))>-1){X[i]=null}}else{if((i=X.indexOf(Z.width+"x"+Z.height))>-1){X[i]=null;Z.place=Y[i]}}if(Z.place){Z.show()}else{W.trigger("vasterror",601,"Unable to display Companion because creative dimensions do not fit within Companion display area (i.e., no available space).",Z);if(W.required=="all"){W.trigger("vasterror",602,"Unable to display Required Companion",W);return false}}})}}});function P(Y,X){this.linear_options={};this.nonlinear_options={};this.companion_options={};t(this,X);this.type;this.creative;this.tracking={};this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ac,aa,Z,ab){this.is_error=true});this.on("vastevent",function(ac,aa,Z,ab){M(this.tracking[aa])});this.on("lineardone",function(){this.is_linear_done=true});var W=this;setTimeout(function(){W.parse(Y)},0)}P.prototype=t(Object.create(CustomObject),{parse:function(X){var W=this;this.id=X.getAttribute("id")||null;this.tracking=F(creatives_xml.getElementsByTagName("TrackingEvents")[0]);if(linear_xml=X.getElementsByTagName("Linear")[0]){this.type="linear";this.creative=new S(linear_xml,this.linear_options);this.creative.on(["done","error"],function(){setTimeout(function(){W.trigger("lineardone")},0)})}else{if(nonlinear_xml=X.getElementsByTagName("NonLinearAds")[0]){this.type="nonlinear";this.creative=new L(nonlinear_xml,this.nonlinear_options)}else{if(companion_xml=X.getElementsByTagName("CompanionAds")[0]){this.type="companion";this.creative=new G(companion_xml,this.companion_options)}else{this.trigger("vasterror",0,"",this);return}}}this.creative.proxy(["ready","vasterror","vastevent","linearstart"],W)},show:function(){var W=this;switch(this.type){case"linear":this.creative.show();break;case"nonlinear":this.creative.show();break;case"companion":this.creative.show();break}}});function I(Y,X){this.linear_options={};this.nonlinear_options={};this.companion_options={};t(this,X);this.error_url;this.impression_url;this.tracking={};this.creatives=[];this.linear=[];this.nonlinear=[];this.companion=[];this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});var W=this;setTimeout(function(){W.parse(Y)},0)}I.prototype=t(Object.create(CustomObject),{parse:function(Y){var W=this;if(error_xml=Y.getElementsByTagName("Error")[0]){this.error_url=error_xml.textContent.trim()}if(impression_xml=Y.getElementsByTagName("Impression")[0]){this.impression_url=impression_xml.textContent.trim()}if(creatives_xml=Y.getElementsByTagName("Creatives")[0]){var X={linear_options:W.linear_options,nonlinear_options:W.nonlinear_options,companion_options:W.companion_options};v(creatives_xml.getElementsByTagName("Creative"),function(aa){var Z=new P(aa,X);W.creatives.push(Z);Z.on("ready",function(){if(Z.type=="linear"){W.linear.push(Z)}if(Z.type=="nonlinear"){W.nonlinear.push(Z)}if(Z.type=="companion"){W.companion.push(Z)}if(y(W.creatives,function(ab){return ab.is_ready||ab.is_error})){W.trigger("ready")}});Z.proxy(["vasterror","vastevent","linearstart"],W)});this.linear.sort(function(aa,Z){return aa.sequence-Z.sequence});this.nonlinear.sort(function(aa,Z){return aa.sequence-Z.sequence});this.companion.sort(function(aa,Z){return aa.sequence-Z.sequence})}},start:function(){var W=this;this.on("lineardone",function(){W.startNonLinear()});this.startCompanion();this.startLinear()},startLinear:function(){var X=this;var W=0;(function(){var Y=arguments.callee;if(creative=X.linear[W]){creative.on("lineardone",function(){W++;Y()});creative.show()}else{X.trigger("lineardone")}})()},startNonLinear:function(){v(this.nonlinear,function(W){W.show()})},startCompanion:function(){v(this.companion,function(W){W.show()})}});function R(Y,X){this.linear_options={};this.nonlinear_options={};this.companion_options={};t(this,X);this.vast;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});var W=this;setTimeout(function(){W.parse(Y)},0)}R.prototype=t(Object.create(CustomObject),{parse:function(Y){var W=this;var X=Y.getElementsByTagName("VASTAdTagURI")[0].textContent;this.vast=new D(X,{linear_options:this.linear_options,nonlinear_options:this.nonlinear_options,companion_options:this.companion_options});this.vast.proxy(["ready","error","lineardone","vasterror","vastevent","linearstart"],W)},start:function(){this.vast.start()},startLinear:function(){this.vast.startLinear()},startCompanion:function(){this.vast.startCompanion()},startNonLinear:function(){this.vast.startNonLinear()}});function V(Y,X){this.linear_options={};this.nonlinear_options={};this.companion_options={};t(this,X);this.id;this.sequence;this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.is_wrapper=false;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});var W=this;setTimeout(function(){W.parse(Y)},0)}V.prototype=t(Object.create(CustomObject),{parse:function(Y){var W=this;this.id=Y.getAttribute("id")||null;this.sequence=parseInt(Y.getAttribute("sequence"))||1;var X={linear_options:W.linear_options,nonlinear_options:W.nonlinear_options,companion_options:W.companion_options};if(wrapper_xml=Y.getElementsByTagName("Wrapper")[0]){this.inline=new R(wrapper_xml,X)}else{if(inline_xml=Y.getElementsByTagName("InLine")[0]){this.inline=new I(inline_xml,X)}else{this.trigger("error")}}this.inline.proxy(["ready","linearstart","lineardone","error","vastevent","vasterror"],W)},start:function(){this.inline.start()},startLinear:function(){this.inline.startLinear()},startCompanion:function(){this.inline.startCompanion()},startNonLinear:function(){this.inline.startNonLinear()}});function D(Y,X){var W=this;this.timeout=5000;this.linear_options={player_options:{},vpaid_options:{timeout:10000}};this.nonlinear_options={};this.companion_options={};t(this,X);this.url=Y;this.ads=[];this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.load(Y);this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true})}D.prototype=t(Object.create(CustomObject),{load:function(X){var W=this;var Z=null;var Y=setTimeout(function(){W.trigger("error",301,"Timeout of VAST URI provided in Wrapper element");Z.abort()},this.timeout);Z=d(X,function(ab,aa){clearTimeout(Y);if(ab){if(!aa.responseXML||!aa.responseXML.documentElement){W.trigger("error",100,"XML parsing error");return}v(aa.responseXML.documentElement.getElementsByTagName("Ad"),function(ac){var ae=new V(ac,{linear_options:W.linear_options,nonlinear_options:W.nonlinear_options,companion_options:W.companion_options});ae.on("ready",function(){if(y(W.ads,function(af){return af.is_ready||af.is_error})){W.trigger("ready")}});ae.proxy(["linearstart","vastevent","vasterror","error"],W);W.ads.push(ae)});if(W.ads.length){W.ads.sort(function(ae,ac){return ae.sequence-ac.sequence})}else{W.trigger("error")}}else{W.trigger("error")}})},start:function(){var W=this;this.on("lineardone",function(){W.startNonLinear()});this.startCompanion();this.startLinear()},startLinear:function(){var X=this;var W=0;(function(){var Y=arguments.callee;if(ad=X.ads[W]){ad.on("lineardone",function(){W++;Y()});ad.startLinear()}else{if(!X.is_linear_done){X.trigger("lineardone")}}})()},startCompanion:function(){v(this.ads,function(W){W.startCompanion()})},startNonLinear:function(){v(this.ads,function(W){W.startNonLinear()})}});(function(){var W=document.createElement("STYLE");W.innerHTML=".Ad {position: absolute;width: 100%;height: 100%;top: 0;z-index: 1000;}.Ad .ad-info {position: absolute;right: 5px;vertical-align: middle;top: 10px;color: #fff;font-size: 13pt;z-index: 10;background: rgba(0,0,0,0.5);padding: 5px 10px;}.Ad .ad-info .ad-link{color: #fff;border-bottom: 1px dashed #fff;text-decoration: none;cursor: pointer;}.Ad .ad-skip {position: absolute;display: table;right: 5px;bottom: 70px;padding: 5px;background: rgba(0,0,0,0.4);cursor: pointer;z-index: 10;}.Ad .ad-skip  > .message {display: table-cell;color: #fff;vertical-align: middle;text-align: center;font-size: 12pt;padding-right: 10px;}.Ad .ad-skip > img {display: table-cell;height: 60px;}.customPlayer > .nonlinear {position: absolute;z-index: 1000;}.customPlayer > .nonlinear .close {position: absolute;right: 0;top: 0;width: 15px;height: 15px;cursor: pointer;color: red;z-index: 1;text-align: center;}.customPlayer > .nonlinear .close:hover {text-decoration: underline;}.customPlayer > .nonlinear .inner {position: absolute;left: 0;top: 0;cursor: pointer;}";document.head.appendChild(W)})();function E(X,W){this.click_through=null;this.skipoffset=null;t(this,W);this.player=X;this.info=f('<div class="ad-info"><span><span class="ad-link">Visit advertiser\'s site</span><span style="margin:0 10px">&bull;</span></span><span class="timer"></span></div>');this.skip=f('<div class="ad-skip"><div class="message"></div></div>');this.ctrl=new l(X,{progress:{readonly:true},timer:{show:false}});this.ctrl.proxy(["play","pause","volumechange","mute","unmute"],this);this.init()}E.prototype=t(Object.create(CustomObject),{getElement:function(){return this.ctrl.getElement()},init:function(){var X=this;var Y=this.player;var ae=this.info.getElementsByClassName("timer")[0];var ab=this.info.firstChild;var aa=this.skip;var W=this.ctrl.getElement();W.appendChild(this.info);W.appendChild(this.skip);Y.on("timeupdate",function(af,ag){ae.innerHTML="Ad. "+X.ctrl.formatTime(X.ctrl.duration-ag)});if(this.click_through){e(ab,"click",function(){X.trigger("clickthru",X.click_through);return false})}else{ab.style.display="none"}if(this.skipoffset){var ac=null;if(this.skipoffset.type=="seconds"){ac=this.skipoffset.value}if(this.skipoffset.type=="percent"){ac=X.ctrl.duration/100*this.skipoffset.value}if(ac){var Z=aa.getElementsByClassName("message")[0];Y.on("timeupdate",function(af,ag){if(ag>ac){af.handler.remove();Z.innerHTML="Skip to video";e(aa,"click",function(ah){X.trigger("skip");return false})}else{Z.innerHTML="You can skip<br>to video<br>in "+parseInt(ac-ag)}})}}else{aa.style.display="none"}}});function B(Y,X){var W=this;this.player=Y;this.conf={vpaid_flash_bridge:"vpaid_bridge.swf",schedule:[],companion_places:[]};p(this.conf,X);this.queue=[];v(this.conf.schedule,function(aa){var aa=p({offset:"pre",tag:null},aa);if(typeof aa.tag==="function"){aa.tag=aa.tag()}if(aa.offset=="pre"){W.player.on("play",function(ac){ac.handler.remove();W.processVast(aa)})}if(aa.offset=="post"){W.player.on("timeupdate",function(ac,ae){if((W.player.getDuration()-ae)<=2){ac.handler.remove();W.processVast(aa)}})}if(m=/^(\d+)$/.exec(aa.offset)){var Z=m[1]|0;W.player.on("timeupdate",function(ac,ae){if(ae>Z){ac.handler.remove();W.processVast(aa)}})}if(m=/^(\d+)%$/.exec(aa.offset)){var ab=m[1]|0;W.player.on("timeupdate",function(ac){if(W.player.getProgress()>ab){ac.handler.remove();W.processVast(aa)}})}})}B.prototype={processVast:function(Y){var W=this;var X=f('<div class="Ad"></div>');this.player.root.appendChild(X);var Z=new D(Y.tag,{linear_options:{place:X,player_options:{cookieKeyVolume:this.player.conf.cookieKeyVolume,flash_swf:this.player.conf.flash_swf,plugins:{BigMode:this.player.conf.plugins.BigMode}},vpaid_options:{vpaid_flash_bridge:W.conf.vpaid_flash_bridge}},nonlinear_options:{place:this.player.root},companion_options:{places:this.conf.companion_places}});Z.on(["vastevent","vasterror"],function(aa){console.log("==>",arguments)});Z.on("ready",function(){if(W.queue[0]==this){this.start()}});Z.on("linearstart",function(ab,aa){W.initControls(aa)});Z.on("lineardone",function(){W.queue.shift();if(W.queue.length==0){W.player.trigger("vast_linear_ad_done");W.player.play();W.player.root.removeChild(X)}else{if(W.queue[0].is_ready){W.queue[0].start()}}});Z.on("error",function(ae,ab,aa,ac){console.error(ab,aa,ac);this.trigger("lineardone")});if(this.queue.length==0){this.player.pause();W.player.trigger("vast_start_ad")}this.queue.push(Z)},initControls:function(W){var Y=this;if(!W.is_vpaid){var Z=W.media.media.player;var X=new E(Z,{click_through:W.click_through,skipoffset:W.skipoffset});X.on(["play","pause","skip","mute","unmute"],function(aa){W[aa.type]()});X.on("clickthru",function(ab,aa){W.clickthru(aa)});X.on("volumechange",function(ab,aa){W.setVolume(aa);Y.player.setVolume(aa)});Z.root.appendChild(X.getElement())}}};return B})();w.prototype.__plugins.VAST=VASTPlugin;function s(C,B){this.player=C;this.conf={hq:false};p(this.conf,B);this.can_hq=false;this.hq=!!this.conf.hq;this.btn=f('<div class="hq" style="width: 32px;"><svg><path transform="translate(-104, 0)" d="M114.1,3.7h3.7v13.6h-3.7v-5.5h-4.3v5.5h-3.7V3.7h3.7v5h4.3V3.7z M133.8,20.5h-4.6l-2.4-3l0,0v0l0,0c-2.1,0-3.8-0.6-4.9-1.8c-1.1-1.2-1.7-2.9-1.7-5.2c0-2.3,0.6-4,1.7-5.2c1.1-1.2,2.8-1.8,4.9-1.8c2.2,0,3.8,0.6,4.9,1.8c1.1,1.2,1.7,2.9,1.7,5.2c0,3.1-1,5.1-2.9,6.2L133.8,20.5z M129.6,10.5c0-1.4-0.2-2.4-0.7-3c-0.5-0.6-1.1-1-2-1c-1.8,0-2.8,1.3-2.8,4c0,2.6,0.9,3.9,2.7,3.9c0.9,0,1.6-0.3,2.1-1C129.3,12.8,129.6,11.8,129.6,10.5z"/></svg></div>');var A=this;this.player.on("tray_ready",function(E,D){if(D.lastChild&&D.lastChild.className=="fullscreen"){D.insertBefore(A.getUI(),D.lastChild)}else{D.appendChild(A.getUI())}});this.init()}s.prototype={init:function(){var A=this;this.origin_setSources=this.player.setSources;this.player.setSources=this.setSources.bind(this);e(this.btn,"click",function(){A.setHQ(!A.hq)})},getUI:function(){return this.btn},setSources:function(B){var A=this;this.sources=B;v(B,function(C){A.can_hq=A.can_hq||C.hq});this.setHQ(this.can_hq?this.hq:false);this.player},setHQ:function(A){this.hq=!!A;if(this.can_hq){this.btn.style.display=null}else{this.btn.style.display="none"}if(this.hq){this.btn.style.opacity=1}else{this.btn.style.opacity=0.5}this.applySourceHQ(A)},applySourceHQ:function(){var B=this;var A=this.sources.filter(function(E){return typeof E.hq==="undefined"||E.hq==B.hq});if(this.player.is_start_load){var D=this.player.is_playing;var C=this.player.getProgress();this.player.on("canplay",function(E){E.handler.remove();this.setProgress(C);if(D){this.play()}});this.origin_setSources.call(this.player,A);this.player.load()}else{this.origin_setSources.call(this.player,A)}}};w.prototype.__plugins.HQ=s;function a(C,B){var A=this;this.player=C;this.conf={bigClass:"big",target:document.body};p(this.conf,B);this.can_hq=false;this.hq=!!this.conf.hq;this.btn=f('<div class="big"><svg><path d="M22,11.4l-3-3l-3.1,3.1l-3.3-3.3L15.7,5l-3-3H22V11.4z M8.3,19l3,3H2v-9.4l3,3l3.2-3.2l3.3,3.3L8.3,19z"/><path d="M12.5,2.1l3,3L18.7,2L22,5.3l-3.1,3.1l3,3h-9.4V2.1z M5.2,15.5l-3-3h9.4v9.4l-3-3L5.3,22L2,18.7L5.2,15.5z"/></svg></div>');this.player.on("tray_ready",function(E,D){if(D.lastChild&&D.lastChild.className=="fullscreen"){D.insertBefore(this.btn,D.lastChild)}else{D.appendChild(this.btn)}var F=this.btn.getElementsByTagName("path");if(b(A.conf.target,A.conf.bigClass)){F[0].style.display="none";F[1].style.display=""}else{F[1].style.display="none";F[0].style.display=""}e(this.btn,"click",function(){if(b(A.conf.target,A.conf.bigClass)){k(A.conf.target,A.conf.bigClass);F[1].style.display="none";F[0].style.display=""}else{g(A.conf.target,A.conf.bigClass);F[0].style.display="none";F[1].style.display=""}});this.player.on("fullscreenchange",function(H,G){if(G){A.btn.style.display="none"}else{A.btn.style.display=""}})},this);this.player.on("change_small_mode",function(E,D){A.btn.style.display=D?"none":""})}w.prototype.__plugins.BigMode=a;return function(A,B){var B=t({allow_backends:["HTML5","Flash"],controls:{}},B);var C=new w(A,B);if(B.controls){var D=new l(C,p({poster:B.poster},B.controls));D.on(["play","pause","mute","unmute"],function(E){C[E.type]()});D.on("fullscreentoggle",function(){var E=C._plugins.FullScreen;if(E.is_fullscreen){E.exitFullscreen()}else{E.requestFullscreen()}});D.on("positionchange",function(F,E){C.setProgress(E*100)});D.on("volumechange",function(F,E){C.setVolume(E)});A.appendChild(D.getElement())}return C}})();