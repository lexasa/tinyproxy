window.CustomPlayer=(function(){function j(C,D){var B=new RegExp("(^|\\s)"+D+"(\\s|$)","g");if(B.test(C.className)){return}C.className=(C.className+" "+D).replace(/\s+/g," ").replace(/(^ | $)/g,"")}function l(C,D){var B=new RegExp("(^|\\s)"+D+"(\\s|$)","g");C.className=C.className.replace(B,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")}function b(C,D){var B=new RegExp("(^|\\s)"+D+"(\\s|$)","g");return B.test(C.className)}function w(D,C){if(D){for(var B=0;B<D.length;B++){if(C(D[B])===false){break}}}}function k(D){var C=[];for(var B in D){if(D.hasOwnProperty(B)){C.push(B)}}return C}function r(B){return typeof B==="object"&&B!==null&&B.constructor===Object}function A(B){return B?(r(B)?k(B).length==0:B.length==0):true}function q(C,B){w(k(B),function(D){if(r(C[D])&&r(B[D])&&!A(C[D])){q(C[D],B[D])}else{if(typeof C[D]!=="undefined"){C[D]=B[D]}}});return C}function u(C,B){w(k(B),function(D){if(r(C[D])&&r(B[D])&&!A(C[D])){u(C[D],B[D])}else{C[D]=B[D]}});return C}function z(D,C){for(var B=0;B<D.length;B++){if(!C(D[B])){return false}}return true}function f(I,G,F,E){if(G instanceof Array){for(var C=0;C<G.length;C++){f(I,G[C],F,E)}}else{var H=G.split(".")[0];var B=G.split(".")[1]||null;var D=function(J){if(F.call(E?E:I,J)===false){J.stopPropagation();J.preventDefault()}};if(!I.__events){I.__events={}}I.__events=I.__events||{};I.__events[H]=I.__events[H]||[];I.__events[H].push({tag:B,handler:D});I.addEventListener(H,D,false)}}function y(G,E){if(E instanceof Array){for(var D=0;D<E.length;D++){y(G,E[D])}}else{var F=E.split(".")[0];var B=E.split(".")[1]||null;var C=G.__events[F];for(var D=0;D<C.length;D++){if(C[D]&&(B===null||C[D].tag==B)){G.removeEventListener(F,C[D].handler,false);C[D]=null}}}}function g(B){var C=document.createElement("DIV");C.innerHTML=B;return C.firstChild}function v(){var B=navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin.description;return !!B}function s(D,B){var C={};w(document.cookie.split(";"),function(E){var F=E.split("=");if(F.length==2){C[F[0].trim()]=F[1].trim()}});return C[D]&&!isNaN(C[D])?C[D]:B}function o(B,C){document.cookie=B+"="+C+"; path=/"}function e(C,E){var B=this;var D=new XMLHttpRequest();D.onreadystatechange=function(){if(D.readyState==4){E(D.status==200,D)}};D.open("GET",C,true);D.send(null);return D}function d(){var B,C={};if(B=navigator.userAgent.match(/\bandroid\s(\d+)\.(\d+)\.(\d+)\b/i)){C.is_android=true;C.version=[B[1],B[2],B[3]]}else{if(/iPad/.test(navigator.platform)){C.is_ipad=true}}C.is_mobile=C.is_android||C.is_ipad;return C}CustomObject={proxy:function(C,D){if(C instanceof Array){for(var B=0;B<C.length;B++){this.proxy(C[B],D)}}else{this.on(C,function(){var E=Array.prototype.splice.call(arguments,1);D.trigger.apply(D,[C].concat(E))})}},on:function(F,E,D){var B=this;this._handlers=this._handlers||{};if(F instanceof Array){for(var C=0;C<F.length;C++){this.on(F[C],E,D)}}else{if(typeof this._handlers[F]==="undefined"){this._handlers[F]=[]}this._handlers[F].push({_id:this._handlers[F].length,handler:E,scope:D||this,remove:function(){B._handlers[F][this._id]=null}})}return this},trigger:function(F){this._handlers=this._handlers||{};var D=Array.prototype.splice.call(arguments,1);var B=(this._handlers[F]||[]).concat(this._handlers["*"]||[]);for(var E=0;E<B.length;E++){if(h=B[E]){var C=h.handler.apply(h.scope,[{type:F,handler:h}].concat(D));if(C===false){break}}}return this}};function x(B,D){this.root=B;this.is_show_poster=false;this.is_loading=false;this.is_playing=false;this.is_muted=false;this.is_start_load=false;this.duration=null;this.sources=[];this._handlers={};this._plugins={};this.conf={baseCSSClass:"customPlayer",muted:false,autoplay:false,sources:[],plugins:{},defaultVolume:1,allow_backends:k(this.__backends),cookieKeyVolume:null,backend_options:{flash_swf:D.flash_swf||"video.swf",useDefaultControls:false}};q(this.conf,D);j(this.root,this.conf.baseCSSClass);if(this.conf.plugins){this._initPlugins(this.conf.plugins)}if(this.conf.sources){this.setSources(this.conf.sources)}var C=this;setTimeout(function(){C._init()},0)}x.prototype=u(Object.create(CustomObject),{__backends:{},__plugins:{},_init:function(){var B=this;if(this.conf.autoplay){B.play()}if(this.conf.cookieKeyVolume){this.setVolume(s(this.conf.cookieKeyVolume,this.conf.defaultVolume))}else{this.setVolume(this.conf.defaultVolume)}if(this.conf.muted){this.mute()}},_destroyBackend:function(){if(this.backend){this.backend.destroy();this.root.removeChild(this.backend.getElement())}},_initBackend:function(D){var B=this;this.trigger("waiting");if(!(this.backend instanceof D)){if(this.backend){this._destroyBackend()}this.backend=new D(this.conf.backend_options);this.backend.on("play",function(){B.is_playing=true});this.backend.on("pause",function(){B.is_playing=false});this.backend.on("ended",function(){B.is_playing=false});this.backend.on("error",function(G,F,E){B.error(F,E)});this.backend.on("timeupdate",function(F,E){B.trigger("timeupdate",E,B.getDuration())});this.backend.on("ready",function(){this.setVolume(B.volume+0.1);this.setVolume(B.volume-0.1);this.setVolume(B.volume)});this.backend.proxy(["waiting","playing","seeking","seeked","progress","ended","volumechange","play","canplay","pause"],this);this.backend.init();var C=this.backend.getElement();C.style.width="100%";C.style.height="100%";C.style.position="absolute";C.style.left=0;C.style.top=0;this.root.appendChild(C);this.trigger("backendchange",this.backend)}},_initSources:function(F){var C=this.conf?this.conf.allow_backends:k(this.__backends);var B=this.__backends;for(var G=0;G<C.length;G++){var E=C[G];if(typeof B[E]==="undefined"){continue}for(var D=0;D<F.length;D++){if(B[E].prototype.isSupported()&&B[E].prototype.canPlayType(F[D].type)){this._initBackend(B[E]);this.source=F[D];this.trigger("sourcechange",this.source);return true}}}return false},_initPlugins:function(C){for(var B in C){if(C[B]&&(typeof C[B].enabled==="undefined"||C[B].enabled)){this._plugins[B]=new this.__plugins[B](this,C[B])}}},getWidth:function(){return this.root.offsetWidth},getHeight:function(){return this.root.offsetHeight},supportMedia:function(F){var C=this.conf?this.conf.allow_backends:k(this.__backends);var B=this.__backends;for(var E=0;E<C.length;E++){var D=C[E];if(typeof B[D]==="undefined"){continue}if(B[D].prototype.isSupported()&&B[D].prototype.canPlayType(F)){return true}}return false},destroy:function(){if(this.backend){this._destroyBackend();this.backend=null}this._handlers={};this.root.parentElement.removeChild(this.root);return this},decodeErrorCode:function(B){var C={100:"We are working to fix this as soon as possible. Thanks for patience.",101:"Your browser can not reproduce this video. Please update your browser for the best viewing experience.",102:"Oops, try again! There is no video.",200:"We are working to fix this as soon as possible. Thanks for patience.",201:"Video temporarily is unavailable, please try again later."};return C[B]||"Unknown error"},error:function(C,B){this.trigger("error",C,B||this.decodeErrorCode(C))},setSources:function(B){if(B&&B.length){if(this.is_playing){this.pause()}this.source=null;this.sources=B}else{this.error(102)}return this},load:function(){var B=this;if(this.sources&&this.sources.length){if(this._initSources(this.sources)){if(this.backend.is_ready){this.backend.setSource(B.source.src,B.source.type)}else{this.backend.on("ready",function(C){C.handler.remove();this.setSource(B.source.src,B.source.type)})}this.is_start_load=true}else{this.error(101)}}else{this.error(102)}},play:function(){if(!this.is_playing){this.is_playing=true;if(this.is_start_load){this.backend.play()}else{this.on("canplay",function(B){B.handler.remove();this.backend.play()});this.load()}}return this},pause:function(){if(this.is_playing){this.backend.pause();this.is_playing=false}return this},getVolume:function(){if(this.backend){this.volume=this.backend.getVolume()}return this.volume},setVolume:function(B){this.volume=Math.min(1,Math.max(0,B));if(this.conf.cookieKeyVolume){o(this.conf.cookieKeyVolume,this.volume)}this.trigger("volumechange",this.volume);if(this.backend){this.backend.setVolume(this.volume)}},mute:function(){this._old_volume=this.getVolume();this.setVolume(0)},unmute:function(){this.setVolume(this._old_volume||1)},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},setProgress:function(B){var C=this.getDuration()/100*B;this.backend.setCurrentTime(C)},getProgress:function(){if(this.backend){return this.getCurrentTime()/this.getDuration()*100}else{return 0}}});(function(){var B=document.createElement("STYLE");B.innerHTML='.customPlayer {position: relative;outline: none;background: #000;z-index: 0;font: 400 14px/1.2 \'Roboto\', sans-serif;overflow: hidden;}.customPlayer.fullscreen {position: absolute;top: 0;left: 0;width: 100% !important;height: 100% !important;}.customPlayer .ui {position: absolute;left: 0;top: 0;right: 0;bottom: 0;z-index: 100;outline: none;}.customPlayer .no-animate,.customPlayer .no-animate *{transition: none !important;}.customPlayer .ui > .loader {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui > .loader.hide {opacity: 0;}.customPlayer .ui > .error.fatal {position: absolute;display: table;top: 0;left: 0;width: 100%;height: 100%;color: rgb(255, 82, 82);font-size: 20pt;text-align: center;z-index: 1000;background: #000;}.customPlayer .ui > .error>div {display: table-cell;vertical-align: middle;}.customPlayer .ui .start-screen {position: absolute;left: 0;top: 0;width: 100%;height: 100%;z-index: 10;cursor: pointer;background-color: black;opacity: 1;transition: opacity ease .5s;}.customPlayer .ui .start-screen.hide {opacity: 0;}.customPlayer .ui .start-screen > .poster {position: absolute;left: 0;top: 0;width: 100%;height: 100%;background-repeat: no-repeat;background-position: 50% 50%;background-size: contain;opacity: 1;transition: opacity ease .7s;}.customPlayer .ui .start-screen > .poster.hide {opacity: 0;}.customPlayer .ui .start-screen svg {position: absolute;width: 40%;height: 40%;left: 30%;top: 30%;}.customPlayer .ui .start-screen:hover svg > path {fill: rgba(255,255,255,0.9);}.customPlayer .ui>.controls {position: absolute;left: 0px;right: 0px;bottom: 0px;height: 69px;background: none;background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAABFCAYAAACL3IzzAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjBCQUNBRUVFNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjBCQUNBRUVGNjM5QjExRTVBQjkzRDJCRDQyRkU1MEE0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MEJBQ0FFRUM2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MEJBQ0FFRUQ2MzlCMTFFNUFCOTNEMkJENDJGRTUwQTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4PyzKNAAAAbElEQVR42myPUQ6AMAhDK9u1jB/e/0xV6NaQ6M/SBy0w3NcZAfAIEBEECvNJJLaqGjGMw4lUSgzjVlVLxAdnjk9lM9+aUKrmcWqvVI+5oZgbZeH0yo4yr/vWvIZ90TpIX9Xh8NCfmxfK/AgwACr2StbF5TFoAAAAAElFTkSuQmCC\');opacity: 0;transition: opacity ease .3s;z-index: 9;}.customPlayer .ui>.controls.show {opacity: 1;}.customPlayer .ui>.controls svg {width: 100%;height: 100%;fill: #FFFFFF;}.customPlayer .ui>.controls *:hover>svg {fill: #FCC010;}.customPlayer .ui>.controls .play-pause {position: absolute;left: 20px;bottom: 10px;cursor: pointer;width: 24px;height: 24px;overflow: hidden;}.customPlayer .ui>.controls .play-pause path.play {display: block;}.customPlayer .ui>.controls .play-pause path.pause {display: none;}.customPlayer .ui.playing>.controls .play-pause path.play {display: none;}.customPlayer .ui.playing>.controls .play-pause path.pause {display: block;}.customPlayer .ui>.controls .timer {position: absolute;bottom: 12px;left: 50px;color: #fff;font-size: 12px;padding: 0;line-height: 20px;height: 20px;vertical-align: middle;}.customPlayer .ui>.controls .time-label {position: absolute;color: #fff;background: #000;border-radius: 5px;padding: 5px 10px;text-align: center;bottom: 60px;opacity: 0;cursor: default;transition: opacity ease .5s;}.customPlayer .ui>.controls .time-label:after {content: "";position: absolute;width: 0;height: 0;top: 100%;left: 50%;border-style: solid;border-color: transparent;border-width: 5px;border-top-color: #000;margin-left: -5px;}.customPlayer .ui>.controls .time-label.show {opacity: 1;}.customPlayer .ui.small-mode>.controls .time-label {bottom: 75px;font-size: 20px;}.customPlayer .ui>.controls .progress {position: absolute;left: 0px;right: 0px;bottom: 45px;height: 17px;background: none;cursor: pointer;border-bottom: 5px solid rgba(108, 108, 108, 0.5);z-index: 0;}.customPlayer .ui>.controls .progress.readonly {border-bottom-width: 2px;cursor: default;}.customPlayer .ui>.controls .progress .load {position: absolute;height: 5px;left: 0;bottom: -5px;background: rgba(154, 154, 156, 0.5);z-index: 0;transition: width ease .3s;}.customPlayer .ui>.controls .progress.readonly .load {height: 2px;bottom: -2px;}.customPlayer .ui>.controls .progress .play {position: absolute;left: 0;bottom: -5px;height: 5px;background: #FCC010;z-index: 10;transition: width ease .3s;}.customPlayer .ui>.controls .progress.readonly .play {background: #BEBEBE;height: 2px;bottom: -2px;}.customPlayer .ui>.controls .progress.readonly .play:after {display: none;}.customPlayer .ui>.controls .progress .play:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 0px;height: 0px;border: none;margin: 3px 0 0 0;transition:margin ease .3s,width ease .3s,height ease .3s;}.customPlayer .ui>.controls .progress:hover .play:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}.customPlayer .ui>.controls .tray {position: absolute;bottom: 0px;right: 0px;height: 45px;white-space: nowrap;}.customPlayer .ui>.controls .tray > *{position: relative;width: 24px;height: 24px;margin: 10px;display: inline-block;cursor: pointer;vertical-align: middle;box-sizing: content-box;}.customPlayer .ui>.controls .volume svg {width: 24px;height: 24px;}.customPlayer .ui>.controls .volume svg .mute {display: none;}.customPlayer .ui.muted>.controls .volume svg .unmute {display: none;}.customPlayer .ui.muted>.controls .volume svg .mute {display: block;}.customPlayer .ui>.controls .volume {position: relative;outline: none;width: 120px;}.customPlayer .ui>.controls .volume .vlevel{display: none;position: absolute;width: 100%;box-sizing: border-box;height: 100px;bottom: 100%;left: 0px;border-width: 10px 10px 0 10px;border-style: solid;border-color: rgba(0,0,0,0.3);}.customPlayer .ui>.controls .volume .vlevel:before {position: absolute;content: "";left: 0;top: 0;width: 100%;height: 100%;background: rgba(154, 154, 156, 0.5);}.customPlayer .ui>.controls .volume .vlevel>.value{position: absolute;bottom: 0px;left: 0px;background: #fff;width: 100%;height: 100%;}.customPlayer .ui>.controls .volume .level{position: absolute;right: 5px;left: 40px;top: 50%;margin-top: -13px;height: 5px;border-style: solid;border-color: rgba(0,0,0,0);border-width: 10px 0;}.customPlayer .ui>.controls .volume .level:before {content: "";position: absolute;width: 100%;left: 0;top: 0;height: 5px;background: rgba(108, 108, 108, 0.5);}.customPlayer .ui>.controls .volume .level>.value{position: absolute;left: 0;width: 100%;height: 100%;background: #FFFFFF;transition: width ease .3s;}.customPlayer .ui>.controls .volume .level>.value:after {content: "";position: absolute;right: 0px;top: 0px;background: inherit;border-radius: 50%;width: 0px;height: 0px;border: none;margin: 3px 0 0 0;transition:margin ease .3s,width ease .3s,height ease .3s;}.customPlayer .ui>.controls .volume:hover .level>.value:after {width: 12px;height: 12px;margin: -3px -6px 0 0;}.customPlayer .ui.small-mode > .controls .progress {border-bottom-width: 20px;}.customPlayer .ui.small-mode > .controls .progress .load {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play {height: 20px;bottom: -20px;}.customPlayer .ui.small-mode > .controls .progress .play:after {display: none;content: "";position: absolute;right: -8px;top: 0px;height: 100%;width: 16px;background: #fff;border: none;margin: 0;border-radius: 0;}.customPlayer .ui.small-mode > .controls .volume {width: 24px;background: rgba(0,0,0,0);transition: background ease .5s;}.customPlayer .ui.small-mode > .controls .volume .vlevel{display: block;height: 0;border-top-width: 0; transition:border ease .3s,height ease .3s;}.customPlayer .ui.small-mode > .controls .volume .level{display: none;}.customPlayer .ui.small-mode > .controls .volume:focus {background: rgba(0,0,0,0.3);}.customPlayer .ui.small-mode > .controls .volume:focus .vlevel{border-top-width: 10px; height: 100px;}.customPlayer.fullscreen > .ui .tray .big {display: none;}.customPlayer > .ui.small-mode .tray .big {display: none;}';document.head.appendChild(B)})();window.TouchEvent=window.TouchEvent||function(){};function n(C,B){this.conf=u({progress:{show:true,readonly:false},timer:{show:true},poster:null},B);this.player=C;this.duration;this.is_show_start_screen=true;this.is_first_play=true;this.is_played=false;this.is_muted=false;this.dom=g('<div class="ui" tabindex="0" style="background:rgba(0,0,0,0)"><div class="loader"><svg viewBox="0 0 160 160" style="width:100%; height:100%"><circle cx="80" cy="80" r="75" fill="rgba(0, 0, 0, 0.5)" stroke="rgba(255, 255, 255, 0.1)" stroke-width="2" /><circle cx="80" cy="80" r="65" stroke="rgba(255, 255, 255, 0.5)" stroke-width="10" fill="transparent" /></svg></div><div class="start-screen"><div class="poster hide"></div><svg viewBox="0 0 160 160"><circle cx="80" cy="80" r="80" fill="rgba(0, 0, 0, 0.3)" /><path transform="translate(10, -14)" fill="rgba(255, 255, 255, 0.6)" d="M70,32.7c33.8,0,61.2,27.5,61.2,61.2c0,33.8-27.5,61.2-61.2,61.2c-33.8,0-61.2-27.5-61.2-61.2C8.7,60.2,36.2,32.7,70,32.7 M70,24C31.3,24,0,55.3,0,94c0,38.7,31.3,70,70,70c38.7,0,70-31.3,70-70C140,55.3,108.7,24,70,24L70,24z M59,73.4L94.7,94L59,114.6V73.4 M50.2,58.2v71.6l62-35.8L50.2,58.2L50.2,58.2z"/></svg></div><div class="controls"><div class="time-label"></div><div class="progress"><div class="load"></div><div class="play"></div></div><div class="play-pause"><svg><path class="play" transform="translate(-24, 0)" d="M26,0v24l20-12L26,0L26,0z"/><path class="pause" transform="translate(0, 0)" d="M3.5,0h7v24h-7V0z M13.5,0h7v24h-7V0z"/></svg></div><div class="timer"></div><div class="tray"><div class="volume" tabindex="0"><svg><g class="unmute" transform="translate(-48, 0)"><path d="M64.7,2.1L56.3,7h-5.8C49.7,7,49,7.7,49,8.5v7c0,0.8,0.7,1.5,1.5,1.5h5.8l8.4,4.9c1,0.6,2.3-0.1,2.3-1.3V3.4C67,2.3,65.7,1.6,64.7,2.1z"/><path d="M70.4,6.8c-0.1-0.5-0.7-0.9-1.2-0.8c-0.5,0.1-0.9,0.7-0.8,1.2C68.8,8.8,69,10.4,69,12s-0.2,3.2-0.5,4.7c-0.1,0.5,0.2,1.1,0.8,1.2c0.1,0,0.1,0,0.2,0c0.5,0,0.9-0.3,1-0.8c0.4-1.7,0.6-3.4,0.6-5.2S70.8,8.5,70.4,6.8z"/></g><path class="mute" transform="translate(-72, 0)" d="M73,15.5v-7C73,7.7,73.7,7,74.5,7h5.8l8.4-4.9c0.7-0.4,1.5-0.2,1.9,0.4L76.2,17h-1.7C73.7,17,73,16.3,73,15.5z M93.2,6.1c-0.5,0.1-0.9,0.7-0.8,1.2C92.8,8.8,93,10.4,93,12s-0.2,3.2-0.5,4.7c-0.1,0.5,0.2,1.1,0.8,1.2c0.1,0,0.1,0,0.2,0c0.5,0,0.9-0.3,1-0.8c0.4-1.7,0.6-3.4,0.6-5.2s-0.2-3.5-0.6-5.2C94.3,6.3,93.8,6,93.2,6.1z M81.3,17.6l7.5,4.3c1,0.6,2.3-0.1,2.3-1.3V7.8L81.3,17.6z M74.7,22.7l20-20c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-20,20c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3S74.5,22.9,74.7,22.7z"/></svg><div class="vlevel"><div class="value"></div></div><div class="level"><div class="value"></div></div></div></div></div></div>');this.loader=this.dom.getElementsByClassName("loader")[0];this.start_screen=this.dom.getElementsByClassName("start-screen")[0];this.start_screen.poster=this.start_screen.getElementsByClassName("poster")[0];this.controls=this.dom.getElementsByClassName("controls")[0];this.controls.time_label=this.controls.getElementsByClassName("time-label")[0];this.controls.timer=this.controls.getElementsByClassName("timer")[0];this.controls.play_pause_btn=this.controls.getElementsByClassName("play-pause")[0];this.controls.tray=this.controls.getElementsByClassName("tray")[0];this.controls.tray.volume=this.controls.tray.getElementsByClassName("volume")[0];this.controls.tray.mute=this.controls.tray.volume.getElementsByTagName("svg")[0];this.controls.tray.volume.level=this.controls.tray.volume.getElementsByClassName("level")[0];this.controls.tray.volume.level.value=this.controls.tray.volume.level.getElementsByClassName("value")[0];this.controls.tray.volume.vlevel=this.controls.tray.volume.getElementsByClassName("vlevel")[0];this.controls.tray.volume.vlevel.value=this.controls.tray.volume.vlevel.getElementsByClassName("value")[0];this.controls.progress=this.controls.getElementsByClassName("progress")[0];this.controls.progress.load=this.controls.progress.getElementsByClassName("load")[0];this.controls.progress.play=this.controls.progress.getElementsByClassName("play")[0];this.init()}n.prototype=u(Object.create(CustomObject),{getElement:function(){return this.dom},init:function(){this.initUI();this.initPlayerEvents();this.initUIEvents();this.initEasterEgg();this.initAdaptive();if(this.conf.poster){var C=this;var B=new Image;B.addEventListener("load",function(){C.start_screen.poster.style.backgroundImage="url("+C.conf.poster+")";l(C.start_screen.poster,"hide")});B.src=this.conf.poster}this.controls.tray.volume.level.value.style.width=this.player.volume*100+"%";this.controls.style.display="none";this.hideLoader();if(this.conf.progress.readonly){j(this.controls.progress,"readonly")}if(!this.conf.progress.show){this.controls.progress.style.display="none"}if(!this.conf.timer.show){this.controls.timer.style.display="none"}this.player.trigger("tray_ready",this.controls.tray)},initAdaptive:function(){var B=this;setInterval(function(){var D=B.dom.offsetWidth;if(D==0){return}var C=D>0&&D<=480;if(B.is_small_mode!=C){B.player.trigger("change_small_mode",C);if(C){j(B.dom,"small-mode")}else{l(B.dom,"small-mode")}}B.is_small_mode=C},1000)},initUI:function(){var D=this;this.on("play",function(){if(D.is_first_play){D.hideStartScreen();D.is_first_play=false}});f(this.dom,"dblclick",function(G){if(G.target==D.dom){D.trigger("fullscreentoggle")}});f(this.dom,"selectstart",function(){return false});f(this.start_screen,"click",function(G){D.trigger("play")});f(this.dom,["mousedown","mouseup"],function(G){if(G.target==D.dom){if(G.type=="mousedown"){this._click_start=G.timeStamp}if(G.type=="mouseup"){if((G.timeStamp-this._click_start)<300){if(D.is_active){D.trigger(D.is_played?"pause":"play")}}}}});f(this.dom,"keydown",function(G){if(G.keyCode==32){D.trigger(D.is_played?"pause":"play");return false}});f(this.dom,"click",function(G){D.trigger("user_active")});f(this.dom,["mousemove","touchmove"],function(G){if(G.timeStamp-this._last_move<500){D.trigger("user_active")}this._last_move=G.timeStamp});f(this.controls.play_pause_btn,"click",function(){D.trigger(D.is_played?"pause":"play")});if(!this.conf.progress.readonly){var E=this.controls.progress;var B=this.controls.time_label;var C=function(I){var G=I-E.getBoundingClientRect().left;var J=D.duration*(G/E.offsetWidth);var H=B.offsetWidth;B.style.left=Math.max(0,Math.min(E.offsetWidth-H,G-(H/2)))+"px";B.innerHTML=D.formatTime(J);clearTimeout(B._t);j(B,"show")};f(E,["mousedown","touchstart"],function(G){if(G instanceof TouchEvent||G.which==1){D.hold_progress=true;var H=E.getBoundingClientRect().left;f(document,["mousemove.progress","touchmove.progress"],function(J){var I=J instanceof TouchEvent?J.changedTouches[0].clientX:J.clientX;j(E,"no-animate");E.play.style.width=Math.max(0,Math.min(100,(I-H)/E.offsetWidth*100))+"%";C(I);return false});f(document,["mouseup.progress","touchend.progress"],function(K){var J=E.offsetWidth;if(J){var I=K instanceof TouchEvent?K.changedTouches[0].clientX:K.clientX;D.hold_progress=false;var L=Math.max(0,Math.min(1,(I-H)/J));l(E,"no-animate");D.trigger("positionchange",L)}y(document,["mousemove.progress","mouseup.progress","touchmove.progress","touchend.progress"]);clearTimeout(B._t);B._t=setTimeout(function(){l(B,"show")},2000)})}});f(E,"mouseout",function(G){l(B,"show")});f(E,"mousemove",function(G){C(G.clientX)})}if(/iPad/.test(navigator.platform)){this.controls.tray.volume.style.display="none"}else{(function(G){f(G,["mousedown","touchstart"],function(I){if(I instanceof TouchEvent||I.which==1){var H=I instanceof TouchEvent?I.changedTouches[0].clientX:I.clientX;var J=G.getBoundingClientRect().left;D.trigger("volumechange",(H-J)/G.offsetWidth);f(document,["mousemove.volume","touchmove.volume"],function(L){var K=L instanceof TouchEvent?L.changedTouches[0].clientX:L.clientX;j(G,"no-animate");D.trigger("volumechange",(K-J)/G.offsetWidth);return false});f(document,["mouseup.volume","touchend.volume"],function(K){l(G,"no-animate");y(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})}})})(this.controls.tray.volume.level);(function(G){f(G,["mousedown","touchstart"],function(I){var J=I instanceof TouchEvent?I.changedTouches[0].clientY:I.clientY;var H=G.getBoundingClientRect().bottom;D.trigger("volumechange",(H-J)/(G.offsetHeight-10));f(document,["mousemove.volume","touchmove.volume"],function(K){var L=K instanceof TouchEvent?K.changedTouches[0].clientY:K.clientY;j(G,"no-animate");D.trigger("volumechange",(H-L)/(G.offsetHeight-10));return false});f(document,["mouseup.volume","touchend.volume"],function(K){l(G,"no-animate");y(document,["mousemove.volume","mouseup.volume","touchend.volume","touchmove.volume"])})})})(this.controls.tray.volume.vlevel);var F=this.controls.tray.mute;f(F,"click",function(){if(D.is_small_mode){D.controls.tray.volume.focus()}else{D.trigger(D.is_muted?"unmute":"mute")}})}},initUIEvents:function(){var C=this;var B,D;this.on("user_active",function(){C.is_active=true;j(C.controls,"show");l(C.controls,"hide");C.controls.style.display="";clearTimeout(B);clearTimeout(D);B=setTimeout(function(){C.is_active=false;j(C.controls,"hide");l(C.controls,"show");D=setTimeout(function(){C.controls.style.display="none"},500)},3000)})},initPlayerEvents:function(){var B=this;this.player.on(["waiting","seeking"],function(C){B.showLoader()});this.player.on(["playing","seeked"],function(C){B.hideLoader()});this.player.on("error",function(E,D,C){B.showError("("+D+") "+C)});this.player.on("play",function(){B.is_played=true;B.hideStartScreen();l(B.dom,"paused");j(B.dom,"playing");B.controls.play_pause_btn.title="Pause"});this.player.on("pause",function(){B.is_played=false;j(B.dom,"paused");l(B.dom,"playing");B.controls.play_pause_btn.title="Play"});this.player.on("ended",function(){B.showStartScreen();B.trigger("exitfullscreen");B.is_played=false;B.is_first_play=true});this.player.on("timeupdate",function(E,D,C){B.time=D;B.duration=C;if(B.duration){if(!B.hold_progress){B.controls.progress.play.style.width=(D/B.duration*100)+"%"}}if(D>0){B.controls.timer.innerHTML=B.formatTime(D)+" / "+B.formatTime(B.duration)}B.updateLoader()});this.player.on("progress",function(C,D){B.buffer=D;B.updateLoader()});this.player.on("volumechange",function(D,C){B.is_muted=C==0;if(B.is_muted){j(B.dom,"muted")}else{l(B.dom,"muted")}B.controls.tray.volume.level.value.style.width=(C*100)+"%";B.controls.tray.volume.vlevel.value.style.height=(C*100)+"%"})},updateLoader:function(){if(this.buffer){for(var C=0;C<this.buffer.length;C++){var D=this.buffer[C][0];var B=this.buffer[C][1];if(this.time>D&&this.time<B){this.controls.progress.load.style.width=(B/this.duration*100)+"%";break}}}},hideStartScreen:function(){if(!this.is_show_start_screen){return}var B=this;this.controls.style.display="";j(this.start_screen,"hide");this.is_show_start_screen=false;setTimeout(function(){B.start_screen.style.display="none"},1000)},showStartScreen:function(){if(this.is_show_start_screen){return}var B=this;this.controls.style.display="none";this.start_screen.style.display="";this.is_show_start_screen=true;setTimeout(function(){l(B.start_screen,"hide")},100)},hideLoader:function(){if(!this.is_show_loader){return}var B=this;this.is_show_loader=false;j(this.loader,"hide");setTimeout(function(){if(!B.is_show_loader){B.loader.style.display="none"}},500)},showLoader:function(){if(this.is_show_loader){return}var B=this;this.is_show_loader=true;setTimeout(function(){if(B.is_show_loader){B.loader.style.display="";setTimeout(function(){l(B.loader,"hide")},100)}},500);var C=this.loader.getElementsByTagName("circle");(function(){C[0].setAttribute("r",((Math.sin((new Date)/100)+1)/4+0.5)*75);C[1].setAttribute("r",((Math.sin((new Date-100)/100)+1)/4+0.5)*65);if(B.is_show_loader||B.loader.style.display!="none"){setTimeout(arguments.callee,30)}})()},showError:function(B){this.dom.appendChild(g('<div class="error fatal"><div>'+B+"</div></div>"))},formatTime:function(E){var D=this.duration>=3600;var F=Math.ceil(E||0);var B=(F/3600)|0;F-=B*3600;var C=(F/60)|0;F-=C*60;return(D?("0"+B).substr(-2)+":":"")+("0"+C).substr(-2)+":"+("0"+F).substr(-2)},initEasterEgg:function(){var C=[];var B=this;f(this.dom,"keydown",function(F){C.push(F.keyCode)>6?C.shift():null;if(C.join(":")==="65:78:73:83:83:65"){var D=[1071,1053,1040,44,32,1071,32,1058,1045,1041,1071,32,1051,1070,1041,1051,1070,33,33,33];for(var E=0;E<D.length;E++){(function(G,I){var H=g('<div style="position:absolute;color:white;opacity:0.6;font-weight:bold;text-shadow:0 0 5px #000">'+I+"<div>");(function(){H.style.left=(G)+"%";H.style.top=50+(Math.sin(G/15)*30)+"%";H.style.fontSize=((0.5+(Math.sin(G/10)+1)/4)*35)+"px";if(G<-10){B.dom.removeChild(H)}else{G-=0.5;setTimeout(arguments.callee,30)}})();B.dom.appendChild(H)})(100+E*4,String.fromCharCode(D[E]))}}})}});HTML5Backend=(function(){!function(D){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=D()}else{if("function"==typeof define&&define.amd){define([],D)}else{var C;"undefined"!=typeof window?C=window:"undefined"!=typeof global?C=global:"undefined"!=typeof self&&(C=self),C.Hls=D()}}}(function(){var F,D,C;return(function E(H,L,J){function I(Q,O){if(!L[Q]){if(!H[Q]){var N=typeof require=="function"&&require;if(!O&&N){return N(Q,!0)}if(G){return G(Q,!0)}var P=new Error("Cannot find module '"+Q+"'");throw P.code="MODULE_NOT_FOUND",P}var M=L[Q]={exports:{}};H[Q][0].call(M.exports,function(R){var S=H[Q][1][R];return I(S?S:R)},M,M.exports,E,H,L,J)}return L[Q].exports}var G=typeof require=="function"&&require;for(var K=0;K<J.length;K++){I(J[K])}return I})({1:[function(K,L,I){function M(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}L.exports=M;M.EventEmitter=M;M.prototype._events=undefined;M.prototype._maxListeners=undefined;M.defaultMaxListeners=10;M.prototype.setMaxListeners=function(O){if(!J(O)||O<0||isNaN(O)){throw TypeError("n must be a positive number")}this._maxListeners=O;return this};M.prototype.emit=function(T){var U,S,O,P,Q,R;if(!this._events){this._events={}}if(T==="error"){if(!this._events.error||(G(this._events.error)&&!this._events.error.length)){U=arguments[1];if(U instanceof Error){throw U}throw TypeError('Uncaught, unspecified "error" event.')}}S=this._events[T];if(H(S)){return false}if(N(S)){switch(arguments.length){case 1:S.call(this);break;case 2:S.call(this,arguments[1]);break;case 3:S.call(this,arguments[1],arguments[2]);break;default:O=arguments.length;P=new Array(O-1);for(Q=1;Q<O;Q++){P[Q-1]=arguments[Q]}S.apply(this,P)}}else{if(G(S)){O=arguments.length;P=new Array(O-1);for(Q=1;Q<O;Q++){P[Q-1]=arguments[Q]}R=S.slice();O=R.length;for(Q=0;Q<O;Q++){R[Q].apply(this,P)}}}return true};M.prototype.addListener=function(P,Q){var O;if(!N(Q)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",P,N(Q.listener)?Q.listener:Q)}if(!this._events[P]){this._events[P]=Q}else{if(G(this._events[P])){this._events[P].push(Q)}else{this._events[P]=[this._events[P],Q]}}if(G(this._events[P])&&!this._events[P].warned){var O;if(!H(this._maxListeners)){O=this._maxListeners}else{O=M.defaultMaxListeners}if(O&&O>0&&this._events[P].length>O){this._events[P].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[P].length);if(typeof console.trace==="function"){console.trace()}}}return this};M.prototype.on=M.prototype.addListener;M.prototype.once=function(O,Q){if(!N(Q)){throw TypeError("listener must be a function")}var R=false;function P(){this.removeListener(O,P);if(!R){R=true;Q.apply(this,arguments)}}P.listener=Q;this.on(O,P);return this};M.prototype.removeListener=function(Q,T){var S,O,R,P;if(!N(T)){throw TypeError("listener must be a function")}if(!this._events||!this._events[Q]){return this}S=this._events[Q];R=S.length;O=-1;if(S===T||(N(S.listener)&&S.listener===T)){delete this._events[Q];if(this._events.removeListener){this.emit("removeListener",Q,T)}}else{if(G(S)){for(P=R;P-->0;){if(S[P]===T||(S[P].listener&&S[P].listener===T)){O=P;break}}if(O<0){return this}if(S.length===1){S.length=0;delete this._events[Q]}else{S.splice(O,1)}if(this._events.removeListener){this.emit("removeListener",Q,T)}}}return this};M.prototype.removeAllListeners=function(Q){var O,P;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[Q]){delete this._events[Q]}}return this}if(arguments.length===0){for(O in this._events){if(O==="removeListener"){continue}this.removeAllListeners(O)}this.removeAllListeners("removeListener");this._events={};return this}P=this._events[Q];if(N(P)){this.removeListener(Q,P)}else{while(P.length){this.removeListener(Q,P[P.length-1])}}delete this._events[Q];return this};M.prototype.listeners=function(P){var O;if(!this._events||!this._events[P]){O=[]}else{if(N(this._events[P])){O=[this._events[P]]}else{O=this._events[P].slice()}}return O};M.listenerCount=function(Q,P){var O;if(!Q._events||!Q._events[P]){O=0}else{if(N(Q._events[P])){O=1}else{O=Q._events[P].length}}return O};function N(O){return typeof O==="function"}function J(O){return typeof O==="number"}function G(O){return typeof O==="object"&&O!==null}function H(O){return O===void 0}},{}],2:[function(J,K,H){var M=arguments[3];var I=arguments[4];var G=arguments[5];var L=JSON.stringify;K.exports=function(U){var Y=[];var V;var R=Object.keys(G);for(var Q=0,P=R.length;Q<P;Q++){var X=R[Q];if(G[X].exports===U){V=X;break}}if(!V){V=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var S={};for(var Q=0,P=R.length;Q<P;Q++){var X=R[Q];S[X]=X}I[V]=[Function(["require","module","exports"],"("+U+")(self)"),S]}var W=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var O={};O[V]=V;I[W]=[Function(["require"],"require("+L(V)+")(self)"),O];var N="("+M+")({"+Object.keys(I).map(function(Z){return L(Z)+":["+I[Z][0]+","+L(I[Z][1])+"]"}).join(",")+"},{},["+L(W)+"])";var T=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(T.createObjectURL(new Blob([N],{type:"text/javascript"})))}},{}],3:[function(H,G,J){Object.defineProperty(J,"__esModule",{value:true});var I=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function O(P){return P&&P.__esModule?P:{"default":P}}function K(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var L=H("../events");var M=O(L);var N=(function(){function R(U){K(this,R);this.hls=U;this.lastfetchlevel=0;this._autoLevelCapping=-1;this._nextAutoLevel=-1;this.onflp=this.onFragmentLoadProgress.bind(this);U.on(M["default"].FRAG_LOAD_PROGRESS,this.onflp)}I(R,[{key:"destroy",value:function Q(){this.hls.off(M["default"].FRAG_LOAD_PROGRESS,this.onflp)}},{key:"onFragmentLoadProgress",value:function S(V,W){var U=W.stats;if(U.aborted===undefined){this.lastfetchduration=(new Date()-U.trequest)/1000;this.lastfetchlevel=W.frag.level;this.lastbw=U.loaded*8/this.lastfetchduration;this._nextAutoLevel=-1}}},{key:"autoLevelCapping",get:function P(){return this._autoLevelCapping},set:function T(U){this._autoLevelCapping=U}},{key:"nextAutoLevel",get:function P(){var Y=this.lastbw,U=this.hls,W,V,X;if(this._autoLevelCapping===-1){X=U.levels.length-1}else{X=this._autoLevelCapping}if(this._nextAutoLevel!==-1){return Math.min(this._nextAutoLevel,X)}for(V=0;V<=X;V++){if(V<=this.lastfetchlevel){W=0.8*Y}else{W=0.7*Y}if(W<U.levels[V].bitrate){return Math.max(0,V-1)}}return V-1},set:function T(U){this._nextAutoLevel=U}}]);return R})();J["default"]=N;G.exports=J["default"]},{"../events":11}],4:[function(J,I,N){Object.defineProperty(N,"__esModule",{value:true});var M=(function(){function V(Z,X){for(var W=0;W<X.length;W++){var Y=X[W];Y.enumerable=Y.enumerable||false;Y.configurable=true;if("value" in Y){Y.writable=true}Object.defineProperty(Z,Y.key,Y)}}return function(Y,W,X){if(W){V(Y.prototype,W)}if(X){V(Y,X)}return Y}})();function U(V){return V&&V.__esModule?V:{"default":V}}function O(V,W){if(!(V instanceof W)){throw new TypeError("Cannot call a class as a function")}}var P=J("../events");var Q=U(P);var S=J("../utils/logger");var R=J("../demux/demuxer");var L=U(R);var H=J("../helper/level-helper");var G=U(H);var K=J("../errors");var T=(function(){function ac(aD){O(this,ac);this.ERROR=-2;this.STARTING=-1;this.IDLE=0;this.LOADING=1;this.WAITING_LEVEL=2;this.PARSING=3;this.PARSED=4;this.APPENDING=5;this.BUFFER_FLUSHING=6;this.config=aD.config;this.startPosition=0;this.hls=aD;this.onsbue=this.onSBUpdateEnd.bind(this);this.onsbe=this.onSBUpdateError.bind(this);this.onmse=this.onMSEAttached.bind(this);this.onmsed=this.onMSEDetached.bind(this);this.onmp=this.onManifestParsed.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onfl=this.onFragLoaded.bind(this);this.onis=this.onInitSegment.bind(this);this.onfpg=this.onFragParsing.bind(this);this.onfp=this.onFragParsed.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);aD.on(Q["default"].MSE_ATTACHED,this.onmse);aD.on(Q["default"].MSE_DETACHED,this.onmsed);aD.on(Q["default"].MANIFEST_PARSED,this.onmp)}M(ac,[{key:"destroy",value:function az(){this.stop();this.hls.off(Q["default"].MANIFEST_PARSED,this.onmp);this.state=this.IDLE}},{key:"startLoad",value:function ap(){if(this.levels&&this.video){this.startInternal();if(this.lastCurrentTime){S.logger.log("seeking @ "+this.lastCurrentTime);this.nextLoadPosition=this.startPosition=this.lastCurrentTime;if(!this.lastPaused){S.logger.log("resuming video");this.video.play()}this.state=this.IDLE}else{this.nextLoadPosition=this.startPosition;this.state=this.STARTING}this.tick()}else{S.logger.warn("cannot start loading as either manifest not parsed or video not attached")}}},{key:"startInternal",value:function aA(){var aD=this.hls;this.stop();this.demuxer=new L["default"](aD);this.timer=setInterval(this.ontick,100);this.level=-1;aD.on(Q["default"].FRAG_LOADED,this.onfl);aD.on(Q["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aD.on(Q["default"].FRAG_PARSING_DATA,this.onfpg);aD.on(Q["default"].FRAG_PARSED,this.onfp);aD.on(Q["default"].ERROR,this.onerr);aD.on(Q["default"].LEVEL_LOADED,this.onll)}},{key:"stop",value:function au(){this.mp4segments=[];this.flushRange=[];this.bufferRange=[];var aH=this.fragCurrent;if(aH){if(aH.loader){aH.loader.abort()}this.fragCurrent=null}this.fragPrevious=null;if(this.sourceBuffer){for(var aE in this.sourceBuffer){var aG=this.sourceBuffer[aE];try{this.mediaSource.removeSourceBuffer(aG);aG.removeEventListener("updateend",this.onsbue);aG.removeEventListener("error",this.onsbe)}catch(aF){}}this.sourceBuffer=null}if(this.timer){clearInterval(this.timer);this.timer=null}if(this.demuxer){this.demuxer.destroy();this.demuxer=null}var aD=this.hls;aD.off(Q["default"].FRAG_LOADED,this.onfl);aD.off(Q["default"].FRAG_PARSED,this.onfp);aD.off(Q["default"].FRAG_PARSING_DATA,this.onfpg);aD.off(Q["default"].LEVEL_LOADED,this.onll);aD.off(Q["default"].FRAG_PARSING_INIT_SEGMENT,this.onis);aD.off(Q["default"].ERROR,this.onerr)}},{key:"tick",value:function av(){var aM,aF,aW,aS;switch(this.state){case this.ERROR:break;case this.STARTING:this.startLevel=this.hls.startLevel;if(this.startLevel===-1){this.startLevel=0;this.fragBitrateTest=true}this.level=this.hls.nextLoadLevel=this.startLevel;this.state=this.WAITING_LEVEL;this.loadedmetadata=false;break;case this.IDLE:if(!this.video){break}if(this.loadedmetadata){aM=this.video.currentTime}else{aM=this.nextLoadPosition}if(this.startFragmentRequested===false){aF=this.startLevel}else{aF=this.hls.nextLoadLevel}var aT=this.bufferInfo(aM,0.3),a0=aT.len,aJ=aT.end,aQ;if(this.levels[aF].hasOwnProperty("bitrate")){aQ=Math.min(8*this.config.maxBufferSize/this.levels[aF].bitrate,this.config.maxBufferLength);aQ=Math.min(aQ,this.config.maxMaxBufferLength)}else{aQ=this.config.maxBufferLength}if(a0<aQ){this.hls.nextLoadLevel=aF;this.level=aF;aW=this.levels[aF].details;if(typeof aW==="undefined"){this.state=this.WAITING_LEVEL;break}var a2=aW.fragments,aY=a2.length,aK=a2[0].start,aI=a2[aY-1].start+a2[aY-1].duration,aX=undefined;if(aW.live){if(aJ<Math.max(aK,aI-this.config.liveMaxLatencyDurationCount*aW.targetduration)){this.seekAfterBuffered=aK+Math.max(0,aW.totalduration-this.config.liveSyncDurationCount*aW.targetduration);S.logger.log("buffer end: "+aJ+" is located too far from the end of live sliding playlist, media position will be reseted to: "+this.seekAfterBuffered.toFixed(3));aJ=this.seekAfterBuffered}if(this.startFragmentRequested&&!aW.PTSKnown){if(this.fragPrevious){var aE=this.fragPrevious.sn+1;if(aE>=aW.startSN&&aE<=aW.endSN){aX=a2[aE-aW.startSN];S.logger.log("live playlist, switching playlist, load frag with next SN: "+aX.sn)}}if(!aX){aX=a2[Math.round(aY/2)];S.logger.log("live playlist, switching playlist, unknown, load middle frag : "+aX.sn)}}}else{if(aJ<aK){aX=a2[0]}}if(!aX){if(aJ>aI){break}for(aS=0;aS<aY;aS++){aX=a2[aS];aK=aX.start;if(aK<=aJ&&aK+aX.duration>aJ){break}}if(this.fragPrevious&&aX.level===this.fragPrevious.level&&aX.sn===this.fragPrevious.sn){if(aS===aY-1){break}else{aX=a2[aS+1];S.logger.log("SN just loaded, load next one: "+aX.sn)}}}S.logger.log("Loading "+aX.sn+" of ["+aW.startSN+" ,"+aW.endSN+"],level "+aF+", currentTime:"+aM+",bufferEnd:"+aJ.toFixed(3));aX.autoLevel=this.hls.autoLevelEnabled;if(this.levels.length>1){aX.expectedLen=Math.round(aX.duration*this.levels[aF].bitrate/8);aX.trequest=new Date()}if(this.fragLoadIdx!==undefined){this.fragLoadIdx++}else{this.fragLoadIdx=0}if(aX.loadCounter){aX.loadCounter++;var a1=this.config.fragLoadingLoopThreshold;if(aX.loadCounter>a1&&Math.abs(this.fragLoadIdx-aX.loadIdx)<a1){this.hls.trigger(Q["default"].ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:false,frag:aX});return}}else{aX.loadCounter=1}aX.loadIdx=this.fragLoadIdx;this.fragCurrent=aX;this.startFragmentRequested=true;this.hls.trigger(Q["default"].FRAG_LOADING,{frag:aX});this.state=this.LOADING}break;case this.WAITING_LEVEL:aF=this.levels[this.level];if(aF&&aF.details){this.state=this.IDLE}break;case this.LOADING:var aR=this.video,aH=this.fragCurrent;if(aR&&(!aR.paused||this.loadedmetadata===false)&&aH.autoLevel&&this.level&&this.levels.length>1){var aP=new Date()-aH.trequest;if(aP>500*aH.duration){var aD=aH.loaded*1000/aP;if(aH.expectedLen<aH.loaded){aH.expectedLen=aH.loaded}aM=aR.currentTime;var aN=(aH.expectedLen-aH.loaded)/aD;var aV=this.bufferInfo(aM,0.3).end-aM;var aO=aH.duration*this.levels[this.hls.nextLoadLevel].bitrate/(8*aD);if(aV<2*aH.duration&&aN>aV&&aN>aO){S.logger.warn("loading too slow, abort fragment loading");S.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay :"+aN.toFixed(1)+"/"+aV.toFixed(1)+"/"+aO.toFixed(1));aH.loader.abort();this.hls.trigger(Q["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:aH});this.state=this.IDLE}}}break;case this.PARSING:break;case this.PARSED:case this.APPENDING:if(this.sourceBuffer){if(this.sourceBuffer.audio&&this.sourceBuffer.audio.updating||this.sourceBuffer.video&&this.sourceBuffer.video.updating){}else{if(this.mp4segments.length){var aG=this.mp4segments.shift();try{this.sourceBuffer[aG.type].appendBuffer(aG.data);this.appendError=0}catch(aL){S.logger.error("error while trying to append buffer:"+aL.message+",try appending later");this.mp4segments.unshift(aG);if(this.appendError){this.appendError++}else{this.appendError=1}var aZ={type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_APPENDING_ERROR,frag:this.fragCurrent};if(this.appendError>this.config.appendErrorMaxRetry){S.logger.log("fail "+this.config.appendErrorMaxRetry+" times to append segment in sourceBuffer");aZ.fatal=true;this.hls.trigger(Q["default"].ERROR,aZ);this.state=this.ERROR;return}else{aZ.fatal=false;this.hls.trigger(Q["default"].ERROR,aZ)}}this.state=this.APPENDING}}}else{this.state=this.IDLE}break;case this.BUFFER_FLUSHING:while(this.flushRange.length){var aU=this.flushRange[0];if(this.flushBuffer(aU.start,aU.end)){this.flushRange.shift()}else{break}}if(this.flushRange.length===0){if(this.immediateSwitch){this.immediateLevelSwitchEnd()}this.state=this.IDLE;this.fragPrevious=null}break;default:break}this._checkFragmentChanged()}},{key:"bufferInfo",value:function al(aL,aJ){var aM=this.video,aF=aM.buffered,aE,aN,aO,aK,aH;var aI=[];for(aH=0;aH<aF.length;aH++){if(aI.length&&aF.start(aH)-aI[aI.length-1].end<aJ){aI[aI.length-1].end=aF.end(aH)}else{aI.push({start:aF.start(aH),end:aF.end(aH)})}}for(aH=0,aE=0,aN=aO=aL;aH<aI.length;aH++){var aD=aI[aH].start,aG=aI[aH].end;if(aL+aJ>=aD&&aL<aG){aN=aD;aO=aG+aJ;aE=aO-aL}else{if(aL+aJ<aD){aK=aD}}}return{len:aE,start:aN,end:aO,nextStart:aK}}},{key:"getBufferRange",value:function V(aD){var aF,aE;for(aF=this.bufferRange.length-1;aF>=0;aF--){aE=this.bufferRange[aF];if(aD>=aE.start&&aD<=aE.end){return aE}}return null}},{key:"followingBufferRange",value:function ar(aD){if(aD){return this.getBufferRange(aD.end+0.5)}return null}},{key:"isBuffered",value:function ah(aD){var aE=this.video,aG=aE.buffered;for(var aF=0;aF<aG.length;aF++){if(aD>=aG.start(aF)&&aD<=aG.end(aF)){return true}}return false}},{key:"_checkFragmentChanged",value:function Y(){var aG,aE;if(this.video&&this.video.seeking===false){this.lastCurrentTime=aE=this.video.currentTime;if(this.isBuffered(aE)){aG=this.getBufferRange(aE)}else{if(this.isBuffered(aE+0.1)){aG=this.getBufferRange(aE+0.1)}}if(aG){var aF=aG.frag;if(aF!==this.fragPlaying){this.fragPlaying=aF;this.hls.trigger(Q["default"].FRAG_CHANGED,{frag:aF})}var aD=this.levels[this.level].details;if(aD&&!aD.live){if(aF.sn===aD.endSN){if(this.mediaSource&&this.mediaSource.readyState==="open"){S.logger.log("all media data available, signal endOfStream() to MediaSource");this.mediaSource.endOfStream()}}}}}}},{key:"flushBuffer",value:function aj(aH,aJ){var aL,aE,aD,aK,aN,aG;if(this.flushBufferCounter++<2*this.bufferRange.length&&this.sourceBuffer){for(var aI in this.sourceBuffer){aL=this.sourceBuffer[aI];if(!aL.updating){for(aE=0;aE<aL.buffered.length;aE++){aD=aL.buffered.start(aE);aK=aL.buffered.end(aE);if(navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&aJ===Number.POSITIVE_INFINITY){aN=aH;aG=aJ}else{aN=Math.max(aD,aH);aG=Math.min(aK,aJ)}if(aG-aN>0.5){S.logger.log("flush "+aI+" ["+aN+","+aG+"], of ["+aD+","+aK+"], pos:"+this.video.currentTime);aL.remove(aN,aG);return false}}}else{return false}}}var aM=[],aF;for(aE=0;aE<this.bufferRange.length;aE++){aF=this.bufferRange[aE];if(this.isBuffered((aF.start+aF.end)/2)){aM.push(aF)}}this.bufferRange=aM;S.logger.log("buffer flushed");return true}},{key:"immediateLevelSwitch",value:function X(){S.logger.log("immediateLevelSwitch");if(!this.immediateSwitch){this.immediateSwitch=true;this.previouslyPaused=this.video.paused;this.video.pause()}var aD=this.fragCurrent;if(aD&&aD.loader){aD.loader.abort()}this.fragCurrent=null;this.flushBufferCounter=0;this.flushRange.push({start:0,end:Number.POSITIVE_INFINITY});this.state=this.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}},{key:"immediateLevelSwitchEnd",value:function ab(){this.immediateSwitch=false;this.video.currentTime-=0.0001;if(!this.previouslyPaused){this.video.play()}}},{key:"nextLevelSwitch",value:function ak(){var aG,aD,aH;aD=this.getBufferRange(this.video.currentTime);if(aD){this.flushRange.push({start:0,end:aD.start-1})}if(!this.video.paused){var aE=this.hls.nextLoadLevel,aF=this.levels[aE];if(this.hls.stats.fragLastKbps&&this.fragCurrent){aG=this.fragCurrent.duration*aF.bitrate/(1000*this.hls.stats.fragLastKbps)+1}else{aG=0}}else{aG=0}aH=this.getBufferRange(this.video.currentTime+aG);if(aH){aH=this.followingBufferRange(aH);if(aH){this.flushRange.push({start:aH.start,end:Number.POSITIVE_INFINITY})}}if(this.flushRange.length){this.flushBufferCounter=0;this.state=this.BUFFER_FLUSHING;this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold;this.tick()}}},{key:"onMSEAttached",value:function af(aD,aE){this.video=aE.video;this.mediaSource=aE.mediaSource;this.onvseeking=this.onVideoSeeking.bind(this);this.onvseeked=this.onVideoSeeked.bind(this);this.onvmetadata=this.onVideoMetadata.bind(this);this.onvended=this.onVideoEnded.bind(this);this.video.addEventListener("seeking",this.onvseeking);this.video.addEventListener("seeked",this.onvseeked);this.video.addEventListener("loadedmetadata",this.onvmetadata);this.video.addEventListener("ended",this.onvended);if(this.levels&&this.config.autoStartLoad){this.startLoad()}}},{key:"onMSEDetached",value:function ae(){if(this.video){this.video.removeEventListener("seeking",this.onvseeking);this.video.removeEventListener("seeked",this.onvseeked);this.video.removeEventListener("loadedmetadata",this.onvmetadata);this.video.removeEventListener("ended",this.onvended);this.onvseeking=this.onvseeked=this.onvmetadata=null}this.video=null;this.loadedmetadata=false;this.stop()}},{key:"onVideoSeeking",value:function aw(){if(this.state===this.LOADING){if(this.bufferInfo(this.video.currentTime,0.3).len===0){S.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");this.fragCurrent.loader.abort();this.fragCurrent=null;this.fragPrevious=null;this.state=this.IDLE}}if(this.video){this.lastCurrentTime=this.video.currentTime}if(this.fragLoadIdx!==undefined){this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold}this.tick()}},{key:"onVideoSeeked",value:function aC(){this.tick()}},{key:"onVideoMetadata",value:function ag(){if(this.video.currentTime!==this.startPosition){this.video.currentTime=this.startPosition}this.loadedmetadata=true;this.tick()}},{key:"onVideoEnded",value:function ay(){S.logger.log("video ended");this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function aB(aG,aH){var aE=false,aF=false,aD;aH.levels.forEach(function(aI){aD=aI.codecs;if(aD){if(aD.indexOf("mp4a.40.2")!==-1){aE=true}if(aD.indexOf("mp4a.40.5")!==-1){aF=true}}});this.audiocodecswitch=aE&&aF;if(this.audiocodecswitch){S.logger.log("both AAC/HE-AAC audio found in levels; declaring audio codec as HE-AAC")}this.levels=aH.levels;this.startLevelLoaded=false;this.startFragmentRequested=false;if(this.video&&this.config.autoStartLoad){this.startLoad()}}},{key:"onLevelLoaded",value:function W(aH,aI){var aF=aI.details,aE=aI.level,aD=this.levels[aE],aJ=aF.totalduration;S.logger.log("level "+aE+" loaded ["+aF.startSN+","+aF.endSN+"],duration:"+aJ);if(aF.live){var aG=aD.details;if(aG){G["default"].mergeDetails(aG,aF);if(aF.PTSKnown){S.logger.log("live playlist sliding:"+aF.fragments[0].start.toFixed(3))}else{S.logger.log("live playlist - outdated PTS, unknown sliding")}}else{aF.PTSKnown=false;S.logger.log("live playlist - first load, unknown sliding")}}else{aF.PTSKnown=false}aD.details=aF;if(this.startLevelLoaded===false){if(aF.live){this.startPosition=Math.max(0,aJ-this.config.liveSyncDurationCount*aF.targetduration)}this.nextLoadPosition=this.startPosition;this.startLevelLoaded=true}if(this.state===this.WAITING_LEVEL){this.state=this.IDLE}this.tick()}},{key:"onFragLoaded",value:function ao(aF,aG){var aD=this.fragCurrent;if(this.state===this.LOADING&&aD&&aG.frag.level===aD.level&&aG.frag.sn===aD.sn){if(this.fragBitrateTest===true){this.state=this.IDLE;this.fragBitrateTest=false;aG.stats.tparsed=aG.stats.tbuffered=new Date();this.hls.trigger(Q["default"].FRAG_BUFFERED,{stats:aG.stats,frag:aD})}else{this.state=this.PARSING;this.stats=aG.stats;var aI=this.levels[this.level],aE=aI.details,aH=aE.totalduration,aJ=aD.start;S.logger.log("Demuxing "+aD.sn+" of ["+aE.startSN+" ,"+aE.endSN+"],level "+this.level);this.demuxer.push(aG.payload,aI.audioCodec,aI.videoCodec,aJ,aD.cc,this.level,aH)}}}},{key:"onInitSegment",value:function ai(aE,aF){if(this.state===this.PARSING){var aG=this.levels[this.level].audioCodec,aD=this.levels[this.level].videoCodec,aH;if(aG===undefined||aF.audiocodec===undefined){aG=aF.audioCodec}if(aD===undefined||aF.videocodec===undefined){aD=aF.videoCodec}if(this.audiocodecswitch&&aF.audioChannelCount===2&&navigator.userAgent.toLowerCase().indexOf("android")===-1&&navigator.userAgent.toLowerCase().indexOf("firefox")===-1){aG="mp4a.40.5"}if(!this.sourceBuffer){this.sourceBuffer={};S.logger.log("selected A/V codecs for sourceBuffers:"+aG+","+aD);if(aG){aH=this.sourceBuffer.audio=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aG);aH.addEventListener("updateend",this.onsbue);aH.addEventListener("error",this.onsbe)}if(aD){aH=this.sourceBuffer.video=this.mediaSource.addSourceBuffer("video/mp4;codecs="+aD);aH.addEventListener("updateend",this.onsbue);aH.addEventListener("error",this.onsbe)}}if(aG){this.mp4segments.push({type:"audio",data:aF.audioMoov})}if(aD){this.mp4segments.push({type:"video",data:aF.videoMoov})}this.tick()}}},{key:"onFragParsing",value:function an(aD,aE){if(this.state===this.PARSING){this.tparse2=Date.now();var aG=this.levels[this.level],aF=this.fragCurrent;S.logger.log("parsed data, type/startPTS/endPTS/startDTS/endDTS/nb:"+aE.type+"/"+aE.startPTS.toFixed(3)+"/"+aE.endPTS.toFixed(3)+"/"+aE.startDTS.toFixed(3)+"/"+aE.endDTS.toFixed(3)+"/"+aE.nb);G["default"].updateFragPTS(aG.details,aF.sn,aE.startPTS,aE.endPTS);this.mp4segments.push({type:aE.type,data:aE.moof});this.mp4segments.push({type:aE.type,data:aE.mdat});this.nextLoadPosition=aE.endPTS;this.bufferRange.push({type:aE.type,start:aE.startPTS,end:aE.endPTS,frag:aF});this.tick()}else{S.logger.warn("not in PARSING state, discarding "+aD)}}},{key:"onFragParsed",value:function aa(){if(this.state===this.PARSING){this.state=this.PARSED;this.stats.tparsed=new Date();this.tick()}}},{key:"onError",value:function Z(aD,aE){switch(aE.details){case K.ErrorDetails.FRAG_LOAD_ERROR:case K.ErrorDetails.FRAG_LOAD_TIMEOUT:case K.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case K.ErrorDetails.LEVEL_LOAD_ERROR:case K.ErrorDetails.LEVEL_LOAD_TIMEOUT:S.logger.warn("buffer controller: "+aE.details+" while loading frag,switch to "+(aE.fatal?"ERROR":"IDLE")+" state ...");this.state=aE.fatal?this.ERROR:this.IDLE;break;default:break}}},{key:"onSBUpdateEnd",value:function am(){if(this.state===this.APPENDING&&this.mp4segments.length===0){var aH=this.fragCurrent;if(aH){this.fragPrevious=aH;this.stats.tbuffered=new Date();this.hls.trigger(Q["default"].FRAG_BUFFERED,{stats:this.stats,frag:aH});S.logger.log("video buffered : "+this.timeRangesToString(this.video.buffered));this.state=this.IDLE}var aF=this.video;if(aF){if(this.seekAfterBuffered){aF.currentTime=this.seekAfterBuffered}else{var aE=aF.currentTime;var aD=this.bufferInfo(aE,0);if(aD.len===0){var aG=aD.nextStart;if(aG&&aG-aE<0.3){S.logger.log("adjust currentTime from "+aE+" to "+aG);if(aF.readyState!=HTMLMediaElement.HAVE_NOTHING){aF.currentTime=aG}}}}}this.seekAfterBuffered=undefined}this.tick()}},{key:"onSBUpdateError",value:function aq(aD){S.logger.error("sourceBuffer error:"+aD);this.state=this.ERROR;this.hls.trigger(Q["default"].ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_APPENDING_ERROR,fatal:true,frag:this.fragCurrent})}},{key:"timeRangesToString",value:function at(aG){var aF="",aD=aG.length;for(var aE=0;aE<aD;aE++){aF+="["+aG.start(aE)+","+aG.end(aE)+"]"}return aF}},{key:"currentLevel",get:function ax(){if(this.video){var aD=this.getBufferRange(this.video.currentTime);if(aD){return aD.frag.level}}return -1}},{key:"nextBufferRange",get:function ax(){if(this.video){return this.followingBufferRange(this.getBufferRange(this.video.currentTime))}else{return null}}},{key:"nextLevel",get:function ax(){var aD=this.nextBufferRange;if(aD){return aD.frag.level}else{return -1}}}]);return ac})();N["default"]=T;I.exports=N["default"]},{"../demux/demuxer":6,"../errors":10,"../events":11,"../helper/level-helper":12,"../utils/logger":19}],5:[function(H,G,K){Object.defineProperty(K,"__esModule",{value:true});var J=(function(){function R(V,T){for(var S=0;S<T.length;S++){var U=T[S];U.enumerable=U.enumerable||false;U.configurable=true;if("value" in U){U.writable=true}Object.defineProperty(V,U.key,U)}}return function(U,S,T){if(S){R(U.prototype,S)}if(T){R(U,T)}return U}})();function Q(R){return R&&R.__esModule?R:{"default":R}}function L(R,S){if(!(R instanceof S)){throw new TypeError("Cannot call a class as a function")}}var M=H("../events");var N=Q(M);var P=H("../utils/logger");var I=H("../errors");var O=(function(){function X(ab){L(this,X);this.hls=ab;this.onml=this.onManifestLoaded.bind(this);this.onll=this.onLevelLoaded.bind(this);this.onerr=this.onError.bind(this);this.ontick=this.tick.bind(this);ab.on(N["default"].MANIFEST_LOADED,this.onml);ab.on(N["default"].LEVEL_LOADED,this.onll);ab.on(N["default"].ERROR,this.onerr);this._manualLevel=this._autoLevelCapping=-1}J(X,[{key:"destroy",value:function aa(){var ab=this.hls;ab.off(N["default"].MANIFEST_LOADED,this.onml);ab.off(N["default"].LEVEL_LOADED,this.onll);ab.off(N["default"].ERROR,this.onerr);if(this.timer){clearInterval(this.timer)}this._manualLevel=-1}},{key:"onManifestLoaded",value:function Y(ac,ae){var ag=[],ak=[],ah,af,aj={},ab=false,ai=false;ae.levels.forEach(function(am){if(am.videoCodec){ab=true}if(am.audioCodec){ai=true}var al=aj[am.bitrate];if(al===undefined){aj[am.bitrate]=ak.length;am.url=[am.url];am.urlId=0;ag.push(am)}else{ag[al].url.push(am.url)}});if(ab&&ai){ag.forEach(function(al){if(al.videoCodec){ak.push(al)}})}else{ak=ag}ah=ak[0].bitrate;ak.sort(function(am,al){return am.bitrate-al.bitrate});this._levels=ak;for(af=0;af<ak.length;af++){if(ak[af].bitrate===ah){this._firstLevel=af;P.logger.log("manifest loaded,"+ak.length+" level(s) found, first bitrate:"+ah);break}}this.hls.trigger(N["default"].MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:ae.stats});return}},{key:"setLevelInternal",value:function S(ab){if(ab>=0&&ab<this._levels.length){if(this.timer){clearInterval(this.timer);this.timer=null}this._level=ab;P.logger.log("switching to level "+ab);this.hls.trigger(N["default"].LEVEL_SWITCH,{level:ab});var ae=this._levels[ab];if(ae.details===undefined||ae.details.live===true){P.logger.log("(re)loading playlist for level "+ab);var ac=ae.urlId;this.hls.trigger(N["default"].LEVEL_LOADING,{url:ae.url[ac],level:ab,id:ac})}}else{this.hls.trigger(N["default"].ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.LEVEL_SWITCH_ERROR,level:ab,fatal:false,reason:"invalid level idx"})}}},{key:"onError",value:function V(ae,af){var ab=af.details,ac,ah;switch(ab){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:case I.ErrorDetails.FRAG_LOOP_LOADING_ERROR:ac=af.frag.level;break;case I.ErrorDetails.LEVEL_LOAD_ERROR:case I.ErrorDetails.LEVEL_LOAD_TIMEOUT:ac=af.level;break;default:break}if(ac!==undefined){ah=this._levels[ac];if(ah.urlId<ah.url.length-1){ah.urlId++;ah.details=undefined;P.logger.warn("level controller,"+ab+" for level "+ac+": switching to redundant stream id "+ah.urlId)}else{var ag=this._manualLevel===-1&&ac;if(ag){P.logger.warn("level controller,"+ab+": emergency switch-down for next fragment");this.hls.abrController.nextAutoLevel=0}else{if(ah&&ah.details&&ah.details.live){P.logger.warn("level controller,"+ab+" on live stream, discard")}else{P.logger.error("cannot recover "+ab+" error");this._level=undefined;if(this.timer){clearInterval(this.timer);this.timer=null;af.fatal=true;this.hls.trigger(ae,af)}}}}}}},{key:"onLevelLoaded",value:function R(ab,ac){if(ac.details.live&&!this.timer){this.timer=setInterval(this.ontick,1000*ac.details.targetduration)}}},{key:"tick",value:function W(){var ab=this._level;if(ab!==undefined){var ae=this._levels[ab],ac=ae.urlId;this.hls.trigger(N["default"].LEVEL_LOADING,{url:ae.url[ac],level:ab,id:ac})}}},{key:"nextLoadLevel",value:function U(){if(this._manualLevel!==-1){return this._manualLevel}else{return this.hls.abrController.nextAutoLevel}}},{key:"levels",get:function T(){return this._levels}},{key:"level",get:function T(){return this._level},set:function Z(ab){if(this._level!==ab||this._levels[ab].details===undefined){this.setLevelInternal(ab)}}},{key:"manualLevel",get:function T(){return this._manualLevel},set:function Z(ab){this._manualLevel=ab;if(ab!==-1){this.level=ab}}},{key:"firstLevel",get:function T(){return this._firstLevel},set:function Z(ab){this._firstLevel=ab}},{key:"startLevel",get:function T(){if(this._startLevel===undefined){return this._firstLevel}else{return this._startLevel}},set:function Z(ab){this._startLevel=ab}}]);return X})();K["default"]=O;G.exports=K["default"]},{"../errors":10,"../events":11,"../utils/logger":19}],6:[function(H,G,J){Object.defineProperty(J,"__esModule",{value:true});var I=(function(){function W(aa,Y){for(var X=0;X<Y.length;X++){var Z=Y[X];Z.enumerable=Z.enumerable||false;Z.configurable=true;if("value" in Z){Z.writable=true}Object.defineProperty(aa,Z.key,Z)}}return function(Z,X,Y){if(X){W(Z.prototype,X)}if(Y){W(Z,Y)}return Z}})();function V(W){return W&&W.__esModule?W:{"default":W}}function K(W,X){if(!(W instanceof X)){throw new TypeError("Cannot call a class as a function")}}var L=H("../events");var O=V(L);var S=H("./tsdemuxer");var N=V(S);var U=H("./tsdemuxerworker");var P=V(U);var R=H("../utils/logger");var Q=H("../remux/mp4-remuxer");var M=V(Q);var T=(function(){function X(ab){K(this,X);this.hls=ab;if(ab.config.enableWorker&&typeof Worker!=="undefined"){R.logger.log("TS demuxing in webworker");try{var aa=H("webworkify");this.w=aa(P["default"]);this.onwmsg=this.onWorkerMessage.bind(this);this.w.addEventListener("message",this.onwmsg);this.w.postMessage({cmd:"init"})}catch(ac){R.logger.error("error while initializing TSDemuxerWorker, fallback on regular TSDemuxer");this.demuxer=new N["default"](ab,M["default"])}}else{this.demuxer=new N["default"](ab,M["default"])}this.demuxInitialized=true}I(X,[{key:"destroy",value:function Z(){if(this.w){this.w.removeEventListener("message",this.onwmsg);this.w.terminate();this.w=null}else{this.demuxer.destroy()}}},{key:"push",value:function W(ac,af,ab,aa,ah,ag,ae){if(this.w){this.w.postMessage({cmd:"demux",data:ac,audioCodec:af,videoCodec:ab,timeOffset:aa,cc:ah,level:ag,duration:ae},[ac])}else{this.demuxer.push(new Uint8Array(ac),af,ab,aa,ah,ag,ae);this.demuxer.remux()}}},{key:"onWorkerMessage",value:function Y(aa){switch(aa.data.event){case O["default"].FRAG_PARSING_INIT_SEGMENT:var ab={};if(aa.data.audioMoov){ab.audioMoov=new Uint8Array(aa.data.audioMoov);ab.audioCodec=aa.data.audioCodec;ab.audioChannelCount=aa.data.audioChannelCount}if(aa.data.videoMoov){ab.videoMoov=new Uint8Array(aa.data.videoMoov);ab.videoCodec=aa.data.videoCodec;ab.videoWidth=aa.data.videoWidth;ab.videoHeight=aa.data.videoHeight}this.hls.trigger(O["default"].FRAG_PARSING_INIT_SEGMENT,ab);break;case O["default"].FRAG_PARSING_DATA:this.hls.trigger(O["default"].FRAG_PARSING_DATA,{moof:new Uint8Array(aa.data.moof),mdat:new Uint8Array(aa.data.mdat),startPTS:aa.data.startPTS,endPTS:aa.data.endPTS,startDTS:aa.data.startDTS,endDTS:aa.data.endDTS,type:aa.data.type,nb:aa.data.nb});break;case O["default"].FRAG_PARSING_METADATA:this.hls.trigger(O["default"].FRAG_PARSING_METADATA,{samples:aa.data.samples});break;default:this.hls.trigger(aa.data.event,aa.data.data);break}}}]);return X})();J["default"]=T;G.exports=J["default"]},{"../events":11,"../remux/mp4-remuxer":17,"../utils/logger":19,"./tsdemuxer":8,"./tsdemuxerworker":9,webworkify:2}],7:[function(I,K,H){Object.defineProperty(H,"__esModule",{value:true});var J=(function(){function N(R,P){for(var O=0;O<P.length;O++){var Q=P[O];Q.enumerable=Q.enumerable||false;Q.configurable=true;if("value" in Q){Q.writable=true}Object.defineProperty(R,Q.key,Q)}}return function(Q,O,P){if(O){N(Q.prototype,O)}if(P){N(Q,P)}return Q}})();function M(N,O){if(!(N instanceof O)){throw new TypeError("Cannot call a class as a function")}}var G=I("../utils/logger");var L=(function(){function Z(ab){M(this,Z);this.data=ab;this.bytesAvailable=this.data.byteLength;this.word=0;this.bitsAvailable=0}J(Z,[{key:"loadWord",value:function Q(){var ac=this.data.byteLength-this.bytesAvailable,ab=new Uint8Array(4),ae=Math.min(4,this.bytesAvailable);if(ae===0){throw new Error("no bytes available")}ab.set(this.data.subarray(ac,ac+ae));this.word=new DataView(ab.buffer).getUint32(0);this.bitsAvailable=ae*8;this.bytesAvailable-=ae}},{key:"skipBits",value:function aa(ab){var ac;if(this.bitsAvailable>ab){this.word<<=ab;this.bitsAvailable-=ab}else{ab-=this.bitsAvailable;ac=ab>>3;ab-=ac>>3;this.bytesAvailable-=ac;this.loadWord();this.word<<=ab;this.bitsAvailable-=ab}}},{key:"readBits",value:function V(ab){var ae=Math.min(this.bitsAvailable,ab),ac=this.word>>>32-ae;if(ab>32){G.logger.error("Cannot read more than 32 bits at a time")}this.bitsAvailable-=ae;if(this.bitsAvailable>0){this.word<<=ae}else{if(this.bytesAvailable>0){this.loadWord()}}ae=ab-ae;if(ae>0){return ac<<ae|this.readBits(ae)}else{return ac}}},{key:"skipLZ",value:function T(){var ab;for(ab=0;ab<this.bitsAvailable;++ab){if(0!==(this.word&2147483648>>>ab)){this.word<<=ab;this.bitsAvailable-=ab;return ab}}this.loadWord();return ab+this.skipLZ()}},{key:"skipUEG",value:function P(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function X(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function W(){var ab=this.skipLZ();return this.readBits(ab+1)-1}},{key:"readEG",value:function S(){var ab=this.readUEG();if(1&ab){return 1+ab>>>1}else{return -1*(ab>>>1)}}},{key:"readBoolean",value:function N(){return 1===this.readBits(1)}},{key:"readUByte",value:function R(){return this.readBits(8)}},{key:"skipScalingList",value:function O(af){var ac=8,ae=8,ab,ag;for(ab=0;ab<af;ab++){if(ae!==0){ag=this.readEG();ae=(ac+ag+256)%256}ac=ae===0?ac:ae}}},{key:"readSPS",value:function Y(){var ap=0,af=0,ao=0,ak=0,aq,ah,al,an,ai,ae,ag,am,aj;this.readUByte();aq=this.readUByte();ah=this.readBits(5);this.skipBits(3);al=this.readUByte();this.skipUEG();if(aq===100||aq===110||aq===122||aq===144){var ac=this.readUEG();if(ac===3){this.skipBits(1)}this.skipUEG();this.skipUEG();this.skipBits(1);if(this.readBoolean()){am=ac!==3?8:12;for(aj=0;aj<am;aj++){if(this.readBoolean()){if(aj<6){this.skipScalingList(16)}else{this.skipScalingList(64)}}}}}this.skipUEG();var ab=this.readUEG();if(ab===0){this.readUEG()}else{if(ab===1){this.skipBits(1);this.skipEG();this.skipEG();an=this.readUEG();for(aj=0;aj<an;aj++){this.skipEG()}}}this.skipUEG();this.skipBits(1);ai=this.readUEG();ae=this.readUEG();ag=this.readBits(1);if(ag===0){this.skipBits(1)}this.skipBits(1);if(this.readBoolean()){ap=this.readUEG();af=this.readUEG();ao=this.readUEG();ak=this.readUEG()}return{profileIdc:aq,profileCompat:ah,levelIdc:al,width:(ai+1)*16-ap*2-af*2,height:(2-ag)*(ae+1)*16-ao*2-ak*2}}},{key:"readSliceType",value:function U(){this.readUByte();this.readUEG();return this.readUEG()}}]);return Z})();H["default"]=L;K.exports=H["default"]},{"../utils/logger":19}],8:[function(I,G,M){Object.defineProperty(M,"__esModule",{value:true});var K=(function(){function T(X,V){for(var U=0;U<V.length;U++){var W=V[U];W.enumerable=W.enumerable||false;W.configurable=true;if("value" in W){W.writable=true}Object.defineProperty(X,W.key,W)}}return function(W,U,V){if(U){T(W.prototype,U)}if(V){T(W,V)}return W}})();function S(T){return T&&T.__esModule?T:{"default":T}}function N(T,U){if(!(T instanceof U)){throw new TypeError("Cannot call a class as a function")}}var O=I("../events");var P=S(O);var Q=I("./exp-golomb");var H=S(Q);var R=I("../utils/logger");var J=I("../errors");var L=(function(){function Y(ai,aj){N(this,Y);this.observer=ai;this.remuxerClass=aj;this.lastCC=0;this.PES_TIMESCALE=90000;this.remuxer=new this.remuxerClass(this.observer)}K(Y,[{key:"switchLevel",value:function ac(){this.pmtParsed=false;this._pmtId=-1;this._avcTrack={type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0};this._aacTrack={type:"audio",id:-1,sequenceNumber:0,samples:[],len:0};this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0};this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function ae(){this.switchLevel();this.remuxer.insertDiscontinuity()}},{key:"push",value:function aa(aB,ak,aw,ao,aq,aj,ai){var an,az,at,al,ay=aB.length,au,ap,aC,am;this.audioCodec=ak;this.videoCodec=aw;this.timeOffset=ao;this._duration=ai;if(aq!==this.lastCC){R.logger.log("discontinuity detected");this.insertDiscontinuity();this.lastCC=aq}else{if(aj!==this.lastLevel){R.logger.log("level switch detected");this.switchLevel();this.lastLevel=aj}}var av=this.pmtParsed,aA=this._avcTrack.id,ax=this._aacTrack.id,ar=this._id3Track.id;for(al=0;al<ay;al+=188){if(aB[al]===71){au=!!(aB[al+1]&64);ap=((aB[al+1]&31)<<8)+aB[al+2];aC=(aB[al+3]&48)>>4;if(aC>1){am=al+5+aB[al+4];if(am===al+188){continue}}else{am=al+4}if(av){if(ap===aA){if(au){if(an){this._parseAVCPES(this._parsePES(an))}an={data:[],size:0}}if(an){an.data.push(aB.subarray(am,al+188));an.size+=al+188-am}}else{if(ap===ax){if(au){if(az){this._parseAACPES(this._parsePES(az))}az={data:[],size:0}}if(az){az.data.push(aB.subarray(am,al+188));az.size+=al+188-am}}else{if(ap===ar){if(au){if(at){this._parseID3PES(this._parsePES(at))}at={data:[],size:0}}if(at){at.data.push(aB.subarray(am,al+188));at.size+=al+188-am}}}}}else{if(au){am+=aB[am]+1}if(ap===0){this._parsePAT(aB,am)}else{if(ap===this._pmtId){this._parsePMT(aB,am);av=this.pmtParsed=true;aA=this._avcTrack.id;ax=this._aacTrack.id;ar=this._id3Track.id}}}}else{this.observer.trigger(P["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"TS packet did not start with 0x47"})}}if(an){this._parseAVCPES(this._parsePES(an))}if(az){this._parseAACPES(this._parsePES(az))}if(at){this._parseID3PES(this._parsePES(at))}}},{key:"remux",value:function Z(){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this.timeOffset)}},{key:"destroy",value:function af(){this.switchLevel();this._initPTS=this._initDTS=undefined;this._duration=0}},{key:"_parsePAT",value:function X(ai,aj){this._pmtId=(ai[aj+10]&31)<<8|ai[aj+11]}},{key:"_parsePMT",value:function V(am,an){var ai,al,ak,aj;ai=(am[an+1]&15)<<8|am[an+2];al=an+3+ai-4;ak=(am[an+10]&15)<<8|am[an+11];an+=12+ak;while(an<al){aj=(am[an+1]&31)<<8|am[an+2];switch(am[an]){case 15:this._aacTrack.id=aj;break;case 21:this._id3Track.id=aj;break;case 27:this._avcTrack.id=aj;break;default:R.logger.log("unkown stream type:"+am[an]);break}an+=((am[an+3]&15)<<8|am[an+4])+5}}},{key:"_parsePES",value:function ah(ap){var al=0,aq,ai,ak,aj,at,am,an,ar,ao;aq=ap.data[0];ak=(aq[0]<<16)+(aq[1]<<8)+aq[2];if(ak===1){aj=(aq[4]<<8)+aq[5];ai=aq[7];if(ai&192){an=(aq[9]&14)*536870912+(aq[10]&255)*4194304+(aq[11]&254)*16384+(aq[12]&255)*128+(aq[13]&254)/2;if(an>4294967295){an-=8589934592}if(ai&64){ar=(aq[14]&14)*536870912+(aq[15]&255)*4194304+(aq[16]&254)*16384+(aq[17]&255)*128+(aq[18]&254)/2;if(ar>4294967295){ar-=8589934592}}else{ar=an}}at=aq[8];ao=at+9;ap.data[0]=ap.data[0].subarray(ao);ap.size-=ao;am=new Uint8Array(ap.size);while(ap.data.length){aq=ap.data.shift();am.set(aq,al);al+=aq.byteLength}return{data:am,pts:an,dts:ar,len:aj}}else{return null}}},{key:"_parseAVCPES",value:function ag(aj){var am=this;var an,ai=this._avcTrack,al,aq=false;an=this._parseAVCNALu(aj.data);if(an.length===0&this._avcTrack.samples.length>0){var ap=this._avcTrack.samples[this._avcTrack.samples.length-1];var ao=ap.units.units[ap.units.units.length-1];var ak=new Uint8Array(ao.data.byteLength+aj.data.byteLength);ak.set(ao.data,0);ak.set(aj.data,ao.data.byteLength);ao.data=ak;ap.units.length+=aj.data.byteLength;this._avcTrack.len+=aj.data.byteLength}aj.data=null;an.units.forEach(function(ay){switch(ay.type){case 1:var ax=new H["default"](ay.data).readSliceType();if(ax===2||ax===4||ax===7||ax===9){aq=true}break;case 5:aq=true;break;case 7:if(!ai.sps){var az=new H["default"](ay.data);var au=az.readSPS();ai.width=au.width;ai.height=au.height;ai.profileIdc=au.profileIdc;ai.profileCompat=au.profileCompat;ai.levelIdc=au.levelIdc;ai.sps=[ay.data];ai.timescale=am.remuxer.timescale;ai.duration=am.remuxer.timescale*am._duration;var ar=ay.data.subarray(1,4);var at="avc1.";for(var av=0;av<3;av++){var aw=ar[av].toString(16);if(aw.length<2){aw="0"+aw}at+=aw}ai.codec=at}break;case 8:if(!ai.pps){ai.pps=[ay.data]}break;default:break}});if(an.length){if(aq===true||ai.sps){al={units:an,pts:aj.pts,dts:aj.dts,key:aq};this._avcTrack.samples.push(al);this._avcTrack.len+=an.length;this._avcTrack.nbNalu+=an.units.length}}}},{key:"_parseAVCNALu",value:function W(aq){var an=0,ao=aq.byteLength,aw,ak,ai=0;var ar=[],ax,av,ap,al,aj=0;while(an<ao){aw=aq[an++];switch(ai){case 0:if(aw===0){ai=1}break;case 1:if(aw===0){ai=2}else{ai=0}break;case 2:case 3:if(aw===0){ai=3}else{if(aw===1){av=aq[an]&31;if(ap){ax={data:aq.subarray(ap,an-ai-1),type:al};aj+=an-ai-1-ap;ar.push(ax)}else{ak=an-ai-1;if(ak){if(this._avcTrack.samples.length){var au=this._avcTrack.samples[this._avcTrack.samples.length-1];var at=au.units.units[au.units.units.length-1];var am=new Uint8Array(at.data.byteLength+ak);am.set(at.data,0);am.set(aq.subarray(0,ak),at.data.byteLength);at.data=am;au.units.length+=ak;this._avcTrack.len+=ak}}}ap=an;al=av;if(av===1||av===5){an=ao}ai=0}else{ai=0}}break;default:break}}if(ap){ax={data:aq.subarray(ap,ao),type:al};aj+=ao-ap;ar.push(ax)}return{units:ar,length:aj}}},{key:"_parseAACPES",value:function ab(al){var aj=this._aacTrack,am,ap=al.data,ak,au,av,aw,ai,an,ar;if(this.aacOverFlow){var ao=new Uint8Array(this.aacOverFlow.byteLength+ap.byteLength);ao.set(this.aacOverFlow,0);ao.set(ap,this.aacOverFlow.byteLength);ap=ao}for(av=0,ar=ap.length;av<ar-1;av++){if(ap[av]===255&&(ap[av+1]&240)===240){break}}if(av){var aq,at;if(av<ar-1){aq="AAC PES did not start with ADTS header,offset:"+av;at=false}else{aq="no ADTS header found in AAC PES";at=true}this.observer.trigger(P["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:at,reason:aq});if(at){return}}if(!aj.audiosamplerate){ak=this._ADTStoAudioConfig(ap,av,this.audioCodec);aj.config=ak.config;aj.audiosamplerate=ak.samplerate;aj.channelCount=ak.channelCount;aj.codec=ak.codec;aj.timescale=this.remuxer.timescale;aj.duration=this.remuxer.timescale*this._duration;R.logger.log("parsed codec:"+aj.codec+",rate:"+ak.samplerate+",nb channel:"+ak.channelCount)}an=0;while(av+5<ar){au=(ap[av+3]&3)<<11;au|=ap[av+4]<<3;au|=(ap[av+5]&224)>>>5;aw=!!(ap[av+1]&1)?7:9;au-=aw;ai=Math.round(al.pts+an*1024*this.PES_TIMESCALE/aj.audiosamplerate);if(av+aw+au<=ar){am={unit:ap.subarray(av+aw,av+aw+au),pts:ai,dts:ai};this._aacTrack.samples.push(am);this._aacTrack.len+=au;av+=au+aw;an++}else{break}}if(av<ar){this.aacOverFlow=ap.subarray(av,ar)}else{this.aacOverFlow=null}}},{key:"_ADTStoAudioConfig",value:function T(al,ak,ar){var ao,an,am,aj,ai,aq=navigator.userAgent.toLowerCase(),ap=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];ao=((al[ak+2]&192)>>>6)+1;an=(al[ak+2]&60)>>>2;if(an>ap.length-1){this.observer.trigger(P["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:true,reason:"invalid ADTS sampling index:"+an});return}aj=(al[ak+2]&1)<<2;aj|=(al[ak+3]&192)>>>6;R.logger.log("manifest codec:"+ar+",ADTS data:type:"+ao+",sampleingIndex:"+an+"["+ap[an]+"kHz],channelConfig:"+aj);if(aq.indexOf("firefox")!==-1){if(an>=6){ao=5;ai=new Array(4);am=an-3}else{ao=2;ai=new Array(2);am=an}}else{if(aq.indexOf("android")!==-1){ao=2;ai=new Array(2);am=an}else{ao=5;ai=new Array(4);if(ar&&ar.indexOf("mp4a.40.5")!==-1||!ar&&an>=6){am=an-3}else{if(ar&&ar.indexOf("mp4a.40.2")!==-1&&(an>=6||aj===1)){ao=2;ai=new Array(2)}am=an}}}ai[0]=ao<<3;ai[0]|=(an&14)>>1;ai[1]|=(an&1)<<7;ai[1]|=aj<<3;if(ao===5){ai[1]|=(am&14)>>1;ai[2]=(am&1)<<7;ai[2]|=2<<2;ai[3]=0}return{config:ai,samplerate:ap[an],channelCount:aj,codec:"mp4a.40."+ao}}},{key:"_parseID3PES",value:function U(ai){this._id3Track.samples.push(ai)}}]);return Y})();M["default"]=L;G.exports=M["default"]},{"../errors":10,"../events":11,"../utils/logger":19,"./exp-golomb":7}],9:[function(H,G,I){Object.defineProperty(I,"__esModule",{value:true});function T(U){return U&&U.__esModule?U:{"default":U}}function Q(U){if(Array.isArray(U)){for(var W=0,V=Array(U.length);W<U.length;W++){V[W]=U[W]}return V}else{return Array.from(U)}}var K=H("../events");var N=T(K);var M=H("events");var J=T(M);var R=H("../demux/tsdemuxer");var P=T(R);var O=H("../remux/mp4-remuxer");var L=T(O);var S=function S(V){var U=new J["default"]();U.trigger=function W(aa){for(var Y=arguments.length,ab=Array(Y>1?Y-1:0),Z=1;Z<Y;Z++){ab[Z-1]=arguments[Z]}U.emit.apply(U,[aa,aa].concat(Q(ab)))};U.off=function X(aa){for(var Y=arguments.length,ab=Array(Y>1?Y-1:0),Z=1;Z<Y;Z++){ab[Z-1]=arguments[Z]}U.removeListener.apply(U,[aa].concat(Q(ab)))};V.addEventListener("message",function(Y){switch(Y.data.cmd){case"init":V.demuxer=new P["default"](U,L["default"]);break;case"demux":V.demuxer.push(new Uint8Array(Y.data.data),Y.data.audioCodec,Y.data.videoCodec,Y.data.timeOffset,Y.data.cc,Y.data.level,Y.data.duration);V.demuxer.remux();break;default:break}});U.on(N["default"].FRAG_PARSING_INIT_SEGMENT,function(aa,ab){var Y={event:aa};var Z=[];if(ab.audioCodec){Y.audioCodec=ab.audioCodec;Y.audioMoov=ab.audioMoov.buffer;Y.audioChannelCount=ab.audioChannelCount;Z.push(Y.audioMoov)}if(ab.videoCodec){Y.videoCodec=ab.videoCodec;Y.videoMoov=ab.videoMoov.buffer;Y.videoWidth=ab.videoWidth;Y.videoHeight=ab.videoHeight;Z.push(Y.videoMoov)}V.postMessage(Y,Z)});U.on(N["default"].FRAG_PARSING_DATA,function(Z,aa){var Y={event:Z,type:aa.type,startPTS:aa.startPTS,endPTS:aa.endPTS,startDTS:aa.startDTS,endDTS:aa.endDTS,moof:aa.moof.buffer,mdat:aa.mdat.buffer,nb:aa.nb};V.postMessage(Y,[Y.moof,Y.mdat])});U.on(N["default"].FRAG_PARSED,function(Y){V.postMessage({event:Y})});U.on(N["default"].ERROR,function(Y,Z){V.postMessage({event:Y,data:Z})});U.on(N["default"].FRAG_PARSING_METADATA,function(Z,aa){var Y={event:Z,samples:aa.samples};V.postMessage(Y)})};I["default"]=S;G.exports=I["default"]},{"../demux/tsdemuxer":8,"../events":11,"../remux/mp4-remuxer":17,events:1}],10:[function(I,K,H){Object.defineProperty(H,"__esModule",{value:true});var J={NETWORK_ERROR:"hlsNetworkError",MEDIA_ERROR:"hlsMediaError",OTHER_ERROR:"hlsOtherError"};H.ErrorTypes=J;var G={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_PARSING_ERROR:"fragParsingError",FRAG_APPENDING_ERROR:"fragAppendingError"};H.ErrorDetails=G},{}],11:[function(H,I,G){Object.defineProperty(G,"__esModule",{value:true});G["default"]={MSE_ATTACHED:"hlsMediaSourceAttached",MSE_DETACHED:"hlsMediaSourceDetached",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_METADATA:"hlsFraParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFPSDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying"};I.exports=G["default"]},{}],12:[function(I,K,H){Object.defineProperty(H,"__esModule",{value:true});var J=(function(){function N(R,P){for(var O=0;O<P.length;O++){var Q=P[O];Q.enumerable=Q.enumerable||false;Q.configurable=true;if("value" in Q){Q.writable=true}Object.defineProperty(R,Q.key,Q)}}return function(Q,O,P){if(O){N(Q.prototype,O)}if(P){N(Q,P)}return Q}})();function L(N,O){if(!(N instanceof O)){throw new TypeError("Cannot call a class as a function")}}var G=I("../utils/logger");var M=(function(){function Q(){L(this,Q)}J(Q,null,[{key:"mergeDetails",value:function N(R,V){var S=Math.max(R.startSN,V.startSN)-V.startSN,U=Math.min(R.endSN,V.endSN)-V.startSN,ac=V.startSN-R.startSN,ab=R.fragments,X=V.fragments,aa=0,T;if(U<S){V.PTSKnown=false;return}for(var W=S;W<=U;W++){var ae=ab[ac+W],Z=X[W];aa=ae.cc-Z.cc;if(!isNaN(ae.startPTS)){Z.start=Z.startPTS=ae.startPTS;Z.endPTS=ae.endPTS;Z.duration=ae.duration;T=Z}}if(aa){G.logger.log("discontinuity sliding from playlist, take drift into account");for(W=0;W<X.length;W++){X[W].cc+=aa}}if(T){Q.updateFragPTS(V,T.sn,T.startPTS,T.endPTS)}else{var Y=ab[ac].start;for(W=0;W<X.length;W++){X[W].start+=Y}}V.PTSKnown=R.PTSKnown;return}},{key:"updateFragPTS",value:function P(V,X,T,S){var W,R,Y,U;if(X<V.startSN||X>V.endSN){return}W=X-V.startSN;R=V.fragments;Y=R[W];if(!isNaN(Y.startPTS)){T=Math.max(T,Y.startPTS);S=Math.min(S,Y.endPTS)}Y.start=Y.startPTS=T;Y.endPTS=S;Y.duration=S-T;for(U=W;U>0;U--){Q.updatePTS(R,U,U-1)}for(U=W;U<R.length-1;U++){Q.updatePTS(R,U,U+1)}V.PTSKnown=true}},{key:"updatePTS",value:function O(S,U,W){var R=S[U],T=S[W],V=T.startPTS;if(!isNaN(V)){if(W>U){R.duration=V-R.start;if(R.duration<0){G.logger.error("negative duration computed for "+R+", there should be some duration drift between playlist and fragment!")}}else{T.duration=R.start-V;if(T.duration<0){G.logger.error("negative duration computed for "+T+", there should be some duration drift between playlist and fragment!")}}}else{if(W>U){T.start=R.start+R.duration}else{T.start=R.start-T.duration}}}}]);return Q})();H["default"]=M;K.exports=H["default"]},{"../utils/logger":19}],13:[function(S,I,ah){Object.defineProperty(ah,"__esModule",{value:true});var ab=(function(){function aj(an,al){for(var ak=0;ak<al.length;ak++){var am=al[ak];am.enumerable=am.enumerable||false;am.configurable=true;if("value" in am){am.writable=true}Object.defineProperty(an,am.key,am)}}return function(am,ak,al){if(ak){aj(am.prototype,ak)}if(al){aj(am,al)}return am}})();function H(aj){return aj&&aj.__esModule?aj:{"default":aj}}function M(aj){if(Array.isArray(aj)){for(var al=0,ak=Array(aj.length);al<aj.length;al++){ak[al]=aj[al]}return ak}else{return Array.from(aj)}}function N(aj,ak){if(!(aj instanceof ak)){throw new TypeError("Cannot call a class as a function")}}var U=S("./events");var R=H(U);var ae=S("./errors");var W=S("./stats");var ac=H(W);var ai=S("./loader/playlist-loader");var X=H(ai);var O=S("./loader/fragment-loader");var L=H(O);var V=S("./controller/abr-controller");var G=H(V);var T=S("./controller/buffer-controller");var Z=H(T);var J=S("./controller/level-controller");var af=H(J);var Y=S("./utils/logger");var ag=S("./utils/xhr-loader");var aa=H(ag);var Q=S("events");var P=H(Q);var K=(function(){ab(aj,null,[{key:"isSupported",value:function ak(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function al(){return R["default"]}},{key:"ErrorTypes",get:function al(){return ae.ErrorTypes}},{key:"ErrorDetails",get:function al(){return ae.ErrorDetails}}]);function aj(){var aA=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];N(this,aj);var ax={autoStartLoad:true,debug:false,maxBufferLength:30,maxBufferSize:60*1000*1000,liveSyncDurationCount:3,liveMaxLatencyDurationCount:Infinity,maxMaxBufferLength:600,enableWorker:true,fragLoadingTimeOut:20000,fragLoadingMaxRetry:1,fragLoadingRetryDelay:1000,fragLoadingLoopThreshold:3,manifestLoadingTimeOut:10000,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1000,fpsDroppedMonitoringPeriod:5000,fpsDroppedMonitoringThreshold:0.2,appendErrorMaxRetry:200,loader:aa["default"],abrController:G["default"]};for(var aC in ax){if(aC in aA){continue}aA[aC]=ax[aC]}if(aA.liveMaxLatencyDurationCount!==undefined&&aA.liveMaxLatencyDurationCount<=aA.liveSyncDurationCount){throw new Error('Illegal hls.js configuration: "liveMaxLatencyDurationCount" must be strictly superior to "liveSyncDurationCount" in player configuration')}(0,Y.enableLogs)(aA.debug);this.config=aA;var ay=this.observer=new P["default"]();ay.trigger=function az(aF){for(var aD=arguments.length,aG=Array(aD>1?aD-1:0),aE=1;aE<aD;aE++){aG[aE-1]=arguments[aE]}ay.emit.apply(ay,[aF,aF].concat(M(aG)))};ay.off=function aB(aF){for(var aD=arguments.length,aG=Array(aD>1?aD-1:0),aE=1;aE<aD;aE++){aG[aE-1]=arguments[aE]}ay.removeListener.apply(ay,[aF].concat(M(aG)))};this.on=ay.on.bind(ay);this.off=ay.off.bind(ay);this.trigger=ay.trigger.bind(ay);this.playlistLoader=new X["default"](this);this.fragmentLoader=new L["default"](this);this.levelController=new af["default"](this);this.abrController=new aA.abrController(this);this.bufferController=new Z["default"](this);this.statsHandler=new ac["default"](this)}ab(aj,[{key:"destroy",value:function aw(){Y.logger.log("destroy");this.trigger(R["default"].DESTROYING);this.playlistLoader.destroy();this.fragmentLoader.destroy();this.levelController.destroy();this.bufferController.destroy();this.statsHandler.destroy();this.url=null;this.detachVideo();this.observer.removeAllListeners()}},{key:"attachVideo",value:function ap(ay){Y.logger.log("attachVideo");this.video=ay;this.statsHandler.attachVideo(ay);var ax=this.mediaSource=new MediaSource();this.onmso=this.onMediaSourceOpen.bind(this);this.onmse=this.onMediaSourceEnded.bind(this);this.onmsc=this.onMediaSourceClose.bind(this);ax.addEventListener("sourceopen",this.onmso);ax.addEventListener("sourceended",this.onmse);ax.addEventListener("sourceclose",this.onmsc);ay.src=URL.createObjectURL(ax);ay.addEventListener("error",this.onverror)}},{key:"detachVideo",value:function ar(){Y.logger.log("detachVideo");var ay=this.video;this.statsHandler.detachVideo(ay);var ax=this.mediaSource;if(ax){if(ax.readyState==="open"){ax.endOfStream()}ax.removeEventListener("sourceopen",this.onmso);ax.removeEventListener("sourceended",this.onmse);ax.removeEventListener("sourceclose",this.onmsc);ay.src="";this.mediaSource=null;Y.logger.log("trigger MSE_DETACHED");this.trigger(R["default"].MSE_DETACHED)}this.onmso=this.onmse=this.onmsc=null;if(ay){this.video=null}}},{key:"loadSource",value:function an(ax){Y.logger.log("loadSource:"+ax);this.url=ax;this.trigger(R["default"].MANIFEST_LOADING,{url:ax})}},{key:"startLoad",value:function au(){Y.logger.log("startLoad");this.bufferController.startLoad()}},{key:"recoverMediaError",value:function ao(){Y.logger.log("recoverMediaError");var ax=this.video;this.detachVideo();this.attachVideo(ax)}},{key:"onMediaSourceOpen",value:function am(){Y.logger.log("media source opened");this.trigger(R["default"].MSE_ATTACHED,{video:this.video,mediaSource:this.mediaSource});this.mediaSource.removeEventListener("sourceopen",this.onmso)}},{key:"onMediaSourceClose",value:function at(){Y.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function aq(){Y.logger.log("media source ended")}},{key:"levels",get:function al(){return this.levelController.levels}},{key:"currentLevel",get:function al(){return this.bufferController.currentLevel},set:function av(ax){Y.logger.log("set currentLevel:"+ax);this.loadLevel=ax;this.bufferController.immediateLevelSwitch()}},{key:"nextLevel",get:function al(){return this.bufferController.nextLevel},set:function av(ax){Y.logger.log("set nextLevel:"+ax);this.levelController.manualLevel=ax;this.bufferController.nextLevelSwitch()}},{key:"loadLevel",get:function al(){return this.levelController.level},set:function av(ax){Y.logger.log("set loadLevel:"+ax);this.levelController.manualLevel=ax}},{key:"nextLoadLevel",get:function al(){return this.levelController.nextLoadLevel()},set:function av(ax){this.levelController.level=ax}},{key:"firstLevel",get:function al(){return this.levelController.firstLevel},set:function av(ax){Y.logger.log("set firstLevel:"+ax);this.levelController.firstLevel=ax}},{key:"startLevel",get:function al(){return this.levelController.startLevel},set:function av(ax){Y.logger.log("set startLevel:"+ax);this.levelController.startLevel=ax}},{key:"autoLevelCapping",get:function al(){return this.abrController.autoLevelCapping},set:function av(ax){Y.logger.log("set autoLevelCapping:"+ax);this.abrController.autoLevelCapping=ax}},{key:"autoLevelEnabled",get:function al(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function al(){return this.levelController.manualLevel}},{key:"stats",get:function al(){return this.statsHandler.stats}}]);return aj})();ah["default"]=K;I.exports=ah["default"]},{"./controller/abr-controller":3,"./controller/buffer-controller":4,"./controller/level-controller":5,"./errors":10,"./events":11,"./loader/fragment-loader":14,"./loader/playlist-loader":15,"./stats":18,"./utils/logger":19,"./utils/xhr-loader":20,events:1}],14:[function(H,G,L){Object.defineProperty(L,"__esModule",{value:true});var J=(function(){function Q(U,S){for(var R=0;R<S.length;R++){var T=S[R];T.enumerable=T.enumerable||false;T.configurable=true;if("value" in T){T.writable=true}Object.defineProperty(U,T.key,T)}}return function(T,R,S){if(R){Q(T.prototype,R)}if(S){Q(T,S)}return T}})();function P(Q){return Q&&Q.__esModule?Q:{"default":Q}}function M(Q,R){if(!(Q instanceof R)){throw new TypeError("Cannot call a class as a function")}}var N=H("../events");var O=P(N);var I=H("../errors");var K=(function(){function W(X){M(this,W);this.hls=X;this.onfl=this.onFragLoading.bind(this);X.on(O["default"].FRAG_LOADING,this.onfl)}J(W,[{key:"destroy",value:function T(){if(this.loader){this.loader.destroy();this.loader=null}this.hls.off(O["default"].FRAG_LOADING,this.onfl)}},{key:"onFragLoading",value:function V(Y,Z){var aa=Z.frag;this.frag=aa;this.frag.loaded=0;var X=this.hls.config;aa.loader=this.loader=new X.loader(X);this.loader.load(aa.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),X.fragLoadingTimeOut,X.fragLoadingMaxRetry,X.fragLoadingRetryDelay,this.loadprogress.bind(this),aa)}},{key:"loadsuccess",value:function R(Y,X){var Z=Y.currentTarget.response;X.length=Z.byteLength;this.frag.loader=undefined;this.hls.trigger(O["default"].FRAG_LOADED,{payload:Z,frag:this.frag,stats:X})}},{key:"loaderror",value:function U(X){this.loader.abort();this.hls.trigger(O["default"].ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_ERROR,fatal:false,frag:this.frag,response:X})}},{key:"loadtimeout",value:function Q(){this.loader.abort();this.hls.trigger(O["default"].ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:false,frag:this.frag})}},{key:"loadprogress",value:function S(Y,X){this.frag.loaded=X.loaded;this.hls.trigger(O["default"].FRAG_LOAD_PROGRESS,{frag:this.frag,stats:X})}}]);return W})();L["default"]=K;G.exports=L["default"]},{"../errors":10,"../events":11}],15:[function(H,G,K){Object.defineProperty(K,"__esModule",{value:true});var J=(function(){function Q(U,S){for(var R=0;R<S.length;R++){var T=S[R];T.enumerable=T.enumerable||false;T.configurable=true;if("value" in T){T.writable=true}Object.defineProperty(U,T.key,T)}}return function(T,R,S){if(R){Q(T.prototype,R)}if(S){Q(T,S)}return T}})();function P(Q){return Q&&Q.__esModule?Q:{"default":Q}}function L(Q,R){if(!(Q instanceof R)){throw new TypeError("Cannot call a class as a function")}}var M=H("../events");var N=P(M);var I=H("../errors");var O=(function(){function Z(ac){L(this,Z);this.hls=ac;this.onml=this.onManifestLoading.bind(this);this.onll=this.onLevelLoading.bind(this);ac.on(N["default"].MANIFEST_LOADING,this.onml);ac.on(N["default"].LEVEL_LOADING,this.onll)}J(Z,[{key:"destroy",value:function Y(){if(this.loader){this.loader.destroy();this.loader=null}this.url=this.id=null;this.hls.off(N["default"].MANIFEST_LOADING,this.onml);this.hls.off(N["default"].LEVEL_LOADING,this.onll)}},{key:"onManifestLoading",value:function U(ac,ae){this.load(ae.url,null)}},{key:"onLevelLoading",value:function R(ac,ae){this.load(ae.url,ae.level,ae.id)}},{key:"load",value:function aa(ae,ag,af){var ac=this.hls.config;this.url=ae;this.id=ag;this.id2=af;this.loader=new ac.loader(ac);this.loader.load(ae,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),ac.manifestLoadingTimeOut,ac.manifestLoadingMaxRetry,ac.manifestLoadingRetryDelay)}},{key:"resolve",value:function ab(ac,ai){var al=document,af=al.getElementsByTagName("base")[0],ae=af&&af.href,aj=al.head||al.getElementsByTagName("head")[0],ak=af||aj.appendChild(al.createElement("base")),ag=al.createElement("a"),ah;ak.href=ai;ag.href=ac;ah=ag.href;if(af){af.href=ae}else{aj.removeChild(ak)}return ah}},{key:"parseMasterPlaylist",value:function W(af,ak){var ai=[],aj={},ac,ae,ah;var ag=/#EXT-X-STREAM-INF:([^\n\r]*(BAND)WIDTH=(\d+))?([^\n\r]*(CODECS)=\"([^\"\n\r]*)\",?)?([^\n\r]*(RES)OLUTION=(\d+)x(\d+))?([^\n\r]*(NAME)=\"(.*)\")?[^\n\r]*[\r\n]+([^\r\n]+)/g;while((ac=ag.exec(af))!=null){ac.shift();ac=ac.filter(function(al){return al!==undefined});aj.url=this.resolve(ac.pop(),ak);while(ac.length>0){switch(ac.shift()){case"RES":aj.width=parseInt(ac.shift());aj.height=parseInt(ac.shift());break;case"BAND":aj.bitrate=parseInt(ac.shift());break;case"NAME":aj.name=ac.shift();break;case"CODECS":ae=ac.shift().split(",");while(ae.length>0){ah=ae.shift();if(ah.indexOf("avc1")!==-1){aj.videoCodec=this.avc1toavcoti(ah)}else{aj.audioCodec=ah}}break;default:break}}ai.push(aj);aj={}}return ai}},{key:"avc1toavcoti",value:function S(af){var ae,ac=af.split(".");if(ac.length>2){ae=ac.shift()+".";ae+=parseInt(ac.shift()).toString(16);ae+=("00"+parseInt(ac.shift()).toString(16)).substr(-4)}else{ae=af}return ae}},{key:"parseLevelPlaylist",value:function V(aj,ak,ae){var af=0,ag=0,ac={url:ak,fragments:[],live:true,startSN:0},am,al,ah=0;al=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT(INF):([\d\.]+)[^\r\n]*[\r\n]+([^\r\n]+)|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))/g;while((am=al.exec(aj))!==null){am.shift();am=am.filter(function(an){return an!==undefined});switch(am[0]){case"MEDIA-SEQUENCE":af=ac.startSN=parseInt(am[1]);break;case"TARGETDURATION":ac.targetduration=parseFloat(am[1]);break;case"ENDLIST":ac.live=false;break;case"DIS":ah++;break;case"INF":var ai=parseFloat(am[1]);if(!isNaN(ai)){ac.fragments.push({url:this.resolve(am[2],ak),duration:ai,start:ag,sn:af++,level:ae,cc:ah});ag+=ai}break;default:break}}ac.totalduration=ag;ac.endSN=af-1;return ac}},{key:"loadsuccess",value:function T(ai,ah){var af=ai.currentTarget.responseText,ae=ai.currentTarget.responseURL,ak=this.id,ag=this.id2,ac=this.hls,aj;if(ae===undefined){ae=this.url}ah.tload=new Date();ah.mtime=new Date(ai.currentTarget.getResponseHeader("Last-Modified"));if(af.indexOf("#EXTM3U")===0){if(af.indexOf("#EXTINF:")>0){if(this.id===null){ac.trigger(N["default"].MANIFEST_LOADED,{levels:[{url:ae}],url:ae,stats:ah})}else{ac.trigger(N["default"].LEVEL_LOADED,{details:this.parseLevelPlaylist(af,ae,ak),level:ak,id:ag,stats:ah})}}else{aj=this.parseMasterPlaylist(af,ae);if(aj.length){ac.trigger(N["default"].MANIFEST_LOADED,{levels:aj,url:ae,stats:ah})}else{ac.trigger(N["default"].ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:ae,reason:"no level found in manifest"})}}}else{ac.trigger(N["default"].ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:I.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:true,url:ae,reason:"no EXTM3U delimiter"})}}},{key:"loaderror",value:function X(ae){var ac,af;if(this.id===null){ac=I.ErrorDetails.MANIFEST_LOAD_ERROR;af=true}else{ac=I.ErrorDetails.LEVEL_LOAD_ERROR;af=false}this.loader.abort();this.hls.trigger(N["default"].ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:ac,fatal:af,url:this.url,loader:this.loader,response:ae.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function Q(){var ac,ae;if(this.id===null){ac=I.ErrorDetails.MANIFEST_LOAD_TIMEOUT;ae=true}else{ac=I.ErrorDetails.LEVEL_LOAD_TIMEOUT;ae=false}this.loader.abort();this.hls.trigger(N["default"].ERROR,{type:I.ErrorTypes.NETWORK_ERROR,details:ac,fatal:ae,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]);return Z})();K["default"]=O;G.exports=K["default"]},{"../errors":10,"../events":11}],16:[function(H,J,G){Object.defineProperty(G,"__esModule",{value:true});var I=(function(){function M(Q,O){for(var N=0;N<O.length;N++){var P=O[N];P.enumerable=P.enumerable||false;P.configurable=true;if("value" in P){P.writable=true}Object.defineProperty(Q,P.key,P)}}return function(P,N,O){if(N){M(P.prototype,N)}if(O){M(P,O)}return P}})();function L(M,N){if(!(M instanceof N)){throw new TypeError("Cannot call a class as a function")}}var K=(function(){function ac(){L(this,ac)}I(ac,null,[{key:"init",value:function af(){ac.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var am;for(am in ac.types){if(ac.types.hasOwnProperty(am)){ac.types[am]=[am.charCodeAt(0),am.charCodeAt(1),am.charCodeAt(2),am.charCodeAt(3)]}}ac.MAJOR_BRAND=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);ac.AVC1_BRAND=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);ac.MINOR_VERSION=new Uint8Array([0,0,0,1]);ac.VIDEO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);ac.AUDIO_HDLR=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);ac.HDLR_TYPES={video:ac.VIDEO_HDLR,audio:ac.AUDIO_HDLR};ac.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);ac.STCO=new Uint8Array([0,0,0,0,0,0,0,0]);ac.STSC=ac.STCO;ac.STTS=ac.STCO;ac.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);ac.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]);ac.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]);ac.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);ac.FTYP=ac.box(ac.types.ftyp,ac.MAJOR_BRAND,ac.MINOR_VERSION,ac.MAJOR_BRAND,ac.AVC1_BRAND);ac.DINF=ac.box(ac.types.dinf,ac.box(ac.types.dref,ac.DREF))}},{key:"box",value:function Z(aq){var ar=Array.prototype.slice.call(arguments,1),ap=0,ao=ar.length,am,an;while(ao--){ap+=ar[ao].byteLength}am=new Uint8Array(ap+8);an=new DataView(am.buffer);an.setUint32(0,am.byteLength);am.set(aq,4);for(ao=0,ap=8;ao<ar.length;ao++){am.set(ar[ao],ap);ap+=ar[ao].byteLength}return am}},{key:"hdlr",value:function O(am){return ac.box(ac.types.hdlr,ac.HDLR_TYPES[am])}},{key:"mdat",value:function N(am){return ac.box(ac.types.mdat,am)}},{key:"mdhd",value:function aj(am,an){return ac.box(ac.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,am>>24&255,am>>16&255,am>>8&255,am&255,an>>24,an>>16&255,an>>8&255,an&255,85,196,0,0]))}},{key:"mdia",value:function R(am){return ac.box(ac.types.mdia,ac.mdhd(am.timescale,am.duration),ac.hdlr(am.type),ac.minf(am))}},{key:"mfhd",value:function al(am){return ac.box(ac.types.mfhd,new Uint8Array([0,0,0,0,am>>24,am>>16&255,am>>8&255,am&255]))}},{key:"minf",value:function ab(am){if(am.type==="audio"){return ac.box(ac.types.minf,ac.box(ac.types.smhd,ac.SMHD),ac.DINF,ac.stbl(am))}else{return ac.box(ac.types.minf,ac.box(ac.types.vmhd,ac.VMHD),ac.DINF,ac.stbl(am))}}},{key:"moof",value:function U(ao,an,am){return ac.box(ac.types.moof,ac.mfhd(ao),ac.traf(am,an))}},{key:"moov",value:function ak(am){var ao=am.length,an=[];while(ao--){an[ao]=ac.trak(am[ao])}return ac.box.apply(null,[ac.types.moov,ac.mvhd(am[0].timescale,am[0].duration)].concat(an).concat(ac.mvex(am)))}},{key:"mvex",value:function W(am){var ao=am.length,an=[];while(ao--){an[ao]=ac.trex(am[ao])}return ac.box.apply(null,[ac.types.mvex].concat(an))}},{key:"mvhd",value:function ag(an,ao){var am=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,an>>24&255,an>>16&255,an>>8&255,an&255,ao>>24&255,ao>>16&255,ao>>8&255,ao&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return ac.box(ac.types.mvhd,am)}},{key:"sdtp",value:function aa(ao){var ap=ao.samples||[],an=new Uint8Array(4+ap.length),am,aq;for(aq=0;aq<ap.length;aq++){am=ap[aq].flags;an[aq+4]=am.dependsOn<<4|am.isDependedOn<<2|am.hasRedundancy}return ac.box(ac.types.sdtp,an)}},{key:"stbl",value:function X(am){return ac.box(ac.types.stbl,ac.stsd(am),ac.box(ac.types.stts,ac.STTS),ac.box(ac.types.stsc,ac.STSC),ac.box(ac.types.stsz,ac.STSZ),ac.box(ac.types.stco,ac.STCO))}},{key:"avc1",value:function Y(ao){var am=[],an=[],ap;for(ap=0;ap<ao.sps.length;ap++){am.push(ao.sps[ap].byteLength>>>8&255);am.push(ao.sps[ap].byteLength&255);am=am.concat(Array.prototype.slice.call(ao.sps[ap]))}for(ap=0;ap<ao.pps.length;ap++){an.push(ao.pps[ap].byteLength>>>8&255);an.push(ao.pps[ap].byteLength&255);an=an.concat(Array.prototype.slice.call(ao.pps[ap]))}return ac.box(ac.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,ao.width>>8&255,ao.width&255,ao.height>>8&255,ao.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),ac.box(ac.types.avcC,new Uint8Array([1,ao.profileIdc,ao.profileCompat,ao.levelIdc,255].concat([ao.sps.length]).concat(am).concat([ao.pps.length]).concat(an))),ac.box(ac.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function T(am){return new Uint8Array([0,0,0,0,3,23+am.config.length,0,1,0,4,15+am.config.length,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([am.config.length]).concat(am.config).concat([6,1,2]))}},{key:"mp4a",value:function ai(am){return ac.box(ac.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,am.channelCount,0,16,0,0,0,0,am.audiosamplerate>>8&255,am.audiosamplerate&255,0,0]),ac.box(ac.types.esds,ac.esds(am)))}},{key:"stsd",value:function V(am){if(am.type==="audio"){return ac.box(ac.types.stsd,ac.STSD,ac.mp4a(am))}else{return ac.box(ac.types.stsd,ac.STSD,ac.avc1(am))}}},{key:"tkhd",value:function ae(am){return ac.box(ac.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,am.id>>24&255,am.id>>16&255,am.id>>8&255,am.id&255,0,0,0,0,am.duration>>24,am.duration>>16&255,am.duration>>8&255,am.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,am.width>>8&255,am.width&255,0,0,am.height>>8&255,am.height&255,0,0]))}},{key:"traf",value:function Q(am,ao){var an=ac.sdtp(am);return ac.box(ac.types.traf,ac.box(ac.types.tfhd,new Uint8Array([0,0,0,0,am.id>>24,am.id>>16&255,am.id>>8&255,am.id&255])),ac.box(ac.types.tfdt,new Uint8Array([0,0,0,0,ao>>24,ao>>16&255,ao>>8&255,ao&255])),ac.trun(am,an.length+16+16+8+16+8+8),an)}},{key:"trak",value:function M(am){am.duration=am.duration||4294967295;return ac.box(ac.types.trak,ac.tkhd(am),ac.mdia(am))}},{key:"trex",value:function P(am){return ac.box(ac.types.trex,new Uint8Array([0,0,0,0,am.id>>24,am.id>>16&255,am.id>>8&255,am.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function ah(am,aq){var an,ap,ao,ar;an=am.samples||[];ar=new Uint8Array(12+16*an.length);aq+=8+ar.byteLength;ar.set([0,0,15,1,an.length>>>24&255,an.length>>>16&255,an.length>>>8&255,an.length&255,aq>>>24&255,aq>>>16&255,aq>>>8&255,aq&255],0);for(ao=0;ao<an.length;ao++){ap=an[ao];ar.set([ap.duration>>>24&255,ap.duration>>>16&255,ap.duration>>>8&255,ap.duration&255,ap.size>>>24&255,ap.size>>>16&255,ap.size>>>8&255,ap.size&255,ap.flags.isLeading<<2|ap.flags.dependsOn,ap.flags.isDependedOn<<6|ap.flags.hasRedundancy<<4|ap.flags.paddingValue<<1|ap.flags.isNonSync,ap.flags.degradPrio&240<<8,ap.flags.degradPrio&15,ap.cts>>>24&255,ap.cts>>>16&255,ap.cts>>>8&255,ap.cts&255],12+16*ao)}return ac.box(ac.types.trun,ar)}},{key:"initSegment",value:function S(ao){if(!ac.types){ac.init()}var an=ac.moov(ao),am;am=new Uint8Array(ac.FTYP.byteLength+an.byteLength);am.set(ac.FTYP);am.set(an,ac.FTYP.byteLength);return am}}]);return ac})();G["default"]=K;J.exports=G["default"]},{}],17:[function(I,H,L){Object.defineProperty(L,"__esModule",{value:true});var K=(function(){function T(X,V){for(var U=0;U<V.length;U++){var W=V[U];W.enumerable=W.enumerable||false;W.configurable=true;if("value" in W){W.writable=true}Object.defineProperty(X,W.key,W)}}return function(W,U,V){if(U){T(W.prototype,U)}if(V){T(W,V)}return W}})();function S(T){return T&&T.__esModule?T:{"default":T}}function M(T,U){if(!(T instanceof U)){throw new TypeError("Cannot call a class as a function")}}var N=I("../events");var P=S(N);var R=I("../utils/logger");var G=I("../remux/mp4-generator");var Q=S(G);var J=I("../errors");var O=(function(){function Y(af){M(this,Y);this.observer=af;this.ISGenerated=false;this.PES2MP4SCALEFACTOR=4;this.PES_TIMESCALE=90000;this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}K(Y,[{key:"destroy",value:function ae(){}},{key:"insertDiscontinuity",value:function ac(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=undefined}},{key:"switchLevel",value:function ab(){this.ISGenerated=false}},{key:"remux",value:function Z(ah,ai,ag,af){if(!this.ISGenerated){this.generateIS(ah,ai,af)}if(ai.samples.length){this.remuxVideo(ai,af)}if(ah.samples.length){this.remuxAudio(ah,af)}if(ag.samples.length){this.remuxID3(ag,af)}this.observer.trigger(P["default"].FRAG_PARSED)}},{key:"generateIS",value:function X(ah,al,an){var ak=this.observer,ag=ah.samples,af=al.samples,am=ag.length,ai=af.length,aj=this.PES_TIMESCALE;if(am===0&&ai===0){ak.trigger(P["default"].ERROR,{type:J.ErrorTypes.MEDIA_ERROR,details:J.ErrorDetails.FRAG_PARSING_ERROR,fatal:false,reason:"no audio/video samples found"})}else{if(ai===0){if(ah.config){ak.trigger(P["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:Q["default"].initSegment([ah]),audioCodec:ah.codec,audioChannelCount:ah.channelCount});this.ISGenerated=true}if(this._initPTS===undefined){this._initPTS=ag[0].pts-aj*an;this._initDTS=ag[0].dts-aj*an}}else{if(am===0){if(al.sps&&al.pps){ak.trigger(P["default"].FRAG_PARSING_INIT_SEGMENT,{videoMoov:Q["default"].initSegment([al]),videoCodec:al.codec,videoWidth:al.width,videoHeight:al.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=af[0].pts-aj*an;this._initDTS=af[0].dts-aj*an}}}else{if(ah.config&&al.sps&&al.pps){ak.trigger(P["default"].FRAG_PARSING_INIT_SEGMENT,{audioMoov:Q["default"].initSegment([ah]),audioCodec:ah.codec,audioChannelCount:ah.channelCount,videoMoov:Q["default"].initSegment([al]),videoCodec:al.codec,videoWidth:al.width,videoHeight:al.height});this.ISGenerated=true;if(this._initPTS===undefined){this._initPTS=Math.min(af[0].pts,ag[0].pts)-aj*an;this._initDTS=Math.min(af[0].dts,ag[0].dts)-aj*an}}}}}}},{key:"remuxVideo",value:function V(ax,av){var aq,ay=8,ag=this.PES_TIMESCALE,af=this.PES2MP4SCALEFACTOR,aB,aj,ao,au,ah,ak,ap,az,aw,aD,an,al,at,ar=[];ah=new Uint8Array(ax.len+4*ax.nbNalu+8);aq=new DataView(ah.buffer);aq.setUint32(0,ah.byteLength);ah.set(Q["default"].types.mdat,4);while(ax.samples.length){aB=ax.samples.shift();ao=0;while(aB.units.units.length){au=aB.units.units.shift();aq.setUint32(ay,au.data.byteLength);ay+=4;ah.set(au.data,ay);ay+=au.data.byteLength;ao+=4+au.data.byteLength}aD=aB.pts-this._initDTS;an=aB.dts-this._initDTS;if(aw!==undefined){al=this._PTSNormalize(aD,aw);at=this._PTSNormalize(an,aw);aj.duration=(at-aw)/af;if(aj.duration<0){aj.duration=0}}else{al=this._PTSNormalize(aD,this.nextAvcDts);at=this._PTSNormalize(an,this.nextAvcDts);if(this.nextAvcDts){var aC=Math.round((at-this.nextAvcDts)/90),ai=Math.abs(aC);if(ai<300){if(aC>1){R.logger.log("AVC:"+aC+" ms hole between fragments detected,filling it")}else{if(aC<-1){R.logger.log("AVC:"+-aC+" ms overlapping between fragments detected")}}if(ai){at=this.nextAvcDts;al=Math.max(al-aC,at);R.logger.log("Video/PTS/DTS adjusted:"+al+"/"+at)}}else{var aA=ag*av;if(Math.abs(aA-at)>ag*3600){var am=aA-at;at=aA;al=at;this._initPTS-=am;this._initDTS-=am}}}ap=Math.max(0,al);az=Math.max(0,at)}aj={size:ao,duration:0,cts:(al-at)/af,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}};if(aB.key===true){aj.flags.dependsOn=2;aj.flags.isNonSync=0}else{aj.flags.dependsOn=1;aj.flags.isNonSync=1}ar.push(aj);aw=at}if(ar.length>=2){aj.duration=ar[ar.length-2].duration}this.nextAvcDts=at+aj.duration*af;ax.len=0;ax.nbNalu=0;ax.samples=ar;ak=Q["default"].moof(ax.sequenceNumber++,az/af,ax);ax.samples=[];this.observer.trigger(P["default"].FRAG_PARSING_DATA,{moof:ak,mdat:ah,startPTS:ap/ag,endPTS:(al+af*aj.duration)/ag,startDTS:az/ag,endDTS:(at+af*aj.duration)/ag,type:"video",nb:ar.length})}},{key:"remuxAudio",value:function aa(ay,aw){var aq,az=8,ah=this.PES_TIMESCALE,ag=this.PES2MP4SCALEFACTOR,ao,ak,av,ai,al,ap,aA,ax,aC,an,am,au,at=[];ai=new Uint8Array(ay.len+8);aq=new DataView(ai.buffer);aq.setUint32(0,ai.byteLength);ai.set(Q["default"].types.mdat,4);while(ay.samples.length){ao=ay.samples.shift();av=ao.unit;ai.set(av,az);az+=av.byteLength;aC=ao.pts-this._initDTS;an=ao.dts-this._initDTS;if(ax!==undefined){am=this._PTSNormalize(aC,ax);au=this._PTSNormalize(an,ax);ak.duration=(au-ax)/ag;if(ak.duration<0){ak.duration=0}}else{am=this._PTSNormalize(aC,this.nextAacPts);au=this._PTSNormalize(an,this.nextAacPts);if(this.nextAacPts&&this.nextAacPts!==am){var aB=Math.round(1000*(am-this.nextAacPts)/ah),aj=Math.abs(aB);if(aj>1&&aj<300){if(aB>0){R.logger.log("AAC:"+aB+" ms hole between fragments detected,filling it")}else{R.logger.log("AAC:"+-aB+" ms overlapping between fragments detected")}am=au=this.nextAacPts;R.logger.log("Audio/PTS/DTS adjusted:"+am+"/"+au)}else{if(aj){var ar=ah*aw;if(Math.abs(ar-am)>ah*3600){var af=ar-am;am=ar;au=am;this._initPTS-=af;this._initDTS-=af}}}}ap=Math.max(0,am);aA=Math.max(0,au)}ak={size:av.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}};at.push(ak);ax=au}if(at.length>=2){ak.duration=at[at.length-2].duration}this.nextAacPts=am+ag*ak.duration;ay.len=0;ay.samples=at;al=Q["default"].moof(ay.sequenceNumber++,aA/ag,ay);ay.samples=[];this.observer.trigger(P["default"].FRAG_PARSING_DATA,{moof:al,mdat:ai,startPTS:ap/ah,endPTS:this.nextAacPts/ah,startDTS:aA/ah,endDTS:(au+ag*ak.duration)/ah,type:"audio",nb:at.length})}},{key:"remuxID3",value:function U(ag,af){var aj=ag.samples.length,ai;if(aj){for(var ah=0;ah<aj;ah++){ai=ag.samples[ah];ai.pts=(ai.pts-this._initPTS)/this.PES_TIMESCALE;ai.dts=(ai.dts-this._initDTS)/this.PES_TIMESCALE}this.observer.trigger(P["default"].FRAG_PARSING_METADATA,{samples:ag.samples})}ag.samples=[];af=af}},{key:"_PTSNormalize",value:function W(ag,af){var ah;if(af===undefined){return ag}if(af<ag){ah=-8589934592}else{ah=8589934592}while(Math.abs(ag-af)>4294967296){ag+=ah}return ag}},{key:"timescale",get:function T(){return this.MP4_TIMESCALE}}]);return Y})();L["default"]=O;H.exports=L["default"]},{"../errors":10,"../events":11,"../remux/mp4-generator":16,"../utils/logger":19}],18:[function(H,G,J){Object.defineProperty(J,"__esModule",{value:true});var I=(function(){function P(T,R){for(var Q=0;Q<R.length;Q++){var S=R[Q];S.enumerable=S.enumerable||false;S.configurable=true;if("value" in S){S.writable=true}Object.defineProperty(T,S.key,S)}}return function(S,Q,R){if(Q){P(S.prototype,Q)}if(R){P(S,R)}return S}})();function O(P){return P&&P.__esModule?P:{"default":P}}function K(P,Q){if(!(P instanceof Q)){throw new TypeError("Cannot call a class as a function")}}var L=H("./events");var M=O(L);var N=(function(){function Y(aa){K(this,Y);this.hls=aa;this.onmp=this.onManifestParsed.bind(this);this.onfc=this.onFragmentChanged.bind(this);this.onfb=this.onFragmentBuffered.bind(this);this.onflea=this.onFragmentLoadEmergencyAborted.bind(this);this.onerr=this.onError.bind(this);this.onfpsd=this.onFPSDrop.bind(this);aa.on(M["default"].MANIFEST_PARSED,this.onmp);aa.on(M["default"].FRAG_BUFFERED,this.onfb);aa.on(M["default"].FRAG_CHANGED,this.onfc);aa.on(M["default"].ERROR,this.onerr);aa.on(M["default"].FRAG_LOAD_EMERGENCY_ABORTED,this.onflea);aa.on(M["default"].FPS_DROP,this.onfpsd)}I(Y,[{key:"destroy",value:function X(){var aa=this.hls;aa.off(M["default"].MANIFEST_PARSED,this.onmp);aa.off(M["default"].FRAG_BUFFERED,this.onfb);aa.off(M["default"].FRAG_CHANGED,this.onfc);aa.off(M["default"].ERROR,this.onerr);aa.off(M["default"].FRAG_LOAD_EMERGENCY_ABORTED,this.onflea);aa.off(M["default"].FPS_DROP,this.onfpsd)}},{key:"attachVideo",value:function T(aa){this.video=aa}},{key:"detachVideo",value:function V(){this.video=null}},{key:"onManifestParsed",value:function P(aa,ab){this._stats={tech:"hls.js",levelNb:ab.levels.length}}},{key:"onFragmentChanged",value:function Q(ac,ae){var ab=this._stats,af=ae.frag.level,aa=ae.frag.autoLevel;if(ab){if(ab.levelStart===undefined){ab.levelStart=af}if(aa){if(ab.fragChangedAuto){ab.autoLevelMin=Math.min(ab.autoLevelMin,af);ab.autoLevelMax=Math.max(ab.autoLevelMax,af);ab.fragChangedAuto++;if(this.levelLastAuto&&af!==ab.autoLevelLast){ab.autoLevelSwitch++}}else{ab.autoLevelMin=ab.autoLevelMax=af;ab.autoLevelSwitch=0;ab.fragChangedAuto=1;this.sumAutoLevel=0}this.sumAutoLevel+=af;ab.autoLevelAvg=Math.round(1000*this.sumAutoLevel/ab.fragChangedAuto)/1000;ab.autoLevelLast=af}else{if(ab.fragChangedManual){ab.manualLevelMin=Math.min(ab.manualLevelMin,af);ab.manualLevelMax=Math.max(ab.manualLevelMax,af);ab.fragChangedManual++;if(!this.levelLastAuto&&af!==ab.manualLevelLast){ab.manualLevelSwitch++}}else{ab.manualLevelMin=ab.manualLevelMax=af;ab.manualLevelSwitch=0;ab.fragChangedManual=1}ab.manualLevelLast=af}this.levelLastAuto=aa}}},{key:"onFragmentBuffered",value:function W(ac,af){var aa=this._stats,ae=af.stats.tfirst-af.stats.trequest,ag=af.stats.tbuffered-af.stats.trequest,ab=Math.round(8*af.stats.length/(af.stats.tbuffered-af.stats.tfirst));if(aa.fragBuffered){aa.fragMinLatency=Math.min(aa.fragMinLatency,ae);aa.fragMaxLatency=Math.max(aa.fragMaxLatency,ae);aa.fragMinProcess=Math.min(aa.fragMinProcess,ag);aa.fragMaxProcess=Math.max(aa.fragMaxProcess,ag);aa.fragMinKbps=Math.min(aa.fragMinKbps,ab);aa.fragMaxKbps=Math.max(aa.fragMaxKbps,ab);aa.autoLevelCappingMin=Math.min(aa.autoLevelCappingMin,this.hls.autoLevelCapping);aa.autoLevelCappingMax=Math.max(aa.autoLevelCappingMax,this.hls.autoLevelCapping);aa.fragBuffered++}else{aa.fragMinLatency=aa.fragMaxLatency=ae;aa.fragMinProcess=aa.fragMaxProcess=ag;aa.fragMinKbps=aa.fragMaxKbps=ab;aa.fragBuffered=1;aa.fragBufferedBytes=0;aa.autoLevelCappingMin=aa.autoLevelCappingMax=this.hls.autoLevelCapping;this.sumLatency=0;this.sumKbps=0;this.sumProcess=0}aa.fraglastLatency=ae;this.sumLatency+=ae;aa.fragAvgLatency=Math.round(this.sumLatency/aa.fragBuffered);aa.fragLastProcess=ag;this.sumProcess+=ag;aa.fragAvgProcess=Math.round(this.sumProcess/aa.fragBuffered);aa.fragLastKbps=ab;this.sumKbps+=ab;aa.fragAvgKbps=Math.round(this.sumKbps/aa.fragBuffered);aa.fragBufferedBytes+=af.stats.length;aa.autoLevelCappingLast=this.hls.autoLevelCapping}},{key:"onFragmentLoadEmergencyAborted",value:function U(){var aa=this._stats;if(aa){if(aa.fragLoadEmergencyAborted===undefined){aa.fragLoadEmergencyAborted=1}else{aa.fragLoadEmergencyAborted++}}}},{key:"onError",value:function S(ab,ac){var aa=this._stats;if(aa){if(aa[ac.details]===undefined){aa[ac.details]=1}else{aa[ac.details]+=1}if(ac.fatal){if(aa.fatalError===undefined){aa.fatalError=1}else{aa.fatalError+=1}}}}},{key:"onFPSDrop",value:function Z(ab,ac){var aa=this._stats;if(aa){if(aa.fpsDropEvent===undefined){aa.fpsDropEvent=1}else{aa.fpsDropEvent++}aa.fpsTotalDroppedFrames=ac.totalDroppedFrames}}},{key:"stats",get:function R(){if(this.video){this._stats.lastPos=this.video.currentTime.toFixed(3)}return this._stats}}]);return Y})();J["default"]=N;G.exports=J["default"]},{"./events":11}],19:[function(K,L,I){Object.defineProperty(I,"__esModule",{value:true});function M(){}var N={log:M,warn:M,info:M,error:M};var H=N;var G=function G(O){if(O===true||typeof O==="object"){H.log=O.log?O.log.bind(O):console.log.bind(console);H.info=O.info?O.info.bind(O):console.info.bind(console);H.error=O.error?O.error.bind(O):console.error.bind(console);H.warn=O.warn?O.warn.bind(O):console.warn.bind(console);try{H.log()}catch(P){H.log=M;H.info=M;H.error=M;H.warn=M}}else{H=N}};I.enableLogs=G;var J=H;I.logger=J},{}],20:[function(J,L,I){Object.defineProperty(I,"__esModule",{value:true});var K=(function(){function N(R,P){for(var O=0;O<P.length;O++){var Q=P[O];Q.enumerable=Q.enumerable||false;Q.configurable=true;if("value" in Q){Q.writable=true}Object.defineProperty(R,Q.key,Q)}}return function(Q,O,P){if(O){N(Q.prototype,O)}if(P){N(Q,P)}return Q}})();function M(N,O){if(!(N instanceof O)){throw new TypeError("Cannot call a class as a function")}}var H=J("../utils/logger");var G=(function(){function O(W){M(this,O);if(W&&W.xhrSetup){this.xhrSetup=W.xhrSetup}}K(O,[{key:"destroy",value:function U(){this.abort();this.loader=null}},{key:"abort",value:function Q(){if(this.loader&&this.loader.readyState!==4){this.stats.aborted=true;this.loader.abort()}if(this.timeoutHandle){window.clearTimeout(this.timeoutHandle)}}},{key:"load",value:function V(W,X,Z,Y,aa,ab,ac,af){var ae=arguments.length<=8||arguments[8]===undefined?null:arguments[8];this.url=W;this.responseType=X;this.onSuccess=Z;this.onProgress=ae;this.onTimeout=aa;this.onError=Y;this.stats={trequest:new Date(),retry:0};this.timeout=ab;this.maxRetry=ac;this.retryDelay=af;this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),ab);this.loadInternal()}},{key:"loadInternal",value:function R(){var W=this.loader=new XMLHttpRequest();W.onload=this.loadsuccess.bind(this);W.onerror=this.loaderror.bind(this);W.onprogress=this.loadprogress.bind(this);W.open("GET",this.url,true);W.responseType=this.responseType;this.stats.tfirst=null;this.stats.loaded=0;if(this.xhrSetup){this.xhrSetup(W)}W.send()}},{key:"loadsuccess",value:function P(W){window.clearTimeout(this.timeoutHandle);this.stats.tload=new Date();this.onSuccess(W,this.stats)}},{key:"loaderror",value:function S(W){if(this.stats.retry<this.maxRetry){H.logger.warn(W.type+" while loading "+this.url+", retrying in "+this.retryDelay+"...");this.destroy();window.setTimeout(this.loadInternal.bind(this),this.retryDelay);this.retryDelay=Math.min(2*this.retryDelay,64000);this.stats.retry++}else{window.clearTimeout(this.timeoutHandle);H.logger.error(W.type+" while loading "+this.url);this.onError(W)}}},{key:"loadtimeout",value:function N(W){H.logger.warn("timeout while loading "+this.url);this.onTimeout(W,this.stats)}},{key:"loadprogress",value:function T(X){var W=this.stats;if(W.tfirst===null){W.tfirst=new Date()}W.loaded=X.loaded;if(this.onProgress){this.onProgress(X,W)}}}]);return O})();I["default"]=G;L.exports=I["default"]},{"../utils/logger":19}]},{},[13])(13)});function B(C){this.width="100%";this.height="100%";u(this,C);this.video=document.createElement("VIDEO");if(C.poster){this.video.poster=C.poster}this.video.controls=C.useDefaultControls}B.prototype=u(Object.create(CustomObject),{is_ready:false,isSupported:function(){return typeof document.createElement("VIDEO").play=="function"},isHLS:function(C){return["application/x-mpegURL","application/vnd.apple.mpegurl"].indexOf(C)>-1},canPlayTypeNative:function(C){var D=d();if(this.isHLS(C)){if(D.is_android&&D.version[0]>=4){return true}}return["maybe","probably"].indexOf(document.createElement("VIDEO").canPlayType(C))>-1},canPlayType:function(C){if(this.canPlayTypeNative(C)){return true}if(Hls.isSupported()){return true}return false},setSource:function(F,E){var C=this;if(this.canPlayTypeNative(E)){this.video.src=F;this.video.load()}else{if(this.isHLS(E)){var D=new Hls({fragLoadingTimeOut:100000,maxBufferLength:30});D.attachVideo(this.video);D.loadSource(F);D.on(Hls.Events.ERROR,function(H,G){console.log(G);if(G.fatal){C.trigger("error",201)}})}}},getElement:function(){return this.video},destroy:function(){this.video.oncontextmenu=null},setWidth:function(C){this.video.style.width=C},setHeight:function(C){this.video.style.height=C},init:function(){var C=this;this.setWidth(this.width);this.setHeight(this.height);this.initEvents();this.on("ready",function(){C.is_ready=true});this.trigger("ready")},initEvents:function(){var C=this;this.video.onerror=function(){};this.video.oncontextmenu=function(){event.preventDefault()};this.video.addEventListener("loadedmetadata",function(){C.trigger("canplay")});this.video.addEventListener("durationchange",function(){C.trigger("durationchange",this.duration)});this.video.addEventListener("volumechange",function(){C.trigger("volumechange",this.muted?0:this.volume)});this.video.addEventListener("timeupdate",function(){var D=null;for(var E=0;E<this.buffered.length;E++){if(this.currentTime>this.buffered.start(E)&&this.currentTime<this.buffered.end(E)){D=this.duration-this.buffered.end(E)<0.5||Math.abs(this.currentTime-this.buffered.end(E))>0.5;break}}if(D!==null){if(D){if(C.is_waiting){C.trigger("playing");C.is_waiting=false}}else{C.is_waiting=true;C.trigger("waiting")}}C.trigger("timeupdate",this.currentTime);if(this.duration&&this.duration-this.currentTime<0.5){C.trigger("ended");this.pause();this.currentTime=0}});this.video.addEventListener("ended",function(){C.trigger("ended")});this.video.addEventListener("waiting",function(){C.trigger("waiting")});this.video.addEventListener("playing",function(){C.trigger("playing")});this.video.addEventListener("play",function(){C.trigger("play")});this.video.addEventListener("pause",function(){C.trigger("pause")});this.video.addEventListener("canplay",function(){C.trigger("canplay")});this.video.addEventListener("seeking",function(){C.trigger("seeking")});this.video.addEventListener("seeked",function(){C.trigger("seeked")});this.video.addEventListener("progress",function(){var E=[];for(var D=0;D<this.buffered.length;D++){E.push([this.buffered.start(D),this.buffered.end(D)])}C.trigger("progress",E)})},play:function(){this.video.play()},pause:function(){this.video.pause()},getCurrentTime:function(){return this.video.currentTime},getDuration:function(){return this.video.duration},setCurrentTime:function(C){if(this.video.readyState!=HTMLMediaElement.HAVE_NOTHING){this.video.currentTime=Math.max(0,Math.min(this.video.duration-0.9,C))}},setVolume:function(C){C=Math.max(0,Math.min(1,C||0));this.video.volume=C;this.video.muted=!C},getVolume:function(){return this.video.volume}});return B})();x.prototype.__backends.HTML5=HTML5Backend;function p(B){this.flash_swf=null;q(this,B);this.swf=document.createElement("OBJECT")}p.prototype=u(Object.create(CustomObject),{is_ready:false,_flashFn:function(C){var B="window";var D="__"+Math.random().toString(16).split(".")[1];window[D]=function(){C.apply(window,arguments)};return B+"."+D},init:function(){var B=this;this.on("ready",function(){B.is_ready=true});this.swf.setAttribute("type","application/x-shockwave-flash");this.swf.setAttribute("width","100%");this.swf.setAttribute("height","100%");this.swf.setAttribute("data",this.flash_swf);j(this.swf,"screen");var E={wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all",quality:"high",flashvars:"readyFunction="+this._flashFn(function(){B.initEvents()})};for(var C in E){var D=document.createElement("PARAM");D.setAttribute("name",C);D.setAttribute("value",E[C]);this.swf.appendChild(D)}},isSupported:function(){return v()},canPlayType:function(B){return["video/mp4","video/flv","video/x-flv","video/m4v","application/x-mpegURL"].indexOf(B)>-1},getElement:function(){return this.swf},destroy:function(){clearInterval(this._play_interval)},initEvents:function(){var B=this;this.swf.vjs_setProperty("eventProxyFunction",this._flashFn(function(D,C){switch(C){case"playing":B.trigger("playing");break;case"seeked":B.trigger("seeked");break;case"waiting":B.trigger("waiting");break;case"ended":B.trigger("ended");break;case"canplay":case"loadedmetadata":B.trigger("canplay");break;case"play":B.trigger("play");break;case"volumechange":B.trigger("volumechange",B.getVolume());break;case"durationchange":B.trigger("durationchange",B.getDuration());break}}));this.swf.vjs_setProperty("errorEventProxyFunction",this._flashFn(function(D,C){switch(C){case"srcnotfound":B.trigger("error",201);break;default:B.trigger("error",200)}}));this.on("play",function(){B.__timeupdate=setInterval(function(){B.trigger("progress",[[0,B.swf.vjs_getProperty("buffered")]]);B.trigger("timeupdate",B.getCurrentTime())},500)});this.on(["pause","ended"],function(){clearInterval(B.__timeupdate)});this.trigger("ready")},setSource:function(B){this.swf.vjs_src(B)},play:function(){this.swf.vjs_play()},pause:function(){this.swf.vjs_pause();this.trigger("pause")},getCurrentTime:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("currentTime")}return 0},getDuration:function(){if(this.swf.vjs_getProperty){return this.swf.vjs_getProperty("duration")}return 0},setCurrentTime:function(B){this.swf.vjs_setProperty("currentTime",B)},setVolume:function(B){this.swf.vjs_setProperty("volume",B)},getVolume:function(B){return this.swf.vjs_getProperty("volume")}});x.prototype.__backends.Flash=p;function c(D,C){var B=this;this.player=D;this.is_fullscreen=false;if(this.checkSupportFullscreen()){this.init()}}c.prototype={init:function(){var B=this;f(document,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","msfullscreenchange"],function(C){B.player.trigger("fullscreenchange",B.checkFullscreen())});this.player.on("tray_ready",function(D,C){C.appendChild(B.getUI())})},getUI:function(){var B=this;var D=g('<div class="fullscreen"><svg><path class="on" d="M18,18V6H6v12H18z M8,16V8h8v8H8z M22,2v6h-2V4h-4V2H22z M20,16h2v6h-6v-2h4V16z M4,20h4v2H2v-6h2V20z M4,8H2V2h6v2H4V8z"/><path class="off" d="M18,8v2h-4V6h2v2H18z M14,14v4h2v-2h2v-2H14z M6,14v2h2v2h2v-4H6z M8,8H6v2h4V6H8 V8z M22,2v20H2V2H22z M20,4H4v16h16V4z"/></svg></div>');var C=D.getElementsByClassName("on")[0];var E=D.getElementsByClassName("off")[0];f(D,"click",function(){if(B.is_fullscreen){B.exitFullscreen()}else{B.requestFullscreen()}});this.player.on("fullscreenchange",function(G,F){B.is_fullscreen=F;if(B.is_fullscreen){j(B.player.root,"fullscreen");D.title="Exit from Fullscreen";C.style.display="none";E.style.display=""}else{l(B.player.root,"fullscreen");D.title="Fullscreen";C.style.display="";E.style.display="none"}});this.player.trigger("fullscreenchange");return D},checkFullscreen:function(){return(document.fullscreenElement&&document.fullscreenElement!==null)||document.mozFullScreen||document.webkitIsFullScreen},checkSupportFullscreen:function(){if(d().is_android){return false}return document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen||document.createElement("video").webkitEnterFullscreen},requestFullscreen:function(){var C=this;var D=document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen;if(D){D.call(this.player.root);this.is_fullscreen=true}else{var B=this.player.backend.getElement();if(B.webkitEnterFullscreen){this.is_fullscreen=true;f(B,"webkitendfullscreen",function(E){y(B,E.type);C.is_fullscreen=false});B.webkitEnterFullscreen()}}},exitFullscreen:function(){var B=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;if(B){B.call(document);this.is_fullscreen=false}}};x.prototype.__plugins.FullScreen=c;VASTPlugin=(function(){function D(X,Z){var Y=((new Date).getTime()/1000)|0;var Z=u({CACHEBUSTER:Y,CACHE_BUSTER:Y,timestamp:Y},Z);w(k(Z),function(aa){X=X.replace("["+aa+"]",encodeURIComponent(Z[aa]))});return X}function K(Y,aa){var X=new Image;var Y=D(Y,aa);var Z=Y.indexOf("?")==-1?"?":"&";X.src=Y}function V(X,Y){window.open(D(X,Y),"_blank")}function G(X){var Y={};if(X){w(X.getElementsByTagName("Tracking"),function(Z){var ab={};var aa=Z.getAttribute("event");if(typeof Y[aa]==="undefined"){Y[aa]=[]}ab.content=Z.textContent;w(Z.attributes,function(ac){ab[ac.name]=ac.value});Y[aa].push(ab)})}return Y}function L(X){X=X.trim();if(match=/^(\d{1,2}):(\d{1,2}):(\d{1,2})/.exec(X)){return{type:"seconds",value:parseInt(match[1])*3600+parseInt(match[2])*60+parseInt(match[3])}}if(match=/^(\d{1,3})%$/.exec(X)){return{type:"percent",value:parseInt(match[1])}}}function R(X,Y){if(X=="html"){elm=document.createElement("DIV");elm.innerHTML=Y}else{if(X=="iframe"){elm=document.createElement("IFRAME");elm.src=Y;elm.style.border="none";elm.scrolling="no"}else{if(X=="application/x-shockwave-flash"){elm=document.createElement("OBJECT");elm.setAttribute("type","application/x-shockwave-flash");elm.setAttribute("data",Y)}else{elm=document.createElement("IMG");elm.src=Y}}}return elm}function N(Y){if(Y&&Y.length){for(var X=0;X<Y.length;X++){K(Y[X].content)}}}function B(Y){var X=this;this.type;this.src;this.creative;u(this,Y);this.vpaid=null;this.on("vpaidevent",function(ae,ac,ab){switch(ac){case"AdLoaded":X.vpaid.startAd();break;case"AdClickThru":var aa=ab[0];var Z=ab[2];X.trigger("vastevent","clickthru",{click_through:aa,no_fire_pixel:!Z},X);break;case"AdSkipped":X.trigger("vastevent","skip",{},X);break;case"AdStopped":X.trigger("vastevent","complete",{},X);break;case"AdError":X.trigger("vasterror",901,ab);break;case"AdStarted":X.trigger("vastevent","start",{},X);X.trigger("vastevent","creativeView",{},X);break;case"AdVideoFirstQuartile":X.trigger("vastevent","firstQuartile",{},X);break;case"AdVideoMidpoint":X.trigger("vastevent","midpoint",{},X);break;case"AdVideoThirdQuartile":X.trigger("vastevent","thirdQuartile",{},X);break}})}B.prototype=u(Object.create(CustomObject),{vpaidEventsList:["AdLoaded","AdSkipped","AdStarted","AdStopped","AdLinearChange","AdSkippableStateChange","AdSizeChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],show:function(Y,ac,X,aa){var Z=this;var ab=g('<iframe id="iframe" frameborder="no" scrolling="no" allowfullscreen></iframe>');ab.width=ac;ab.height=X;Y.appendChild(ab);var ae=setTimeout(function(){Z.trigger("vasterror",900,"Timeout VPAID AdLoaded event")},aa.timeout);this.on("vpaidevent",function(ag,af){if(af=="AdLoaded"||af=="AdStarted"||af=="AdError"){clearTimeout(ae)}});if(this.type=="application/x-shockwave-flash"){this.showFlash(ab,ac,X,aa)}else{this.showJS(ab,ac,X,aa,ab)}},showFlash:function(Z,X,af,ah){var ag=this;var ac=Z.contentDocument;var aa=Z.contentWindow;var ae="_custom_player_vpaid_on_ready"+Math.random().toString(16).split(".")[1];var ab="_custom_player_vpaid_on_error"+Math.random().toString(16).split(".")[1];var Y=function(aj,ai){var ak="_custom_player_vpaid_"+aj+Math.random().toString(16).split(".")[1];Z.contentWindow[ak]=ai;ag.vpaid.subscribe(aj,ak)};Z.contentWindow[ab]=function(){ag.trigger("vpaidevent","AdError")};Z.contentWindow[ae]=function(){ag.vpaid=Z.contentWindow.vpaid;console.log("--VPAID version:",ag.vpaid.handshakeVersion("2.0"));console.log("getAdLinear:",ag.vpaid.getAdLinear());Y("AdLoaded",function(){ag.vpaid.startAd()});w(ag.vpaidEventsList,function(ai){Y(ai,function(aj){ag.trigger("vpaidevent",ai,aj)})});ag.vpaid.initAd(X,af,"normal",500,ag.creative.params,"")};ac.open();ac.write('<body style="padding:0; margin:0; width:100%; height:100%;"><object id="vpaid" type="application/x-shockwave-flash" width="100%" height="100%" data="'+ah.vpaid_flash_bridge+'"><param name="allowScriptAccess" value="always"></param><param name="allowNetworking" value="all"></param><param name="wmode" value="transparent"><param name="flashvars" value="onReady='+ae+"&onError="+ab+"&src="+encodeURIComponent(this.src)+'"></param></object></body>');ac.close();console.log(this)},showJS:function(ab,aa,X,Z){var Y=this;ab.contentWindow.trigger_error=function(){Y.trigger("vpaidevent","AdError","Can't load vpaid file")};ab.contentWindow.trigger_load=function(){var ac=ab.contentWindow.getVPAIDAd;if(typeof ac!=="function"){Y.trigger("vasterror",901,"General VPAID error.",Y.creative);return}Y.vpaid=ac();w(Y.vpaidEventsList,function(ae){Y.vpaid.subscribe(function(){Y.trigger("vpaidevent",ae,arguments)},ae)});Y.vpaid.initAd(aa,X,"normal",500,Y.creative.params,{slot:ab.contentDocument.body})};ab.contentDocument.open();ab.contentDocument.write('<body style="margin:0; padding:0; width:100%; height:100%;"><script src="'+this.src+'" onload="trigger_load()" onerror="trigger_error()"><\/script></body>');ab.contentDocument.close()},getIsSupport:function(){var X=["application/javascript","application/x-javascript"];if(v()){X.push("application/x-shockwave-flash")}return X.indexOf(this.type)>-1}});function I(Y){var X=this;this.type;this.src;this.creative;u(this,Y);this.player=null;this.use_html5=false;this.use_flash=false}I.prototype=u(Object.create(CustomObject),{show:function(Y,ac,X,aa){var Z=this;this.player=new x(Y,aa);this.player.on("error",function(){});this.player.on("ended",function(){Z.trigger("vastevent","complete",{},Z.creative)});this.player.on("canplay",function(af){af.handler.remove();Z.trigger("start",Z);Z.player.play()});this.player.on("pause",function(){Z.trigger("vastevent","pause",{},Z.creative)});this.player.on("resume",function(){Z.trigger("vastevent","resume",{},Z.creative)});var ab;this.player.on("volumechange",function(ag,af){if(af>0&&ab==0){Z.trigger("vastevent","unmute",{},Z.creative)}if(af==0&&ab!=0){Z.trigger("vastevent","mute",{},Z.creative)}ab=af});var ae=0;this.player.on("timeupdate",function(ah,ag){var af=ag/this.getDuration()*100;if(af>0&&ae==0){ae++;Z.trigger("vastevent","start",{},Z.creative);Z.trigger("vastevent","creativeView",{},Z.creative)}if(af>25&&ae==1){ae++;Z.trigger("vastevent","firstQuartile",{},Z.creative)}if(af>50&&ae==2){ae++;Z.trigger("vastevent","midpoint",{},Z.creative)}if(af>75&&ae==3){ae++;Z.trigger("vastevent","thirdQuartile",{},Z.creative)}});this.player.setSources([{src:this.src,type:this.type}]);this.player.load()},getIsSupport:function(){return x.prototype.supportMedia(this.type)}});function U(Y,X){this.creative;this.is_vpaid=false;u(this,X);this.is_error=false;this.on("vasterror",function(ac,aa,Z,ab){this.is_error=true});this.parse(Y)}U.prototype=u(Object.create(CustomObject),{parse:function(Z){var X=this;var Y={type:Z.getAttribute("type"),src:Z.textContent.trim(),creative:this.creative};this.is_vpaid=this.is_vpaid||(Z.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";if(this.is_vpaid){this.media=new B(Y)}else{this.media=new I(Y)}this.media.proxy(["vastevent","vasterror","vpaidevent","done","start"],X)},getIsSupport:function(){return this.media.getIsSupport()},show:function(Y,aa,X,Z){this.media.show(Y,aa,X,Z)}});function T(Z,Y){this.place=null;this.width;this.height;this.player_options={};this.vpaid_options={};u(this,Y);this.width=this.width||this.place.offsetWidth;this.height=this.height||this.place.offsetHeight;this.id;this.skipoffset=null;this.sequence=1;this.is_vpaid=false;this.click_through=null;this.params={};this.tracking={};this.medias=[];this.is_ready=false;this.is_error=false;this.is_done=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ae,ab,aa,ac){this.is_error=true;this.place.innerHTML="";this.trigger("error")});this.on("vastevent",function(ae,ab,aa,ac){switch(ab){case"clickthru":if(!aa.no_fire_pixel){V(aa.click_through)}break;case"skip":case"complete":this.trigger("done");break}N(this.tracking[ab])});this.on("start",function(aa){X.trigger("linearstart",X)});this.on("done",function(){this.is_done=true});var X=this;setTimeout(function(){X.parse(Z)},0)}T.prototype=u(Object.create(CustomObject),{parse:function(Y){var X=this;this.id=Y.getAttribute("id")||null;this.sequence=parseInt(Y.getAttribute("sequence"))||1;this.is_vpaid=(Y.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";this.tracking=G(Y.getElementsByTagName("TrackingEvents")[0]);if(ad_parameters_xml=Y.getElementsByTagName("AdParameters")[0]){this.params.AdParameters=ad_parameters_xml.textContent.trim()}if(skipoffset_attr=Y.getAttribute("skipoffset")){this.skipoffset=L(skipoffset_attr)}if(clicks_xml=Y.getElementsByTagName("VideoClicks")[0]){if(through_xml=clicks_xml.getElementsByTagName("ClickThrough")[0]){this.click_through=through_xml.textContent.trim()}if(click_tracking_xml=Y.getElementsByTagName("ClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent.trim()})}}w(Y.getElementsByTagName("MediaFile"),function(Z){var aa=new U(Z,{is_vpaid:X.is_vpaid,creative:X});aa.proxy(["vasterror","vastevent","start"],X);X.medias.push(aa)});this.trigger("ready")},show:function(){var X=this;if(this.medias.length){for(var Y=0;Y<this.medias.length;Y++){var aa=this.medias[Y];if(aa.getIsSupport()){this.media=aa;break}}if(this.media){var Z=g('<div style="position:absolute; width:100%; height:100%; top:0; background:black"></div>');X.place.appendChild(Z);this.on("done",function(){X.place.removeChild(Z)});if(this.media.is_vpaid){this.media.show(Z,X.width,X.height,X.vpaid_options)}else{this.media.show(Z,X.width,X.height,X.player_options)}}else{this.trigger("vasterror",403,"Couldn't find MediaFile that is supported by this video player, based on the attributes of the MediaFile element.",this)}}else{this.trigger("vasterror",400,"General Linear error. Video player is unable to display the Linear Ad.",this)}},play:function(){this.media.media.player.play()},pause:function(){this.media.media.player.pause()},skip:function(){this.trigger("vastevent","skip",{},this)},clickthru:function(X){this.trigger("vastevent","clickthru",{click_through:X},this)},setVolume:function(X){this.media.media.player.setVolume(X)},mute:function(){this.media.media.player.mute()},unmute:function(){this.media.media.player.unmute()}});function P(X){this.place;this.elm;this.width;this.height;this.is_vpaid=false;this.min_duration;this.resource;this.click_through;this.tracking=[];this.can_show=false;this.is_error=false;this.on("vasterror",function(ab,Z,Y,aa){this.is_error=true});this.on("vastevent",function(ab,Z,Y,aa){if(Z=="clickthru"){V(Y.click_through)}N(this.tracking[Z])});this.parse(X)}P.prototype=u(Object.create(CustomObject),{parse:function(X){this.is_vpaid=(X.getAttribute("apiFramework")||"").toLowerCase()=="vpaid";this.width=X.getAttribute("width")||0;this.height=X.getAttribute("height")||0;this.tracking=G(X.getElementsByTagName("TrackingEvents")[0]);if(min_duration=X.getAttribute("minSuggestedDuration")){if(m=/^(\d{1,2}):(\d{1,2}):(\d{1,2})/.exec(min_duration)){this.min_duration=parseInt(m[1])*3600+parseInt(m[2])*60+parseInt(m[3])}}if(click_through_xml=X.getElementsByTagName("NonLinearClickThrough")[0]){this.click_through=click_through_xml.textContent}if(click_tracking_xml=X.getElementsByTagName("NonLinearClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent})}if(!this.resource&&(static_xml=X.getElementsByTagName("StaticResource")[0])){var Y=static_xml.getAttribute("creativeType");if(this.supportMedia(Y)){this.resource={type:Y,src:static_xml.textContent.trim()}}}if(!this.resource&&(iframe_xml=X.getElementsByTagName("IFrameResource")[0])){this.resource={type:"iframe",src:iframe_xml.textContent.trim()}}if(!this.resource&&(html_xml=X.getElementsByTagName("HTMLResource")[0])){this.resource={type:"html",src:html_xml.textContent.trim()}}this.can_show=!!this.resource},show:function(Y){var aa=this;this.place=Y;this.elm=g('<div class="nonlinear"><div class="close">x</div><div class="inner"></div></div>');var ab=this.elm.getElementsByClassName("close")[0];var Z=this.elm.getElementsByClassName("inner")[0];this.elm.style.width=this.width+"px";this.elm.style.height=this.height+"px";this.elm.style.right="10px";this.elm.style.bottom="70px";var X=R(this.resource.type,this.resource.src);Z.appendChild(X);if(this.click_through){f(this.elm,"click",function(){aa.trigger("vastevent","clickthru",{click_through:aa.click_through},aa)})}if(this.min_duration){ab.style.display="none";setTimeout(function(){ab.style.display=""},this.min_duration*1000)}f(ab,"click",function(){aa.close();return false});this.place.appendChild(this.elm);this.trigger("vastevent","creativeView",{},this)},close:function(){this.trigger("vastevent","collapse",{},this);this.trigger("vastevent","close",{},this);this.place.removeChild(this.elm)},supportMedia:function(X){return X!="application/x-shockwave-flash"||v()}});function M(Z,Y){this.place=null;u(this,Y);this.sequence;this.required;this.banners=[];this.is_ready=false;this.is_error=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ae,ab,aa,ac){this.is_error=true});var X=this;setTimeout(function(){X.parse(Z)},0)}M.prototype=u(Object.create(CustomObject),{parse:function(Y){var X=this;this.sequence=parseInt(Y.getAttribute("sequence"))||1;w(Y.getElementsByTagName("NonLinear"),function(Z){var aa=new P(Z);aa.proxy(["vasterror","vastevent"],X);X.banners.push(aa)});this.trigger("ready")},show:function(){var Y=this;if(this.banners.length==0){Y.trigger("vasterror",500,"General NonLinearAds error",Y);return}var X=0;(function(){var Z=arguments.callee;if(banner=Y.banners[X]){if(banner.can_show){banner.on("close",function(){X++;Z()});banner.show(Y.place)}else{Y.trigger("vasterror",503,"Couldn’t find NonLinear resource with supported type.",Y);X++;Z()}}else{}})()}});function O(X){this.place;this.width;this.height;this.resource;this.click_through;this.tracking=[];this.is_error=false;this.on("vasterror",function(ab,Z,Y,aa){this.is_error=true});this.on("vastevent",function(ab,Z,Y,aa){if(Z=="clickthru"){V(Y.click_through)}N(this.tracking[Z])});this.parse(X)}O.prototype=u(Object.create(CustomObject),{parse:function(X){this.width=X.getAttribute("width")||0;this.height=X.getAttribute("height")||0;this.tracking=G(X.getElementsByTagName("TrackingEvents")[0]);if(through_xml=X.getElementsByTagName("CompanionClickThrough")[0]){this.click_through=through_xml.textContent}if(click_tracking_xml=X.getElementsByTagName("CompanionClickTracking")[0]){this.tracking.clickthru=this.tracking.clickthru||[];this.tracking.clickthru.push({event:"clickthru",content:click_tracking_xml.textContent})}if(!this.resource&&(static_xml=X.getElementsByTagName("StaticResource")[0])){var Y=static_xml.getAttribute("creativeType");if(this.supportMedia(Y)){this.resource={type:Y,src:static_xml.textContent.trim()}}}if(!this.resource&&(iframe_xml=X.getElementsByTagName("IFrameResource")[0])){this.resource={type:"iframe",src:iframe_xml.textContent.trim()}}if(!this.resource&&(html_xml=X.getElementsByTagName("HTMLResource")[0])){this.resource={type:"html",src:html_xml.textContent.trim()}}if(this.resource&&(ad_slot_id=X.getAttribute("adSlotID"))){if(custom_place=document.getElementById(ad_slot_id)){if(this.width==custom_place.offsetWidth&&this.height==custom_place.offsetHeight){this.place=custom_place}}}},show:function(){var X=this;var Y=R(this.resource.type,this.resource.src);Y.width=this.width;Y.height=this.height;if(this.click_through){Y.style.cursor="pointer";f(Y,"click",function(){X.trigger("vastevent","clickthru",{click_through:X.click_through},X)})}this.place.innerHTML="";this.place.appendChild(Y);X.trigger("vastevent","creativeView",{},this)},supportMedia:function(X){return X!="application/x-shockwave-flash"||v()}});function H(Z,Y){this.places=[];u(this,Y);this.sequence;this.required;this.banners=[];this.is_ready=false;this.is_error=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ae,ab,aa,ac){this.is_error=true});var X=this;setTimeout(function(){X.parse(Z)},0)}H.prototype=u(Object.create(CustomObject),{parse:function(Y){var X=this;this.sequence=parseInt(Y.getAttribute("sequence"))||1;this.required=Y.getAttribute("required")||"any";if(this.required!="none"){w(Y.getElementsByTagName("Companion"),function(Z){var aa=new O(Z);aa.proxy(["vasterror","vastevent"],X);X.banners.push(aa)})}this.trigger("ready")},show:function(){var X=this;if(this.required!="none"){var Y=[];var Z=[];w(this.places,function(aa){if(elm=document.getElementById(aa.id)){Y.push(aa.width+"x"+aa.height);Z.push(elm)}});w(this.banners,function(aa){if(aa.place){if((i=Z.indexOf(aa.place))>-1){Y[i]=null}}else{if((i=Y.indexOf(aa.width+"x"+aa.height))>-1){Y[i]=null;aa.place=Z[i]}}if(aa.place){aa.show()}else{X.trigger("vasterror",601,"Unable to display Companion because creative dimensions do not fit within Companion display area (i.e., no available space).",aa);if(X.required=="all"){X.trigger("vasterror",602,"Unable to display Required Companion",X);return false}}})}}});function Q(Z,Y){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};u(this,Y);this.type;this.creative;this.tracking={};this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.on("ready",function(){this.is_ready=true});this.on("vasterror",function(ae,ab,aa,ac){this.is_error=true});this.on("vastevent",function(ae,ab,aa,ac){N(this.tracking[ab])});this.on("lineardone",function(){this.is_linear_done=true});var X=this;setTimeout(function(){X.parse(Z)},0)}Q.prototype=u(Object.create(CustomObject),{parse:function(Y){var X=this;this.id=Y.getAttribute("id")||null;this.tracking=G(creatives_xml.getElementsByTagName("TrackingEvents")[0]);if(linear_xml=Y.getElementsByTagName("Linear")[0]){this.type="linear";this.creative=new T(linear_xml,this.linear_options);this.creative.on(["done","error"],function(){setTimeout(function(){X.trigger("lineardone")},0)})}else{if(nonlinear_xml=Y.getElementsByTagName("NonLinearAds")[0]){this.type="nonlinear";this.creative=new M(nonlinear_xml,this.nonlinear_options)}else{if(companion_xml=Y.getElementsByTagName("CompanionAds")[0]){this.type="companion";this.creative=new H(companion_xml,this.companion_options)}else{this.trigger("vasterror",0,"",this);return}}}this.creative.parent=this;this.creative.proxy(["ready","vasterror","vastevent","linearstart"],X)},show:function(){var X=this;switch(this.type){case"linear":this.creative.show();break;case"nonlinear":this.creative.show();break;case"companion":this.creative.show();break}}});function J(Z,Y){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};u(this,Y);this.error_url;this.impression_url;this.tracking={};this.creatives=[];this.linear=[];this.nonlinear=[];this.companion=[];this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});this.on("vastevent",function(ae,ab,aa,ac){if(ab=="creativeView"){ae.handler.remove();if(this.impression_url){K(this.impression_url);this.trigger("vastevent","impression",{url:this.impression_url},this)}}});this.on("vasterror",function(ae,ab,aa,ac){if(this.error_url){K(this.error_url,{ERRORCODE:ab})}});var X=this;setTimeout(function(){X.parse(Z)},0)}J.prototype=u(Object.create(CustomObject),{parse:function(Z){var X=this;if(error_xml=Z.getElementsByTagName("Error")[0]){this.error_url=error_xml.textContent.trim()}if(impression_xml=Z.getElementsByTagName("Impression")[0]){this.impression_url=impression_xml.textContent.trim()}if(creatives_xml=Z.getElementsByTagName("Creatives")[0]){var Y={parent:X,linear_options:X.linear_options,nonlinear_options:X.nonlinear_options,companion_options:X.companion_options};w(creatives_xml.getElementsByTagName("Creative"),function(ab){var aa=new Q(ab,Y);X.creatives.push(aa);aa.on("ready",function(){if(aa.type=="linear"){X.linear.push(aa)}if(aa.type=="nonlinear"){X.nonlinear.push(aa)}if(aa.type=="companion"){X.companion.push(aa)}if(z(X.creatives,function(ac){return ac.is_ready||ac.is_error})){X.trigger("ready")}});aa.proxy(["vasterror","vastevent","linearstart"],X)});this.linear.sort(function(ab,aa){return ab.sequence-aa.sequence});this.nonlinear.sort(function(ab,aa){return ab.sequence-aa.sequence});this.companion.sort(function(ab,aa){return ab.sequence-aa.sequence})}},start:function(){var X=this;this.on("lineardone",function(){X.startNonLinear()});this.startCompanion();this.startLinear()},startLinear:function(){var Y=this;var X=0;(function(){var Z=arguments.callee;if(creative=Y.linear[X]){creative.on("lineardone",function(){X++;Z()});creative.show()}else{Y.trigger("lineardone")}})()},startNonLinear:function(){w(this.nonlinear,function(X){X.show()})},startCompanion:function(){w(this.companion,function(X){X.show()})}});function S(Z,Y){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};u(this,Y);this.vast;this.error_url;this.impression_url;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});this.on("vastevent",function(ae,ab,aa,ac){if(ab=="creativeView"){ae.handler.remove();if(this.impression_url){K(this.impression_url);this.trigger("vastevent","impression",{url:this.impression_url},this)}}});this.on("vasterror",function(ae,ab,aa,ac){if(this.error_url){K(this.error_url,{ERRORCODE:ab})}});var X=this;setTimeout(function(){X.parse(Z)},0)}S.prototype=u(Object.create(CustomObject),{parse:function(Z){var X=this;var Y=Z.getElementsByTagName("VASTAdTagURI")[0].textContent;if(error_xml=Z.getElementsByTagName("Error")[0]){this.error_url=error_xml.textContent.trim()}if(impression_xml=Z.getElementsByTagName("Impression")[0]){this.impression_url=impression_xml.textContent.trim()}this.vast=new E(Y,{parent:this,linear_options:this.linear_options,nonlinear_options:this.nonlinear_options,companion_options:this.companion_options});this.vast.proxy(["ready","error","lineardone","vasterror","vastevent","linearstart"],X)},start:function(){this.vast.start()},startLinear:function(){this.vast.startLinear()},startCompanion:function(){this.vast.startCompanion()},startNonLinear:function(){this.vast.startNonLinear()}});function W(Z,Y){this.parent=null;this.linear_options={};this.nonlinear_options={};this.companion_options={};u(this,Y);this.id;this.sequence;this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.is_wrapper=false;this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true});var X=this;setTimeout(function(){X.parse(Z)},0)}W.prototype=u(Object.create(CustomObject),{parse:function(Z){var X=this;this.id=Z.getAttribute("id")||null;this.sequence=parseInt(Z.getAttribute("sequence"))||1;var Y={parent:this,linear_options:X.linear_options,nonlinear_options:X.nonlinear_options,companion_options:X.companion_options};if(wrapper_xml=Z.getElementsByTagName("Wrapper")[0]){this.inline=new S(wrapper_xml,Y)}else{if(inline_xml=Z.getElementsByTagName("InLine")[0]){this.inline=new J(inline_xml,Y)}else{this.trigger("error")}}this.inline.proxy(["ready","linearstart","lineardone","error","vastevent","vasterror"],X)},start:function(){this.inline.start()},startLinear:function(){this.inline.startLinear()},startCompanion:function(){this.inline.startCompanion()},startNonLinear:function(){this.inline.startNonLinear()}});function E(Z,Y){var X=this;this.parent=null;this.timeout=5000;this.linear_options={player_options:{},vpaid_options:{timeout:10000}};this.nonlinear_options={};this.companion_options={};u(this,Y);this.url=Z;this.ads=[];this.is_ready=false;this.is_error=false;this.is_linear_done=false;this.load(Z);this.on("ready",function(){this.is_ready=true});this.on("error",function(){this.is_error=true});this.on("lineardone",function(){this.is_linear_done=true})}E.prototype=u(Object.create(CustomObject),{load:function(Y){var X=this;var aa=null;var Z=setTimeout(function(){X.trigger("error",301,"Timeout of VAST URI provided in Wrapper element");aa.abort()},this.timeout);aa=e(Y,function(ac,ab){clearTimeout(Z);if(ac){if(!ab.responseXML||!ab.responseXML.documentElement){X.trigger("error",100,"XML parsing error");return}w(ab.responseXML.documentElement.getElementsByTagName("Ad"),function(ae){var af=new W(ae,{parent:X,linear_options:X.linear_options,nonlinear_options:X.nonlinear_options,companion_options:X.companion_options});af.on("ready",function(){if(z(X.ads,function(ag){return ag.is_ready||ag.is_error})){X.trigger("ready")}});af.proxy(["linearstart","vastevent","vasterror","error"],X);X.ads.push(af)});if(X.ads.length){X.ads.sort(function(af,ae){return af.sequence-ae.sequence})}else{X.trigger("error")}}else{X.trigger("error")}})},start:function(){var X=this;this.on("lineardone",function(){X.startNonLinear()});this.startCompanion();this.startLinear()},startLinear:function(){var Y=this;var X=0;(function(){var Z=arguments.callee;if(ad=Y.ads[X]){ad.on("lineardone",function(){X++;Z()});ad.startLinear()}else{if(!Y.is_linear_done){Y.trigger("lineardone")}}})()},startCompanion:function(){w(this.ads,function(X){X.startCompanion()})},startNonLinear:function(){w(this.ads,function(X){X.startNonLinear()})}});(function(){var X=document.createElement("STYLE");X.innerHTML=".Ad {position: absolute;width: 100%;height: 100%;top: 0;z-index: 1000;}.Ad .ad-info {position: absolute;right: 5px;vertical-align: middle;top: 10px;color: #fff;font-size: 13pt;z-index: 10;background: rgba(0,0,0,0.5);padding: 5px 10px;}.Ad .ad-info .ad-link{color: #fff;border-bottom: 1px dashed #fff;text-decoration: none;cursor: pointer;}.Ad .ad-skip {position: absolute;display: table;right: 5px;bottom: 70px;padding: 5px;background: rgba(0,0,0,0.4);cursor: pointer;z-index: 10;}.Ad .ad-skip  > .message {display: table-cell;color: #fff;vertical-align: middle;text-align: center;font-size: 12pt;padding-right: 10px;}.Ad .ad-skip > img {display: table-cell;height: 60px;}.customPlayer > .nonlinear {position: absolute;z-index: 1000;}.customPlayer > .nonlinear .close {position: absolute;right: 0;top: 0;width: 15px;height: 15px;cursor: pointer;color: red;z-index: 1;text-align: center;}.customPlayer > .nonlinear .close:hover {text-decoration: underline;}.customPlayer > .nonlinear .inner {position: absolute;left: 0;top: 0;cursor: pointer;}";document.head.appendChild(X)})();function F(Y,X){this.click_through=null;this.skipoffset=null;u(this,X);this.player=Y;this.info=g('<div class="ad-info"><span><span class="ad-link">Visit advertiser\'s site</span><span style="margin:0 10px">&bull;</span></span><span class="timer"></span></div>');this.skip=g('<div class="ad-skip"><div class="message"></div></div>');this.ctrl=new n(Y,{progress:{readonly:true},timer:{show:false}});this.ctrl.proxy(["play","pause","volumechange","mute","unmute"],this);this.init()}F.prototype=u(Object.create(CustomObject),{getElement:function(){return this.ctrl.getElement()},init:function(){var Y=this;var Z=this.player;var af=this.info.getElementsByClassName("timer")[0];var ac=this.info.firstChild;var ab=this.skip;var X=this.ctrl.getElement();X.appendChild(this.info);X.appendChild(this.skip);Z.on("timeupdate",function(ag,ah){af.innerHTML="Ad. "+Y.ctrl.formatTime(Y.ctrl.duration-ah)});if(this.click_through){f(ac,"click",function(){Y.trigger("clickthru",Y.click_through);return false})}else{ac.style.display="none"}if(this.skipoffset){var ae=null;if(this.skipoffset.type=="seconds"){ae=this.skipoffset.value}if(this.skipoffset.type=="percent"){ae=Y.ctrl.duration/100*this.skipoffset.value}if(ae){var aa=ab.getElementsByClassName("message")[0];Z.on("timeupdate",function(ag,ah){if(ah>ae){ag.handler.remove();aa.innerHTML="Skip to video";f(ab,"click",function(ai){Y.trigger("skip");return false})}else{aa.innerHTML="You can skip<br>to video<br>in "+parseInt(ae-ah)}})}}else{ab.style.display="none"}}});function C(Z,Y){var X=this;this.player=Z;this.conf={vpaid_flash_bridge:"vpaid_bridge.swf",schedule:[],companion_places:[],onvastevent:function(){},onvasterror:function(){}};q(this.conf,Y);this.queue=[];w(this.conf.schedule,function(ab){var ab=q({offset:"pre",tag:null,onvastevent:function(){},onvasterror:function(){}},ab);if(typeof ab.tag==="function"){ab.tag=ab.tag()}if(ab.offset=="pre"){X.player.on("play",function(ae){ae.handler.remove();X.processVast(ab)})}if(ab.offset=="post"){X.player.on("timeupdate",function(ae,af){if((X.player.getDuration()-af)<=2){ae.handler.remove();X.processVast(ab)}})}if(m=/^(\d+)$/.exec(ab.offset)){var aa=m[1]|0;X.player.on("timeupdate",function(ae,af){if(af>aa){ae.handler.remove();X.processVast(ab)}})}if(m=/^(\d+)%$/.exec(ab.offset)){var ac=m[1]|0;X.player.on("timeupdate",function(ae){if(X.player.getProgress()>ac){ae.handler.remove();X.processVast(ab)}})}})}C.prototype={processVast:function(Z){var X=this;var Y=g('<div class="Ad"></div>');this.player.root.appendChild(Y);var aa=new E(Z.tag,{linear_options:{place:Y,player_options:{cookieKeyVolume:this.player.conf.cookieKeyVolume,flash_swf:this.player.conf.flash_swf,plugins:{BigMode:this.player.conf.plugins.BigMode}},vpaid_options:{vpaid_flash_bridge:X.conf.vpaid_flash_bridge}},nonlinear_options:{place:this.player.root},companion_options:{places:this.conf.companion_places}});aa.on("vasterror",function(ab){console.error("vast",arguments);X.conf.onvasterror();Z.onvasterror()});aa.on("vastevent",function(af,ab,ac,ae){X.conf.onvastevent(ab,ac,ae);Z.onvastevent(ab,ac,ae)});aa.on("ready",function(){if(X.queue[0]==this){this.start()}});aa.on("linearstart",function(ac,ab){X.initControls(ab)});aa.on("lineardone",function(){X.queue.shift();if(X.queue.length==0){X.player.trigger("vast_linear_ad_done");X.player.play();X.player.root.removeChild(Y)}else{if(X.queue[0].is_ready){X.queue[0].start()}}});aa.on("error",function(af,ac,ab,ae){console.error(ac,ab,ae);this.trigger("lineardone")});if(this.queue.length==0){this.player.pause();X.player.trigger("vast_start_ad")}this.queue.push(aa)},initControls:function(X){var Z=this;if(!X.is_vpaid){var aa=X.media.media.player;var Y=new F(aa,{click_through:X.click_through,skipoffset:X.skipoffset});Y.on(["play","pause","skip","mute","unmute"],function(ab){X[ab.type]()});Y.on("clickthru",function(ac,ab){X.clickthru(ab)});Y.on("volumechange",function(ac,ab){X.setVolume(ab);Z.player.setVolume(ab)});aa.root.appendChild(Y.getElement())}}};return C})();x.prototype.__plugins.VAST=VASTPlugin;function t(D,C){this.player=D;this.conf={hq:false};q(this.conf,C);this.can_hq=false;this.hq=!!this.conf.hq;this.btn=g('<div class="hq" style="width: 32px;"><svg><path transform="translate(-104, 0)" d="M114.1,3.7h3.7v13.6h-3.7v-5.5h-4.3v5.5h-3.7V3.7h3.7v5h4.3V3.7z M133.8,20.5h-4.6l-2.4-3l0,0v0l0,0c-2.1,0-3.8-0.6-4.9-1.8c-1.1-1.2-1.7-2.9-1.7-5.2c0-2.3,0.6-4,1.7-5.2c1.1-1.2,2.8-1.8,4.9-1.8c2.2,0,3.8,0.6,4.9,1.8c1.1,1.2,1.7,2.9,1.7,5.2c0,3.1-1,5.1-2.9,6.2L133.8,20.5z M129.6,10.5c0-1.4-0.2-2.4-0.7-3c-0.5-0.6-1.1-1-2-1c-1.8,0-2.8,1.3-2.8,4c0,2.6,0.9,3.9,2.7,3.9c0.9,0,1.6-0.3,2.1-1C129.3,12.8,129.6,11.8,129.6,10.5z"/></svg></div>');var B=this;this.player.on("tray_ready",function(F,E){if(E.lastChild&&E.lastChild.className=="fullscreen"){E.insertBefore(B.getUI(),E.lastChild)}else{E.appendChild(B.getUI())}});this.init()}t.prototype={init:function(){var B=this;this.origin_setSources=this.player.setSources;this.player.setSources=this.setSources.bind(this);f(this.btn,"click",function(){B.setHQ(!B.hq)})},getUI:function(){return this.btn},setSources:function(C){var B=this;this.sources=C;w(C,function(D){B.can_hq=B.can_hq||D.hq});this.setHQ(this.can_hq?this.hq:false);this.player},setHQ:function(B){this.hq=!!B;if(this.can_hq){this.btn.style.display=null}else{this.btn.style.display="none"}if(this.hq){this.btn.style.opacity=1}else{this.btn.style.opacity=0.5}this.applySourceHQ(B)},applySourceHQ:function(){var C=this;var B=this.sources.filter(function(F){return typeof F.hq==="undefined"||F.hq==C.hq});if(this.player.is_start_load){var E=this.player.is_playing;var D=this.player.getProgress();this.player.on("canplay",function(F){F.handler.remove();this.setProgress(D);if(E){this.play()}});this.origin_setSources.call(this.player,B);this.player.load()}else{this.origin_setSources.call(this.player,B)}}};x.prototype.__plugins.HQ=t;function a(D,C){var B=this;this.player=D;this.conf={bigClass:"big",target:document.body};q(this.conf,C);this.can_hq=false;this.hq=!!this.conf.hq;this.btn=g('<div class="big"><svg><path d="M22,11.4l-3-3l-3.1,3.1l-3.3-3.3L15.7,5l-3-3H22V11.4z M8.3,19l3,3H2v-9.4l3,3l3.2-3.2l3.3,3.3L8.3,19z"/><path d="M12.5,2.1l3,3L18.7,2L22,5.3l-3.1,3.1l3,3h-9.4V2.1z M5.2,15.5l-3-3h9.4v9.4l-3-3L5.3,22L2,18.7L5.2,15.5z"/></svg></div>');this.player.on("tray_ready",function(F,E){if(E.lastChild&&E.lastChild.className=="fullscreen"){E.insertBefore(this.btn,E.lastChild)}else{E.appendChild(this.btn)}var G=this.btn.getElementsByTagName("path");if(b(B.conf.target,B.conf.bigClass)){G[0].style.display="none";G[1].style.display=""}else{G[1].style.display="none";G[0].style.display=""}f(this.btn,"click",function(){if(b(B.conf.target,B.conf.bigClass)){l(B.conf.target,B.conf.bigClass);G[1].style.display="none";G[0].style.display=""}else{j(B.conf.target,B.conf.bigClass);G[0].style.display="none";G[1].style.display=""}})},this)}x.prototype.__plugins.BigMode=a;return function(B,C){var C=u({allow_backends:["HTML5","Flash"],controls:{}},C);var D=new x(B,C);if(C.controls){if(d().is_mobile){D.conf.backend_options.poster=C.poster;D.conf.backend_options.useDefaultControls=true;D.load()}else{var E=new n(D,q({poster:C.poster},C.controls));E.on(["play","pause","mute","unmute"],function(F){D[F.type]()});E.on("fullscreentoggle",function(){var F=D._plugins.FullScreen;if(F.is_fullscreen){F.exitFullscreen()}else{F.requestFullscreen()}});E.on("exitfullscreen",function(){D._plugins.FullScreen.exitFullscreen()});E.on("positionchange",function(G,F){D.setProgress(F*100)});E.on("volumechange",function(G,F){D.setVolume(F)});B.appendChild(E.getElement())}}return D}})();